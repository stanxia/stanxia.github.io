<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="东篱下" type="application/atom+xml" />






<meta name="description" content="采菊东篱下，悠然见南山">
<meta property="og:type" content="website">
<meta property="og:title" content="东篱下">
<meta property="og:url" content="https://stanxia.github.io/index.html">
<meta property="og:site_name" content="东篱下">
<meta property="og:description" content="采菊东篱下，悠然见南山">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="东篱下">
<meta name="twitter:description" content="采菊东篱下，悠然见南山">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://stanxia.github.io/"/>





  <title>东篱下</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">东篱下</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">斯坦@森</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/08/23/spark光速入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/23/spark光速入门/" itemprop="url">spark光速入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-23T22:00:09+08:00">
                2017-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spark/" itemprop="url" rel="index">
                    <span itemprop="name">Spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><h1 id="最全的Spark基础知识解答"><a href="#最全的Spark基础知识解答" class="headerlink" title="最全的Spark基础知识解答"></a>最全的Spark基础知识解答</h1><h2 id="一-Spark基础知识"><a href="#一-Spark基础知识" class="headerlink" title="一. Spark基础知识"></a>一. Spark基础知识</h2><h3 id="1-Spark是什么"><a href="#1-Spark是什么" class="headerlink" title="1.Spark是什么?"></a>1.Spark是什么?</h3><p>UCBerkeley AMPlab所开源的类HadoopMapReduce的通用的并行计算框架</p>
<p>dfsSpark基于mapreduce算法实现的分布式计算，拥有HadoopMapReduce所具有的优点;但不同于MapReduce的是Job中间输出和结果可以保存在内存中，从而不再需要读写HDFS，因此Spark能更好地适用于数据挖掘与机器学习等需要迭代的map reduce的算法。</p>
<h3 id="2-Spark与Hadoop的对比-Spark的优势"><a href="#2-Spark与Hadoop的对比-Spark的优势" class="headerlink" title="2.Spark与Hadoop的对比(Spark的优势)"></a>2.Spark与Hadoop的对比(Spark的优势)</h3><p>1、Spark的中间数据放到内存中，对于迭代运算效率更高</p>
<p>2、Spark比Hadoop更通用</p>
<p>3、Spark提供了统一的编程接口</p>
<p>4、容错性– 在分布式数据集计算时通过checkpoint来实现容错</p>
<p>5、可用性– Spark通过提供丰富的Scala, Java，Python API及交互式Shell来提高可用性</p>
<h3 id="3-Spark有那些组件"><a href="#3-Spark有那些组件" class="headerlink" title="3.Spark有那些组件"></a>3.Spark有那些组件</h3><p>1、Spark Streaming：支持高吞吐量、支持容错的实时流数据处理</p>
<p>2、Spark SQL， Data frames: 结构化数据查询</p>
<p>3、MLLib：Spark 生态系统里用来解决大数据机器学习问题的模块</p>
<p>4、GraphX是构建于Spark上的图计算模型</p>
<p>5、SparkR是一个R语言包，它提供了轻量级的方式使得可以在R语言中使用 Spark</p>
<h2 id="二-DataFrame相关知识点"><a href="#二-DataFrame相关知识点" class="headerlink" title="二. DataFrame相关知识点"></a>二. DataFrame相关知识点</h2><h3 id="1-DataFrame是什么"><a href="#1-DataFrame是什么" class="headerlink" title="1.DataFrame是什么?"></a>1.DataFrame是什么?</h3><p>DataFrame是一种以RDD为基础的分布式数据集，类似于传统数据库中的二维表格。</p>
<h3 id="2-DataFrame与RDD的主要区别在于"><a href="#2-DataFrame与RDD的主要区别在于" class="headerlink" title="2.DataFrame与RDD的主要区别在于?"></a>2.DataFrame与RDD的主要区别在于?</h3><p>DataFrame带有schema元信息，即DataFrame所表示的二维表数据集的每一列都带有名称和类型。这使得SparkSQL得以洞察更多的结构信息，从而对藏于DataFrame背后的数据源以及作用于DataFrame之上的变换进行了针对性的优化，最终达到大幅提升运行时效率的目标。反观RDD，由于无从得知所存数据元素的具体内部结构，Spark Core只能在stage层面进行简单、通用的流水线优化。</p>
<h3 id="3-DataFrame-特性"><a href="#3-DataFrame-特性" class="headerlink" title="3.DataFrame 特性"></a>3.DataFrame 特性</h3><p>1、支持从KB到PB级的数据量</p>
<p>2、支持多种数据格式和多种存储系统</p>
<p>3、通过Catalyst优化器进行先进的优化生成代码</p>
<p>4、通过Spark无缝集成主流大数据工具与基础设施</p>
<p>5、API支持Python、Java、Scala和R语言</p>
<h2 id="三-RDD相关知识点"><a href="#三-RDD相关知识点" class="headerlink" title="三 .RDD相关知识点"></a>三 .RDD相关知识点</h2><h3 id="1-RDD，全称为"><a href="#1-RDD，全称为" class="headerlink" title="1.RDD，全称为?"></a>1.RDD，全称为?</h3><p>Resilient Distributed Datasets，意为容错的、并行的数据结构，可以让用户显式地将数据存储到磁盘和内存中，并能控制数据的分区。同时，RDD还提供了一组丰富的操作来操作这些数据。</p>
<h3 id="2-RDD的特点"><a href="#2-RDD的特点" class="headerlink" title="2.RDD的特点?"></a>2.RDD的特点?</h3><p>它是在集群节点上的不可变的、已分区的集合对象。<br>通过并行转换的方式来创建如(map, filter, join, etc)。<br>失败自动重建。<br>可以控制存储级别(内存、磁盘等)来进行重用。<br>必须是可序列化的。<br>是静态类型的。</p>
<h3 id="3-RDD核心概念"><a href="#3-RDD核心概念" class="headerlink" title="3.RDD核心概念"></a>3.RDD核心概念</h3><p>Client：客户端进程，负责提交作业到Master。</p>
<p>Master:Standalone模式中主控节点，负责接收Client提交的作业，管理Worker，并命令Worker启动分配Driver的资源和启动Executor的资源。</p>
<p>Worker：Standalone模式中slave节点上的守护进程，负责管理本节点的资源，定期向Master汇报心跳，接收Master的命令，启动Driver和Executor。</p>
<p>Driver： 一个Spark作业运行时包括一个Driver进程，也是作业的主进程，负责作业的解析、生成Stage并调度Task到Executor上。包括DAGScheduler，TaskScheduler。</p>
<p>Executor：即真正执行作业的地方，一个集群一般包含多个Executor，每个Executor接收Driver的命令Launch Task，一个Executor可以执行一到多个Task。</p>
<h3 id="4-RDD常见术语"><a href="#4-RDD常见术语" class="headerlink" title="4.RDD常见术语"></a>4.RDD常见术语</h3><p>DAGScheduler： 实现将Spark作业分解成一到多个Stage，每个Stage根据RDD的Partition个数决定Task的个数，然后生成相应的Task set放到TaskScheduler中。</p>
<p>TaskScheduler：实现Task分配到Executor上执行。</p>
<p>Task：运行在Executor上的工作单元</p>
<p>Job：SparkContext提交的具体Action操作，常和Action对应</p>
<p>Stage：每个Job会被拆分很多组任务(task)，每组任务被称为Stage，也称TaskSet</p>
<p>RDD：Resilient Distributed Datasets的简称，弹性分布式数据集，是Spark最核心的模块和类</p>
<p>Transformation/Action：SparkAPI的两种类型;Transformation返回值还是一个RDD，Action返回值不少一个RDD，而是一个Scala的集合;所有的Transformation都是采用的懒策略，如果只是将Transformation提交是不会执行计算的，计算只有在Action被提交时才会被触发。</p>
<p>DataFrame： 带有Schema信息的RDD，主要是对结构化数据的高度抽象。</p>
<p>DataSet：结合了DataFrame和RDD两者的优势，既允许用户很方便的操作领域对象，又具有SQL执行引擎的高效表现。</p>
<h3 id="5-RDD提供了两种类型的操作："><a href="#5-RDD提供了两种类型的操作：" class="headerlink" title="5.RDD提供了两种类型的操作："></a>5.RDD提供了两种类型的操作：</h3><p>transformation和action</p>
<p>1，transformation是得到一个新的RDD，方式很多，比如从数据源生成一个新的RDD，从RDD生成一个新的RDD</p>
<p>2，action是得到一个值，或者一个结果(直接将RDD cache到内存中)</p>
<p>3，所有的transformation都是采用的懒策略，就是如果只是将transformation提交是不会执行计算的，计算只有在action被提交的时候才被触发</p>
<h3 id="6-RDD中关于转换-transformation-与动作-action-的区别"><a href="#6-RDD中关于转换-transformation-与动作-action-的区别" class="headerlink" title="6.RDD中关于转换(transformation)与动作(action)的区别"></a>6.RDD中关于转换(transformation)与动作(action)的区别</h3><p>transformation会生成新的RDD，而后者只是将RDD上某项操作的结果返回给程序，而不会生成新的RDD;无论执行了多少次transformation操作，RDD都不会真正执行运算(记录lineage)，只有当action操作被执行时，运算才会触发。</p>
<h3 id="7-RDD-与-DSM的最大不同是"><a href="#7-RDD-与-DSM的最大不同是" class="headerlink" title="7.RDD 与 DSM的最大不同是?"></a>7.RDD 与 DSM的最大不同是?</h3><p>DSM(distributed shared memory)</p>
<p>RDD只能通过粗粒度转换来创建，而DSM则允许对每个内存位置上数据的读和写。在这种定义下，DSM不仅包括了传统的共享内存系统，也包括了像提供了共享 DHT(distributed hash table) 的 Piccolo 以及分布式数据库等。</p>
<h3 id="8-RDD的优势"><a href="#8-RDD的优势" class="headerlink" title="8.RDD的优势?"></a>8.RDD的优势?</h3><p>1、高效的容错机制</p>
<p>2、结点落后问题的缓和 (mitigate straggler) ：</p>
<p>3、批量操作：</p>
<p>4、优雅降级 (degrade gracefully)</p>
<h3 id="9-如何获取RDD"><a href="#9-如何获取RDD" class="headerlink" title="9.如何获取RDD?"></a>9.如何获取RDD?</h3><p>1、从共享的文件系统获取，(如：HDFS)</p>
<p>2、通过已存在的RDD转换</p>
<p>3、将已存在scala集合(只要是Seq对象)并行化 ，通过调用SparkContext的parallelize方法实现</p>
<p>4、改变现有RDD的之久性;RDD是懒散，短暂的。</p>
<h3 id="10-RDD都需要包含以下四个部分"><a href="#10-RDD都需要包含以下四个部分" class="headerlink" title="10.RDD都需要包含以下四个部分"></a>10.RDD都需要包含以下四个部分</h3><p>a.源数据分割后的数据块，源代码中的splits变量</p>
<p>b.关于“血统”的信息，源码中的dependencies变量</p>
<p>c.一个计算函数(该RDD如何通过父RDD计算得到)，源码中的iterator(split)和compute函数</p>
<p>d.一些关于如何分块和数据存放位置的元信息，如源码中的partitioner和preferredLocations0</p>
<h3 id="11-RDD中将依赖的两种类型"><a href="#11-RDD中将依赖的两种类型" class="headerlink" title="11.RDD中将依赖的两种类型"></a>11.RDD中将依赖的两种类型</h3><p>窄依赖(narrowdependencies)和宽依赖(widedependencies)。</p>
<p>窄依赖是指父RDD的每个分区都只被子RDD的一个分区所使用。相应的，那么宽依赖就是指父RDD的分区被多个子RDD的分区所依赖。例如，map就是一种窄依赖，而join则会导致宽依赖</p>
<p>依赖关系分类的特性：</p>
<p>第一，窄依赖可以在某个计算节点上直接通过计算父RDD的某块数据计算得到子RDD对应的某块数据;</p>
<p>第二，数据丢失时，对于窄依赖只需要重新计算丢失的那一块数据来恢复;</p>
<h2 id="四-Spark-Streaming相关知识点"><a href="#四-Spark-Streaming相关知识点" class="headerlink" title="四. Spark Streaming相关知识点"></a>四. Spark Streaming相关知识点</h2><h3 id="1-Spark-Streaming的基本原理"><a href="#1-Spark-Streaming的基本原理" class="headerlink" title="1.Spark Streaming的基本原理"></a>1.Spark Streaming的基本原理</h3><p>Spark Streaming的基本原理是将输入数据流以时间片(秒级)为单位进行拆分，然后以类似批处理的方式处理每个时间片数据</p>
<h4 id="RDD-基本操作"><a href="#RDD-基本操作" class="headerlink" title="RDD 基本操作"></a>RDD 基本操作</h4><h5 id="常见的聚合操作："><a href="#常见的聚合操作：" class="headerlink" title="常见的聚合操作："></a>常见的聚合操作：</h5><p>count(*) 所有值不全为NULL时，加1操作<br>count(1) 不管有没有值，只要有这条记录，值就加1<br>count(col) col列里面的值为null，值不会加1，这个列里面的值不为NULL，才加1</p>
<p>sum求和</p>
<p>sum(可转成数字的值) 返回bigint<br>avg求平均值<br>avg(可转成数字的值)返回double<br>distinct不同值个数<br>count(distinct col)<br>按照某些字段排序</p>
<p>select col1,other… from table where conditio order by col1,col2 [asc|desc]</p>
<h5 id="Join表连接"><a href="#Join表连接" class="headerlink" title="Join表连接"></a>Join表连接</h5><p>join等值连接(内连接)，只有某个值在m和n中同时存在时。</p>
<p>left outer join 左外连接，左边表中的值无论是否在b中存在时，都输出;右边表中的值，只有在左边表中存在时才输出。</p>
<p>right outer join 和 left outer join 相反。</p>
<h5 id="Transformation具体内容："><a href="#Transformation具体内容：" class="headerlink" title="Transformation具体内容："></a>Transformation具体内容：</h5><p>reduceByKey(func, [numTasks]) : 在一个(K，V)对的数据集上使用，返回一个(K，V)对的数据集，key相同的值，都被使用指定的reduce函数聚合到一起。和groupbykey类似，任务的个数是可以通过第二个可选参数来配置的。</p>
<p>join(otherDataset, [numTasks]) :在类型为(K,V)和(K,W)类型的数据集上调用，返回一个(K,(V,W))对，每个key中的所有元素都在一起的数据集</p>
<p>groupWith(otherDataset, [numTasks]) : 在类型为(K,V)和(K,W)类型的数据集上调用，返回一个数据集，组成元素为(K, Seq[V], Seq[W]) Tuples。这个操作在其它框架，称为CoGroup</p>
<p>cartesian(otherDataset) : 笛卡尔积。但在数据集T和U上调用时，返回一个(T，U)对的数据集，所有元素交互进行笛卡尔积。</p>
<p>flatMap(func) :类似于map，但是每一个输入元素，会被映射为0到多个输出元素(因此，func函数的返回值是一个Seq，而不是单一元素)</p>
<p>Case 1将一个list乘方后输出</p>
<p>val input = sc.parallelize(List(1,2,3,4))</p>
<p>val result = input.map(x =&gt; x*x)</p>
<p>println(result.collect().mkString(“,”))</p>
<p>Case 2 wordcount</p>
<p>val textFile = sc.textFile(args(1))</p>
<p>val result = textFile.flatMap(line =&gt; line.split(“\s+”)).map(word =&gt; (word, 1)).reduceByKey(<em> + </em>)</p>
<p>println(result.collect().mkString(“,”))</p>
<p>result.saveAsTextFile(args(2))</p>
<p>Case 3 打印rdd的元素</p>
<p>rdd.foreach(println) 或者 rdd.map(println).</p>
<p>rdd.collect().foreach(println)</p>
<p>rdd.take(100).foreach(println)</p>
<p>spark SQL(待补充)</p>
<p>SQL</p>
<h4 id="Spark-Streaming优劣"><a href="#Spark-Streaming优劣" class="headerlink" title="Spark Streaming优劣"></a>Spark Streaming优劣</h4><h5 id="优势："><a href="#优势：" class="headerlink" title="优势："></a>优势：</h5><p>1、统一的开发接口</p>
<p>2、吞吐和容错</p>
<p>3、多种开发范式混用，Streaming + SQL, Streaming +MLlib</p>
<p>4、利用Spark内存pipeline计算</p>
<h5 id="劣势："><a href="#劣势：" class="headerlink" title="劣势："></a>劣势：</h5><p>微批处理模式，准实时</p>
<h4 id="DStream"><a href="#DStream" class="headerlink" title="DStream"></a>DStream</h4><p>1.将流式计算分解成一系列确定并且较小的批处理作业</p>
<p>2.将失败或者执行较慢的任务在其它节点上并行执行，执行的最小单元为RDD的partition</p>
<p>3.较强的容错能力</p>
<h2 id="五-日志系统"><a href="#五-日志系统" class="headerlink" title="五. 日志系统"></a>五. 日志系统</h2><h3 id="1-Flume"><a href="#1-Flume" class="headerlink" title="1.Flume"></a>1.Flume</h3><p>Flume是一个分布式的日志收集系统，具有高可靠、高可用、事务管理、失败重启等功能。数据处理速度快，完全可以用于生产环境。</p>
<p>Flume的核心是agent。</p>
<p>Agent是一个java进程，运行在日志收集端，通过agent接收日志，然后暂存起来，再发送到目的地。</p>
<p>Agent里面包含3个核心组件：source、channel、sink。</p>
<p>Source组件是专用于收集日志的，可以处理各种类型各种格式的日志数据,包括avro、thrift、exec、jms、spoolingdirectory、netcat、sequencegenerator、syslog、http、legacy、自定义。source组件把数据收集来以后，临时存放在channel中。</p>
<p>Channel组件是在agent中专用于临时存储数据的，可以存放在memory、jdbc、file、自定义。channel中的数据只有在sink发送成功之后才会被删除。</p>
<p>Sink组件是用于把数据发送到目的地的组件，目的地包括hdfs、logger、avro、thrift、ipc、file、null、hbase、solr、自定义。</p>
<h3 id="2-Kafka"><a href="#2-Kafka" class="headerlink" title="2.Kafka"></a>2.Kafka</h3><p>Apache Kafka是分布式发布-订阅消息系统。</p>
<p>它最初由LinkedIn公司开发，之后成为Apache项目的一部分。Kafka是一种快速、可扩展的、设计内在就是分布式的，分区的和可复制的提交日志服务。</p>
<p>Apache Kafka与传统消息系统相比，有以下不同：</p>
<p>1、它被设计为一个分布式系统，易于向外扩展;</p>
<p>2、它同时为发布和订阅提供高吞吐量;</p>
<p>3、它支持多订阅者，当失败时能自动平衡消费者;</p>
<p>4、它将消息持久化到磁盘，因此可用于批量消费</p>
<h2 id="六-分布式搜索"><a href="#六-分布式搜索" class="headerlink" title="六. 分布式搜索"></a>六. 分布式搜索</h2><h3 id="搜索引擎是什么"><a href="#搜索引擎是什么" class="headerlink" title="搜索引擎是什么?"></a>搜索引擎是什么?</h3><p>搜索引擎是指根据一定的策略、运用特定的计算机程序从互联网上搜集信息，在对信息进行组织和处理后，为用户提供检索服务，将用户检索相关的信息展示给用户的系统。搜索引擎包括全文索引、目录索引、元搜索引擎、垂直搜索引擎、集合式搜索引擎、门户搜索引擎与免费链接列表等。</p>
<h3 id="Lucene是什么"><a href="#Lucene是什么" class="headerlink" title="Lucene是什么?"></a>Lucene是什么?</h3><p>Lucene一个高性能、可伸缩的信息搜索库，即它不是一个完整的全文检索引擎，而是一个全检索引擎的架构，提供了完整的查询引擎和索引引擎，部分文本分析引擎。</p>
<h3 id="Elasticsearch是什么"><a href="#Elasticsearch是什么" class="headerlink" title="Elasticsearch是什么?"></a>Elasticsearch是什么?</h3><p>Elasticsearch一个高可扩展的开源的全文本搜索和分析工具。</p>
<p>它允许你以近实时的方式快速存储、搜索、分析大容量的数据。Elasticsearch是一个基于ApacheLucene(TM)的开源搜索引擎。无论在开源还是专有领域，Lucene可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。</p>
<p>ElasticSearch 有4中方式来构建数据库</p>
<p>最简单的方法是使用indexAPI，将一个Document发送到特定的index，一般通过curltools实现。</p>
<p>第二第三种方法是通过bulkAPI和UDPbulkAPI。两者的区别仅在于连接方式。</p>
<p>第四种方式是通过一个插件-river。river运行在ElasticSearch上，并且可以从外部数据库导入数据到ES中。需要注意的是，数据构建仅在分片上进行，而不能在副本上进行。</p>
<p>ELK是一套常用的开源日志监控和分析系统</p>
<p>包括一个分布式索引与搜索服务Elasticsearch，一个管理日志和事件的工具logstash，和一个数据可视化服务Kibana，logstash 负责日志的收集，处理和储存，elasticsearch 负责日志检索和分析，Kibana 负责日志的可视化。</p>
<h2 id="七-分布式数据库"><a href="#七-分布式数据库" class="headerlink" title="七. 分布式数据库"></a>七. 分布式数据库</h2><h3 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h3><h4 id="1-Hive是什么"><a href="#1-Hive是什么" class="headerlink" title="1.Hive是什么?"></a>1.Hive是什么?</h4><p>Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供类SQL查询功能。本质是将HQL转换为MapReduce程序</p>
<h4 id="2-Hive的设计目标"><a href="#2-Hive的设计目标" class="headerlink" title="2.Hive的设计目标?"></a>2.Hive的设计目标?</h4><p>1、Hive的设计目标是使Hadoop上的数据操作与传统SQL相结合，让熟悉SQL编程开发人员能够轻松向Hadoop平台迁移</p>
<p>2、Hive提供类似SQL的查询语言HQL，HQL在底层被转换为相应的MapReduce操作</p>
<p>3、Hive在HDFS上构建数据仓库来存储结构化的数据，这些数据一般来源与HDFS上的原始数据，使用Hive可以对这些数据执行查询、分析等操作。</p>
<h4 id="3-Hive的内部表与外部表"><a href="#3-Hive的内部表与外部表" class="headerlink" title="3.Hive的内部表与外部表"></a>3.Hive的内部表与外部表</h4><p>Hive在创建内部表时，会将数据移动到数据仓库指向的路径，若创建外部表，仅记录数据所在的路径，不对数据位置做任何改变，在删除表的时候，内部表的元数据和数据会被一起删除，外部表只会删除元数据，不删除数据。这样来说，外部表要比内部表安全，数据组织液更加灵活，方便共享源数据。</p>
<h4 id="4-Hive的调用方式"><a href="#4-Hive的调用方式" class="headerlink" title="4.Hive的调用方式"></a>4.Hive的调用方式</h4><p>1、Hive Shell</p>
<p>2、Thrift</p>
<p>3、JDBC</p>
<p>4、ODBC</p>
<h4 id="5-Hive的运行机制"><a href="#5-Hive的运行机制" class="headerlink" title="5.Hive的运行机制"></a>5.Hive的运行机制</h4><p>1、将sql转换成抽象语法树</p>
<p>2、将抽象语法树转化成查询块</p>
<p>3、将查询块转换成逻辑查询计划(操作符树)</p>
<p>4、将逻辑计划转换成物理计划(M\Rjobs)</p>
<h4 id="6-Hive的优势"><a href="#6-Hive的优势" class="headerlink" title="6.Hive的优势"></a>6.Hive的优势</h4><p>1、并行计算</p>
<p>2、充分利用集群的CPU计算资源、存储资源</p>
<p>3、处理大规模数据集</p>
<p>4、使用SQL，学习成本低</p>
<h4 id="7-Hive应用场景"><a href="#7-Hive应用场景" class="headerlink" title="7.Hive应用场景"></a>7.Hive应用场景</h4><p>1、海量数据处理</p>
<p>2、数据挖掘</p>
<p>3、数据分析</p>
<p>4、SQL是商务智能工具的通用语言，Hive有条件和这些BI产品进行集成</p>
<h4 id="8-Hive不适用场景"><a href="#8-Hive不适用场景" class="headerlink" title="8.Hive不适用场景"></a>8.Hive不适用场景</h4><p>1、复杂的科学计算</p>
<p>2、不能做到交互式的实时查询</p>
<h4 id="9-Hive和数据库-RDBMS-的区别"><a href="#9-Hive和数据库-RDBMS-的区别" class="headerlink" title="9.Hive和数据库(RDBMS)的区别"></a>9.Hive和数据库(RDBMS)的区别</h4><p>1、数据存储位置。Hive是建立在Hadoop之上的，所有的Hive的数据都是存储在HDFS中的。而数据库则可以将数据保存在块设备或本地文件系统中。</p>
<p>2、数据格式。Hive中没有定义专门的数据格式，由用户指定，需要指定三个属性：列分隔符，行分隔符，以及读取文件数据的方法。数据库中，存储引擎定义了自己的数据格式。所有数据都会按照一定的组织存储。</p>
<p>3、数据更新。Hive的内容是读多写少的，因此，不支持对数据的改写和删除，数据都在加载的时候中确定好的。数据库中的数据通常是需要经常进行修改。</p>
<p>4、执行延迟。Hive在查询数据的时候，需要扫描整个表(或分区)，因此延迟较高，只有在处理大数据是才有优势。数据库在处理小数据是执行延迟较低。</p>
<p>5、索引。Hive没有，数据库有</p>
<p>6、执行。Hive是MapReduce，数据库是Executor</p>
<p>7、可扩展性。Hive高，数据库低</p>
<p>8、数据规模。Hive大，数据库小</p>
<p>hive代码简单例子：</p>
<p>创建一个名为”test“的table</p>
<p>create table IF NOT EXISTS students (name string,age int,city string) comment”students-information-table”</p>
<p>partitioned by (class string) –分区字段</p>
<p>row format delimited fields terminated by ‘\001’ –字段分隔符</p>
<p>lines terminated by ‘\n’ –行分隔符</p>
<p>stored as orcfile; –存储格式（textfile,rcfile,orcfile）</p>
<p>load data (local) inpath “file_path” (overwrite) into table studentX partition (grade=’excellent’);–加载数据</p>
<p>show partitions studentX; –查看分区</p>
<p>select * from studentX where grade=’excellent’; –条件查询</p>
<p>drop table IF EXISTS  students;–表删除操作</p>
<p>create EXTERNAL table IF NOT EXISTS studentX (name string,age int,city string,class string) partitioned by (class string) ROW FORMAT DELIMITED FIELDS TERMINATED BY ‘,’;–创建外部表，指定数据存放位置</p>
<p>alter table test add partition (class=’one’) location ‘/testmore/one’;–添加分区</p>
<h4 id="列式存储格式-Parquet"><a href="#列式存储格式-Parquet" class="headerlink" title="列式存储格式 Parquet"></a>列式存储格式 Parquet</h4><p>Parquet 是面向分析型业务的列式存储格式，由 Twitter 和 Cloudera 合作开发， 2015 年 5 月从 Apache 的孵化器里毕业成为 Apache 顶级项目 。</p>
<h5 id="列式存储和行式存储相比的优势"><a href="#列式存储和行式存储相比的优势" class="headerlink" title="列式存储和行式存储相比的优势 :"></a>列式存储和行式存储相比的优势 :</h5><p>可以跳过不符合条件的数据，只读取需要的数据，降低 IO 数据量。<br>压缩编码可以降低磁盘存储空间。由于同一列的数据类型是一样的，可以使用更高效的压缩编码(例如 Run Length Encoding 和 DeltaEncoding )进一步节约存储空间。<br>只读取需要的列，支持向量运算，能够获取更好的扫描性能。</p>
<h2 id="八-基础问答题"><a href="#八-基础问答题" class="headerlink" title="八. 基础问答题"></a>八. 基础问答题</h2><h3 id="Q-你理解的Hive和传统数据库有什么不同-各有什么试用场景。"><a href="#Q-你理解的Hive和传统数据库有什么不同-各有什么试用场景。" class="headerlink" title="Q:你理解的Hive和传统数据库有什么不同?各有什么试用场景。"></a>Q:你理解的Hive和传统数据库有什么不同?各有什么试用场景。</h3><p>1、数据存储位置。Hive是建立在Hadoop之上的，所有的Hive的数据都是存储在HDFS中的。而数据库则可以将数据保存在块设备或本地文件系统中。</p>
<p>2、数据格式。Hive中没有定义专门的数据格式，由用户指定，需要指定三个属性：列分隔符，行分隔符，以及读取文件数据的方法。数据库中，存储引擎定义了自己的数据格式。所有数据都会按照一定的组织存储。</p>
<p>3、数据更新。Hive的内容是读多写少的，因此，不支持对数据的改写和删除，数据都在加载的时候中确定好的。数据库中的数据通常是需要经常进行修改。</p>
<p>4、执行延迟。Hive在查询数据的时候，需要扫描整个表(或分区)，因此延迟较高，只有在处理大数据是才有优势。数据库在处理小数据是执行延迟较低。</p>
<p>5、索引。Hive没有，数据库有</p>
<p>6、执行。Hive是MapReduce，数据库是Executor</p>
<p>7、可扩展性。Hive高，数据库低</p>
<p>8、数据规模。Hive大，数据库小</p>
<h3 id="Q-Hive的实用场景"><a href="#Q-Hive的实用场景" class="headerlink" title="Q:Hive的实用场景"></a>Q:Hive的实用场景</h3><p>1、Data Ingestion (数据摄取)</p>
<p>2、Data Discovery(数据发现)</p>
<p>3、Data analytics(数据分析)</p>
<p>4、Data Visualization &amp; Collaboration(数据可视化和协同开发)</p>
<h3 id="Q-大数据分析与挖掘方法论被称为CRISP-DM方法是以数据为中心迭代循环进行的六步活动"><a href="#Q-大数据分析与挖掘方法论被称为CRISP-DM方法是以数据为中心迭代循环进行的六步活动" class="headerlink" title="Q:大数据分析与挖掘方法论被称为CRISP-DM方法是以数据为中心迭代循环进行的六步活动"></a>Q:大数据分析与挖掘方法论被称为CRISP-DM方法是以数据为中心迭代循环进行的六步活动</h3><p>A:它们分别是：商业理解、数据理解、数据准备、建立模型<em>、模型评估、结果部署</em>。</p>
<h3 id="Q-数据分析挖掘方法大致包含-："><a href="#Q-数据分析挖掘方法大致包含-：" class="headerlink" title="Q:数据分析挖掘方法大致包含 ( )："></a>Q:数据分析挖掘方法大致包含 ( )：</h3><p>1.分类 Classification</p>
<p>2.估计Estimation</p>
<p>3.预测Prediction</p>
<p>4.关联规则Association Rules</p>
<p>5.聚类Cluster</p>
<p>6.描述与可视化Description and Visualization</p>
<h3 id="Q-在数据分析与挖掘中对数据的访问性要求包括"><a href="#Q-在数据分析与挖掘中对数据的访问性要求包括" class="headerlink" title="Q:在数据分析与挖掘中对数据的访问性要求包括"></a>Q:在数据分析与挖掘中对数据的访问性要求包括</h3><p>交互性访问、批处理访问_、迭代计算、数据查询，HADOOP仅仅支持了其中批处理访问，而Spark则支持所有4种方式。</p>
<h3 id="Q-Spark作为计算框架的优势是什么"><a href="#Q-Spark作为计算框架的优势是什么" class="headerlink" title="Q:Spark作为计算框架的优势是什么?"></a>Q:Spark作为计算框架的优势是什么?</h3><p>1、Spark的中间数据放到内存中，对于迭代运算效率更高</p>
<p>2、Spark比Hadoop更通用</p>
<p>3、Spark提供了统一的编程接口</p>
<p>4、容错性– 在分布式数据集计算时通过checkpoint来实现容错</p>
<p>5、可用性– Spark通过提供丰富的Scala, Java，Python API及交互式Shell来提高可用性</p>
<hr>

<p>转载自36大数据（36dsj.com)</p>
<p>==&gt;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/06/09/「动漫」全职高手11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/09/「动漫」全职高手11/" itemprop="url">「动漫」全职高手（更新到11）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-09T20:41:06+08:00">
                2017-06-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/动漫/" itemprop="url" rel="index">
                    <span itemprop="name">动漫</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><blockquote>
<p>每周五更新</p>
</blockquote>
<div id="dplayer8" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer8 = new DPlayer({"element":document.getElementById("dplayer8"),"autoplay":false,"theme":"#FADFA3","loop":false,"video":{"url":"http://oliji9s3j.bkt.clouddn.com/11.mp4","pic":"http://oliji9s3j.bkt.clouddn.com/%E5%85%A8%E8%81%8C%E9%AB%98%E6%89%8B.png"}});</script>
<h3 id="迅雷下载链接："><a href="#迅雷下载链接：" class="headerlink" title="迅雷下载链接："></a>迅雷下载链接：</h3><p><a href="magnet:?xt=urn:btih:FF31978401BE5AFA885DF06D7DF2361F6F295BC9" target="_blank" rel="external">The.King’s.Avatar.EP01-03.2017.1080p.WEB-DL.x264.AAC-HQC.mp4</a></p>
<p><a href="magnet:?xt=urn:btih:375ACE39E139E9B9023C5674BCD08A9D2C726C55" target="_blank" rel="external">The.King’s.Avatar.EP04-05.2017.1080p.WEB-DL.x264.AAC-HQC.mp4</a></p>
<p><a href="magnet:?xt=urn:btih:8E8D32C97AACE11A2883EBA455BC8119EE88A1C6" target="_blank" rel="external">The.King’s.Avatar.EP06.2017.1080p.WEB-DL.x264.AAC-HQC.mp4</a></p>
<p><a href="magnet:?xt=urn:btih:941fee29668641c978a1dcf5b557e878dc0617e8&amp;dn=&amp;tr=http%3A%2F%2F208.67.16.113%3A8000%2Fannounce&amp;tr=udp%3A%2F%2F208.67.16.113%3A8000%2Fannounce&amp;tr=http%3A%2F%2Ftracker.openbittorrent.com%3A80%2Fannounce&amp;tr=http%3A%2F%2Ftracker.publicbt.com%3A80%2Fannounce&amp;tr=http%3A%2F%2Ftracker.prq.to%2Fannounce&amp;tr=" target="_blank" rel="external">[全职高手 The King’s Avatar][07][简体][1080P][MP4].mp4</a></p>
<p><a href="magnet:?xt=urn:btih:4BAPPZHXFHIOGPVXNF5SITT2LWQKZ6G2" target="_blank" rel="external">[全职高手 The King’s Avatar][08][简体][1080P][MP4].mp4</a></p>
<p><a href="magnet:?xt=urn:btih:CC521C1E15A8BD2E84A7C49676A3FC85CD2DECF5" target="_blank" rel="external">[全职高手 The King’s Avatar][09][简体][720P][MP4].mp4</a></p>
<p><a href="magnet:?xt=urn:btih:E686C56BEAD3D0092F2F17B366F9152DB89B30EB" target="_blank" rel="external">[全职高手 The King’s Avatar][10][简体][720P][MP4].mp4</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/06/07/linux-part01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/07/linux-part01/" itemprop="url">linux_part01</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-07T23:47:06+08:00">
                2017-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><h2 id="vi"><a href="#vi" class="headerlink" title="vi"></a>vi</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">:set nu 显示行号</div><div class="line"></div><div class="line">:set nonu 隐藏行号</div><div class="line"></div><div class="line">a  光标所在字符后插入</div><div class="line"></div><div class="line">A  光标所在行尾插入</div><div class="line"></div><div class="line">i  光标所在字符前插入</div><div class="line"></div><div class="line">I  光标所在行行首插入</div><div class="line"></div><div class="line">o  光标下插入新行</div><div class="line"></div><div class="line">O  光标上插入新行</div><div class="line"></div><div class="line">gg 到第一行</div><div class="line"></div><div class="line">G  到最后一行</div><div class="line"></div><div class="line">nG 到第n行</div><div class="line"></div><div class="line">:n 到第n行</div><div class="line"></div><div class="line">$  到行尾</div><div class="line"></div><div class="line">0  到行首</div><div class="line"></div><div class="line">yy 复制当前行</div><div class="line"></div><div class="line">nyy 复制当前行以下几行</div><div class="line"></div><div class="line">dd 剪切当前行</div><div class="line"></div><div class="line">ndd 剪切当前行以下几行</div><div class="line"></div><div class="line">p（小写）  粘贴在当前光标所在行下</div><div class="line"></div><div class="line">P(大写）   粘贴在当前光标所在行上</div><div class="line"></div><div class="line">u  撤销</div><div class="line"></div><div class="line">/string 搜索字符串</div><div class="line"></div><div class="line">:set ic 忽略大小写</div><div class="line"></div><div class="line">n  搜索下一个出现位置</div><div class="line"></div><div class="line">:%s/old/new/g  全文替换指定字符串</div><div class="line"></div><div class="line">:n1,n2s/old/new/g  在一定范围内替换指定字符串</div><div class="line"></div><div class="line">:ws 保存并退出</div><div class="line"></div><div class="line">ZZ  保存并退出</div><div class="line"></div><div class="line">:q! 不保存退出</div></pre></td></tr></table></figure>
<h2 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h2><p>cut -f 2 xxx.txt 提取第二列的数据<br>cut -d “:” -f 2 xxx.txt 指定分隔符 提取第二列的数据</p>
<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>grep xxx file 查看file中含xxx的行<br>grep -v xxx 去除含xxx的行</p>
<h2 id="test-或者-判断"><a href="#test-或者-判断" class="headerlink" title="test 或者 [  ] 判断"></a>test 或者 [  ] 判断</h2><p>test -e xxx.file 判断是否存在 返回 ：$? 0 1   ##状态码 执行成功0 失败1<br>[ -e xxx.file ]  ##注意有空格<br>[ -d file ] 判断文件是否存在，并且是否为目录  /是目录为true<br>[ -f file ] 判断文件是否为存在，并且是否为普通文件 ／是普通文件为真<br>[ -r file ] 判断文件是否为存在，并且是否有读权限 ／是读权限为真<br>[ -w file ] 判断文件是否为存在，并且是否有写权限 ／是有写权限为真<br>[ -x file ] 判断文件是否为存在，并且是否有执行权限 ／是有执行权限为真</p>
<h2 id="amp-amp"><a href="#amp-amp" class="headerlink" title="&amp;&amp; ||"></a>&amp;&amp; ||</h2><p>xxx &amp;&amp; yyy    表示只有xxx为true时才执行yyy<br>yyy || zzz     表示只有yyy为false时才执行zzz<br>[ -d /root] &amp;&amp; echo “yes” || echo “no”     表示第一个判断为true时执行yes否则no</p>
<h2 id="数字大小判断"><a href="#数字大小判断" class="headerlink" title="数字大小判断"></a>数字大小判断</h2><p>-eq    =<br>-ne    !=<br>-gt     &gt;<br>-lt      &lt;<br>-ge    ≥<br>-le     ≤</p>
<h2 id="字符串判断"><a href="#字符串判断" class="headerlink" title="字符串判断"></a>字符串判断</h2><p>-z  是否为空<br>-n  是否非空<br>==  相等<br>!=  不等</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/06/04/Anaconda安装TensorFlow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/04/Anaconda安装TensorFlow/" itemprop="url">Anaconda安装TensorFlow</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-04T09:58:44+08:00">
                2017-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机器学习/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><p>1.从清华大学镜像网站下载tensorflow安装包<a href="https://mirror.tuna.tsinghua.edu.cn/tensorflow/mac/cpu/" target="_blank" rel="external">点我下载</a><br>2.创建tensorflow环境：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">conda create -n tensorflow</div><div class="line">source activate tensorflow</div></pre></td></tr></table></figure></p>
<p>3.安装下载的安装包<br><code>sudo pip install --ignore-installed xxx.wh1</code><br>(此处安装时最好使用sudo，否则可能会出现以下情况：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Exception:</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;/Library/Python/2.7/site-packages/pip-9.0.1-py2.7.egg/pip/basecommand.py&quot;, line 215, in main</div><div class="line">    status = self.run(options, args)</div><div class="line">。。。</div></pre></td></tr></table></figure></p>
<p>4.验证<br>python环境写个tensorflow版的hello,world：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">import tensorflow as tf</div><div class="line">hello = tf.constant(&apos;Hello, TensorFlow!&apos;)</div><div class="line">sess = tf.Session()</div><div class="line">print(sess.run(hello))</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/05/29/sqoop连接mysql问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/29/sqoop连接mysql问题/" itemprop="url">sqoop连接mysql问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-29T18:08:55+08:00">
                2017-05-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><h3 id="sqoop连接mysql时，出现以下错误："><a href="#sqoop连接mysql时，出现以下错误：" class="headerlink" title="sqoop连接mysql时，出现以下错误："></a>sqoop连接mysql时，出现以下错误：</h3><p>1:<br>ing statement: java.sql.SQLException: Access denied for user ‘root’@’monsterxls’ (using password: YES)<br>2:<br>com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure<br>3:<br>Caused by: java.net.ConnectException: Connection refused</p>
<h3 id="解决方法：赋予所有服务器访问mysql的权限（集群中的所有服务器）"><a href="#解决方法：赋予所有服务器访问mysql的权限（集群中的所有服务器）" class="headerlink" title="解决方法：赋予所有服务器访问mysql的权限（集群中的所有服务器）"></a>解决方法：赋予所有服务器访问mysql的权限（集群中的所有服务器）</h3><p>mysql&gt; GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@‘master’ IDENTIFIED BY ‘123456’ WITH GRANT OPTION;<br>mysql&gt; GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@‘slave1’ IDENTIFIED BY ‘123456’ WITH GRANT OPTION;<br>mysql&gt; GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@‘slave2’ IDENTIFIED BY ‘123456’ WITH GRANT OPTION;<br>…</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/05/09/hive-union用法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/09/hive-union用法/" itemprop="url">[hive]union用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-09T20:49:47+08:00">
                2017-05-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><h1 id="Hive-Union使用指南"><a href="#Hive-Union使用指南" class="headerlink" title="[Hive]Union使用指南"></a>[Hive]Union使用指南</h1><h4 id="1-union语法"><a href="#1-union语法" class="headerlink" title="1. union语法"></a>1. union语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select_statement UNION [ALL | DISTINCT] select_statement UNION [ALL | DISTINCT] select_statement ...</div></pre></td></tr></table></figure>
<p>UNION将多个SELECT语句的结果集合并为一个独立的结果集。当前只能支持UNION ALL(bag union)。不消除重复行。每个select语句返回的列的数量和名字必须一样，否则，一个语法错误会被抛出。</p>
<p>从语法中可以看出UNION有两个可选的关键字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">使用DISTINCT关键字与使用UNION 默认值效果一样，都会删除重复行</div><div class="line">使用ALL关键字，不会删除重复行，结果集包括所有SELECT语句的匹配行（包括重复行）</div></pre></td></tr></table></figure>
<p>注意</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Hive 1.2.0之前的版本仅支持UNION ALL，其中重复的行不会被删除。</div><div class="line">Hive 1.2.0和更高版本中，UNION的默认行为是从结果中删除重复的行。</div></pre></td></tr></table></figure>
<p>DISTINCT union可以显式使用UNION DISTINCT，也可以通过使用UNION而不使用以下DISTINCT或ALL关键字来隐式生成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">每个select_statement返回的列的数量和名称必须相同。 否则，将抛出错误。</div></pre></td></tr></table></figure>
<p>注意</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">在Hive 0.12.0和更低版本中，UNION只能在子查询中使用，例如“<span class="keyword">SELECT</span> * <span class="keyword">FROM</span>（select_statement <span class="keyword">UNION</span> ALL select_statement）unionResult”。</div><div class="line">从Hive <span class="number">0.13</span><span class="number">.0</span>开始，<span class="keyword">UNION</span>也可以在顶级查询中使用：例如“select_statement <span class="keyword">UNION</span> ALL select_statement <span class="keyword">UNION</span> ALL ...”。 （见HIVE<span class="number">-6189</span>。）</div><div class="line">在Hive <span class="number">1.2</span><span class="number">.0</span>之前，仅支持<span class="keyword">UNION</span> ALL。 </div><div class="line">Hive <span class="number">1.2</span><span class="number">.0</span>以后版本可以支持支持<span class="keyword">UNION</span>（或<span class="keyword">UNION</span> <span class="keyword">DISTINCT</span>）。 （见HIVE<span class="number">-9039</span>。）</div></pre></td></tr></table></figure>
<h4 id="2-UNION在FROM子句内"><a href="#2-UNION在FROM子句内" class="headerlink" title="2. UNION在FROM子句内"></a>2. UNION在FROM子句内</h4><p>如果还需要对UNION的结果集进行一些其他的处理，整个语句表达式可以嵌入到FROM子句中，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> *</div><div class="line"><span class="keyword">FROM</span> (</div><div class="line">  select_statement</div><div class="line">  <span class="keyword">UNION</span> ALL</div><div class="line">  select_statement</div><div class="line">) unionResultAlias</div></pre></td></tr></table></figure>
<p>例如，假设我们有两个不同的表分别表示哪个用户发布了一个视频，以及哪个用户发布了一个评论，那么下面的查询将UNION ALL的结果与用户表join在一起，为所有视频发布和评论发布创建一个注释流：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> u.id, actions.date</div><div class="line"><span class="keyword">FROM</span> (</div><div class="line">    <span class="keyword">SELECT</span> av.uid <span class="keyword">AS</span> uid</div><div class="line">    <span class="keyword">FROM</span> action_video av</div><div class="line">    <span class="keyword">WHERE</span> av.date = <span class="string">'2008-06-03'</span></div><div class="line">    <span class="keyword">UNION</span> ALL</div><div class="line">    <span class="keyword">SELECT</span> ac.uid <span class="keyword">AS</span> uid</div><div class="line">    <span class="keyword">FROM</span> action_comment ac</div><div class="line">    <span class="keyword">WHERE</span> ac.date = <span class="string">'2008-06-03'</span></div><div class="line"> ) actions <span class="keyword">JOIN</span> <span class="keyword">users</span> u <span class="keyword">ON</span> (u.id = actions.uid)</div></pre></td></tr></table></figure>
<h4 id="3-DDL和插入语句的联合"><a href="#3-DDL和插入语句的联合" class="headerlink" title="3. DDL和插入语句的联合"></a>3. DDL和插入语句的联合</h4><p>UNION 可以在视图，插入和CTAS（创建表作为select）语句中使用。 查询可以包含多个UNION子句，如上面的语法中所示。</p>
<h4 id="4-Applying-Subclauses"><a href="#4-Applying-Subclauses" class="headerlink" title="4. Applying Subclauses"></a>4. Applying Subclauses</h4><p>如果要对单个SELECT语句应用ORDER BY，SORT BY，CLUSTER BY，DISTRIBUTE BY或LIMIT，请将该子句放在括在SELECT中的括号内：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">key</span> <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">key</span> <span class="keyword">FROM</span> src <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">key</span> <span class="keyword">LIMIT</span> <span class="number">10</span>)subq1</div><div class="line"><span class="keyword">UNION</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">key</span> <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">key</span> <span class="keyword">FROM</span> src1 <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">key</span> <span class="keyword">LIMIT</span> <span class="number">10</span>)subq2</div></pre></td></tr></table></figure>
<p>如果要对整个UNION结果应用ORDER BY，SORT BY，CLUSTER BY，DISTRIBUTE BY或LIMIT子句，请在最后一个之后放置ORDER BY，SORT BY，CLUSTER BY，DISTRIBUTE BY或LIMIT。 以下示例使用ORDER BY和LIMIT子句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">key</span> <span class="keyword">FROM</span> src</div><div class="line"><span class="keyword">UNION</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">key</span> <span class="keyword">FROM</span> src1 </div><div class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">key</span> <span class="keyword">LIMIT</span> <span class="number">10</span></div></pre></td></tr></table></figure>
<h4 id="5-模式匹配的列别名"><a href="#5-模式匹配的列别名" class="headerlink" title="5. 模式匹配的列别名"></a>5. 模式匹配的列别名</h4><p>UNION期望在表达式列表的两侧有相同的模式。 因此，以下查询可能会失败，并显示一条错误消息，例如“FAILED：SemanticException 4:47 union的两边的模式应该匹配”。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> target_table</div><div class="line">  <span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">id</span>, <span class="keyword">category</span> <span class="keyword">FROM</span> source_table_1</div><div class="line">  <span class="keyword">UNION</span> ALL</div><div class="line">  <span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">id</span>, <span class="string">"Category159"</span> <span class="keyword">FROM</span> source_table_2</div></pre></td></tr></table></figure>
<p>在这种情况下，列别名可使UNION两侧的模式相同：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> target_table</div><div class="line">  <span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">id</span>, <span class="keyword">category</span> <span class="keyword">FROM</span> source_table_1</div><div class="line">  <span class="keyword">UNION</span> ALL</div><div class="line">  <span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">id</span>, <span class="string">"Category159"</span> <span class="keyword">as</span> <span class="keyword">category</span> <span class="keyword">FROM</span> source_table_2</div></pre></td></tr></table></figure>
<h4 id="6-列类型转换"><a href="#6-列类型转换" class="headerlink" title="6. 列类型转换"></a>6. 列类型转换</h4><p>在2.2.0版本<a href="http://lib.csdn.net/base/hive" target="_blank" rel="external">Hive</a>-14251之前，Hive尝试在Hive类型组（Hive type group）之间执行隐式转换。 随着HIVE-14251的改变，Hive将仅在每个类型组（包括字符串组，数字组或日期组，而不是组间）中执行隐式转换。 为了合并来自不同组的类型，例如字符串类型和日期类型，在查询中需要从字符串到日期或从日期到字符串的显式转换。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">id</span>, <span class="keyword">cast</span>(<span class="string">'2001-01-01'</span> <span class="keyword">as</span> <span class="built_in">date</span>) d <span class="keyword">FROM</span> source_table_1</div><div class="line"><span class="keyword">UNION</span> ALL</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, <span class="keyword">id</span>, hiredate <span class="keyword">as</span> d <span class="keyword">FROM</span> source_table_2</div></pre></td></tr></table></figure>
<h4 id="7-Example"><a href="#7-Example" class="headerlink" title="7. Example"></a>7. Example</h4><p>aa数据：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">hive&gt; select * from tmp_union_aa;</div><div class="line">OK</div><div class="line">ios	aa</div><div class="line">ios	ab</div><div class="line">adr	ac</div><div class="line">adr	ad</div><div class="line">adr	ad</div><div class="line">ios	ab</div></pre></td></tr></table></figure>
<p>ab数据：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">hive&gt; select * from tmp_union_ab;</div><div class="line">OK</div><div class="line">ios	ba</div><div class="line">ios	bb</div><div class="line">adr	ac</div><div class="line">adr	bd</div><div class="line">adr	bd</div><div class="line">ios	ab</div></pre></td></tr></table></figure>
<p>union all合并：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">hive&gt; select * from</div><div class="line">(</div><div class="line">   select platform, id from tmp_union_aa</div><div class="line">   union all</div><div class="line">   select platform, id from tmp_union_ab</div><div class="line">) u;</div><div class="line"></div><div class="line">ios	aa</div><div class="line">ios	ab</div><div class="line">adr	ac</div><div class="line">adr	ad</div><div class="line">adr	ad</div><div class="line">ios	ab</div><div class="line">ios	ba</div><div class="line">ios	bb</div><div class="line">adr	ac</div><div class="line">adr	bd</div><div class="line">adr	bd</div><div class="line">ios	ab</div></pre></td></tr></table></figure>
<p>union 合并：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">hive&gt;select * from</div><div class="line">(</div><div class="line">   select platform, id from tmp_union_aa</div><div class="line">   union</div><div class="line">   select platform, id from tmp_union_ab</div><div class="line">) u;</div><div class="line"></div><div class="line">adr	ac</div><div class="line">adr	ad</div><div class="line">adr	bd</div><div class="line">ios	aa</div><div class="line">ios	ab</div><div class="line">ios	ba</div><div class="line">ios	bb</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/05/06/mac使用技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/06/mac使用技巧/" itemprop="url">mac使用技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-06T20:10:53+08:00">
                2017-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mac/" itemprop="url" rel="index">
                    <span itemprop="name">mac</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><blockquote>
<p>长期更新</p>
</blockquote>
<h2 id="隐藏小技巧"><a href="#隐藏小技巧" class="headerlink" title="隐藏小技巧"></a>隐藏小技巧</h2><h3 id="开启充电提示音（类似于iphone充电提示音，默认关闭）"><a href="#开启充电提示音（类似于iphone充电提示音，默认关闭）" class="headerlink" title="开启充电提示音（类似于iphone充电提示音，默认关闭）"></a>开启充电提示音（类似于iphone充电提示音，默认关闭）</h3><p>终端输入（开启）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">defaults write com.apple.PowerChime ChimeOnAllHardware -bool true; open /System/Library/CoreServices/PowerChime.app &amp;</div></pre></td></tr></table></figure>
<p>关闭：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">defaults write com.apple.PowerChime ChimeOnAllHardware -bool false;killall PowerChime</div></pre></td></tr></table></figure>
<h2 id="隐藏文件夹"><a href="#隐藏文件夹" class="headerlink" title="隐藏文件夹"></a>隐藏文件夹</h2><p>更好的保护学习资料，有时候需要设置隐藏文件夹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv foldername .foldername</div></pre></td></tr></table></figure>
<h2 id="查看隐藏文件夹"><a href="#查看隐藏文件夹" class="headerlink" title="查看隐藏文件夹"></a>查看隐藏文件夹</h2><p>mac最新版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">⌘⇧.(Command + Shift + .)  #隐藏 和显示</div></pre></td></tr></table></figure>
<h1 id="Macbook-Pro-用外接显示器时，如何关闭笔记本屏幕，同时开盖使用"><a href="#Macbook-Pro-用外接显示器时，如何关闭笔记本屏幕，同时开盖使用" class="headerlink" title="Macbook Pro 用外接显示器时，如何关闭笔记本屏幕，同时开盖使用"></a>Macbook Pro 用外接显示器时，如何关闭笔记本屏幕，同时开盖使用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo nvram boot-args=&quot;iog=0x0&quot; #(10.10以前版本)</div><div class="line">sudo nvram boot-args=&quot;niog=1&quot; #(10.10及以后版本)这个命令的意思就是外接显示器时关闭自身屏幕，重启生效</div></pre></td></tr></table></figure>
<p>开机流程：连上电源和外接显示器，按开机键，立即合盖，等外接显示器有信号时开盖即可如果报错 (已知 10.11/10.12 会报错)<br>nvram: Error setting variable - ‘boot-args’: (iokit/common) general error</p>
<ol>
<li>重启，按住command + r 进入恢复界面</li>
</ol>
<ol>
<li>左上角菜单里面找到终端，输入nvram boot-args=”niog=1”，回车问题解决。重启生效</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/04/26/Airbnb的大数据平台架构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/26/Airbnb的大数据平台架构/" itemprop="url">Airbnb的大数据平台架构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-26T22:59:32+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><blockquote>
<p>转载自：<a href="http://www.infoq.com/cn/articles/Airbnb-Hadoop-Hive" target="_blank" rel="external">http://www.infoq.com/cn/articles/Airbnb-Hadoop-Hive</a></p>
</blockquote>
<p>Airbnb成立于2008年8月，拥有世界一流的客户服务和日益增长的用户社区。随着Airbnb的业务日益复杂，其大数据平台数据量也迎来了爆炸式增长。</p>
<p>本文为Airbnb公司工程师James Mayfield分析的<a href="https://medium.com/airbnb-engineering/data-infrastructure-at-airbnb-8adfb34f169c#.3nbxp845m" target="_blank" rel="external">Airbnb大数据平台构架</a>，提供了详尽的思想和实施。</p>
<h2 id="Part-1：大数据架构背后的哲理"><a href="#Part-1：大数据架构背后的哲理" class="headerlink" title="Part 1：大数据架构背后的哲理"></a>Part 1：大数据架构背后的哲理</h2><p>Airbnb公司提倡数据信息化，凡事以数据说话。收集指标，通过实验验证假设、构建机器学习模型和挖掘商业机会使得Airbnb公司高速、灵活的成长。</p>
<p>经过多版本迭代之后，大数据架构栈基本稳定、可靠和可扩展的。本文分享了Airbnb公司大数据架构经验给社区。后续会给出一系列的文章来讲述分布式架构和使用的相应的组件。James Mayfield说，“我们每天使用着开源社区提供的优秀的项目，这些项目让大家更好的工作。我们在使用这些有用的项目得到好处之后也得反馈社区。”</p>
<p>下面基于在Airbnb公司大数据平台架构构建过程的经验，给出一些有效的观点。</p>
<ul>
<li>多关注开源社区：在开源社区有很多大数据架构方面优秀的资源，需要去采用这些系统。同样，当我们自己开发了有用的项目也最好回馈给社区，这样会良性循环。</li>
<li>多采用标准组件和方法：有时候自己造轮子并不如使用已有的更好资源。当凭直觉去开发出一种“与众不同”的方法时，你得考虑维护和修复这些程序的隐性成本。</li>
<li>确保大数据平台的可扩展性：当前业务数据已不仅仅是随着业务线性增长了，而是爆发性增长。我们得确保产品能满足这种业务的增长。</li>
<li>多倾听同事的反馈来解决问题：倾听公司数据的使用者反馈意见是架构路线图中非常重要的一步。</li>
<li>预留多余资源：集群资源的超负荷使用让我们培养了一种探索无限可能的文化。对于架构团队来说，经常沉浸在早期资源充足的兴奋中，但Airbnb大数据团队总是假设数据仓库的新业务规模比现有机器资源大。</li>
</ul>
<h2 id="Part-2：大数据架构预览"><a href="#Part-2：大数据架构预览" class="headerlink" title="Part 2：大数据架构预览"></a>Part 2：大数据架构预览</h2><p>这里是大数据平台架构一览图。</p>
<p><img src="http://oliji9s3j.bkt.clouddn.com/AIRBNB.png" alt=""></p>
<p>Airbnb数据源主要来自两方面：数据埋点发送事件日志到Kafka；MySQL数据库dumps存储在AWS的RDS，通过数据传输组件Sqoop传输到Hive“金”集群（其实就是Hive集群，只是Airbnb内部有两个Hive集群，分别为“金”集群和“银”集群，具体分开两个集群的原因会在文章末尾给出。）。</p>
<p>包含用户行为以及纬度快照的数据发送到Hive“金”集群存储，并进行数据清洗。这步会做些业务逻辑计算，聚合数据表，并进行数据校验。</p>
<p>在以上架构图中，Hive集群单独区分“金”集群和“银”集群大面上的原因是为了把数据存储和计算进行分离。这样可以保证灾难性恢复。这个架构中，“金”集群运行着更重要的作业和服务，对资源占用和即席查询可以达到无感知。“银”集群只是作为一个产品环境。</p>
<p>“金”集群存储的是原始数据，然后复制“金”集群上的所有数据到“银”集群。但是在“银”集群上生成的数据不会再复制到“金”集群。你可以认为 “银”集群是所有数据的一个超集。由于Airbnb大部分数据分析和报表都出自“银”集群，所以得保证“银”集群能够无延迟的复制数据。更严格的讲，对于“金”集群上已存在的数据进行更新也得迅速的同步到“银”集群。集群间的数据同步优化在开源社区并没有很好的解决方案，Airbnb自己实现了一个工具，后续文章会详细的讲。</p>
<p>在HDFS存储和Hive表的管理方面做了不少优化。数据仓库的质量依赖于数据的不变性（Hive表的分区）。更进一步，Airbnb不提倡建立不同的数据系统，也不想单独为数据源和终端用户报表维护单独的架构。以以往的经验看，中间数据系统会造成数据的不一致性，增加ETL的负担，让回溯数据源到数据指标的演化链变得异常艰难。Airbnb采用Presto来查询Hive表，代替Oracle、 Teradata、 Vertica、 Redshift等。在未来，希望可以直接用Presto连接Tableau。</p>
<p>另外一个值得注意的几个事情，在架构图中的<a href="http://airbnb.io/airpal" target="_blank" rel="external">Airpal</a>，一个基于Presto，web查询系统，已经开源。Airpal是Airbnb公司用户基于数据仓库的即席SQL查询借口，有超过1/3的Airbnb同事在使用此工具查询。任务调度系统<a href="http://airbnb.io/projects/airflow" target="_blank" rel="external">Airflow</a> ，可以跨平台运行Hive，Presto，Spark，MySQL等Job，并提供调度和监控功能。Spark集群时工程师和数据分析师偏爱的工具，可以提供机器学习和流处理。S3作为一个独立的存储，大数据团队从HDFS上收回部分数据，这样可以减少存储的成本。并更新Hive的表指向S3文件，容易访问数据和元数据管理。</p>
<h2 id="Part-3：Hadoop集群演化"><a href="#Part-3：Hadoop集群演化" class="headerlink" title="Part 3：Hadoop集群演化"></a>Part 3：Hadoop集群演化</h2><p>Airbnb公司在今年迁移集群到“金和银”集群。为了后续的可扩展，两年前迁移Amazon EMR到 EC2实例上运行HDFS，存储有300 TB数据。现在，Airbnb公司有两个独立的HDFS集群，存储的数据量达11PB。S3上也存储了几PB数据。</p>
<p>下面是遇到的主要问题和解决方案：<br>A) 基于Mesos运行Hadoop<br>早期Airbnb工程师发现Mesos计算框架可以跨服务发布。在AWS c3.8xlarge机器上搭建集群，在EBS上存储3TB的数据。在Mesos上运行所有Hadoop、 Hive、Presto、 Chronos和Marathon。</p>
<p>基于Mesos的Hadoop集群遇到的问题：</p>
<ul>
<li>Job运行和产生的日志不可见</li>
<li>Hadoop集群健康状态不可见</li>
<li>Mesos只支持MR1</li>
<li>task tracker连接导致性能问题</li>
<li>系统的高负载，并很难定位</li>
<li>不兼容Hadoop安全认证Kerberos</li>
</ul>
<p>解决方法：不自己造轮子，直接采用其它大公司的解决方案。</p>
<p>B) 远程读数据和写数据<br>所有的HDFS数据都存储在持久性数据块级存储卷（EBS），当查询时都是通过网络访问Amazon EC2。Hadoop设计在节点本地读写速度会更快，而现在的部署跟这相悖。</p>
<p>Hadoop集群数据分成三部分存储在AWS一个分区三个节点上，每个节点都在不同的机架上。所以三个不同的副本就存储在不同的机架上，导致一直在远程的读数据和写入数据。这个问题导致在数据移动或者远程复制的过程出现丢失或者崩溃。</p>
<p>解决方法：使用本地存储的实例，并运行在单个节点上。</p>
<p>C) 在同构机器上混布任务<br>纵观所有的任务，发现整体的架构中有两种完全不同的需求配置。Hive/Hadoop/HDFS是存储密集型，基本不耗内存和CPU。而Presto和Spark是耗内存和CPU型，并不怎么需要存储。在AWS c3.8xlarge机器上持久性数据块级存储卷（EBS）里存储3 TB是非常昂贵的。</p>
<p>解决方法：迁移到Mesos计算框架后，可以选择不同类型的机器运行不同的集群。比如，选择AWS c3.8xlarge实例运行Spark。AWS后来发布了“D系列”实例。从AWS c3.8xlarge实例每节点远程的3 TB存储迁移数据到AWS d2.8xlarge 4 TB本地存储，这给Airbnb公司未来三年节约了上亿美元。</p>
<p>D) HDFS Federation<br>早期Airbnb公司使用Pinky和Brain两个集群联合，数据存储共享，但mappers和reducers是在每个集群上逻辑独立的。这导致用户访问数据需要在Pinky和Brain两个集群都查询一遍。并且这种集群联合不能广泛被支持，运行也不稳定。</p>
<p>解决方法：迁移数据到各HDFS节点，达到机器水平的隔离性，这样更容易容灾。</p>
<p>E) 繁重的系统监控<br>个性化系统架构的严重问题之一是需要自己开发独立的监控和报警系统。Hadoop、Hive和HDFS都是复杂的系统，经常出现各种bug。试图跟踪所有失败的状态，并能设置合适的阈值是一项非常具有挑战性的工作。</p>
<p>解决方法：通过和大数据公司Cloudera签订协议获得专家在架构和运维这些大系统的支持。减少公司维护的负担。Cloudera提供的Manager工具减少了监控和报警的工作。</p>
<h2 id="最后陈述"><a href="#最后陈述" class="headerlink" title="最后陈述"></a>最后陈述</h2><p>在评估老系统的问题和低效率后进行了系统的修复。无感知的迁移PB级数据和成百上千的Jobs是一个长期的过程。作者提出后面会单独写相关的文章，并开源对于的工具给开源社区。</p>
<p>大数据平台的演化给公司减少大量成本，并且优化集群的性能，下面是一些统计数据：</p>
<ul>
<li>磁盘读写数据的速度从70 – 150 MB / sec到400 + MB / sec。</li>
<li>Hive任务提高了两倍的CPU时间</li>
<li>读吞吐量提高了三倍</li>
<li>写吞吐量提高了两倍</li>
<li>成本减少百分之七十</li>
</ul>
<p><strong>查看英文原文：<a href="">Data Infrastructure at Airbnb</a></strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/04/26/hive变量传递设置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/26/hive变量传递设置/" itemprop="url">hive变量传递设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-26T21:51:57+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><p>在oozie的workflow中执行一个hive查询，但是直接就报异常：Variable substitution depth too large:40，从网上查询可知，可以确认是由于语句中使用了过多的变量导致，在hive以前的版本中，这个限制是写死的40个，查询Hive的最新的原代码，虽然判断的位置的提示信息已经变化，但是原理一样：</p>
<p>### org.apache.hadoop.hive.ql.parse.VariableSubstitution：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">substitute</span><span class="params">(HiveConf conf, String expr)</span> </span>&#123;</div><div class="line"><span class="keyword">if</span> (expr == <span class="keyword">null</span>) &#123;   </div><div class="line">  <span class="keyword">return</span> expr;</div><div class="line">    &#125;    </div><div class="line"><span class="keyword">if</span> (HiveConf.getBoolVar(conf, ConfVars.HIVEVARIABLESUBSTITUTE)) &#123;</div><div class="line">      l4j.debug(<span class="string">"Substitution is on: "</span> + expr);</div><div class="line">    &#125; </div><div class="line"><span class="keyword">else</span> &#123;     </div><div class="line">  <span class="keyword">return</span> expr;</div><div class="line">    &#125;    </div><div class="line"><span class="keyword">int</span> depth = HiveConf.getIntVar(conf, ConfVars.HIVEVARIABLESUBSTITUTEDEPTH);    <span class="keyword">return</span> substitute(conf, expr, depth);</div><div class="line">  &#125;<span class="number">123456789101112</span></div></pre></td></tr></table></figure>
<p>如果开启hive.variable.substitute（默认开启），则使用SystemVariables的substitute方法和hive.variable.substitute.depth(默认为40)进行进一步的判断：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> String <span class="title">substitute</span><span class="params">(Configuration conf, String expr, <span class="keyword">int</span> depth)</span> </span>&#123;</div><div class="line">    Matcher match = varPat.matcher(<span class="string">""</span>);</div><div class="line">    String eval = expr;</div><div class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder();    <span class="keyword">int</span> s = <span class="number">0</span>;    <span class="keyword">for</span> (; s &lt;= depth; s++) &#123;</div><div class="line">      match.reset(eval);</div><div class="line">      builder.setLength(<span class="number">0</span>);      <span class="keyword">int</span> prev = <span class="number">0</span>;      <span class="keyword">boolean</span> found = <span class="keyword">false</span>;      <span class="keyword">while</span> (match.find(prev)) &#123;</div><div class="line">        String group = match.group();</div><div class="line">        String var = group.substring(<span class="number">2</span>, group.length() - <span class="number">1</span>); <span class="comment">// remove $&#123; .. &#125;</span></div><div class="line">        String substitute = getSubstitute(conf, var);        <span class="keyword">if</span> (substitute == <span class="keyword">null</span>) &#123;</div><div class="line">          substitute = group;   <span class="comment">// append as-is</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          found = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        builder.append(eval.substring(prev, match.start())).append(substitute);</div><div class="line">        prev = match.end();</div><div class="line">      &#125;      <span class="keyword">if</span> (!found) &#123;        <span class="keyword">return</span> eval;</div><div class="line">      &#125;</div><div class="line">      builder.append(eval.substring(prev));</div><div class="line">      eval = builder.toString();</div><div class="line">    &#125;    <span class="keyword">if</span> (s &gt; depth) &#123;      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(          <span class="string">"Variable substitution depth is deeper than "</span> + depth + <span class="string">" for expression "</span> + expr);</div><div class="line">    &#125;    <span class="keyword">return</span> eval;</div><div class="line">  &#125; <span class="number">12345678910111213141516171819202122232425262728293031323334</span></div></pre></td></tr></table></figure>
<p>如果使用的${}参数超过hive.variable.substitute.depth的数量，则直接抛出异常，所以我们在语句的前面直接加上set hive.variable.substitute.depth=100; 问题解决!</p>
<p>set命令的执行是在CommandProcessor实现类SetProcessor里具体执行，但是substitute语句同时也会在CompileProcessor中调用，也就是在hive语句编译时就调用了，所以oozie在使用时调用beeline执行语句时，compile阶段就报出异常。</p>
<p>但是为什么Hue直接执行这个语句时没有问题? 因为hue在执行hive时使用的是python开发的beeswax，而beeswax是自己直接处理了这些变量，使用变量实际的值替换变量后再提交给hive执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">substitute_variables</span><span class="params">(input_data, substitutions)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  Replaces variables with values from substitutions.</div><div class="line">  """</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(value)</span>:</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, basestring):      <span class="keyword">return</span> value</div><div class="line"></div><div class="line">    new_value = Template(value).safe_substitute(substitutions)    <span class="keyword">if</span> new_value != value:</div><div class="line">      LOG.debug(<span class="string">"Substituted %s -&gt; %s"</span> % (repr(value), repr(new_value)))    <span class="keyword">return</span> new_value  <span class="keyword">return</span> recursive_walk(f, input_data)</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://stanxia.github.io/2017/04/26/Music Queen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="东篱下">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/26/Music Queen/" itemprop="url">Music Queen</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-26T21:00:34+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GEM/" itemprop="url" rel="index">
                    <span itemprop="name">GEM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <script src="/assets/js/DPlayer.min.js"> </script><p>不脆弱 不沉默 不协妥 不退缩</p>
<p>不慌张 不绝望 不狂妄 不投降</p>
<p>一路逆风 我们不投降</p>
<p>一路逆风 顽强的飞翔</p>
<blockquote>
<p>一路逆风</p>
</blockquote>
<div id="dplayer0" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer0 = new DPlayer({"element":document.getElementById("dplayer0"),"autoplay":false,"theme":"#FADFA3","loop":true,"video":{"url":"http://oliji9s3j.bkt.clouddn.com/G.E.M.%E3%80%90%E4%B8%80%E8%B7%AF%E9%80%86%E9%A2%A8%20AGAINST%20THE%20WIND%E3%80%91Official%20MV%20%5BHD%5D%20%E9%84%A7%E7%B4%AB%E6%A3%8B.mp4","pic":"http://oliji9s3j.bkt.clouddn.com/%E4%B8%80%E8%B7%AF%E9%80%86%E9%A3%8E.png"}});</script>
<blockquote>
<p>来自天堂的魔鬼</p>
</blockquote>
<div id="dplayer1" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer1 = new DPlayer({"element":document.getElementById("dplayer1"),"autoplay":false,"theme":"#FADFA3","loop":true,"video":{"url":"http://oliji9s3j.bkt.clouddn.com/G.E.M.%E3%80%90%E4%BE%86%E8%87%AA%E5%A4%A9%E5%A0%82%E7%9A%84%E9%AD%94%E9%AC%BC%20AWAY%E3%80%91Official%20MV%20%5BHD%5D%20%E9%84%A7%E7%B4%AB%E6%A3%8B.mp4","pic":"http://oliji9s3j.bkt.clouddn.com/%E6%9D%A5%E8%87%AA%E5%A4%A9%E5%A0%82%E7%9A%84%E9%AD%94%E9%AC%BC.png"}});</script>
<blockquote>
<p>再见MTV</p>
</blockquote>
<div id="dplayer2" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer2 = new DPlayer({"element":document.getElementById("dplayer2"),"autoplay":false,"theme":"#FADFA3","loop":true,"video":{"url":"http://oliji9s3j.bkt.clouddn.com/G.E.M.%E3%80%90%E5%86%8D%E8%A6%8B%20GOODBYE%E3%80%91Official%20MV%20%5BHD%5D%20%E9%84%A7%E7%B4%AB%E6%A3%8B.mp4","pic":"http://oliji9s3j.bkt.clouddn.com/%E5%86%8D%E8%A7%81mtv.png"}});</script>
<blockquote>
<p>再见LIVE</p>
</blockquote>
<div id="dplayer3" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer3 = new DPlayer({"element":document.getElementById("dplayer3"),"autoplay":false,"theme":"#FADFA3","loop":true,"video":{"url":"http://oliji9s3j.bkt.clouddn.com/G.E.M.%E3%80%90%E5%86%8D%E8%A6%8B%20GOODBYE%E3%80%91LIVE%20PIANO%20SESSION%20II%20%28Part%203_3%29%20%5BHD%5D%20%E9%84%A7%E7%B4%AB%E6%A3%8B.mp4","pic":"http://oliji9s3j.bkt.clouddn.com/%E5%86%8D%E8%A7%81.png"}});</script>
<blockquote>
<p>多远都要在一起</p>
</blockquote>
<div id="dplayer4" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer4 = new DPlayer({"element":document.getElementById("dplayer4"),"autoplay":false,"theme":"#FADFA3","loop":true,"video":{"url":"http://oliji9s3j.bkt.clouddn.com/G.E.M.%E3%80%90%E5%A4%9A%E9%81%A0%E9%83%BD%E8%A6%81%E5%9C%A8%E4%B8%80%E8%B5%B7%20LONG%20DISTANCE%E3%80%91Official%20MV%20%5BHD%5D%20%E9%84%A7%E7%B4%AB%E6%A3%8B.mp4","pic":"http://oliji9s3j.bkt.clouddn.com/%E5%A4%9A%E8%BF%9C%E9%83%BD%E8%A6%81%E5%9C%A8%E4%B8%80%E8%B5%B7.png"}});</script>
<blockquote>
<p>光年之外</p>
</blockquote>
<div id="dplayer5" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer5 = new DPlayer({"element":document.getElementById("dplayer5"),"autoplay":false,"theme":"#FADFA3","loop":true,"video":{"url":"http://oliji9s3j.bkt.clouddn.com/G.E.M.%E3%80%90%E5%85%89%E5%B9%B4%E4%B9%8B%E5%A4%96%E3%80%91MV%20%28%E9%9B%BB%E5%BD%B1%E3%80%8A%E5%A4%AA%E7%A9%BA%E6%BD%9B%E8%A1%8C%E8%80%85%20Passengers%E3%80%8B%E4%B8%AD%E6%96%87%E4%B8%BB%E9%A1%8C%E6%9B%B2%29%20%5BHD%5D%20%E9%84%A7%E7%B4%AB%E6%A3%8B.mp4","pic":"http://oliji9s3j.bkt.clouddn.com/%E5%85%89%E5%B9%B4%E4%B9%8B%E5%A4%96.png"}});</script>
<blockquote>
<p>新的心跳</p>
</blockquote>
<div id="dplayer6" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer6 = new DPlayer({"element":document.getElementById("dplayer6"),"autoplay":false,"theme":"#FADFA3","loop":true,"video":{"url":"http://oliji9s3j.bkt.clouddn.com/G.E.M.%E3%80%90%E6%96%B0%E7%9A%84%E5%BF%83%E8%B7%B3%20HEARTBEAT%E3%80%91Official%20MV%20%5BHD%5D%20%E9%84%A7%E7%B4%AB%E6%A3%8B.mp4","pic":"http://oliji9s3j.bkt.clouddn.com/%E6%96%B0%E7%9A%84%E5%BF%83%E8%B7%B3.png"}});</script>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">森</p>
              <p class="site-description motion-element" itemprop="description">采菊东篱下，悠然见南山</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">59</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">森</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
