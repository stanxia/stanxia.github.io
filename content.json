{"meta":{"title":"ä¸œç¯±ä¸‹","subtitle":"é—²åº­èˆé”®","description":"æŠ€æœ¯æ”¹å˜ä¸–ç•Œï¼Œé˜…è¯»å¡‘é€ äººç”Ÿ","author":"èˆ’æœä¸€å¤","url":"https://stanxia.github.io"},"posts":[{"title":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","date":"2020-02-09T12:26:00.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2020/02/09/å‰‘æŒ‡offer/","link":"","permalink":"https://stanxia.github.io/2020/02/09/å‰‘æŒ‡offer/","excerpt":"","text":"å‚è€ƒé“¾æ¥CS-Notes","raw":null,"content":null,"categories":[{"name":"offer","slug":"offer","permalink":"https://stanxia.github.io/categories/offer/"}],"tags":[{"name":"offer","slug":"offer","permalink":"https://stanxia.github.io/tags/offer/"}]},{"title":"hexoå’Œnextå†…ç½®æ ‡ç­¾","slug":"hexoå’Œnextå†…ç½®æ ‡ç­¾","date":"2020-02-06T12:26:00.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2020/02/06/hexoå’Œnextå†…ç½®æ ‡ç­¾/","link":"","permalink":"https://stanxia.github.io/2020/02/06/hexoå’Œnextå†…ç½®æ ‡ç­¾/","excerpt":"","text":"noteæ ‡ç­¾ä½¿ç”¨ 12345678&#123;% note class_name %&#125; blabla &#123;% endnote %&#125;class_name: - default - primary - success - info - warning - danger æ•ˆæœæ¼”ç¤º default primary success info warning danger tabsæ ‡ç­¾ä½¿ç”¨ 123456789&#123;% tabs unique_name,default_index %&#125;&lt;!-- tab [tag_name] --&gt;è¿™æ˜¯tab1&lt;!-- endtab --&gt;&lt;!-- tab [tag_name] --&gt;è¿™æ˜¯tab2&lt;!-- endtab --&gt;...&#123;% endtabs %&#125; æ•ˆæœæ¼”ç¤º 1234567891011&#123;% tabs code,1 %&#125;&lt;!-- tab java --&gt;java code&lt;!-- endtab --&gt;&lt;!-- tab scala --&gt;scala code&lt;!-- endtab --&gt;&lt;!-- tab python --&gt;python code&lt;!-- endtab --&gt;&#123;% endtabs %&#125; javascalapython12345public class Hello&#123; //&#125; 12345object Hello&#123; //&#125; undefined Block QuotePerfect for adding quotes to your post, with optional author, source and title information. Alias: quote 123&#123;% blockquote [author[, source]] [link] [source_link_title] %&#125;content&#123;% endblockquote %&#125; ExamplesNo arguments. Plain blockquote. 123&#123;% blockquote %&#125;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque hendrerit lacus ut purus iaculis feugiat. Sed nec tempor elit, quis aliquam neque. Curabitur sed diam eget dolor fermentum semper at eu lorem.&#123;% endblockquote %&#125; Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque hendrerit lacus ut purus iaculis feugiat. Sed nec tempor elit, quis aliquam neque. Curabitur sed diam eget dolor fermentum semper at eu lorem. Quote from a book 123&#123;% blockquote David Levithan, Wide Awake %&#125;Do not just seek happiness for yourself. Seek happiness for all. Through kindness. Through mercy.&#123;% endblockquote %&#125; Do not just seek happiness for yourself. Seek happiness for all. Through kindness. Through mercy. David LevithanWide Awake Quote from Twitter 123&#123;% blockquote @DevDocs https://twitter.com/devdocs/status/356095192085962752 %&#125;NEW: DevDocs now comes with syntax highlighting. http://devdocs.io&#123;% endblockquote %&#125; NEW: DevDocs now comes with syntax highlighting. http://devdocs.io @DevDocstwitter.com/devdocs/status/356095192085962752 Quote from an article on the web 123&#123;% blockquote Seth Godin http://sethgodin.typepad.com/seths_blog/2009/07/welcome-to-island-marketing.html Welcome to Island Marketing %&#125;Every interaction is both precious and an opportunity to delight.&#123;% endblockquote %&#125; Every interaction is both precious and an opportunity to delight. Seth GodinWelcome to Island Marketing Code BlockUseful feature for adding code snippets to your post. Alias: code 123&#123;% codeblock [title] [lang:language] [url] [link text] [additional options] %&#125;code snippet&#123;% endcodeblock %&#125; Specify additional options in option:value format, e.g. line_number:false first_line:5. Extra Options Description Default line_number Show line number true highlight Enable code highlighting true first_line Specify the first line number 1 mark Line highlight specific line(s), each value separated by a comma. Specify number range using a dash Example: mark:1,4-7,10 will mark line 1, 4 to 7 and 10. wrap Wrap the code block in true ExamplesA plain code block 1234&#123;% codeblock %&#125;alert(&apos;Hello World!&apos;);&#123;% endcodeblock %&#125;alert(&apos;Hello World!&apos;); Specifying the language 1234&#123;% codeblock lang:objc %&#125;[rectangle setX: 10 y: 10 width: 20 height: 20];&#123;% endcodeblock %&#125;[rectangle setX: 10 y: 10 width: 20 height: 20]; Adding a caption to the code block 1234&#123;% codeblock Array.map %&#125;array.map(callback[, thisArg])&#123;% endcodeblock %&#125;Array.maparray.map(callback[, thisArg]) Adding a caption and a URL 123456&#123;% codeblock _.compact http://underscorejs.org/#compact Underscore.js %&#125;_.compact([0, 1, false, 2, &apos;&apos;, 3]);=&gt; [1, 2, 3]&#123;% endcodeblock %&#125;_.compactUnderscore.js_.compact([0, 1, false, 2, &apos;&apos;, 3]);=&gt; [1, 2, 3] Backtick Code BlockThis is identical to using a code block, but instead uses three backticks to delimit the block. 1[language] [title] [url] [link text] code snippet Pull QuoteTo add pull quotes to your posts: 123&#123;% pullquote [class] %&#125;content&#123;% endpullquote %&#125; jsFiddleTo embed a jsFiddle snippet: 1&#123;% jsfiddle shorttag [tabs] [skin] [width] [height] %&#125; GistTo embed a Gist snippet: 1&#123;% gist gist_id [filename] %&#125; iframeTo embed an iframe: 1&#123;% iframe url [width] [height] %&#125; ImageInserts an image with specified size. 1&#123;% img [class names] /path/to/image [width] [height] &apos;&quot;title text&quot; &quot;alt text&quot;&apos; %&#125; LinkInserts a link with target=&quot;_blank&quot; attribute. 1&#123;% link text url [external] [title] %&#125; Include CodeInserts code snippets in source/downloads/code folder. The folder location can be specified through the code_dir option in the config. 1&#123;% include_code [title] [lang:language] [from:line] [to:line] path/to/file %&#125; ExamplesEmbed the whole content of test.js 1&#123;% include_code lang:javascript test.js %&#125; Embed line 3 only 1&#123;% include_code lang:javascript from:3 to:3 test.js %&#125; Embed line 5 to 8 1&#123;% include_code lang:javascript from:5 to:8 test.js %&#125; Embed line 5 to the end of file 1&#123;% include_code lang:javascript from:5 test.js %&#125; Embed line 1 to 8 1&#123;% include_code lang:javascript to:8 test.js %&#125; YouTubeInserts a YouTube video. 1&#123;% youtube video_id %&#125; VimeoInserts a responsive or specified size Vimeo video. 1&#123;% vimeo video_id [width] [height] %&#125; Include PostsInclude links to other posts. 12&#123;% post_path filename %&#125;&#123;% post_link filename [title] [escape] %&#125; You can ignore permalink and folder information, like languages and dates, when using this tag. For instance: . This will work as long as the filename of the post is how-to-bake-a-cake.md, even if the post is located at source/posts/2015-02-my-family-holiday and has permalink 2018/en/how-to-bake-a-cake. You can customize the text to display, instead of displaying the postâ€™s title. Using post_path inside Markdown syntax []() is not supported. Postâ€™s title and custom text are escaped by default. You can use the escape option to disable escaping. For instance: Display title of the post. 1&#123;% post_link hexo-3-8-released %&#125; Hexo 3.8.0 Released Display custom text. 1&#123;% post_link hexo-3-8-released &apos;Link to a post&apos; %&#125; Link to a post Escape title. 1&#123;% post_link hexo-4-released &apos;How to use &lt;b&gt; tag in title&apos; %&#125; How to use tag in title Do not escape title. 1&#123;% post_link hexo-4-released &apos;&lt;b&gt;bold&lt;/b&gt; custom title&apos; false %&#125; bold custom title Include AssetsInclude post assets. 123&#123;% asset_path filename %&#125;&#123;% asset_img filename [title] %&#125;&#123;% asset_link filename [title] [escape] %&#125; RawIf certain content is causing processing issues in your posts, wrap it with the raw tag to avoid rendering errors. 123&#123;% raw %&#125;content&#123;% endraw %&#125; Post ExcerptUse text placed before the tag as an excerpt for the post. excerpt: value in the front-matter, if specified, will take precedent. Examples: 123Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.&lt;!-- more --&gt;Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.","raw":null,"content":null,"categories":[{"name":"blog","slug":"blog","permalink":"https://stanxia.github.io/categories/blog/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://stanxia.github.io/tags/hexo/"},{"name":"next","slug":"next","permalink":"https://stanxia.github.io/tags/next/"}]},{"title":"è®¡ç®—æœºåŸºç¡€çŸ¥è¯†","slug":"è®¡ç®—æœºåŸºç¡€çŸ¥è¯†","date":"2020-02-06T01:28:00.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2020/02/06/è®¡ç®—æœºåŸºç¡€çŸ¥è¯†/","link":"","permalink":"https://stanxia.github.io/2020/02/06/è®¡ç®—æœºåŸºç¡€çŸ¥è¯†/","excerpt":"","text":"ç›®çš„ä¸ç§¯è·¬æ­¥ï¼Œä½•ä»¥è‡³åƒé‡Œã€‚ é“¾æ¥æˆ³æˆ‘æŸ¥çœ‹åŸºç¡€çŸ¥è¯†","raw":null,"content":null,"categories":[{"name":"basic","slug":"basic","permalink":"https://stanxia.github.io/categories/basic/"}],"tags":[{"name":"algo","slug":"algo","permalink":"https://stanxia.github.io/tags/algo/"},{"name":"basic","slug":"basic","permalink":"https://stanxia.github.io/tags/basic/"},{"name":"network","slug":"network","permalink":"https://stanxia.github.io/tags/network/"}]},{"title":"Githubä½œä¸ºå›¾åºŠ","slug":"Githubä½œä¸ºå›¾åºŠ","date":"2020-02-06T00:56:00.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2020/02/06/Githubä½œä¸ºå›¾åºŠ/","link":"","permalink":"https://stanxia.github.io/2020/02/06/Githubä½œä¸ºå›¾åºŠ/","excerpt":"","text":"ä¸ºä»€ä¹ˆä½¿ç”¨Github å› ä¸ºå…è´¹ã€‚ å¦‚ä½•ä½¿ç”¨ å› ä¸ºç›®å‰çš„ä½¿ç”¨çš„æ˜¯Macç”µè„‘ï¼Œåœ¨ç½‘ä¸Šå†²æµªæ—¶äº†è§£ä¸Šä¼ çš„å›¾åºŠçš„å·¥å…·ï¼Œæ¨èè¾ƒå¤šçš„ä¸ºä¸€æ¬¾å«ipicçš„è½¯ä»¶ï¼Œä½†æ˜¯è¯¥è½¯ä»¶ï¼š å…è´¹ç‰ˆæœ¬åªæ”¯æŒæ–°æµªå¾®åš ä¸æ”¯æŒGithubä½œä¸ºå›¾åºŠ æ‰€ä»¥æ”¾å¼ƒä½¿ç”¨è¯¥è½¯ä»¶ã€‚ ç»§ç»­ç½‘ä¸Šå†²æµªä¹‹åï¼Œäº†è§£åˆ°ä¸€æ¬¾å«åšpicgoçš„è½¯ä»¶ï¼Œæœ‰ä¸¤ç‚¹å¸å¼•æˆ‘ï¼š å¼€æº æ”¯æŒGithub é“¾æ¥ æˆ³æˆ‘äº†è§£PicGo","raw":null,"content":null,"categories":[{"name":"tools","slug":"tools","permalink":"https://stanxia.github.io/categories/tools/"}],"tags":[{"name":"tools","slug":"tools","permalink":"https://stanxia.github.io/tags/tools/"}]},{"title":"é“¾è¡¨","slug":"é“¾è¡¨","date":"2020-02-05T11:55:00.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2020/02/05/é“¾è¡¨/","link":"","permalink":"https://stanxia.github.io/2020/02/05/é“¾è¡¨/","excerpt":"","text":"æ¦‚å¿µ é“¾è¡¨ä¸éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œé€šè¿‡æŒ‡é’ˆå°†é›¶æ•£çš„å†…å­˜å—å…³è”èµ·æ¥ã€‚ æ•°ç»„ä¸é“¾è¡¨çš„æ¯”è¾ƒæœ€ç›´è§‚çš„æ¯”è¾ƒæ˜¯æ•°ç»„æ˜¯è¿ç»­çš„å†…å­˜å—ï¼Œè€Œé“¾è¡¨ä¸éœ€è¦è¿ç»­ã€‚ æ€§èƒ½æ¯”è¾ƒï¼š å¸¸è§åˆ†ç±» å¸¸è§çš„é“¾è¡¨æœ‰å•é“¾è¡¨ï¼ŒåŒå‘é“¾è¡¨ï¼Œå¾ªç¯é“¾è¡¨ï¼ŒåŒå‘å¾ªç¯é“¾è¡¨ç­‰ã€‚ å•é“¾è¡¨é¡¾åæ€ä¹‰ï¼Œå•é“¾è¡¨æ˜¯å•æ–¹å‘çš„ï¼Œé“¾è¡¨ç”±æ•°æ®ç»“ç‚¹å’Œåç»§æŒ‡é’ˆç»„æˆã€‚ ç‰¹ç‚¹ å¾ªç¯é“¾è¡¨ åŒå‘é“¾è¡¨ åŒå‘å¾ªç¯é“¾è¡¨ ç‰¹æ€§ ç¼–ç  å®ç°ä¸€ä¸ªç®€å•çš„å•é“¾è¡¨ã€‚ scalajavapython1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/* ç®€å•çš„é“¾è¡¨ /case class NodeTclass HiLinkedList[T &gt;: Null] &#123; var head: Node[T] = _ var tail: Node[T] = _ var size = 0 //æ·»åŠ ç»“ç‚¹ def add(data: T): Unit = &#123; if (head == null) &#123; head = Node(data, null) tail = head &#125; else &#123; val node = Node(data, null) tail.next = node tail = node &#125; size += 1 println(â€œAdding Action succeedï¼size is â€œ, size) &#125; //æŸ¥è¯¢ç»“ç‚¹ def find(data: T): Node[T] = &#123; var tmp = head while (tmp != null) &#123; println(â€œloop..â€) println(tmp.data) if (tmp.data == data) &#123; return tmp &#125; else &#123; tmp = tmp.next &#125; &#125; null &#125; //åˆ é™¤ç»“ç‚¹ def remove(data: T): Node[T] = &#123; val node = find(data) var tmp = head if (tmp.data == data) &#123; head = tmp.next size -= 1 &#125; else &#123; if (node != null) &#123; while (tmp != null) &#123; println(â€œremove loop..â€) if (tmp.next == node) &#123; tmp.next = node.next size -= 1 return node &#125; tmp = tmp.next &#125; &#125; &#125; node &#125;&#125; 123// todo 123Todo æ ·ä¾‹ æ­¤å¤„ä½¿ç”¨scalaå®ç°å¸¸è§çš„é“¾è¡¨æ ·ä¾‹ã€‚ LRUå›æ–‡","raw":null,"content":null,"categories":[{"name":"algo","slug":"algo","permalink":"https://stanxia.github.io/categories/algo/"}],"tags":[{"name":"algo","slug":"algo","permalink":"https://stanxia.github.io/tags/algo/"}]},{"title":"æ•°ç»„","slug":"æ•°ç»„","date":"2020-02-05T11:50:00.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2020/02/05/æ•°ç»„/","link":"","permalink":"https://stanxia.github.io/2020/02/05/æ•°ç»„/","excerpt":"","text":"æ¦‚å¿µ æ•°ç»„ï¼ˆArrayï¼‰\\æ˜¯ä¸€ç§**çº¿æ€§è¡¨**æ•°æ®ç»“æ„ã€‚å®ƒç”¨ä¸€ç»„è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨ä¸€ç»„å…·æœ‰ç›¸åŒç±»å‹çš„æ•°æ®ã€‚ ç‰¹æ€§ æ•°ç»„ä¸‹æ ‡ç”±0å¼€å§‹ä¸ºä»€ä¹ˆï¼Ÿ æ•°ç»„æŸ¥æ‰¾æ•°æ®æ—¶çš„å¯»å€å…¬å¼ä¸ºï¼šstart_address + n*data_block_sizeã€‚ ä¸€æ–¹é¢æ˜¯æŒ‰ç…§ä¸Šè¿°å…¬å¼ï¼Œå¦‚æœä¸‹æ ‡ç”±1å¼€å§‹ï¼Œåˆ™å…¬å¼ä¸ºï¼šstart_address + (n-1)*data_block_size æ¯æ¬¡å¯»å€æ—¶ä¼šåšä¸€æ¬¡ n-1çš„è¿ç®—ã€‚ å¦ä¸€æ–¹é¢æ˜¯å†å²åŸå› ï¼Œéƒ½æ˜¯ä»0å¼€å§‹çš„ã€‚ å¿«é€ŸæŸ¥æ‰¾æ ¹æ®ä¸‹æ ‡éšæœºæŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚ æ’å…¥ã€åˆ é™¤æ…¢æ’å…¥ã€åˆ é™¤ä¼šå¯¼è‡´æ•°ç»„åç»­å…ƒç´ çš„åç§»ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚ ç¼–ç¨‹","raw":null,"content":null,"categories":[{"name":"algo","slug":"algo","permalink":"https://stanxia.github.io/categories/algo/"}],"tags":[{"name":"algo","slug":"algo","permalink":"https://stanxia.github.io/tags/algo/"}]},{"title":"new 2020","slug":"new page","date":"2020-02-05T00:24:00.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2020/02/05/new page/","link":"","permalink":"https://stanxia.github.io/2020/02/05/new page/","excerpt":"","text":"æ¬¢è¿ğŸ‘é˜”åˆ«","raw":null,"content":null,"categories":[{"name":"think","slug":"think","permalink":"https://stanxia.github.io/categories/think/"}],"tags":[{"name":"think","slug":"think","permalink":"https://stanxia.github.io/tags/think/"}]},{"title":"A big week for American banks","slug":"A-big-week-for-American-banks","date":"2019-04-17T14:06:36.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/17/A-big-week-for-American-banks/","link":"","permalink":"https://stanxia.github.io/2019/04/17/A-big-week-for-American-banks/","excerpt":"","text":"Our weekly podcast on the markets, the economy and the world of business Podcasts | Apr 16th 2019 AMERICAâ€™S LARGEST banks reported earnings this week. Bank of Americaâ€™s chief executive, Brian Moynihan, tells Anne McElvoy why he is bullish about the American economy and justifies his pay package. Also, can Goldman Sachs reinvent itself in the shadow of a scandal? And Tiger Woodsâ€™s stroke of geniusâ€”for the business of golf. Simon Long hosts. Listen on: Apple Podcasts | Spotify | Google | Stitcher | TuneIn","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Indiaâ€™s enormous election, and more from our daily podcast","slug":"Indiaâ€™s-enormous-election,-and-more-from-our-daily-podcast-","date":"2019-04-17T01:32:52.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/17/Indiaâ€™s-enormous-election,-and-more-from-our-daily-podcast-/","link":"","permalink":"https://stanxia.github.io/2019/04/17/Indiaâ€™s-enormous-election,-and-more-from-our-daily-podcast-/","excerpt":"","text":"Also, moderating social media and pole-dancingâ€™s sporting ambitions Podcasts | Apr 15th 2019 THE WORLDâ€™S largest democratic exercise is under way in India. The prime minister, Narendra Modi, looks likely to win on a divisive platform of Hindu nationalism and aggression towards Pakistan, even if those are not votersâ€™ biggest concerns. Social-media companies are increasingly under the microscope of regulators; we take a look at the seemingly intractable problem of policing online content. And pole-dancing is trying to shed its seedy image. But can it develop into a global sport? Runtime: 21 min. Listen on: Apple Podcasts | Spotify | Google | Stitcher | TuneIn","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Lessons of the Mueller report","slug":"Lessons of the Mueller report","date":"2019-04-17T01:16:19.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2019/04/17/Lessons of the Mueller report/","link":"","permalink":"https://stanxia.github.io/2019/04/17/Lessons of the Mueller report/","excerpt":"","text":"Every political scandal sets a precedent for the next Mar 28th 2019 ROBERT MUELLER toiled over his report for two years, slightly longer than it took Herman Melville to write â€œMoby Dickâ€. Going by a summary provided by the attorney-general, though, the endings are the same: the whale gets away. The special counsel did not find that members of the Trump campaign conspired with the Russian government when it interfered in the 2016 election. The president is crowing. Democrats in Congress point out that Mr Mueller did not exonerate the president over obstruction of justice, which is also true. But make no mistake: this is as good an outcome as Donald Trump could have wished for. For the rest of his first term, and perhaps long into his second, he will be able to point to an exhaustive investigation and say he was right all along. The president thrives on grievanceâ€”against the media, the federal bureaucracy, or anyone he suspects of feeling superior. The outcome of the Mueller report will feed that. As a result, the silver harpoon that some Americans hoped would finish off Mr Trump may in fact strengthen him. A few lessons can be drawn from this episode. The first is not to confuse a legal process with a political one. Ever since Mr Trump won power, those Americans who could not bear the idea of him as president have dreamed of some non-political way to erase the resultâ€”of a jurist who could simply declare it all over. Mr Mueller seemed the likeliest candidate for this role, just as Kenneth Starr did in the campaign to remove Bill Clinton. In fact the fate of Mr Trumpâ€™s presidency will depend on politics, probably through the ballot box in 2020. Even those Democrats who cling to the fantasy of using Congress to impeach and remove him need to understand just how political this process would be. The fevered speculation during the two years of the Mueller investigation has often masked that. The other lesson Democrats should heed is to keep quiet about a legal process until it is over. That is worth bearing in mind as House committees under Democratic control pursue their own investigations, and courts and prosecutors look into allegations about Mr Trump and his family. Some of his opponents have prejudged these investigations. If it turns out that he did not commit the crimes they expect, they risk not just having distracted voters from the real agenda, but also giving him a boost. They should not make the same mistake twice. The Mueller investigation also holds lessons for those Republicans emboldened to seek vengeance for what they say was treason against their president. Thanks to Mr Mueller, the presidentâ€™s campaign manager and personal lawyer are both heading to prison. His national security adviser pleaded guilty to lying to the FBI about his conversations with the Russian ambassador. Since Watergate, nothing like this has happened in American politics. By revealing duplicitous and corrupt behaviour among Mr Trumpâ€™s team, and by bringing prosecutions, Mr Mueller has helped cleanse political campaigning. The investigation also revealed that the president misled voters about his business interests in Russia. While the candidate was rewriting orthodox Republican Party policy towards Vladimir Putin, his company was trying to build a skyscraper in Moscow. His retrospective justification was that he might have lost the election, in which case it would have been a shame to give up on a deal. This conflict of interest did not amount to criminal collusion or conspiracy, in the special counselâ€™s view. It is nevertheless the sort of transgression that Americaâ€™s political system would not have tolerated before Mr Trump came along. There is a last reason to be thankful to Mr Mueller. Each time Americaâ€™s political system goes through an upheaval, it sets a precedent for how its institutions will handle the next one. Mr Muellerâ€™s conduct was exemplary. If widespread misconduct once again occurs in an American presidential election, the expectation will be that a special counsel will investigate. Though Mr Trump repeatedly denounced the investigation as a witch-hunt, he did not fire the witch-finder. Mr Mueller was able to finish his work. For that, at least, Mr Trump deserves credit.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Binyamin Netanyahu a parable of modern populism","slug":"Binyamin Netanyahu a parable of modern populism","date":"2019-04-17T00:26:21.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/17/Binyamin Netanyahu a parable of modern populism/","link":"","permalink":"https://stanxia.github.io/2019/04/17/Binyamin Netanyahu a parable of modern populism/","excerpt":"","text":"In Israel, as elsewhere, politics is a perplexing mix of sound policy and the cynical erosion of institutions Mar 30th 2019 HIS DEVOTEES call him â€œThe Magicianâ€, â€œThe Winnerâ€ andâ€”the ultimate accoladeâ€”melekh yisrael, â€œKing of Israelâ€. Binyamin Netanyahu is Israelâ€™s most gifted politician in a generation. He is his countryâ€™s second-longest-serving prime minister and, if he wins his fifth election on April 9th, may beat the record of the countryâ€™s founding father, David Ben Gurion. â€œBibiâ€, as he is known by all, is important beyond Israel, too, and not only because he speaks in perfect soundbites in both Hebrew and English and stands tall in todayâ€™s chaotic Middle East. He matters because he embodied the politics of muscular nationalism, chauvinism and the resentment of elites long before such populism became a global force. Mr Netanyahu counts among his friends and allies such nationalists as Donald Trump and Narendra Modi, not to mention European ones from Viktor Orban in Hungary to Matteo Salvini in Italy. The reign of King Bibi is thus a parable of modern politics: the rise of a talented politician and a long success based on a perplexing mixture of carrying out sound policy and cynically sowing division. As his power is threatened, he has turned to railing more loudly against the free press, the judiciary and shadowy forces. Now Bibi faces his greatest danger, in the form of criminal charges for corruption. In a different age he would have had to resign, and would now be defending himself as an ordinary citizen. But he is intent on remaining in office, and hopes that voters will yet save him from the policemen, prosecutors and judges. Israeli politics is turning into a contest between genuine achievement and demagoguery on one side and the rule of law on the other. All who care about democracy should watch closely. Little Israel commands attention because it has a big history: biblical romance and technological talent; the slaughter of the Holocaust and military prowess; energetic democracy and the long occupation of land claimed and inhabited by Palestinians. That said, Mr Netanyahu is a big figure in his own right (see article). He is more intelligent and capable than many populists, and can claim plenty of successes. By shrinking the bloated state he has helped Israelâ€™s economy flourish, particularly its tech startups. With deft use of diplomacy and the mostly cautious use of military force, he has boosted security without being sucked into disastrous wars. Thanks to that and a shared hostility to Iran, relations with many Arab rulers are better than at any time in Israelâ€™s history. Yet Mr Netanyahu is also worryingly dogmatic. He has paid lip service to peace with Palestinians but has taken no meaningful steps towards it. He has denounced any Western co-operation with Iran, even if it served to limit Iranâ€™s nuclear programme. In Bibiâ€™s pessimistic view, Israel is surrounded by wolves in sheepâ€™s clothing and wolves in wolvesâ€™ clothing. Israel can only manage conflicts, not solve them, he believes, so it must rely on an iron wall and the passage of time. Such â€œanti-solutionismâ€ risks storing trouble for the future. It increases the danger of war with Iran, or of its hardliners making a dash for nukes. The more Israel entrenches itself in the West Bank, the more its â€œtemporaryâ€ military occupation looks like the permanent subjugation of Palestinians under a separate law, even apartheid. This is made worse by the absence of Americaâ€™s restraining influence. Mr Netanyahu has warmly embraced Mr Trump, who in turn has showered him with gifts, most recently his endorsement of Israelâ€™s annexation of the Golan Heights. Might Mr Trump also back Israelâ€™s annexation of bits of the West Bank, so denying Palestinians the hope of statehood? In the long run Bibiâ€™s overt alignment with Americaâ€™s Republicans and the evangelical right endangers the bipartisan pro-Israeli consensus in Washington that is the foundation of Israelâ€™s security. But the greatest threat from Bibiâ€™s reign has been at home. He has kept power not just on the strength of his record but also by seeking political advantage at the cost of eroding Israelâ€™s democratic norms. In claiming that no peace with Palestinians is possible (or desirable), members of his right-wing coalition outbid each other to pass measures asserting Jewish supremacy. Mr Netanyahu pushed for an electoral pact with the hitherto untouchable far-right Jewish Power group, which wants to annex all the occupied territories and â€œencourageâ€ Arabs, including Israeli citizens, to leave. He has played us-and-them politics for so long that he has exacerbated the countryâ€™s many schismsâ€”between Jews and Arabs, diaspora Jews and Israelis, western Ashkenazi and eastern Mizrahi Jews, and secular and religious ones. By casting himself as uniquely able to protect Israel against its enemies, he often treats those who say otherwise as wimps or traitors. Mr Netanyahu and his friends denounce as backstabbers any Jews who stand in their way. The free press peddles fake news. Political opponents, even the generals who pack the new Blue and White opposition party, are in cahoots with the Arabs. Bibi has flirted with the conspiracy theory beloved of anti-Semites that George Soros, a Jewish billionaire, is plotting to undermine nationalist governments around the world. The corruption charges against him, says Mr Netanyahu, amount to a â€œblood libelâ€â€”a vile medieval canard that accused Jews of mixing the blood of murdered Christian children in their Passover bread. Yet the police chief who investigated the charges, and the attorney-general who ordered his indictment, were both hand-picked by Mr Netanyahu. His allies want a law that would grant a prime minister immunity from prosecution. Israel is an outlier among Western democracies. It was born as the state of the Jews; Zionism and Palestinian nationalism claim the same land. Israel must contend with a genuine â€œotherâ€ and existential threats, not the bogeymen invented by populists elsewhere. The left, in disarray in many countries, suffered a body-blow in Israel because its attempt to negotiate a land-for-peace deal with Palestinians collapsed into bloodshed. Yet precisely because of these pressures, Israel offers an important test of the resilience of democracy. On April 9th Israeli voters face a fateful choice. Re-elect Mr Netanyahu and reward him for subverting the independence of Israelâ€™s institutions. Or turf him out in the hope of rebuilding trust in democracyâ€”and aspiring to be â€œa light unto the nationsâ€.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"America must stop Binyamin Netanyahu from annexing Palestinian land","slug":"America must stop Binyamin Netanyahu from annexing Palestinian land","date":"2019-04-17T00:18:03.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/17/America must stop Binyamin Netanyahu from annexing Palestinian land/","link":"","permalink":"https://stanxia.github.io/2019/04/17/America must stop Binyamin Netanyahu from annexing Palestinian land/","excerpt":"","text":"Some of his election pledges would kill the chance of a two-state solution Apr 11th 2019 MAKE IT OFFICIAL: henceforth, the Hebrew word for magician is Bibi. This is not just because Binyamin Netanyahu, Israelâ€™s prime minister, appears to have won a record fifth term in office on April 9th. It is also because he pulled off the trick with corruption charges hanging over him, and in the face of a tough challenge from a new party packed with generals. Bibi, as he is known, made some parties vanish by taking their supporters, and conjured more seats for his own Likud party. He may soon surpass David Ben-Gurion, the countryâ€™s founding father, as Israelâ€™s longest-serving leader (see article). His victory has come at a cost. His potionâ€”mixing muscular nationalism with Jewish chauvinism and anti-elitismâ€”has helped poison Israelâ€™s politics. He claims he is innocent, blaming the charges against him on shadowy plots and sowing distrust of institutions: the police, the judiciary and the media. Mr Netanyahu may do yet more lasting damage. In the final days of the campaign he vowed to annex parts of the West Bank beyond Jerusalem, something no previous leader has thought prudent. This risks killing any chance of peace based on a two-state solutionâ€”which involves the creation of a Palestinian stateâ€”and of thus turning Israel into a rogue nation. Fear not, say the optimists: Mr Netanyahu was just throwing out sweets to win over right-wing voters; he knows full well that annexation of the occupied territories would breach international law, cause an outcry in Europe and alienate Arab states that have been moving closer to Israel. The problem with this view is that it ignores the changing political and strategic landscape. Mr Netanyahu must still form a government, which means making concessions to his likely allies on the right, who feel more strongly about annexation than he does. The prime ministerâ€™s legal troublesâ€”he faces indictment on three cases of alleged corruptionâ€”leave him vulnerable. What will be the price when the Knesset considers a bill that would shield him from prosecution? If it is annexation, the process may begin with Maale Adumim, a large settlement on the outskirts of Jerusalem which the prime minister specifically promised to bring under Israeli sovereignty. But as Mr Netanyahu himself has said, it is unlikely to end there. Americaâ€™s role has changed, too. For decades its presidents acted as a counterweight to Israeli annexationists (and gave cover to prime ministers fearful of standing up to them). President Donald Trump, though, has taken Americaâ€™s finger off the scales. He has emboldened the right by recognising Israelâ€™s annexation of the Golan Heights, which it captured from Syria in 1967, and moving the embassy to Jerusalem, a contested city. Mr Netanyahu made good use of these moves in his campaign. Even if he does not feel the need to go further by formally annexing territory, there is nothing to stop the creeping sort: the expansion of Jewish settlements and their infrastructure. That is happening with barely a peep from the world, let alone the divided Palestinians. The Trump administration says it is about to release a plan for the â€œultimate dealâ€ between Israelis and Palestinians. If this is to have any hope of success, or even of starting a process, the president must rule out unilateral annexationâ€”whether or not the Palestinians participate. If Israelis can grab land at a whim, they will have little incentive to negotiate. If Palestinians see parts of their future state taken away willy-nilly, neither will they. In the end, Israel faces a stark choice. Jews and Arabs count roughly equal numbers between the Mediterranean and the Jordan river. So Israel cannot permanently hold on to all the land without sacrificing either its Jewish majority or the ideal of a proper democracy that does not discriminate against Arabs. The more Mr Netanyahu abandons land-for-peace, the more the choice will be annexation-for-apartheid. That dilemma is something even Bibi cannot conjure away.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"â€œFosse/Verdonâ€ is a compelling examination of a creative partnership","slug":"â€œFosse-Verdonâ€ is a compelling examination of a creative partnership","date":"2019-04-16T23:54:24.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2019/04/16/â€œFosse-Verdonâ€ is a compelling examination of a creative partnership/","link":"","permalink":"https://stanxia.github.io/2019/04/16/â€œFosse-Verdonâ€ is a compelling examination of a creative partnership/","excerpt":"","text":"Bob Fosse and Gwen Verdon were integral to some of the 20th centuryâ€™s biggest musicals Prospero | Apr 16th 2019 â€œFOSSE/VERDONâ€, a new mini-series about two Broadway legends, could have been a simple paean to the magic of the stage. Bob Fosse (Sam Rockwell), a director, and his wife Gwen Verdon (Michelle Williams), a dancer, helped to create hits such as â€œDamn Yankees!â€, â€œChicagoâ€ and â€œCabaretâ€. There is plenty of exquisite choreography, as legs kick in perfect time and dazzling costumes shimmer on twisting bodies, plus a sparkling rendition of â€œBig Spenderâ€. Elsewhere, in a fantasy scene, Fosse twirls effortlessly down a corridor, surrounded by colourful dancers. But the show turns out to be a surprisingly moving examination of the characters of Fosse and Verdon, as well as their extraordinary careers. It opens with the build-up to â€œCabaretâ€, Fosseâ€™s best-known film, which he directed and choreographed in 1971. The viewer is transported from Hollywood to damp, dark Munich, where it was shot, and the pressure is palpable. The film cannot afford to be â€œanother $20m fiascoâ€, a producer warns, referring to one of Fosseâ€™s previous misses. Fosse, in turn, takes it out on his crew. â€œI wanna see every muscle, every tendon,â€ he barks during exhausting rehearsals for â€œMein Herrâ€, one of the nightclub songs. After seeing the first cut, he moans to his assistant that â€œitâ€™s unwatchableâ€. On the night of the premiere, he paces in the auditorium rather than watching the film (it was a box-office triumph and would go on to win eight Oscars). His personal torment, and abject terror of failure, is clear. The programme dances back and forth in time. Title cards, such as â€œHollywood: 19 years leftâ€ and â€œGwen Verdon: 14 years after her last Tony awardâ€, contextualise the scenes, which range across five decades. It allows the viewer to see patterns emerge. A flashback to Fosseâ€™s childhood dance classes, for exampleâ€”â€œdonâ€™t show me the effort, Bobby, donâ€™t show me the sweat. All they wanna see is that smileâ€â€”helps to explain Fosseâ€™s treatment of his own dancers. Depictions of his career highs jar with his descent into depression and alcoholism, as well as scenes of childhood abuse. His wild lifestyle of pills, sex, parties and more pills, is juxtaposed with images of Verdon feeding their daughter dinner and arranging child care. The effect is troubling, and powerful. Mr Rockwellâ€™s thoughtful and pained performance elicits a surprising amount of sympathy for Fosse, even as he behaves appallingly. One excruciating scene shows a lead dancer refusing his sexual advances; she is subsequently fired. But the decision to give Verdon equal billing in the production was a wise one (the series was originally adapted from â€œFosseâ€, a biography written in 2013, but the producers realised that this would result in a narrow, uneven story). She emerges as a quiet kind of hero, helped by an elegant performance by Ms Williams. Verdon, as well as being Fosseâ€™s long-suffering wife, was his creative collaborator. Her career peaked in the 1950s, when she won a string of Tony awards, but she gradually lost her hold over Hollywood and was eventually eclipsed by her husband. Yet when â€œCabaretâ€ hits a crisisâ€”the endless rehearsals are ruining the shooting schedule, and the budgetâ€”it is Verdon that Fosse needs, begging her to come and join him in Germany. She sweeps in, taking charge of hair and make-up and fine-tuning the dancing. Where Fosse had used the dancers as moving props, Verdon makes them into fleshed-out characters with backstories. As such, â€œFosse/Verdonâ€ reminds viewers that great feats are rarely accomplished alone (a theme that Lin-Manuel Miranda, an executive producer of the series, touched upon in â€œHamiltonâ€, his own musical hit). Tributes to Tinseltown and Broadway, such as â€œLa La Landâ€, often focus on the glamour and romanticism of it all. â€œFosse/Verdonâ€ is all the better for lifting the stage curtain to look at the people behind it. The series understands that while show business projects an image of human perfection, its masters are as flawed as they are brilliant. â€œFosse/Verdonâ€ is showing on FX in America now. It will be released in Britain on BBC Two later this year","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Chevron is buying Anadarko for $33bn","slug":"Chevron is buying Anadarko for $33bn","date":"2019-04-16T23:16:56.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/16/Chevron is buying Anadarko for $33bn/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Chevron is buying Anadarko for $33bn/","excerpt":"","text":"The deal signals greater consolidation in the shale business Apr 13th 2019 IN RECENT MONTHS a question has been hanging over the plains of Texas: what would be the next big shale deal? The logic for consolidation seemed clear. Texasâ€™s Permian basin is Americaâ€™s most productive oilfield, despite a patchwork of plots with hundreds of owners. Shale companies looked cheap, with investors sceptical about firmsâ€™ ability to produce both oil and profits. On April 12th the curious got their answer. Chevron, a giant oil company, will pay $33bn in cash and shares to buy Anadarko, an independent producer with rich holdings in the Permian. It will also assume Anadarkoâ€™s $16bn debt. The deal transforms Chevron into the worldâ€™s second-biggest publicly traded oil-producer, behind only ExxonMobil. It is the latest sign of shaleâ€™s growing importance to the worldâ€™s biggest energy firms. Oil majors have arrived relatively late to fracking. Small, independent companies were first to set about coaxing oil from shale. They developed ways to drill not just down but horizontally, then assault shale with water and sand until the rock gave up its hydrocarbon riches. But the industry titans have warmed to the idea. Unlike, say, a complex deepwater project in a distant jurisdiction, shale offers quick drilling times, predictable cashflow and favourable American regulation. Smaller companies have often fracked frenetically, eager to reinvest proceeds and chase growth. Too frenetically at times; some took on more debt than they could handle. Giant companies have less experience with the technique. But their diversified revenue and larger balance-sheets allow them to accumulate acreage even as they drill at a more measured pace. Last year BP, a British firm, paid $10.5bn to acquire the shale assets of BHP, a giant miner. ExxonMobil and Chevron have placed the biggest bets. Chevronâ€™s shale holdings were vast even before the Anadarko deal. The company controlled 1.7m acres (690,000 hectares) in two of the Permianâ€™s most productive regions. In March ExxonMobil said it expects production in the Permian to exceed 1m barrels a day within five years. With Anadarko, Chevronâ€™s Permian production may be 60% higher than ExxonMobilâ€™s, according to Rystad Energy, a research firm. Anadarko gives Chevron more than just shale. Its assets include a liquefied-natural-gas project in Mozambique and holdings in the Gulf of Mexico. Still, Anadarkoâ€™s Permian plots would have been the main lure. With them, Chevron can drill more wells, more efficiently. Adjacent plots will let the company move farther sideways through the rock and simplify the transport of equipment and other inputs, such as the millions of gallons of water required to wrest oil from each well. Chevron reckons that the deal will bring $2bn in savings, all told. Some investors hope that, as shale companies consolidate, they will mature and their performance will improve. Independent producers may now bulk up, following the lead of Concho Resources. Last year it bought RSP Permian, a rival, for $9.5bn. Meanwhile, the supermajorsâ€™ holdings look poised to expand. ExxonMobil has said it would consider additional shale acquisitions. Royal Dutch Shell is rumoured to be weighing the purchase of Endeavor Energy, whose headquarters sit in the heart of the Permian. Not all investors are sold on the attractions of shale. Follow This, a group of them concerned about climate change, expressed disappointment that Chevron would spend $33bn on Anadarko, rather than on renewable energy. At its annual meeting next month, Chevronâ€™s shareholders will vote on a resolution that would compel the company to disclose how it can reduce its carbon footprint in line with the Paris climate agreement. Chevron insists that it is â€œpositioned to win in any environmentâ€. An environmentally friendlier one may be an exception.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Tiger Woods wins his fifth Masters in a comeback for the ages","slug":"Tiger Woods wins his fifth Masters in a comeback for the ages","date":"2019-04-16T23:16:55.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2019/04/16/Tiger Woods wins his fifth Masters in a comeback for the ages/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Tiger Woods wins his fifth Masters in a comeback for the ages/","excerpt":"","text":"But if history is any guide, he is running out of time to beat Jack Nicklausâ€™s 18 major victories Game theory | Apr 15th 2019 JUST A YEAR and a half ago, the most common question about Tiger Woodsâ€™s future was not whether he would win another major tournament, but whether he would ever play competitively again. After an unprecedented run of glory in which he won 14 majors in just over 12 years, Mr Woods saw his career derailed by an infidelity scandal, injuries and over-use of prescription drugs. Already on the wrong side of 40 years old, Mr Woodsâ€™s legacy appeared to be fixed: a star that burned brighter than any other but was extinguished far too soon, a victim of the hubris caused by too much success at too young an age. That was then. On April 14th Tiger unleashed his roar once againâ€”literally. After winning the Masters Tournament for the fifth time and a major championship for the 15th, he screamed at the top of his lungs while lofting his arms and putter high into the air, before embracing his caddy, family members and vanquished rivals as he seemed to fight back tears of joy. Much like the broader narrative of his career, it was also the first time he had come from behind to secure a major: in all of his previous victories, he had led at the start of the final round. Mr Woodsâ€™s title is not only a personal triumph, but also a welcome boon to golf as a game. Only the presence of its biggest star atop the leaderboards enables it to compete with the most popular team sports for viewership and cultural relevance. No one would confuse the play of the grizzled, 43-year old Mr Woods with that of the 21-year-old phenom who won the Masters by a record 12 strokes in 1997. Whereas the young Mr Woods was so dominant that he barely seemed to be playing the same sport as his competitors were, this version seemed all too human. He frequently sprayed drives into the trees and misfired on straightforward putts, turning birdies into pars and pars into bogeys. He trailed by four strokes after the first round, by one at the cut and by two on Sunday morning. But just as Mr Woods has learned how to deal with adversity in his personal life, so too has he mastered how to limit the cost of mistakes on the golf course. Time and again, Mr Woods found a window through trees or a path around hazards, recovering from an errant tee shot with a pinpoint approach. (His driving accuracy of 62.5% was among the worst in the tournament, while his 81% rate of reaching greens in regulation was the best.) On the par-four ninth hole on the final day, his second shot landed at the far end of a long, downward-sloping greenâ€”a predicament in which the younger Mr Woods rarely found himself, where escaping with a par would feel like an eagle. Now a wily veteran, Mr Woods uncorked a lag putt for the ages. He aimed the ball on a line far above the straight path to the hole, and barely tapped it despite the vast distance. It almost stopped short as it approached the ridgeâ€”and then veered hard towards the hole, gaining speed as it plunged downhill, before coming to rest just inches from its target. The stroke he saved after tapping in for par wound up constituting his entire margin of victory, encapsulating the story of the tournament: unlike his rivals, Mr Woods refused to beat himself. Even after that par save, Mr Woods trailed Francesco Molinari by a strokeâ€”a deficit that doubled after he bogeyed the tenth hole. EAGLE, The Economistâ€™s statistical win-probability model for golf tournaments, gave Mr Molinari a 65% chance of victory heading into the 12th hole, while Mr Woods languished at 16% (see chart). Just last July, Mr Molinari got the better of Mr Woods, when they were in the same playing group on the final day of the Open Championship in Scotland and Mr Molinari went on to win. This time, however, Mr Molinari succumbed to the demons that have undone so many a contender on the back nine on Sunday at Augusta National Golf Club. He left his tee shot short on the par-three 12th, seeing it disappear into the waters of Raeâ€™s Creek, and then failed to make his putt for bogey. Mr Woods, in contrast, played it safe and made par. Three holes later, Mr Molinari saw his hopes of trying on his first Masters victorâ€™s green jacket dashed for good. A poor drive on the par-five 15th forced Mr Molinari into an awkward approach shot, which bounced off a tree and wound up in the water as well. Mr Woods, meanwhile, displayed the steely resolve that made him an icon a decade ago. On the same hole that finished Mr Molinari, Mr Woods secured a birdie with a dead-centre drive, a meticulous approach to the green, and a clean two-putt. And on the next hole, the par-three 16th, he delighted the fans with a taste of his magic of yesteryear. His high-arcing tee shot first hit the green beyond one-putt range. But it then rolled sideways towards the hole like a heat-seeking missile, until he was assured of a tap-in birdie and a two-stroke lead. Even then, Mr Woods wound up needing stumbles from his rivals to compensate for his own. Both Dustin Johnson, who by most statistical measures is currently the best player in the world, and Brooks Koepka, who had won three of the past six majors he had entered, reached the 18th green at 12 under par with achievable, if challenging, birdie putts. Both missedâ€”barely, in Mr Johnsonâ€™s case. That wound up making the difference in the tournament, as Mr Woods muffed both his approach shot on the 18th and his putt for par. No one dreams about winning the Masters with a bogey, but it was a fitting end to a gritty triumph. Must it be St Nicklaus? Mr Woodsâ€™s victory gives him a long-overdue 15th major title, leaving him three behind Jack Nicklausâ€™s all-time record of 18. Mr Nicklaus won his last at the age of 46, suggesting that Mr Woods has at least three more years to bridge the gap. Now that Mr Woods has rediscovered his form, might golfâ€™s most treasured record now be within reach? The afterglow of Mr Woodsâ€™s win is probably not the best time to preach faith in statistical golf models. EAGLE gave him just a 2.2% chance of winning the Masters, less than half the probability implied by pricing in betting markets. Although such odds might appear uncommonly long, they were no knock on Mr Woodsâ€™s game: most major victors start the tournament with less than a one-in-20 chance. In EAGLEâ€™s estimation, Mr Woods was playing sufficiently well before the Masters began that he was already one of the top ten players in the world. Instead, the daunting odds were merely a reflection of how much good fortune is required, in addition to elite skill, to beat a field containing all of the worldâ€™s best players over just 72 holes. Even Mr Johnson, whom the model anointed as the favourite and finished tied for second, had less than a 10% shot to win. The brutal arithmetic of large golf tournaments suggests that if Mr Woods is now a top-five player, he would be expected to win another major roughly once every 3.5 years. As a â€œmereâ€ top-ten competitor, that frequency would fall to around one every six years. From this perspective, Mr Nicklaus should only feel threatened if Mr Woods manages to regain his former status as the unquestioned world number one despite his advanced age. That would mean following up this Masters victory with a steady drumbeat of scores in the 60s and finishes in the top 5 and 10 of PGA Tour events. (Mr Woodsâ€™s Masters performance alone has improved EAGLEâ€™s estimate of his expected score on a typical course by over a tenth of a stroke per round). Otherwise, the smart money will probably remain on Mr Woodsâ€™s major-championship tally remaining at 15. However, statistical models rely on extrapolating historical patterns into the future. And since no one has ever played golf as well as Mr Woods did at his best, there is no precedent on which to train a model for the second act of such a career. As the crowds roared following his every birdie and his rivalsâ€™ every misstep, distracting players two or three holes away, a victory that was still statistically improbable already felt inevitable in the heart of every fan who had seen Mr Woods in his heyday. Much to the delight of the lords of golf, even the most casual of observers will make sure to tune in the next time Mr Woods strides to the tee box with a major on the line.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"A new era at Goldman Sachs starts in the shadow of a scandal","slug":"A new era at Goldman Sachs starts in the shadow of a scandal","date":"2019-04-16T23:16:54.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/16/A new era at Goldman Sachs starts in the shadow of a scandal/","link":"","permalink":"https://stanxia.github.io/2019/04/16/A new era at Goldman Sachs starts in the shadow of a scandal/","excerpt":"","text":"Can the bank reinvent itself? Apr 15th 2019 NO ONE IS more aware of the value of a brand than Goldman Sachs. The investment bank, founded in 1869, has advised the biggest and best American companies on the value of theirs for the past 150 years. It helped F.W. Woolworth, a pioneering department store, with its initial public offering in 1912. It took Ford and Disney public in the 1950s, helped Amazon buy Whole Foods in 2017 and will take Uber public later this year. Yet these are troubling times for its own brand, tarnished by association with a fraud-ridden Malaysian state-run fund, 1MDB, and hurt by the bankâ€™s failure to adapt after the global financial crisis. These issues were echoed in the firmâ€™s first-quarter results, released on April 15th. Revenues came in below expectationsâ€”13% lower than for the first quarter of 2018â€”largely as the result of lower trading revenues. The share price fell more than 3% and the earnings call was peppered with analysts asking questions about 1MDB. The first task for David Solomon, who took over as chief executive last October, is to clean up Goldmanâ€™s reputation. In 2012 and 2013 it helped 1MDB raise $6.5bn across three bond offerings, earning $600m in feesâ€”way above the norm for such work. American and Malaysian authorities have alleged that much of the money raised was stolen in a scheme masterminded by Jho Low, a Malaysian financier. He has denied wrongdoing (and vanished). Last November Americaâ€™s Department of Justice (DoJ) announced that a former senior partner at Goldman, Tim Leissner, had pleaded guilty to conspiracy to launder money and to violate foreign bribery laws. And they indicted Mr Low and another former Goldman banker, Roger Ng, who has also denied wrongdoing. Goldman claims that Mr Ng and Mr Leissner, who transferred embezzled funds into his personal bank account, kept the bank in the dark about their actions. But criminal charges have been filed against the firm in Malaysia. Though Goldman is contesting the case, it is spooking shareholders, who worry about both onerous fines and what it implies about oversight at the bank. Since November its share price has under-performed an index of other bank stocks by 10.3 percentage points, suggesting that the scandal may have wiped as much as $9.1bn off its value. It is against these headwinds that Mr Solomon must try to convince investors that Goldman can reinvent itself. Its peers have already digested the fact that Wall Streetâ€™s traditional model, in which banks advise on huge corporate deals and make bold trades on their own behalf, has become less profitable. According to Michael Spellacy of Accenture, a consultancy, 90% of the economic profit made in the capital-markets industry is now earned on the buy sideâ€”that is, by those who manage assets or investmentsâ€”and just 10% from sell-side investment-banking activities. A decade ago, he says, that split was closer to 50-50. Goldmanâ€™s slowness in reacting to these structural changes has allowed its competitors to catch up. In 2010 its return on equity (ROE) was 11%, easily beating the 8% average for â€œbulge-bracketâ€ American investment banks, a group including JP Morgan and Morgan Stanley. But last year that group averaged an ROE of 11.2%, placing Goldman, at 12%, near the middle of the pack. And investors are becoming concerned about the way it earns its returns. Volatile profits, like those from trading businesses, mergers and acquisitions, are considered less valuable than steady fee-based income, for example from wealth management. In 2016 Mr Solomonâ€™s predecessor, Lloyd Blankfein, took the first steps towards a new strategy by launching a consumer bank, Marcus. In 2017 Goldman announced a target of increasing yearly revenues by $5bn by 2020. But the focus on expanding consumer lending, which offers a relatively low return on investment, did not impress shareholders. They have had a rough ride. Holding shares in the firm since 2010 would have earned just 13% (without adjusting for inflation), compared with an average of 71% for its bulge-bracket peers and 152% for the S&amp;P 500. Goldman continues to trade at just 0.9 times its tangible book value, a measure of the money that might be returned to shareholders if it were liquidated. The average ratio of price to tangible book value for a bulge-bracket bank is 1.15. As far as 1MDB is concerned, the big worry for shareholders is the size and scope of the penalties. A large fine is all but inevitable. It could be based on the $600m Goldman earned from the bond issuanceâ€”or the $2.7bn American authorities say was stolen from the proceeds. That will be multiplied by anything up to four, depending on the degree to which the firm is found culpable. That Goldman is co-operating with the DoJ will bring the multiplier down; if the DoJ decides the firmâ€™s oversight of compliance procedures was inadequate, it will be towards the higher end. Steven Chubak of Wolfe Research, an equity-research firm, thinks the total will be somewhere between $1bn and $4bn. When it comes to the required shift in strategy, however, Goldmanâ€™s efforts may soon start to bear fruit. Its expansion into consumer businesses is continuing apace. In 2018 it acquired Clarity Money, a personal-finance app. Last month Tim Cook, Appleâ€™s chief executive, announced that it will launch a credit card with Goldman this summer. When Marcus launched it was as a consumer lender; since then it has added deposit-taking. Though it offers market-leading rates, deposits are still a cheap source of funding. In 2012 just 8% of Goldmanâ€™s funding came from deposits. Last year that share had risen to 19%. If it can keep replacing wholesale funding with deposits at the pace of the past five years, says Mr Chubak, it will have reduced funding costs by $500m by 2022. The consumer space is not the only place Goldman is rolling out new technology. More than a quarter of Goldmanâ€™s employees are now engineers, says Heather Kennedy Miner, the bankâ€™s head of investor relations. The firm has deployed a new platform, called Marquee, for institutional investors and will expand into corporate cash management in 2020, which will further increase low-cost deposits. The firm also seems to be planning an overdue restructuring of its fixed-income, currency and commodities (FICC) business. Revenues earned from FICC have fallen from $13.6bn in 2010, accounting for more than a third of Goldmanâ€™s revenues, to $5.9bn now, or just a sixth. Last October Stephen Scherr, Goldmanâ€™s newly appointed chief financial officer, announced a review of all its business lines, which will be published early next year. In February the Wall Street Journal reported that the commodities business would be scaled back. (Mr Scherr emphasises that Goldman has no plans to abandon commodities entirely, as some of its competitors, including JP Morgan and Morgan Stanley, have.) In March Mr Solomon announced plans to cut the number of staff in sales and trading by 5% this year. Its new strategy will mean Goldman is competing on less familiar territory. Consumer deposits and corporate cash management are competitive markets that JP Morgan and Bank of America have dominated for decades. But they are also huge markets. Even a small slice could have a big impact on Goldmanâ€™s profits, says Mr Scherr. Compared with established banks, Goldman is able to develop and deploy new technology easily; but unlike startup digital competitors, its innovations are backed by a $925bn balance-sheet. Americaâ€™s financial-services industry has been slow to adapt to technological change. An old bank with a new direction might be well-placed to disrupt it.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"A terrible blaze devastates Notre Dame cathedral","slug":"A terrible blaze devastates Notre Dame cathedral","date":"2019-04-16T23:16:53.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/16/A terrible blaze devastates Notre Dame cathedral/","link":"","permalink":"https://stanxia.github.io/2019/04/16/A terrible blaze devastates Notre Dame cathedral/","excerpt":"","text":"Stunned Parisians watch centuries of history dissolve in flames Apr 15th 2019 THEY GATHERED on the bridges over the Seine to watch in disbelief. Some Parisians were in tears; most watched in eerie silence. The devastating fire that broke out in the wood-timbered roof of the gothic cathedral of Notre Dame in the early evening of April 15th rapidly spread before their eyes, consuming the central spire and defeating the efforts of fire-fighters to bring the flames under control. President Emmanuel Macron, spoke for many across France when he tweeted that he was witnessing â€œpart of us burn.â€ By midnight in Paris the worst seemed to be over. The main stone structure appeared to have been saved, and the prompt action of hundreds of fire-fighters had rescued many works of art and relics from the burning building. But as well as the medieval oak-beamed roof and the later-built spire, the damage to the interior has been immense. The 850-year-old edifice had survived war, revolution and Nazi occupation, an emblem of resistance in the face of a constantly disrupted history. It was the site of Napoleonâ€™s coronation in 1804 and the inspiration for literary works, most famously Victor Hugoâ€™s â€œThe Hunchback of Notre-Dameâ€, and one of the cityâ€™s most iconic landmarks, visited by 13m tourists each year. Notre Dame was at once a living place of worship for the French Catholic church and the property of the French secular state: a symbol in itself of the countryâ€™s history and its present, in all its glorious contradictions. The heartbreak felt by many as they watched nine centuries of history dissolve in flames was profound. Bertrand DelanoÃ«, the former mayor of Paris, called the cathedral a â€œjewel of the heritage of humanityâ€. Mr Macron, who had been preparing to give a televised address to the nation at the end of his â€œgreat national debateâ€, cancelled the speech and went straight to the site of the disaster. It will take time and a full investigation before the exact cause of the fire is established. Early reports from the Paris fire service suggested that it was not a work of arson but an accident that broke out in the central roof, where building works were underway to renovate the 19th-century spire. But already questions are being asked about disaster-planning for a monument of this scale and national importance, situated amid narrow streets on an inaccessible island in the centre of the city. The search for somebody to blame will absorb France for weeks and months to come. The public prosecutor has opened an inquiry. When shock and disbelief turns to anger, many will want to know exactly what precautions were taken by those working on the renovation, and why it was so difficult for fire-fighters to stop the blaze spreading. Five hundred were deployed, but it took them ages to get there. Some will look to Anne Hidalgo, the mayor of Paris, who tweeted that she had â€œno words for the painâ€ she felt. Others still will look to Mr Macron. The unpopular president already had his hands full dealing with the gilets jaunes (yellow jackets) protests, which have dragged on since last November. This evening was supposed to mark the moment that he reconnected with the French people, and put his reputation for haughty rule behind him. Now he has a different challenge. Paris, and all of France, is hurting. The tragic devastation of Notre Dame will touch the country for a long timeâ€”and put the head of stateâ€™s capacity to touch the French with the right words of consolation to a severe test. He made a good start last night, visiting the scene and pledging that â€œwe will rebuildâ€ the cathedral. It is a task that will take many, many years.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Right-wing populist parties are polling well in Britain","slug":"Right-wing populist parties are polling well in Britain","date":"2019-04-16T23:16:52.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2019/04/16/Right-wing populist parties are polling well in Britain/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Right-wing populist parties are polling well in Britain/","excerpt":"","text":"Recent opinion surveys show the new Brexit Party is gathering support Apr 15th 2019 BRITAINâ€™S NEW Brexit party has gathered support with remarkable speed. Formed in January 2019, it is already registering double-digit support in opinion polls and has nearly caught up with the UK Independence Party (UKIP), from which it split. The new party is headed by Nigel Farage, the former leader of UKIP, who successfully pushed the Conservative party to call a referendum on Britainâ€™s membership of the European Union in 2016â€”and helped the Leave campaign to victory. It was a stunning achievement for what had been regarded as a fringe party, and Mr Farage announced his retirement from politics. Now he is back. Without Mr Farage, UKIP has drifted ever farther to the xenophobic far right under successive leaders. The Brexit Party, for its part, says it aims to draw support from across the political spectrum, from both Conservatives and Labour Brexiteers, to ensure that Britain leaves the EU. The referendum marked UKIPâ€™s high point. In the general election held in 2017 it received just 1.8% of the votes, down from 12.6% in 2015. Even as it became clear that Brexitâ€”at least as hardline Brexiteers had imagined itâ€”was running into trouble, UKIP still polled only about 4% on average in 2018. But populist parties have regained momentum since the beginning of this year. The government lost one vote after another on its deal with the EU, and Brexit has been repeatedly delayed. The original deadline of March 29th has been pushed back to October 31st. Unless an agreement is reached soon, Britain will have to hold elections to the European Parliament next month, which will be another humiliation for Theresa May, the prime minister. Populists and hard Brexiteers accuse members of Parliament of betraying Brexit. The latest survey gives populist parties a combined vote of 21%. The Brexit Party, which Mr Farage recently described as â€œa virtualâ€ party, consisting of little more than a website, is just behind UKIP on 10%. Both are ahead of the pro-Remain Liberal Democrats on 8% and not far behind the Conservatives on 14%. The contrast between the Brexit party and its mirror-image, Change UK, a new party made up of Remainers drawn from Labour and the Conservatives, is striking. Change UK barely figures in the polls despite having lots of favourable press coverage and several prominent MPs. It suffers from a serious branding problem: it faffed around with its name, does not have a leader and failed to present itself as a full-throated anti-Brexit Party. It could learn a lesson or two from the astute Mr Farage.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Sudanâ€™s protesters stand firm for civilian rule","slug":"Sudanâ€™s protesters stand firm for civilian rule","date":"2019-04-16T23:16:50.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2019/04/16/Sudanâ€™s protesters stand firm for civilian rule/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Sudanâ€™s protesters stand firm for civilian rule/","excerpt":"","text":"The generals have blinked and replaced one of their own Apr 15th 2019 AWAD IBN AUF was leader of Sudan for just over a day. In his brief spell as head of state the former vice-president and defence chief declared a three-month state of emergency, suspended the constitution, arrested a few senior officials and announced a curfew. â€œThe people asked us to take overâ€¦and we did,â€ he said in a stony-faced televised address on April 11th, shortly after placing his boss, Omar al-Bashir, under house arrest. It looked as if four months of nationwide protests against Mr Bashir and his 30-year-old autocracy had culminated in a coup. Sudanâ€™s demonstrators, who have been camped outside the headquarters of the armed forces in central Khartoum since April 6th, were having none of it. Though they had called on the army to side with them in order to topple Mr Bashir, who has ruled since 1989, his bloodstained deputy was far from the replacement they had in mind. Mr Auf has had sanctions placed on him by America for his role in war crimes (his former boss has been indicted by the International Criminal Court for genocide in Sudanâ€™s Darfur region). Faced with a storm of popular outrage, the short-lived autocrat stepped down on April 12th. He was replaced by another general, Abdel-Fattah Burhan, then head of the army. Mr Burhan is said to be more popular with rank-and-file soldiers, many of whom are sympathetic to the demonstrators. Mr Burhan has so far made a better fist of the job. His speech on April 13th was less tone-deaf than that of his predecessor. He commended the revolution, particularly noting the prominent role played by women in the protests that began in December in response to rising food prices. He paid tribute to the civilians who have been killed by security forces in the past four months. More concretely, he promised to hand over power to civilians after a transition period of no more than two years. On April 13th the opposition nominated delegates to begin negotiating with a military council headed by Mr Burhan. In the first meeting the council promised to repeal all repressive laws and to oversee a predominantly civilian administration, according to the Sudanese Professionalsâ€™ Association (SPA), which organised many of the protests. Alongside this, the military council moved to weaken the power of the former tyrant. It replaced Salah Abdallah Gosh, the intelligence chief widely regarded as the second most powerful man in the country after Mr Bashir. On April 14th the military council said it had arrested members of Mr Bashirâ€™s National Congress Party (NCP) and would begin seizing the partyâ€™s assets. It also promised to restructure Mr Goshâ€™s notorious intelligence agency and to allow the opposition to choose a new prime minister. But the protesters remain dissatisfied. â€œWe canâ€™t live on promises,â€ says Hamid Murtada, an activist. The SPA has called for the sit-in outside the defence ministry to continue until the â€œdeep stateâ€ is fully dismantled. Many people are particularly worried by the appointment of Mohamed Hamdan Dagalo (known as Hemeti) as the military councilâ€™s deputy leader. A paramilitary unit he was in charge of, the Rapid Support Forces, with links to the notorious Janjaweed militia, was involved in the mass rape and butchery of civilians while battling rebels in Darfur. He and others in the juntaâ€™s top ranks are close to Saudi Arabia and the United Arab Emirates, both of which welcomed developments over the weekend. Saudi Arabia has promised aid to help ease the countryâ€™s economic woes. Whether the junta will actually relinquish power remains to be seen. â€œItâ€™s very possible the military said all that just to end the sit-in,â€ says Mohammed Osman, an analyst in Khartoum. Indeed, on the morning of April 15th it tried again to disband the protest, this time asking demonstrators to help clear roadblocks. After a brief stand-off the soldiers retreated. â€œClean up the regime and weâ€™ll clean up the square,â€ shouted protesters as they departed. The generals had better put their aprons on.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Have Arthur Millerâ€™s plays lost their edge","slug":"Have Arthur Millerâ€™s plays lost their edge","date":"2019-04-16T23:16:48.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/16/Have Arthur Millerâ€™s plays lost their edge/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Have Arthur Millerâ€™s plays lost their edge/","excerpt":"","text":"The problem often lies in the staging, not the works themselves Prospero | Apr 15th 2019 ARTHUR MILLER did not aim to please his audiences. He reckoned that new ideas were a â€œhumiliationâ€ and an â€œaffrontâ€ not only to peopleâ€™s sensibilities but to their convictions, too. Like the ancient Greeks, Miller thought of drama as a â€œcivic artâ€, a discipline that could contribute towards a stateâ€™s social and political progress. Unlike his contemporaries, he was not commercially minded. He said what no one else had the courage to, and his audiences would weep, or sit with their heads bowed. Irate patriots picketed theatres, and producers shied away from his work. Actors who appeared in his plays were shunned by their friends. Millerâ€™s observations hold true in the 21st century, particularly about the fallacy of the American Dream. Many still think of material wealth and status as essential to happiness, as Willy Loman does in â€œDeath of a Salesmanâ€. â€œThe American Clockâ€, which reflects on the Wall Street Crash and the Great Depression, is a reminder of the perils of short-termism. â€œThe Priceâ€, set 30 years later, focuses on the longer-term repercussions. In â€œAll My Sonsâ€ Miller questions individualist thinking. â€œThe Crucibleâ€ examines the destructive allure of ideologies. Those insights, far from alienating todayâ€™s audiences, are now Millerâ€™s selling points. Productions of his work have increased since his death in 2005, according to Susan Abbotson, the president of the Arthur Miller Society. He has been among the ten most-performed playwrights in American theatres for the past four years. Six productions of his work are currently being staged in London, an unusually high number for any playwright other than William Shakespeare. Tickets in the West End sell for as much as Â£142 ($186), a sum Miller would no doubt have been uncomfortable with given his belief that theatre should be affordable. Does this popularity suggest that his plays have lost their subversive edge? Perhapsâ€”time can dull even radical ideas. It is no longer shocking to hear that humans are doomed to repeat their mistakes. But Millerâ€™s fashionableness also suggests that directors have stopped confronting their audiences, and have started pandering to them. A recent production at the Union Theatre of â€œAn Enemy of the Peopleâ€, Millerâ€™s adaptation of Henrik Ibsenâ€™s play, had an image of President Donald Trump on its poster. The action was set in a contemporary â€œsmall-town Republicanâ€ community. Mayor Stockmann, a manipulative politician, dresses in a red suit, grinning and waving to chants of â€œUSA! USA!â€ Miller never assigned a political persuasion to the playâ€™s charactersâ€”he saw himself as a mediator, showing disparate groups what they have in commonâ€”but the suggestion here was that only Republicans can succumb to populist rhetoric and misinformation. This version of â€œAn Enemy of the Peopleâ€ reinforced divisions, and allowed its audience to leave feeling smug. Productions can also be too reverent of the source material. â€œThe Priceâ€ (at Wyndhamâ€™s Theatre) strives for a historically accurate depiction of New York in the 1960s. The audience sees Gregory Solomon, a Russian-Jewish Ã©migrÃ©, blessing his meagre lunchâ€”a hard-boiled eggâ€”in Hebrew. When the play was first performed in 1968, such details invited audiences to reflect on their cityâ€™s recent past, particularly the emotional fall-out from the boom and busts of the â€˜20s and â€˜30s. Now heightened for comic effect, they seem alien and strange. Miller wanted his plays to be relatable, not preserved in aspicâ€”â€œthere are museums for such activities,â€ he saidâ€”and so the setting must be familiar. In 2012 a production in Mumbai turned Solomon into a Muslim nonagenarian to great effect. Millerâ€™s plays provoked because they were about the audience as much as for them. â€œThe Crucibleâ€ (pictured, at the Yard Theatre) opens with the townspeople of Salem dressed in the same style of clothingâ€”beanie hats, baggy t-shirts, cargo trousersâ€”as the audience of this edgy North London theatre. They are invited to confront an uncomfortable truth: any society, no matter how educated or tolerant it believes itself to be, can submit to hysteria. Reactions ranged from brow-furrowed confusion to wide-eyed fascination. It is difficult for Millerâ€™s plays to have the same effect today as when their themes were still unfamiliar, even taboo. Perhaps contemporary playwrights are better placed to touch modern nerves. But thoughtful stagings can continue to make audiences reflect on their own prejudices and shortcomings.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Why British wage growth is picking up at last","slug":"Why British wage growth is picking up at last","date":"2019-04-16T23:16:47.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2019/04/16/Why British wage growth is picking up at last/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Why British wage growth is picking up at last/","excerpt":"","text":"A tight labour market, better jobs and higher productivity are rewarding workers at last Apr 16th 2019 The obvious cause of strengthening pay is the tight labour market. When unemployment hit its post-crisis high of 8.5% in 2011, employers knew that they could get away with offering meagre or no pay rises. Workersâ€™ bargaining power has since grown, as joblessness has fallen. Unemployment is just 3.9%, the lowest in four decades. Britain has about three vacancies for each 100 employee jobs, the highest ratio since the data began in 2001, meaning bosses have to try harder to fill posts. Nominal pay in the hospitality sector, which has a particularly high number of job postings, is growing at 5% a year. A hot jobs market is not the only cause of rising average pay. Another relates to the mix of jobs in the economy. Following the financial crisis, posts in low-productivity, low-paying sectors such as agriculture proliferated. Having more poorly paid positions dragged down the average. Yet lately Britain has created relatively more high-paying jobsâ€”strawberry-pickers have made way for stock-pickers. In the year to September 2018 the changing composition of the workforce boosted average nominal wage growth by 0.5 percentage points. Stronger pay may also owe something to rising productivity. How much workers produce ultimately determines how much they earn. After stagnating in 2007-14, more recently output per hour has grown by about 1% a year in real terms. Silvana Tenreyro of the Bank of England has floated the idea that some of these gains might not have yet shown up in the statistics. The question is whether wage growth will accelerate further. Workers will hope that it does: at its current rate real pay will not return to its pre-crisis peak until 2022. Yet few economists believe Britain will soon resume the healthy productivity growth of the post-war period, which was consistent with real-terms pay rises of some 3% a year. Most economic forecasts have productivity growing at an annual rate of about 1% this year and next. Already there are signs that firms are struggling to afford the modest pay settlements that their workers are demanding. The cost of staffing per unit of output, a measure of domestically generated inflation, grew by 1.7% in 2017 but by 2.7% last year. To absorb these extra costs some firms are accepting lower profits. Other firms are passing them on to customers, stoking consumer-price inflation, which hovers around the Bank of Englandâ€™s 2% target. For now there is little need for the bank to raise interest rates, which would bring down inflation. Uncertainty over Brexit, which is likely to continue until October and perhaps beyond, argues in favour of holding fire. Yet the difficult truth is that Britainâ€™s current rate of wage growth, modest by historical standards, is about as high as it can go without pushing inflation above target. It will be some time before Britonsâ€™ pay squeeze is truly over.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Big carmakers are placing vast bets on battery power","slug":"Big carmakers are placing vast bets on battery power","date":"2019-04-16T23:16:46.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/16/Big carmakers are placing vast bets on battery power/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Big carmakers are placing vast bets on battery power/","excerpt":"","text":"From GM and Geely to Mitsubishi and Mercedes, giants of the industry are revving up their electric plans Apr 16th 2019 IN 1900 ONE in three cars on American roads ran on volts. Then oil began gushing out of Texas. Cheaper than batteries, and easier to top up, petrol fuelled the rise of mass-produced automobiles. Cost and worries about limited range have kept electric vehices (EVs) in a niche ever since. Tesla, which has made battery power sexy again in the past decade, produced just 250,000 units last year, a fraction of what Volkswagen or Toyota churn out each year. For every one of the 2m or so pure EVs and plug-in hybrids, which combine batteries and internal-combustion engines (ICEs), sold in 2018, the worldâ€™s carmakers shifted 50 petrol or diesel cars. EV sales are, however, accelerating as quickly as electric motors. Some industry-watchers reckon that they will account for nearly 15% of the global total by 2025. One in five new cars in China will run on batteries then, according to Bloomberg New Energy Finance, a consultancy. The chief reason such optimistic forecasts no longer look outlandish is the entry into the electric race of the car industryâ€™s juggernauts. A survey by Reuters in January put the industryâ€™s total planned EV-related spending worldwide (including on batteries) at around $300bn over the next five to ten years. From GM and Geely to Mercedes and Nissan, big carmakers all want to turn out millions of such carsâ€”and turn a profit doing so. Their strategies range from cautious to aggressive. Making a profitable, mass-produced EV has proved elusive. A battery powertrain can be three times the price of an ICE. But a combination of better technology and greater scale may soon allow EVs to compete on price with petrol vehicles, and enable motorists to drive long distances without the fear of running out of juice. They had better, carmakers are hoping. Worries about climate change and air pollution are prompting authorities around the world to consider phasing out new petrol and diesel engines in the coming decade. In the absence of federal regulations under Americaâ€™s climate-sceptical president, Donald Trump, some progressive cities and states are tightening local rules. Fiat Chrysler (whose chairman, John Elkann, sits on the board of The Economistâ€™s parent company) has just agreed to pay Tesla hundreds of millions of euros to count the Californian marque as part of its fleet, and thus avoid steep fines for exceeding average CO2-emissions standards for carmakers due to come into force in the European Union next year. In China, where half the worldâ€™s EVs are already sold, the government sees electrification of transport as a way to combat choking urban smogâ€”and to lap the West technologically. Western premium brands appear best positioned to take an early lead. While batteries remain pricey, fancy marques can offset the cost with the higher prices that their vehicles command. Jaguar and Audi have already broken Teslaâ€™s monopoly at the lucrative top end of the market. Daimler, which owns Mercedes, has committed â‚¬10bn ($11.3bn) to its EQ range and wants 20% of its cars to be fully electric by 2025. Daimler and BMW, which has been bruised by losses on its poorly selling i3 electric hatchback, are hedging their bets by backing platforms (as the basic architecture of a car is known in the business) that are able to accommodate petrol and diesel engines as well as electric motors. This should help them contain costs, but at the expense of compromises over battery size and layout. Sacrificing range and interior space in this way may dent brands built on luxury and technological prowess, says Patrick Hummel of UBS, a bank. Many mass-market firms are likewise proceeding cautiously. Their thinner margins leave less room to absorb the cost of batteries. Renault of France and South Koreaâ€™s Hyundai are nevertheless toying with the idea of a dedicated electric-only platform. PSA Group has said it plans to electrify more Peugeots, CitroÃ«ns and Opels. Fiat Chrysler has made similar noises, though the Tesla tie-up suggests its near-term plans are less ambitious. Toyotaâ€™s early bet on hydrogen fuel cells, which lag behind batteries on the road to widespread adoption, had long been a distraction. The Japanese giant has now acknowledged that buyers want battery-power. It is planning ten models by the early 2020s. The most daring by a long way is VW. The German groupâ€™s heftâ€”it produces 10m cars a yearâ€”affords it economies of scale only Toyota could hope to match. The â‚¬30bn VW plans to spend on developing EVs over the next five years, plus â‚¬50bn to fit them with batteries, leaves all other carmakers in the dust. In March Herbert Diess, its chief executive, promised 70 new electric models by 2028, rather than 50 as previously pledged, and 22m EVS delivered over the next ten years. The company is contemplating a huge investment in a â€œgigafactoryâ€ to supply its own batteries rather than depending on outside suppliers. VW is already developing a dedicated platform and converting entire factories to EV production. The first, at Zwickau in Germany, will eventually turn out 330,000 cars a year for the VW brand as well as Audi and SEAT. Its medium-sized ID hatchback, to be shipped next year, will cost around â‚¬30,000, similar to an equivalent diesel-powered Golf, and travel 400-600km (250-370 miles) on a single charge. On April 14th in Shanghai Mr Diess unveiled a sport-utility vehicle to compete with Teslaâ€™s snazzy Model X in China from 2021. Once the range of EVs reaches full production in 2022, VW believes, such models will start breaking even. By 2025, when it hopes one-quarter of its output will be electric, they should be as profitable as petrol cars. As Mike Manley, boss of Fiat Chrysler, observers, it is no longer a question of whether carmakers can deliver a fleet of EVs but whether people will pay for them. If governments withdraw generous subsidies which EV-owners have enjoyed, charging infrastructure fails to materialise or electric carsâ€™ pitiful resale value does not increase, motorists may be reluctant to abandon their tried and tested petrol wheels. Poor sales, combined with the large upfront investments, would hit carmakersâ€™ margins, which for mass-market brands are already about as exciting as a Soviet-era Trabant in mud brown. The financial consequences could be â€œuglyâ€, warns Bernstein, an equity-research firm. Electric fieldAt the same time, the big carmakers can expect more competition from rivals unburdened by complex ICE supply chains and large workforces. VW has 40,000 suppliers worldwide and directly employs 660,000 people. Lower capital intensity, and the relative simplicity of EVs, which use many fewer parts than petrol vehicles and are easier to assemble, is drawing in upstarts. They include Dyson, a British maker of vacuum cleaners, and a raft of Chinese Tesla-wannabes, such as NIO and Byton. Bigger Chinese carmakers, such as Geely and JAC, have also developed expertise in EVs. With domestic sales stalling, they are beginning to eye export markets. Other technological bumps are meanwhile beginning to test the industryâ€™s chassis. Self-driving cars and ride-sharing are forcing car companies to rethink their established business model. If carmakers miss the electric turn now, they will find it harder to find their way in these futuristic areas. The electric race may prove to be a practice lap for wider disruption.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"The fire in Notre Dame cathedral, and more from our daily podcast","slug":"The fire in Notre Dame cathedral, and more from our daily podcast","date":"2019-04-16T23:16:44.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2019/04/16/The fire in Notre Dame cathedral, and more from our daily podcast/","link":"","permalink":"https://stanxia.github.io/2019/04/16/The fire in Notre Dame cathedral, and more from our daily podcast/","excerpt":"","text":"Also, counting civilian casualties and Cubaâ€™s sporting export Podcasts | Apr 16th 2019 EMMANUEL MACRON, the president of France, was already dealing with national protests when a massive fire broke out at the Notre Dame cathedral, an 850-year old Parisian landmark. Can the tragedy, and Mr Macronâ€™s leadership, bring the country together? Americaâ€™s armed forces often donâ€™t know how many civilians are killed in its air-strike campaignsâ€”but thatâ€™s changing, thanks to pressure from the Pentagonâ€™s loudest critics. And, though the Trump administration has cancelled a deal for Cuban baseball players, that wonâ€™t stop them making their way to the big leagues. Runtime: TK min. Listen on: Apple Podcasts | Spotify | Google | Stitcher | TuneIn","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Cathedrals are neglected in much of Europe","slug":"Cathedrals are neglected in much of Europe","date":"2019-04-16T23:16:41.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2019/04/16/Cathedrals are neglected in much of Europe/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Cathedrals are neglected in much of Europe/","excerpt":"","text":"Ancient churches are the greatest glory of Europeâ€™s cities, and a headache for those trying to look after them Erasmus | Apr 16th 2019 THE CATHEDRAL of Notre Dame in Paris, and the vast outpouring of sorrow over its semi-destruction by fire on April 15th, epitomises the power of great houses of prayer to touch and inspire people. More palpably than any other kind of monument, they connect visitors with another world: one in which the finest composers, singers, sculptors, glass-makers, embroiderers and craft-workers of a given era joyfully mixed their energies in a vast, disinterested enterprise. To some degree, that enterprise continues as long as the building stands. That alone makes great historic churches a source of fascination, even for those with little interest in Christian worship. People want them to be there, even if they donâ€™t wish to share the cost or join the prayers. In almost every country in Europe, that creates an acute problem. The cost of maintaining the delicate stone fabric of a cathedral seems to rise geometrically, far out-stripping the ability of small congregations to sustain them. Governments and other secular bodies are minded to help but they also feel compelled, in most places, to respect the independence of the buildingsâ€™ historic stewards, in other words the churches. In England, the established church boasts 42 cathedrals (technically defined as the seat of a bishop), of which 39 are listed as historic buildings whose preservation is both mandated by law and entitled to some public help. (About 12,000 of the 16,000 other places of worship controlled by the Church of England are also listed.) The Church of England likes to call the cathedrals one of its â€œsuccess storiesâ€ with rising numbers of worshippers and visitors, and growing revenue. But as a recent report led by a bishop delicately put it, â€œrecent failures of governance and management within a small number of cathedrals have highlighted vulnerabilities across the sectorâ€¦â€ In plain language, at least two cathedrals have run into severe financial difficulties, which better stewardship might have avoided. English cathedrals are relatively independent bodies, run by a cleric known as a dean who relies on a group of advisers known as a chapter. They are free to raise money in many ways, from concerts to exhibitions to simply charging an admission fee, as about a quarter of them do. In recent weeks Derby Cathedral raised eyebrows by hosting films that included graphic sex scenes and depictions of paganism. Churches in Germany have an advantage. The system of religious taxes (under which people of Catholic or Lutheran heritage pay a levy to their respective denominations) has ensured an ample income stream. Germanyâ€™s religious masters have done better at hauling in revenue than at retaining worshippers, the figures would suggest. But a massive fund-raising effort, drawing in generous private-sector donors and ordinary well-wishers in Germany and Britain, was needed for one of the biggest church reconstruction projects of modern times: the rebuilding of the Frauenkirche in Dresden. This showpiece of German Baroque was destroyed, along with much of the city, in a British bombing raid in February 1945. The project, completed in 2005, was a complement to the erection in 1962 of a new cathedral in Coventry, replacing the one wrecked by a German air raid on the English Midlands. Most European states subsidise their historically dominant Christian denominations, directly or indirectly, while also leaving the sectsâ€™ religious masters relatively autonomous. In Italy, despite the notional separation of Catholic church and state, the two are deeply intertwined, through tax breaks and state help for maintaining the artistic heritage which is one of Italyâ€™s greatest tourist draws. Belgium offers generous help to all its main religions, but Catholic cathedrals still charge stiff admission fees as though they were museums. In church-state relations, France is an outlier. Under the regime of laÃ¯citÃ©, or strict secularism, municipalities took over formal responsibility for Catholic churches; clerics and their congregations are merely users. And clerics, in particular, are thin on the ground. In rural France, it is common for a priest to look after 30 old churches. That paucity of active users prompts municipal authorities to assign a low priority to conserving church buildings. In 2013 a huge neo-Gothic church in the northern French town of Abbeville was dramatically demolished by municipal leaders, who said the place was a safety hazard and too expensive to repair. Hundreds of other French churches may soon have a similar fate. Nor have Franceâ€™s state authorities done very well at protecting houses of prayer from a wave of vandalism, including arson and desecration, that has afflicted them this year. Indeed, all over western Europe, churches are closing for lack of worshippers. In the Netherlands, a cardinal predicted in 2013 that two-thirds of the Roman Catholic churches in the country would shut by 2025. But a diametrically opposing trend is at work further east in Europe. Perhaps the most spectacular act of church reconstruction of recent times was the re-erection of Moscowâ€™s Cathedral of Christ the Saviour, which was dynamited by Stalin in 1931 and thrown back up over five years starting in 1995. It was rebuilt in about a tenth of the time needed for the original construction. Elsewhere in Russia, under a crash building programme decreed by the Russian Orthodox church, at least three new churches are said to be opening per day. And in other parts of central and eastern Europe, from Serbia to Georgia, vast new Orthodox churches now adorn capital cities which were already endowed with many places of prayer. Indeed, the Russian church building spree extends far beyond the borders of the motherland. Anyone who takes a short walk along the banks of the Seine from the wreckage of Notre Dame will soon see a boldly modernistic structure, topped with onion domes: this â€œspiritual and culturalâ€ centre, opened in 2016, was a pet project of President Vladimir Putinâ€™s. It competes hard with an older Russian-style cathedral in Paris which the Muscovite authorities, to their frustration, do not control. As the Russian state media were eager to point out, western Europe is gaining some new Christian places of worship even as many others are destroyed, accidentally or otherwise. See alsoA terrible blaze devastates Notre Dame cathedral (April 15th 2019)","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"Fire in the heart of Paris","slug":"Politics this week","date":"2019-04-16T18:15:21.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2019/04/16/Politics this week/","link":"","permalink":"https://stanxia.github.io/2019/04/16/Politics this week/","excerpt":"","text":"Fire in the heart of ParisPolitics this week Apr 11th 2019 Following months of mass protests in Sudan, it appeared that Omar al-Bashir had been ousted as president by the army. Mr al-Bashir had misruled since taking power in a coup in 1989. His civil war against non-Muslim black Africans ended with the secession of South Sudan. Separately, the International Criminal Court charged him with overseeing genocide in Darfur. See article. Binyamin Netanyahu won a record fifth term as prime minister of Israel. His Likud party tied with Blue and White, a centrist rival. But the right-wing and religious bloc, of which Likud is a part, won a majority of seats in the Knesset. In the final days of the campaign Mr Netanyahu vowed to begin annexing parts of the West Bank, further dimming the prospect of any peace with the Palestinians based on a two-state solution. See here and here. Khalifa Haftar, Libyaâ€™s most powerful warlord, attacked Tripoli, which is controlled by the UN-backed government. Dozens of people were killed in the fighting, as militias allied to the government rallied to defend the capital. A UN peace conference, scheduled for this month, was postponed. See article. Protests continued in Algeria, where crowds called for the resignation of Abdelkader Bensalah, the interim president. Mr Bensalah succeeded Abdelaziz Bouteflika, who resigned amid widespread anger at his regime after 20 years in charge. For the first time police used tear-gas to disperse the demonstrators. Mr Bensalah said the country would hold a presidential election on July 4th. Theresa May, Britainâ€™s prime minister, attended a summit in Brussels to discuss another delay to Brexit. The European Union offered Britain six more months, pushing the deadline to October 31st, Halloween. That means Britain faces having to vote in elections to the European Parliament next month, though British MEPs will have to step down if Brexit actually happens. The president of the European Commission, Jean-Claude Juncker, joked that if there was another late-night meeting on the last day of the talks he might have to leave at midnight; his term ends on November 1st. See article. Julian Assange, a founder of WikiLeaks, was arrested by British police in the Ecuadorean embassy in London. Ecuador had granted Mr Assange refuge in 2012 after he had jumped bail while facing rape allegations. His relationship with his hosts soured after a change of government in Ecuador, where a leftist president was replaced by a more moderate one. Mr Assange has said he fears extradition to the United States, where WikiLeaks is not popular, having published reams of leaked American military secrets. Turkeyâ€™s ruling party demanded a fresh vote in Istanbul, where it narrowly lost the mayoralty in elections on March 31st. Italyâ€™s deputy prime minister, Matteo Salvini, announced the formation of a new nationalist group within the European Parliament, to be called the European Alliance for People and Nations. However, none of the party leaders he hoped would attend from other countries turned up. The Trump administration cancelled a four-month-old agreement under which Cuban baseball players could join Major League teams in America without defecting from their country. The administration said the agreement would encourage human trafficking and help enrich Cubaâ€™s communist government. See article. Jair Bolsonaro, Brazilâ€™s president, sacked the education minister, Ricardo VÃ©lez, who shared his socially conservative views. Mr VÃ©lez had courted controversy by instructing schools to film classes singing the national anthem and repeating Mr Bolsonaroâ€™s campaign slogan. His replacement, Abraham Weintraub, an economist, has said that crack cocaine was introduced to Brazil deliberately by the left. See here. Thanathorn Juangroongruangkit, the leader of the Future Forward party, was charged with sedition in relation to a protest against Thailandâ€™s military junta in 2015. It is one of several repressive steps that has marred the countryâ€™s supposed return to democracy after an election last month. See article. Kassym Jomart Tokayev, Kazakhstanâ€™s interim president following the sudden resignation of Nursultan Nazarbayev after three decades in power, called a snap election for June 9th. See article. South Koreaâ€™s constitutional court ruled that the government must end the countryâ€™s ban on abortion, in place since 1953, before the end of 2020. Doctors can currently be imprisoned if they perform the procedure. However, tens of thousands of abortions are carried out each year. Voting began in Indiaâ€™s seven-stage election. The final phase will take place on May 19th and the results for all seven stages will be announced on May 23rd. Polls suggest the ruling Bharatiya Janata Party will remain the biggest party. See article. A court in Hong Kong found nine people guilty of â€œpublic nuisanceâ€ charges relating to their leading roles in the Umbrella Movement of 2014, which involved weeks of sit-ins and demonstrations in busy commercial districts in support of democratic reform. Among the defendants were three founders of a group involved in the unrest. Kirstjen Nielsen resigned as the secretary of Americaâ€™s Department of Homeland Security. Donald Trump is trying to replace the departmentâ€™s top officials with people who will try harder to keep Mexicans out of the United States. Mr Trump has threatened to close the border entirely, despite advice that this would cause economic chaos. See article. Randolph Alles, the head of Americaâ€™s Secret Service, is quitting. He had reportedly been asked to go before the recent security breach at Mr Trumpâ€™s private club, involving a Chinese woman with several thumb drives. Amnesty Internationalâ€™s annual report on the death penalty recorded a drop of nearly a third in known executions worldwide last year. There were 690 in 2018, down from 1,061 in 2015. The number of death sentences passed by courts also declined slightly, though in the Middle East and north Africa death sentences nearly doubled to 1,170. The region is responsible for two-thirds of the worldâ€™s known executions. (China is also thought to execute thousands of people every year, but keeps its figures secret.) Of the countries that release figures, Iran is by far the most avid executioner, putting 409 people to death each year on average for the past decade.","raw":null,"content":null,"categories":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/categories/economist/"}],"tags":[{"name":"economist","slug":"economist","permalink":"https://stanxia.github.io/tags/economist/"}]},{"title":"IDEA ä½¿ç”¨æŠ€å·§","slug":"IDEA ä½¿ç”¨æŠ€å·§","date":"2017-12-28T09:34:44.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/28/IDEA ä½¿ç”¨æŠ€å·§/","link":"","permalink":"https://stanxia.github.io/2017/12/28/IDEA ä½¿ç”¨æŠ€å·§/","excerpt":"","text":"å‰è¨€ åœ¨ç”Ÿäº§ä¸­ä¸»åŠ›æ˜¯ä½¿ç”¨ IDEA ï¼Œå·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚å› è€Œæ€»ç»“ä¸€ä¸‹åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ç»éªŒï¼Œä¸ºæ–¹ä¾¿åˆå­¦è€…æ›´å¿«çš„æŒæ¡è¿™ä¸ªç¥å™¨ã€‚ é…ç½®é˜¿é‡Œäº‘é…ç½® é˜¿é‡Œäº‘ ä½œä¸º maven çš„ä»“åº“æ¥æºï¼ŒåŸå› å¤§å®¶éƒ½æ‡‚å¾—ï¼Œå›½å¤–çš„ä»“åº“é€Ÿåº¦æœ‰æ—¶å€™å¾ˆå‘µå‘µï¼Œå›½å†…çš„è¿™æ–¹é¢è¿˜æ˜¯é è°±ç‚¹ã€‚ ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€ IDEA å·¦ä¸Šè§’çš„åå¥½è®¾ç½® Preferencesï¼Œæ¥è¿ç‚¹å‡» Build &gt;&gt; Build Tools &gt;&gt; Maven ï¼Œåœ¨ Maven home directory å¤„é€‰æ‹© IDEA è‡ªå¸¦çš„ maven ç‰ˆæœ¬ï¼Œåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æ‰¾åˆ°è¯¥è·¯å¾„ï¼Œæ‰¾åˆ°å¹¶è¿›å…¥ conf ç›®å½•ï¼Œæ‰“å¼€ç¼–è¾‘ settings.xml ã€‚ ç¬¬äºŒæ­¥ï¼šåœ¨ settings.xml ä¸­æœç´¢ mirrors ,å°†ä»¥ä¸‹é…ç½®å†™å…¥è¯¥å¤„ï¼š1234567&lt;!-- é˜¿é‡Œamvenåº“ --&gt;&lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;&lt;/mirror&gt; NOTE:æ³¨æ„å°†ä¸Šè¿°ä»£ç æ”¾å…¥ &lt;mirrors&gt;è¿™é‡Œé¢&lt;/mirrors&gt; ã€‚ ç¬¬ä¸‰æ­¥ï¼šå›åˆ° Maven çš„é…ç½®ç•Œé¢ï¼ŒUser settings file å¤„ç‚¹å‡» Override ,é€‰æ‹©åˆšæ‰ç¼–è¾‘çš„ settings.xml æ–‡ä»¶å…¨è·¯å¾„ã€‚ ç¬¬å››æ­¥ï¼šApply ,OK,å®Œæ´»ã€‚ç°åœ¨å¯ä»¥éªŒè¯æ˜¯å¦æˆåŠŸã€‚","raw":null,"content":null,"categories":[{"name":"idea","slug":"idea","permalink":"https://stanxia.github.io/categories/idea/"}],"tags":[{"name":"idea","slug":"idea","permalink":"https://stanxia.github.io/tags/idea/"},{"name":"mac","slug":"mac","permalink":"https://stanxia.github.io/tags/mac/"}]},{"title":"Phoenix Secondary Indexing","slug":"Phoenix-Secondary-Indexing","date":"2017-12-27T16:48:35.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/12/27/Phoenix-Secondary-Indexing/","link":"","permalink":"https://stanxia.github.io/2017/12/27/Phoenix-Secondary-Indexing/","excerpt":"äºŒçº§ç´¢å¼•æ˜¯ä»ä¸»è®¿é—®è·¯å¾„è®¿é—®æ•°æ®çš„æ­£äº¤æ–¹å¼ã€‚åœ¨ HBase ä¸­ï¼Œæ‚¨æœ‰ä¸€ä¸ªç´¢å¼•æŒ‰å­—å…¸é¡ºåºæ’åºåœ¨ä¸»é”®è¡Œä¸Šã€‚ä»¥ä¸åŒäºä¸»è¦è¡Œçš„æ–¹å¼è®¿é—®è®°å½•éœ€è¦æ‰«æè¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œä»¥é’ˆå¯¹æ‚¨çš„è¿‡æ»¤å™¨å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚é€šè¿‡äºŒçº§ç´¢å¼•ï¼Œæ‚¨ç´¢å¼•çš„åˆ—æˆ–è¡¨è¾¾å¼å½¢æˆä¸€ä¸ªå¤‡ç”¨è¡Œé”®ï¼Œä»¥å…è®¸æ²¿ç€è¿™ä¸ªæ–°è½´è¿›è¡Œç‚¹æŸ¥æ‰¾å’ŒèŒƒå›´æ‰«æã€‚\nCovered Indexes è¦†ç›–ç´¢å¼•\nPhoenix æ˜¯ç‰¹åˆ«å¼ºå¤§çš„ï¼Œå› ä¸ºæˆ‘ä»¬æä¾›è¦†ç›–ç´¢å¼• - ä¸€æ—¦æ‰¾åˆ°ç´¢å¼•æ¡ç›®ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿”å›ä¸»è¡¨ã€‚ç›¸åï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬å…³å¿ƒçš„æ•°æ®ç»‘å®šåˆ°ç´¢å¼•è¡Œï¼ŒèŠ‚çœäº†è¯»å–æ—¶é—´çš„å¼€é”€ã€‚\nä¾‹å¦‚ï¼Œä»¥ä¸‹å†…å®¹å°†åœ¨v1å’Œv2åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå¹¶åœ¨ç´¢å¼•ä¸­åŒ…å«v3åˆ—ä»¥é˜²æ­¢ä»æ•°æ®è¡¨ä¸­è·å–è¯¥åˆ—ï¼š\n1CREATE INDEX my_index ON my_table (v1,v2) INCLUDE(v3)","text":"äºŒçº§ç´¢å¼•æ˜¯ä»ä¸»è®¿é—®è·¯å¾„è®¿é—®æ•°æ®çš„æ­£äº¤æ–¹å¼ã€‚åœ¨ HBase ä¸­ï¼Œæ‚¨æœ‰ä¸€ä¸ªç´¢å¼•æŒ‰å­—å…¸é¡ºåºæ’åºåœ¨ä¸»é”®è¡Œä¸Šã€‚ä»¥ä¸åŒäºä¸»è¦è¡Œçš„æ–¹å¼è®¿é—®è®°å½•éœ€è¦æ‰«æè¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œä»¥é’ˆå¯¹æ‚¨çš„è¿‡æ»¤å™¨å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚é€šè¿‡äºŒçº§ç´¢å¼•ï¼Œæ‚¨ç´¢å¼•çš„åˆ—æˆ–è¡¨è¾¾å¼å½¢æˆä¸€ä¸ªå¤‡ç”¨è¡Œé”®ï¼Œä»¥å…è®¸æ²¿ç€è¿™ä¸ªæ–°è½´è¿›è¡Œç‚¹æŸ¥æ‰¾å’ŒèŒƒå›´æ‰«æã€‚ Covered Indexes è¦†ç›–ç´¢å¼• Phoenix æ˜¯ç‰¹åˆ«å¼ºå¤§çš„ï¼Œå› ä¸ºæˆ‘ä»¬æä¾›è¦†ç›–ç´¢å¼• - ä¸€æ—¦æ‰¾åˆ°ç´¢å¼•æ¡ç›®ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿”å›ä¸»è¡¨ã€‚ç›¸åï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬å…³å¿ƒçš„æ•°æ®ç»‘å®šåˆ°ç´¢å¼•è¡Œï¼ŒèŠ‚çœäº†è¯»å–æ—¶é—´çš„å¼€é”€ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹å†…å®¹å°†åœ¨v1å’Œv2åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå¹¶åœ¨ç´¢å¼•ä¸­åŒ…å«v3åˆ—ä»¥é˜²æ­¢ä»æ•°æ®è¡¨ä¸­è·å–è¯¥åˆ—ï¼š 1CREATE INDEX my_index ON my_table (v1,v2) INCLUDE(v3) Functional Indexes å‡½æ•°ç´¢å¼• å‡½æ•°ç´¢å¼•ï¼ˆåœ¨4.3å’Œæ›´é«˜ç‰ˆæœ¬ä¸­å¯ç”¨ï¼‰å…è®¸æ‚¨ä¸ä»…åœ¨åˆ—ä¸Šè€Œä¸”åœ¨ä»»æ„è¡¨è¾¾å¼ä¸Šåˆ›å»ºç´¢å¼•ã€‚ç„¶åï¼Œå½“ä¸€ä¸ªæŸ¥è¯¢ä½¿ç”¨è¯¥è¡¨è¾¾å¼æ—¶ï¼Œç´¢å¼•å¯ä»¥ç”¨æ¥æ£€ç´¢ç»“æœè€Œä¸æ˜¯æ•°æ®è¡¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ UPPERï¼ˆFIRST_NAME ||â€™â€™|| LAST_NAMEï¼‰ä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œä»¥å…è®¸æ‚¨å¯¹ç»„åˆçš„åå­—å’Œå§“æ°è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„æœç´¢ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢å°†åˆ›å»ºè¿™ä¸ªåŠŸèƒ½ç´¢å¼•ï¼š 1CREATE INDEX UPPER_NAME_IDX ON EMP (UPPER(FIRST_NAME||' '||LAST_NAME)) æœ‰äº†è¿™ä¸ªç´¢å¼•ï¼Œå‘å‡ºä¸‹é¢çš„æŸ¥è¯¢æ—¶ï¼Œå°†ä½¿ç”¨ç´¢å¼•è€Œä¸æ˜¯æ•°æ®è¡¨æ¥æ£€ç´¢ç»“æœï¼š1SELECT EMP_ID FROM EMP WHERE UPPER(FIRST_NAME||' '||LAST_NAME)='JOHN DOE' Phoenix æ”¯æŒä¸¤ç§ç´¢å¼•æŠ€æœ¯ï¼šå…¨å±€ç´¢å¼•å’Œæœ¬åœ°ç´¢å¼•ã€‚æ¯ä¸ªåœ¨ä¸åŒçš„æƒ…å†µä¸‹éƒ½å¾ˆæœ‰ç”¨ï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„æ•…éšœæ¦‚å†µå’Œæ€§èƒ½ç‰¹ç‚¹ã€‚ Global Indexes å…¨å±€ç´¢å¼• å…¨å±€ç´¢å¼•ç›®æ ‡æ˜¯é‡åº¦è¯»æ“ä½œç”¨ä¾‹ã€‚ä½¿ç”¨å…¨å±€ç´¢å¼•ï¼Œç´¢å¼•çš„æ‰€æœ‰æ€§èƒ½æŸå¤±éƒ½æ˜¯åœ¨å†™å…¥æ—¶å‘ç”Ÿçš„ã€‚æˆ‘ä»¬æ‹¦æˆªæ•°æ®è¡¨æ›´æ–°å†™ï¼ˆDELETEï¼ŒUPSERT VALUESå’ŒUPSERT SELECTï¼‰ï¼Œå»ºç«‹ç´¢å¼•æ›´æ–°ï¼Œç„¶åå‘é€ä»»ä½•å¿…è¦çš„æ›´æ–°åˆ°æ‰€æœ‰æ„Ÿå…´è¶£çš„ç´¢å¼•è¡¨ã€‚åœ¨è¯»çš„æ—¶å€™ï¼ŒPhoenix ä¼šé€‰æ‹©ä½¿ç”¨çš„ç´¢å¼•è¡¨ï¼Œè¿™å°†äº§ç”Ÿæœ€å¿«çš„æŸ¥è¯¢æ—¶é—´ï¼Œå¹¶ç›´æ¥æ‰«æå®ƒï¼Œå°±åƒä»»ä½•å…¶ä»–çš„ HBase è¡¨ä¸€æ ·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé™¤éæš—ç¤ºï¼Œå¦åˆ™ç´¢å¼•ä¸ä¼šç”¨äºå¼•ç”¨ä¸å±äºç´¢å¼•çš„åˆ—çš„æŸ¥è¯¢ã€‚ Local Indexes æœ¬åœ°ç´¢å¼• æœ¬åœ°ç´¢å¼•ç›®æ ‡é’ˆå¯¹é‡åº¦å†™æ“ä½œï¼Œç©ºé—´å—é™çš„ç”¨ä¾‹ã€‚å°±åƒå…¨å±€ç´¢å¼•ä¸€æ ·ï¼ŒPhoenix ä¼šåœ¨æŸ¥è¯¢æ—¶è‡ªåŠ¨é€‰æ‹©æ˜¯å¦ä½¿ç”¨æœ¬åœ°ç´¢å¼•ã€‚ä½¿ç”¨æœ¬åœ°ç´¢å¼•ï¼Œç´¢å¼•æ•°æ®å’Œè¡¨æ•°æ®å…±åŒé©»ç•™åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œé˜²æ­¢å†™å…¥æœŸé—´çš„ä»»ä½•ç½‘ç»œå¼€é”€ã€‚å³ä½¿æŸ¥è¯¢æ²¡æœ‰å®Œå…¨è¦†ç›–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬åœ°ç´¢å¼•ï¼ˆå³ï¼ŒPhoenix è‡ªåŠ¨æ£€ç´¢ä¸åœ¨ç´¢å¼•ä¸­çš„åˆ—ï¼Œé€šè¿‡ä¸æ•°æ®è¡¨ç›¸å¯¹åº”çš„ç´¢å¼•ï¼‰ã€‚ä¸å…¨å±€ç´¢å¼•ä¸åŒï¼Œè¡¨ä¸­çš„æ‰€æœ‰æœ¬åœ°ç´¢å¼•éƒ½å­˜å‚¨åœ¨4.8.0ç‰ˆä¹‹å‰çš„å•ç‹¬çš„å…±äº«è¡¨ä¸­ã€‚ä»4.8.0å¼€å§‹ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰æœ¬åœ°ç´¢å¼•æ•°æ®å­˜å‚¨åœ¨ç›¸åŒæ•°æ®è¡¨ä¸­çš„å•ç‹¬çš„å½±å­åˆ—æ—ä¸­ã€‚åœ¨è¯»å–æœ¬åœ°ç´¢å¼•æ—¶ï¼Œç”±äºä¸èƒ½ç¡®å®šç´¢å¼•æ•°æ®çš„ç¡®åˆ‡åŒºåŸŸä½ç½®ï¼Œæ‰€ä»¥å¿…é¡»æ£€æŸ¥æ¯ä¸ªåŒºåŸŸçš„æ•°æ®ã€‚å› æ­¤åœ¨è¯»å–æ—¶ä¼šå‘ç”Ÿä¸€äº›å¼€é”€ã€‚ Index Population é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºç´¢å¼•æ—¶ï¼Œä¼šåœ¨ CREATE INDEX è°ƒç”¨æœŸé—´åŒæ­¥å¡«å……è¯¥ç´¢å¼•ã€‚æ ¹æ®æ•°æ®è¡¨çš„å½“å‰å¤§å°ï¼Œè¿™å¯èƒ½æ˜¯ä¸å¯è¡Œçš„ã€‚ä»4.5å¼€å§‹ï¼Œå¯ä»¥é€šè¿‡åœ¨ç´¢å¼•åˆ›å»º DDL è¯­å¥ä¸­åŒ…å« ASYNC å…³é”®å­—æ¥å¼‚æ­¥å®Œæˆç´¢å¼•çš„å¡«å……ï¼š1CREATE INDEX async_index ON my_schema.my_table (v) ASYNC å¿…é¡»é€šè¿‡ HBase å‘½ä»¤è¡Œå•ç‹¬å¯åŠ¨å¡«å……ç´¢å¼•è¡¨çš„ map-reduce ä½œä¸šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š123$&#123;HBASE_HOME&#125;/bin/hbase org.apache.phoenix.mapreduce.index.IndexTool --schema MY_SCHEMA --data-table MY_TABLE --index-table ASYNC_IDX --output-path ASYNC_IDX_HFILES åªæœ‰ map-reduce ä½œä¸šå®Œæˆåï¼Œç´¢å¼•æ‰ä¼šè¢«æ¿€æ´»å¹¶å¼€å§‹åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ã€‚è¿™é¡¹å·¥ä½œå¯¹äºé€€å‡ºçš„å®¢æˆ·ç«¯æ˜¯æœ‰å¼¹æ€§çš„ã€‚è¾“å‡ºè·¯å¾„é€‰é¡¹ç”¨äºæŒ‡å®šç”¨äºå†™å…¥ HFile çš„ HDFS ç›®å½•ã€‚ Index Usage ç´¢å¼•ä½¿ç”¨ Phoenix è‡ªåŠ¨ä½¿ç”¨ç´¢å¼•æ¥æœåŠ¡ä¸€ä¸ªæŸ¥è¯¢ï¼Œå½“å®ƒç¡®å®šæ›´æœ‰æ•ˆçš„æ—¶å€™ã€‚ä½†æ˜¯ï¼Œé™¤éæŸ¥è¯¢ä¸­å¼•ç”¨çš„æ‰€æœ‰åˆ—éƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œå¦åˆ™ä¸ä¼šä½¿ç”¨å…¨å±€ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æŸ¥è¯¢ä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œå› ä¸ºåœ¨æŸ¥è¯¢ä¸­å¼•ç”¨äº†v2ï¼Œä½†æœªåŒ…å«åœ¨ç´¢å¼•ä¸­ï¼š1SELECT v2 FROM my_table WHERE v1 = 'foo' åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸‰ç§è·å–ç´¢å¼•çš„æ–¹æ³•ï¼š 1.é€šè¿‡åœ¨ç´¢å¼•ä¸­åŒ…å«v2æ¥åˆ›å»ºä¸€ä¸ªè¦†ç›–ç´¢å¼•ï¼š1CREATE INDEX my_index ON my_table (v1) INCLUDE (v2) è¿™å°†å¯¼è‡´v2åˆ—å€¼è¢«å¤åˆ¶åˆ°ç´¢å¼•ä¸­ï¼Œå¹¶éšç€æ›´æ”¹è€Œä¿æŒåŒæ­¥ã€‚è¿™æ˜¾ç„¶ä¼šå¢åŠ ç´¢å¼•çš„å¤§å°ã€‚ 2.æç¤ºæŸ¥è¯¢å¼ºåˆ¶å®ƒä½¿ç”¨ç´¢å¼•ï¼š1SELECT /*+ INDEX(my_table my_index) */ v2 FROM my_table WHERE v1 = 'foo' è¿™å°†å¯¼è‡´åœ¨éå†ç´¢å¼•æ—¶æ‰¾åˆ°æ¯ä¸ªæ•°æ®è¡Œä»¥æ‰¾åˆ°ç¼ºå°‘çš„v2åˆ—å€¼ã€‚è¿™ä¸ªæç¤ºåªæœ‰åœ¨ä½ çŸ¥é“ç´¢å¼•æœ‰å¾ˆå¥½çš„é€‰æ‹©æ€§çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æœ‰å°‘é‡çš„è¡¨æ ¼è¡Œçš„å€¼æ˜¯â€™fooâ€™ï¼‰ï¼Œå¦åˆ™ä½ å¯ä»¥é€šè¿‡é»˜è®¤çš„è¡Œä¸ºæ¥è·å¾—æ›´å¥½çš„æ€§èƒ½å…¨è¡¨æ‰«æã€‚ 3.åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç´¢å¼•ï¼š1CREATE LOCAL INDEX my_index ON my_table (v1) ä¸å…¨å±€ç´¢å¼•ä¸åŒï¼Œå³ä½¿æŸ¥è¯¢ä¸­å¼•ç”¨çš„æ‰€æœ‰åˆ—éƒ½ä¸åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œæœ¬åœ°ç´¢å¼•ä¹Ÿå°†ä½¿ç”¨ç´¢å¼•ã€‚è¿™æ˜¯é»˜è®¤ä¸ºæœ¬åœ°ç´¢å¼•å®Œæˆçš„ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“åœ¨åŒä¸€ä¸ªåŒºåŸŸæœåŠ¡å™¨ä¸Šçš„è¡¨å’Œç´¢å¼•æ•°æ®coresideç¡®ä¿æŸ¥æ‰¾æ˜¯æœ¬åœ°çš„ã€‚ Index Removal ç´¢å¼•ç§»é™¤ è¦åˆ é™¤ç´¢å¼•ï¼Œä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š1DROP INDEX my_index ON my_table å¦‚æœç´¢å¼•åˆ—åœ¨æ•°æ®è¡¨ä¸­è¢«åˆ é™¤ï¼Œç´¢å¼•å°†è‡ªåŠ¨è¢«åˆ é™¤ã€‚å¦å¤–ï¼Œå¦‚æœåœ¨æ•°æ®è¡¨ä¸­åˆ é™¤ä¸€ä¸ªè¢«è¦†ç›–çš„åˆ—ï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨ä»ç´¢å¼•ä¸­åˆ é™¤ã€‚ Index Properties ç´¢å¼•å±æ€§ å°±åƒä½¿ç”¨CREATE TABLEè¯­å¥ä¸€æ ·ï¼ŒCREATE INDEXè¯­å¥å¯ä»¥é€šè¿‡å±æ€§åº”ç”¨åˆ°åº•å±‚çš„HBaseè¡¨ï¼ŒåŒ…æ‹¬å¯¹å…¶è¿›è¡Œé™åˆ¶çš„èƒ½åŠ›:12CREATE INDEX my_index ON my_table (v2 DESC, v1) INCLUDE (v3) SALT_BUCKETS=10, DATA_BLOCK_ENCODING='NONE' è¯·æ³¨æ„ï¼Œå¦‚æœä¸»è¡¨æ˜¯åŠ ç›çš„ï¼Œåˆ™å¯¹äºå…¨å±€ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å°†ä»¥ç›¸åŒçš„æ–¹å¼è‡ªåŠ¨è¢«åŠ ç›ã€‚å¦å¤–ï¼Œç›¸å¯¹äºä¸»ç´¢å¼•è¡¨ä¸ç´¢å¼•è¡¨çš„å¤§å°ï¼Œç´¢å¼•çš„MAX_FILESIZEå‘ä¸‹è°ƒæ•´ã€‚æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…è¿™é‡Œã€‚å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨æœ¬åœ°ç´¢å¼•æ—¶ï¼Œä¸å…è®¸æŒ‡å®šSALT_BUCKETSã€‚ Consistency Guarantees ä¸€è‡´æ€§ä¿è¯ åœ¨æäº¤åæˆåŠŸè¿”å›åˆ°å®¢æˆ·ç«¯ï¼Œæ‰€æœ‰æ•°æ®ä¿è¯å†™å…¥æ‰€æœ‰ç›¸å…³çš„ç´¢å¼•å’Œä¸»è¡¨ã€‚æ¢å¥è¯è¯´ï¼Œç´¢å¼•æ›´æ–°ä¸HBaseæä¾›çš„ç›¸åŒå¼ºä¸€è‡´æ€§ä¿è¯æ˜¯åŒæ­¥çš„ã€‚ ä½†æ˜¯ï¼Œç”±äºç´¢å¼•å­˜å‚¨åœ¨ä¸æ•°æ®è¡¨ä¸åŒçš„è¡¨ä¸­ï¼Œå› æ­¤æ ¹æ®è¡¨çš„å±æ€§å’Œç´¢å¼•çš„ç±»å‹ï¼Œè¡¨å’Œç´¢å¼•ä¹‹é—´çš„ä¸€è‡´æ€§ä¼šå› æœåŠ¡å™¨ç«¯å´©æºƒè€Œå¤±è´¥ã€‚è¿™æ˜¯æ‚¨çš„éœ€æ±‚å’Œä½¿ç”¨æ¡ˆä¾‹é©±åŠ¨çš„é‡è¦è®¾è®¡è€ƒè™‘å› ç´ ã€‚ ä¸‹é¢æ¦‚è¿°äº†å„ç§ä¸€è‡´æ€§ä¿è¯çš„ä¸åŒé€‰é¡¹ã€‚ Transactional Tables äº‹åŠ¡è¡¨é€šè¿‡å°†æ‚¨çš„è¡¨å£°æ˜ä¸ºäº‹åŠ¡æ€§çš„ï¼Œæ‚¨å¯ä»¥å®ç°è¡¨å’Œç´¢å¼•ä¹‹é—´æœ€é«˜çº§åˆ«çš„ä¸€è‡´æ€§ä¿è¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çš„è¡¨çªå˜å’Œç›¸å…³ç´¢å¼•æ›´æ–°çš„æäº¤æ˜¯å…·æœ‰å¼º ACID ä¿è¯çš„åŸå­ã€‚å¦‚æœæäº¤å¤±è´¥ï¼Œé‚£ä¹ˆæ‚¨çš„æ•°æ®ï¼ˆè¡¨æˆ–ç´¢å¼•ï¼‰éƒ½ä¸ä¼šæ›´æ–°ï¼Œä»è€Œç¡®ä¿æ‚¨çš„è¡¨å’Œç´¢å¼•å§‹ç»ˆä¿æŒåŒæ­¥ã€‚ ä¸ºä»€ä¹ˆä¸æ€»æ˜¯æŠŠä½ çš„è¡¨å£°æ˜ä¸ºäº‹åŠ¡æ€§çš„ï¼Ÿè¿™å¯èƒ½å¾ˆå¥½ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ çš„è¡¨è¢«å£°æ˜ä¸ºä¸å¯å˜çš„ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹äº‹åŠ¡å¼€é”€éå¸¸å°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„æ•°æ®æ˜¯å¯å˜çš„ï¼Œè¯·ç¡®ä¿ä¸äº‹åŠ¡æ€§è¡¨å‘ç”Ÿå†²çªæ£€æµ‹ç›¸å…³çš„å¼€é”€å’Œè¿è¡Œäº‹åŠ¡ç®¡ç†å™¨çš„è¿è¡Œå¼€é”€æ˜¯å¯ä»¥æ¥å—çš„ã€‚æ­¤å¤–ï¼Œå…·æœ‰äºŒçº§ç´¢å¼•çš„äº‹åŠ¡è¡¨å¯èƒ½ä¼šé™ä½å†™å…¥æ•°æ®è¡¨çš„å¯ç”¨æ€§ï¼Œå› ä¸ºæ•°æ®è¡¨åŠå…¶è¾…åŠ©ç´¢å¼•è¡¨å¿…é¡»å¯ç”¨ï¼Œå¦åˆ™å†™å…¥å°†å¤±è´¥ã€‚ Immutable Tables ä¸å¯å˜è¡¨å¯¹äºå…¶ä¸­æ•°æ®åªå†™å…¥ä¸€æ¬¡è€Œä»ä¸æ›´æ–°çš„è¡¨ï¼Œå¯ä»¥è¿›è¡ŒæŸäº›ä¼˜åŒ–ä»¥å‡å°‘å¢é‡ç»´æŠ¤çš„å†™å…¥æ—¶é—´å¼€é”€ã€‚è¿™æ˜¯å¸¸è§çš„æ—¶é—´åºåˆ—æ•°æ®ï¼Œå¦‚æ—¥å¿—æˆ–äº‹ä»¶æ•°æ®ï¼Œä¸€æ—¦å†™å…¥è¡Œï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šè¢«æ›´æ–°ã€‚è¦åˆ©ç”¨è¿™äº›ä¼˜åŒ–ï¼Œé€šè¿‡å°† IMMUTABLE_ROWS = true å±æ€§æ·»åŠ åˆ°æ‚¨çš„ DDL è¯­å¥ä¸­ï¼Œå°†æ‚¨çš„è¡¨å£°æ˜ä¸ºä¸å¯å˜ï¼š1CREATE TABLE my_table (k VARCHAR PRIMARY KEY, v VARCHAR) IMMUTABLE_ROWS=true ä½¿ç”¨ IMMUTABLE_ROWS = true å£°æ˜çš„è¡¨ä¸Šçš„æ‰€æœ‰ç´¢å¼•éƒ½è¢«è®¤ä¸ºæ˜¯ä¸å¯å˜çš„ï¼ˆè¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹è¡¨è¢«è®¤ä¸ºæ˜¯å¯å˜çš„ï¼‰ã€‚å¯¹äºå…¨å±€ä¸å¯å˜ç´¢å¼•ï¼Œç´¢å¼•å®Œå…¨åœ¨å®¢æˆ·ç«¯ç»´æŠ¤ï¼Œç´¢å¼•è¡¨æ˜¯åœ¨æ•°æ®è¡¨å‘ç”Ÿæ›´æ”¹æ—¶ç”Ÿæˆçš„ã€‚å¦ä¸€æ–¹é¢ï¼Œæœ¬åœ°ä¸å¯å˜ç´¢å¼•åœ¨æœåŠ¡å™¨ç«¯ä¿æŒä¸å˜ã€‚è¯·æ³¨æ„ï¼Œæ²¡æœ‰ä»»ä½•ä¿æŠ¤æªæ–½å¯ä»¥å¼ºåˆ¶æ‰§è¡Œï¼Œå£°æ˜ä¸ºä¸å¯å˜çš„è¡¨å®é™…ä¸Šä¸ä¼šæ”¹å˜æ•°æ®ï¼ˆå› ä¸ºè¿™ä¼šå¦å®šæ‰€è¾¾åˆ°çš„æ€§èƒ½å¢ç›Šï¼‰ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œç´¢å¼•å°†ä¸å†ä¸è¡¨åŒæ­¥ã€‚ å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç°æœ‰çš„è¡¨ï¼Œæ‚¨æƒ³ä»ä¸å¯å˜ç´¢å¼•åˆ‡æ¢åˆ°å¯å˜ç´¢å¼•ï¼Œè¯·ä½¿ç”¨ALTER TABLEå‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š1ALTER TABLE my_table SET IMMUTABLE_ROWS=false éäº‹åŠ¡æ€§ï¼Œä¸å¯å˜è¡¨çš„ç´¢å¼•æ²¡æœ‰è‡ªåŠ¨å¤„ç†æäº¤å¤±è´¥çš„æœºåˆ¶ã€‚ä¿æŒè¡¨å’Œç´¢å¼•ä¹‹é—´çš„ä¸€è‡´æ€§ç•™ç»™å®¢æˆ·ç«¯å¤„ç†ã€‚å› ä¸ºæ›´æ–°æ˜¯å¹‚ç­‰çš„ï¼Œæ‰€ä»¥æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯å®¢æˆ·ç«¯ç»§ç»­é‡è¯•ä¸€æ‰¹çªå˜ï¼Œç›´åˆ°å®ƒä»¬æˆåŠŸã€‚ Mutable Tables å¯å˜è¡¨å¯¹äºéäº‹åŠ¡æ€§å¯å˜è¡¨ï¼Œæˆ‘ä»¬é€šè¿‡å°†ç´¢å¼•æ›´æ–°æ·»åŠ åˆ°ä¸»è¡¨è¡Œçš„é¢„å†™æ—¥å¿—ï¼ˆWALï¼‰æ¡ç›®æ¥ç»´æŠ¤ç´¢å¼•æ›´æ–°æŒä¹…æ€§ã€‚åªæœ‰åœ¨WALæ¡ç›®æˆåŠŸåŒæ­¥åˆ°ç£ç›˜åï¼Œæˆ‘ä»¬æ‰ä¼šå°è¯•æ›´æ–°ç´¢å¼•/ä¸»è¡¨ã€‚æˆ‘ä»¬é»˜è®¤å¹¶è¡Œç¼–å†™ç´¢å¼•æ›´æ–°ï¼Œä»è€Œå¯¼è‡´éå¸¸é«˜çš„ååé‡ã€‚å¦‚æœæœåŠ¡å™¨åœ¨æˆ‘ä»¬å†™ç´¢å¼•æ›´æ–°çš„æ—¶å€™å´©æºƒäº†ï¼Œæˆ‘ä»¬ä¼šé‡æ’­æ‰€æœ‰ç´¢å¼•æ›´æ–°åˆ°WALæ¢å¤è¿‡ç¨‹ä¸­çš„ç´¢å¼•è¡¨ï¼Œå¹¶ä¾èµ–æ›´æ–°çš„å¹‚ç­‰æ€§æ¥ç¡®ä¿æ­£ç¡®æ€§ã€‚å› æ­¤ï¼Œéäº‹åŠ¡æ€§å¯å˜è¡¨ä¸Šçš„ç´¢å¼•åªæ˜¯ä¸»è¡¨èƒŒåçš„ä¸€æ‰¹ç¼–è¾‘ã€‚ é‡è¦çš„æ˜¯è¦æ³¨æ„å‡ ç‚¹ï¼š å¯¹äºéäº‹åŠ¡æ€§è¡¨ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ç´¢å¼•è¡¨ä¸ä¸»è¡¨ä¸åŒæ­¥ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…åªæœ‰å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”ä¸åŒæ­¥ æ¯ä¸ªæ•°æ®è¡ŒåŠå…¶ç´¢å¼•è¡Œéƒ½ä¿è¯è¢«å†™å…¥æˆ–ä¸¢å¤± - æˆ‘ä»¬ä»æ¥æ²¡æœ‰çœ‹åˆ°éƒ¨åˆ†æ›´æ–°ï¼Œå› ä¸ºè¿™æ˜¯HBaseåŸå­æ€§ä¿è¯çš„ä¸€éƒ¨åˆ†ã€‚ é¦–å…ˆå°†æ•°æ®å†™å…¥è¡¨ä¸­ï¼Œç„¶åå†™å…¥ç´¢å¼•è¡¨ï¼ˆå¦‚æœç¦ç”¨WALï¼Œåˆ™åä¹‹äº¦ç„¶ï¼‰ã€‚ Singular Write Pathæœ‰ä¸€ä¸ªä¿è¯å¤±è´¥å±æ€§çš„å†™å…¥è·¯å¾„ã€‚æ‰€æœ‰å†™å…¥HRegionçš„å†…å®¹éƒ½è¢«æˆ‘ä»¬çš„åå¤„ç†å™¨æ‹¦æˆªã€‚ç„¶åï¼Œæˆ‘ä»¬æ ¹æ®æŒ‚èµ·æ›´æ–°ï¼ˆæˆ–æ›´æ–°ï¼Œå¦‚æœæ˜¯æ‰¹å¤„ç†ï¼‰æ„å»ºç´¢å¼•æ›´æ–°ã€‚ç„¶åè¿™äº›æ›´æ–°è¢«é™„åŠ åˆ°åŸå§‹æ›´æ–°çš„WALæ¡ç›®ã€‚ å¦‚æœåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå°†å¤±è´¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•æ•°æ®è¢«æŒä¹…åŒ–æˆ–è€…ä¸å¯è§ã€‚ ä¸€æ—¦WALè¢«å†™å…¥ï¼Œæˆ‘ä»¬ç¡®ä¿å³ä½¿åœ¨å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œç´¢å¼•å’Œä¸»è¡¨æ•°æ®ä¹Ÿå°†å˜å¾—å¯è§ã€‚ å¦‚æœæœåŠ¡å™¨å‘ç”Ÿå´©æºƒï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨é€šå¸¸çš„WALé‡æ’­æœºåˆ¶é‡æ’­ç´¢å¼•æ›´æ–°ã€‚ å¦‚æœæœåŠ¡å™¨æ²¡æœ‰å´©æºƒï¼Œæˆ‘ä»¬åªæ˜¯å°†ç´¢å¼•æ›´æ–°æ’å…¥åˆ°å®ƒä»¬å„è‡ªçš„è¡¨ä¸­ã€‚ å¦‚æœç´¢å¼•æ›´æ–°å¤±è´¥ï¼Œä¸‹é¢æ¦‚è¿°äº†ä¿æŒä¸€è‡´æ€§çš„å„ç§æ–¹æ³•ã€‚ å¦‚æœPhoenixç³»ç»Ÿç›®å½•è¡¨å‘ç”Ÿæ•…éšœæ—¶æ— æ³•åˆ°è¾¾ï¼Œæˆ‘ä»¬å¼ºåˆ¶æœåŠ¡å™¨ç«‹å³ä¸­æ­¢å¹¶å¤±è´¥ï¼Œè¯·åœ¨JVMä¸Šè°ƒç”¨System.exitï¼Œå¼ºåˆ¶æœåŠ¡å™¨æ­»æœºã€‚é€šè¿‡æ€æ­»æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ç¡®ä¿WALå°†åœ¨æ¢å¤æ—¶é‡æ’­ï¼Œå°†ç´¢å¼•æ›´æ–°é‡æ’­åˆ°ç›¸åº”çš„è¡¨ä¸­ã€‚è¿™ç¡®ä¿äº†äºŒçº§ç´¢å¼•åœ¨çŸ¥é“æ— æ•ˆçŠ¶æ€æ—¶ä¸ä¼šç»§ç»­ä½¿ç”¨ã€‚ ç¦æ­¢è¡¨å†™å…¥ï¼Œç›´åˆ°å¯å˜çš„ç´¢å¼•æ˜¯ä¸€è‡´çš„åœ¨éäº‹åŠ¡æ€§è¡¨å’Œç´¢å¼•ä¹‹é—´ä¿æŒä¸€è‡´æ€§çš„æœ€é«˜çº§åˆ«æ˜¯å£°æ˜åœ¨æ›´æ–°ç´¢å¼•å¤±è´¥çš„æƒ…å†µä¸‹åº”æš‚æ—¶ç¦æ­¢å†™å…¥æ•°æ®è¡¨ã€‚åœ¨æ­¤ä¸€è‡´æ€§æ¨¡å¼ä¸‹ï¼Œè¡¨å’Œç´¢å¼•å°†ä¿ç•™åœ¨å‘ç”Ÿæ•…éšœä¹‹å‰çš„æ—¶é—´æˆ³ï¼Œå†™å…¥æ•°æ®è¡¨å°†è¢«ç¦æ­¢ï¼Œç›´åˆ°ç´¢å¼•é‡æ–°è”æœºå¹¶ä¸æ•°æ®è¡¨åŒæ­¥ã€‚è¯¥ç´¢å¼•å°†ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶åƒå¾€å¸¸ä¸€æ ·ç»§ç»­ä½¿ç”¨æŸ¥è¯¢ã€‚ ä»¥ä¸‹æœåŠ¡å™¨ç«¯é…ç½®æ§åˆ¶æ­¤è¡Œä¸ºï¼š phoenix.index.failure.block.writeå¿…é¡»ä¸ºtrueï¼Œä»¥ä¾¿åœ¨å‘ç”Ÿæäº¤å¤±è´¥æ—¶å†™å…¥æ•°æ®è¡¨ä»¥å¤±è´¥ï¼Œç›´åˆ°å¯ä»¥ä½¿ç”¨æ•°æ®è¡¨è¿½ä¸Šç´¢å¼•ã€‚ phoenix.index.failure.handling.rebuildå¿…é¡»ä¸ºtrueï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œä»¥ä¾¿åœ¨å‘ç”Ÿæäº¤å¤±è´¥çš„æƒ…å†µä¸‹åœ¨åå°é‡å»ºå¯å˜ç´¢å¼•ã€‚ å†™å…¥å¤±è´¥æ—¶ç¦ç”¨å¯å˜ç´¢å¼•ï¼Œç›´åˆ°ä¸€è‡´æ€§æ¢å¤å¦‚æœåœ¨æäº¤æ—¶å†™å…¥å¤±è´¥ï¼Œå…·æœ‰å¯å˜ç´¢å¼•çš„é»˜è®¤è¡Œä¸ºæ˜¯å°†ç´¢å¼•æ ‡è®°ä¸ºç¦ç”¨,åœ¨åå°éƒ¨åˆ†é‡å»ºå®ƒä»¬ï¼Œç„¶ååœ¨æ¢å¤ä¸€è‡´æ€§æ—¶å†æ¬¡å°†å…¶æ ‡è®°ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚åœ¨è¿™ç§ä¸€è‡´æ€§æ¨¡å¼ä¸‹ï¼Œåœ¨é‡å»ºäºŒçº§ç´¢å¼•æ—¶ï¼Œå†™å…¥æ•°æ®è¡¨ä¸ä¼šè¢«é˜»å¡ã€‚ä½†æ˜¯ï¼Œåœ¨é‡å»ºè¿‡ç¨‹ä¸­ï¼ŒäºŒçº§ç´¢å¼•ä¸ä¼šè¢«æŸ¥è¯¢ä½¿ç”¨ã€‚ ä»¥ä¸‹æœåŠ¡å™¨ç«¯é…ç½®æ§åˆ¶æ­¤è¡Œä¸ºï¼š phoenix.index.failure.handling.rebuildå¿…é¡»ä¸ºtrueï¼ˆç¼ºçœå€¼ï¼‰ï¼Œä»¥ä¾¿åœ¨å‘ç”Ÿæäº¤å¤±è´¥çš„æƒ…å†µä¸‹åœ¨åå°é‡å»ºå¯å˜ç´¢å¼•ã€‚ phoenix.index.failure.handling.rebuild.intervalæ§åˆ¶æœåŠ¡å™¨æ£€æŸ¥æ˜¯å¦éœ€è¦éƒ¨åˆ†é‡å»ºå¯å˜ç´¢å¼•ä»¥èµ¶ä¸Šæ•°æ®è¡¨æ›´æ–°çš„æ¯«ç§’é¢‘ç‡ã€‚é»˜è®¤å€¼æ˜¯10000æˆ–10ç§’ã€‚ phoenix.index.failure.handling.rebuild.overlap.timeæ§åˆ¶æ‰§è¡Œéƒ¨åˆ†é‡å»ºæ—¶ä»å‘ç”Ÿæ•…éšœçš„æ—¶é—´æˆ³å¼€å§‹è¿”å›çš„æ¯«ç§’æ•°ã€‚é»˜è®¤å€¼æ˜¯1ã€‚ å†™å…¥å¤±è´¥æ—¶ç¦ç”¨å¯å˜ç´¢å¼•ï¼Œéœ€è¦æ‰‹åŠ¨é‡å»ºè¿™æ˜¯å¯å˜äºŒçº§ç´¢å¼•çš„æœ€ä½ä¸€è‡´æ€§æ°´å¹³ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å†™å…¥äºŒçº§ç´¢å¼•å¤±è´¥æ—¶ï¼Œç´¢å¼•å°†è¢«æ ‡è®°ä¸ºç¦ç”¨ï¼Œå¹¶ä¸”æ‰‹åŠ¨é‡å»ºæ‰€éœ€çš„ç´¢å¼•ä»¥ä½¿å…¶å†æ¬¡è¢«æŸ¥è¯¢ä½¿ç”¨ã€‚ ä»¥ä¸‹æœåŠ¡å™¨ç«¯é…ç½®æ§åˆ¶æ­¤è¡Œä¸ºï¼š å¦‚æœæäº¤å¤±è´¥ï¼Œphoenix.index.failure.handling.rebuildå¿…é¡»è®¾ç½®ä¸ºfalseï¼Œä»¥ç¦æ­¢åœ¨åå°é‡å»ºå¯å˜ç´¢å¼•ã€‚ Setup è®¾ç½® éäº‹åŠ¡æ€§ï¼Œå¯å˜ç´¢å¼•éœ€è¦åœ¨åŒºåŸŸæœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨ä¸Šè¿è¡Œç‰¹æ®Šçš„é…ç½®é€‰é¡¹ - Phoenixç¡®ä¿åœ¨è¡¨ä¸Šå¯ç”¨å¯å˜ç´¢å¼•æ—¶ï¼Œå®ƒä»¬å·²æ­£ç¡®è®¾ç½®;å¦‚æœæœªè®¾ç½®æ­£ç¡®çš„å±æ€§ï¼Œåˆ™å°†æ— æ³•ä½¿ç”¨è¾…åŠ©ç´¢å¼•ã€‚å°†è¿™äº›è®¾ç½®æ·»åŠ åˆ°æ‚¨çš„hbase-site.xmlåï¼Œæ‚¨éœ€è¦é‡å¯é›†ç¾¤ã€‚ æ‚¨å°†éœ€è¦å°†ä»¥ä¸‹å‚æ•°æ·»åŠ åˆ°æ¯ä¸ªåŒºåŸŸæœåŠ¡å™¨ä¸Šçš„hbase-site.xmlï¼š1234&lt;property&gt; &lt;name&gt;hbase.regionserver.wal.codec&lt;/name&gt; &lt;value&gt;org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec&lt;/value&gt;&lt;/property&gt; ä¸Šé¢çš„å±æ€§ä½¿å®šåˆ¶çš„WALç¼–è¾‘èƒ½å¤Ÿè¢«å†™å…¥ï¼Œç¡®ä¿ç´¢å¼•æ›´æ–°çš„æ­£ç¡®å†™å…¥/é‡æ’­ã€‚è¿™ä¸ªç¼–è§£ç å™¨æ”¯æŒé€šå¸¸çš„ä¸»æœºWALEdité€‰é¡¹ï¼Œæœ€æ˜¾ç€çš„æ˜¯WALEditå‹ç¼©ã€‚12345678910&lt;property&gt; &lt;name&gt;hbase.region.server.rpc.scheduler.factory.class&lt;/name&gt; &lt;value&gt;org.apache.hadoop.hbase.ipc.PhoenixRpcSchedulerFactory&lt;/value&gt; &lt;description&gt;Factory to create the Phoenix RPC Scheduler that uses separate queues for index and metadata updates&lt;/description&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hbase.rpc.controllerfactory.class&lt;/name&gt; &lt;value&gt;org.apache.hadoop.hbase.ipc.controller.ServerRpcControllerFactory&lt;/value&gt; &lt;description&gt;Factory to create the Phoenix RPC Scheduler that uses separate queues for index and metadata updates&lt;/description&gt;&lt;/property&gt; é€šè¿‡ç¡®ä¿ç´¢å¼•æ›´æ–°çš„ä¼˜å…ˆçº§é«˜äºæ•°æ®æ›´æ–°ï¼Œä¸Šè¿°å±æ€§å¯é˜²æ­¢åœ¨å…¨å±€ç´¢å¼•ï¼ˆHBase 0.98.4+å’ŒPhoenix 4.3.1+ï¼‰çš„ç´¢å¼•ç»´æŠ¤è¿‡ç¨‹ä¸­å‘ç”Ÿæ­»é”ã€‚å®ƒè¿˜é€šè¿‡ç¡®ä¿å…ƒæ•°æ®rpcè°ƒç”¨æ¯”æ•°æ®rpcè°ƒç”¨å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§æ¥é˜²æ­¢æ­»é”ã€‚ ä»Phoenix 4.8.0å¼€å§‹ï¼Œä¸éœ€è¦æ›´æ”¹é…ç½®å°±å¯ä»¥ä½¿ç”¨æœ¬åœ°ç´¢å¼•ã€‚åœ¨Phoenix 4.7åŠæ›´ä½ç‰ˆæœ¬ä¸­ï¼Œä¸»æœåŠ¡å™¨èŠ‚ç‚¹å’ŒåŒºåŸŸæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šçš„æœåŠ¡å™¨ç«¯hbase-site.xmléœ€è¦è¿›è¡Œä»¥ä¸‹é…ç½®æ›´æ”¹ï¼š123456789101112&lt;property&gt; &lt;name&gt;hbase.master.loadbalancer.class&lt;/name&gt; &lt;value&gt;org.apache.phoenix.hbase.index.balancer.IndexLoadBalancer&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hbase.coprocessor.master.classes&lt;/name&gt; &lt;value&gt;org.apache.phoenix.hbase.index.master.IndexMasterObserver&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hbase.coprocessor.regionserver.classes&lt;/name&gt; &lt;value&gt;org.apache.hadoop.hbase.regionserver.LocalIndexMerger&lt;/value&gt;&lt;/property&gt; å‡çº§4.8.0ä¹‹å‰åˆ›å»ºçš„æœ¬åœ°ç´¢å¼•åœ¨æœåŠ¡å™¨ä¸Šå°†Phoenixå‡çº§åˆ°4.8.0ä»¥ä¸Šç‰ˆæœ¬æ—¶ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯·ä»hbase-site.xmlä¸­é™¤å»ä»¥ä¸Šä¸‰ä¸ªä¸æœ¬åœ°ç´¢å¼•ç›¸å…³çš„é…ç½®ã€‚ä»å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬æ”¯æŒåœ¨çº¿ï¼ˆåœ¨åˆå§‹åŒ–æ¥è‡ª4.8.0+ç‰ˆæœ¬çš„phoenixå®¢æˆ·ç«¯çš„è¿æ¥æ—¶ï¼‰å’Œç¦»çº¿ï¼ˆä½¿ç”¨psqlå·¥å…·ï¼‰åœ¨4.8.0ä¹‹å‰åˆ›å»ºçš„æœ¬åœ°ç´¢å¼•çš„å‡çº§ã€‚ä½œä¸ºå‡çº§çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä»¥ASYNCæ¨¡å¼é‡æ–°åˆ›å»ºæœ¬åœ°ç´¢å¼•ã€‚å‡çº§åç”¨æˆ·éœ€è¦ä½¿ç”¨IndexToolå»ºç«‹ç´¢å¼•ã€‚ åœ¨å‡çº§ä¹‹åä½¿ç”¨å®¢æˆ·ç«¯é…ç½®ã€‚ phoenix.client.localIndexUpgrade å€¼ä¸º true åˆ™è¡¨ç¤ºåœ¨çº¿å‡çº§, false è¡¨ç¤ºç¦»çº¿å‡çº§ã€‚ é»˜è®¤ä¸º true ã€‚ å‘½ä»¤ä½¿ç”¨psqlå·¥å…·$ psql [zookeeper] -lè¿è¡Œç¦»çº¿å‡çº§ã€‚ Tuning ç´¢å¼•æ˜¯ç›¸å½“å¿«çš„ã€‚ä½†æ˜¯ï¼Œè¦ä¼˜åŒ–æ‚¨çš„ç‰¹å®šç¯å¢ƒå’Œå·¥ä½œè´Ÿè½½ï¼Œå¯ä»¥è°ƒæ•´ä¸€äº›å±æ€§ã€‚ ä»¥ä¸‹æ‰€æœ‰å‚æ•°å¿…é¡»åœ¨hbase-site.xmlä¸­è®¾ç½® - å¯¹äºæ•´ä¸ªé›†ç¾¤å’Œæ‰€æœ‰ç´¢å¼•è¡¨ï¼Œä»¥åŠåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰åŒºåŸŸä¸Šéƒ½æ˜¯å¦‚æ­¤ï¼ˆä¾‹å¦‚ï¼Œä¸€å°æœåŠ¡å™¨ä¹Ÿä¸ä¼šä¸€æ¬¡å†™å…¥è®¸å¤šä¸åŒçš„ç´¢å¼•è¡¨ï¼‰ã€‚ index.builder.threads.max ç”¨äºä»ä¸»è¡¨æ›´æ–°æ„å»ºç´¢å¼•æ›´æ–°çš„çº¿ç¨‹æ•° å¢åŠ æ­¤å€¼å…‹æœäº†ä»åº•å±‚HRegionè¯»å–å½“å‰è¡ŒçŠ¶æ€çš„ç“¶é¢ˆã€‚è°ƒæ•´è¿™ä¸ªå€¼å¤ªé«˜ï¼Œåªä¼šå¢åŠ HRegionç“¶é¢ˆï¼Œå› ä¸ºå®ƒå°†æ— æ³•å¤„ç†å¤ªå¤šçš„å¹¶å‘æ‰«æè¯·æ±‚ï¼Œä»¥åŠä¸€èˆ¬çš„çº¿ç¨‹äº¤æ¢é—®é¢˜ã€‚ Default: 10 index.builder.threads.keepalivetime åœ¨æ„å»ºå™¨çº¿ç¨‹æ± ä¸­ä½¿çº¿ç¨‹è¿‡æœŸåçš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ æœªä½¿ç”¨çš„çº¿ç¨‹ä¼šåœ¨è¿™æ®µæ—¶é—´åç«‹å³é‡Šæ”¾ï¼Œè€Œä¸ä¼šä¿ç•™æ ¸å¿ƒçº¿ç¨‹ Default: 60 index.writer.threads.max Number of threads to use when writing to the target index tables. The first level of parallelization, on a per-table basis - it should roughly correspond to the number of index tables Default: 10 index.writer.threads.keepalivetime Amount of time in seconds after we expire threads in the writer thread pool. Unused threads are immediately released after this amount of time and not core threads are retained (though this last is a small concern as tables are expected to sustain a fairly constant write load), but simultaneously allows us to drop threads if we are not seeing the expected load. Default: 60 hbase.htable.threads.max Number of threads each index HTable can use for writes. Increasing this allows more concurrent index updates (for instance across batches), leading to high overall throughput. Default: 2,147,483,647 hbase.htable.threads.keepalivetime Amount of time in seconds after we expire threads in the HTableâ€™s thread pool. Using the â€œdirect handoffâ€ approach, new threads will only be created if it is necessary and will grow unbounded. This could be bad but HTables only create as many Runnables as there are region servers; therefore, it also scales when new region servers are added. Default: 60 index.tablefactory.cache.size Number of index HTables we should keep in cache. Increasing this number ensures that we do not need to recreate an HTable for each attempt to write to an index table. Conversely, you could see memory pressure if this value is set too high. Default: 10 org.apache.phoenix.regionserver.index.priority.min Value to specify to bottom (inclusive) of the range in which index priority may lie. Default: 1000 org.apache.phoenix.regionserver.index.priority.max Value to specify to top (exclusive) of the range in which index priority may lie. Higher priorites within the index min/max range do not means updates are processed sooner. Default: 1050 org.apache.phoenix.regionserver.index.handler.count Number of threads to use when serving index write requests for global index maintenance. Though the actual number of threads is dictated by the Max(number of call queues, handler count), where the number of call queues is determined by standard HBase configuration. To further tune the queues, you can adjust the standard rpc queue length parameters (currently, there are no special knobs for the index queues), specifically ipc.server.max.callqueue.length and ipc.server.callqueue.handler.factor. See the HBase Reference Guide for more details. Default: 30 Performance We track secondary index performance via our performance framework. This is a generic test of performance based on defaults - your results will vary based on hardware specs as well as you individual configuration. That said, we have seen secondary indexing (both immutable and mutable) go as quickly as &lt; 2x the regular write path on a small, (3 node) desktop-based cluster. This is actually pretty reasonable as we have to write to multiple tables as well as build the index update. Index Scrutiny Tool With Phoenix 4.12, there is now a tool to run a MapReduce job to verify that an index table is valid against its data table. The only way to find orphaned rows in either table is to scan over all rows in the table and do a lookup in the other table for the corresponding row. For that reason, the tool can run with either the data or index table as the â€œsourceâ€ table, and the other as the â€œtargetâ€ table. The tool writes all invalid rows it finds either to file or to an output table PHOENIX_INDEX_SCRUTINY. An invalid row is a source row that either has no corresponding row in the target table, or has an incorrect value in the target table (i.e. covered column value). The tool has job counters that track its status. VALID_ROW_COUNT, INVALID_ROW_COUNT, BAD_COVERED_COL_VAL_COUNT. Note that invalid rows - bad col val rows = number of orphaned rows. These counters are written to the table PHOENIX_INDEX_SCRUTINY_METADATA, along with other job metadata. The Index Scrutiny Tool can be launched via the hbase command (in hbase/bin) as follows: 1hbase org.apache.phoenix.mapreduce.index.IndexScrutinyTool -dt my_table -it my_index -o It can also be run from Hadoop using either the phoenix-core or phoenix-server jar as follows: 1HADOOP_CLASSPATH=$(hbase mapredcp) hadoop jar phoenix-&lt;version&gt;-server.jar org.apache.phoenix.mapreduce.index.IndexScrutinyTool -dt my_table -it my_index -o By default two mapreduce jobs are launched, one with the data table as the source table and one with the index table as the source table. The following parameters can be used with the Index Scrutiny Tool: ç¿»è¯‘è‡ª:secondary_indexing","raw":null,"content":null,"categories":[{"name":"phoenix","slug":"phoenix","permalink":"https://stanxia.github.io/categories/phoenix/"}],"tags":[{"name":"phoenix","slug":"phoenix","permalink":"https://stanxia.github.io/tags/phoenix/"}]},{"title":"Google Bigtable ä¸­æ–‡ç‰ˆ","slug":"Google-Bigtable-ä¸­æ–‡ç‰ˆ","date":"2017-12-25T16:48:35.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/25/Google-Bigtable-ä¸­æ–‡ç‰ˆ/","link":"","permalink":"https://stanxia.github.io/2017/12/25/Google-Bigtable-ä¸­æ–‡ç‰ˆ/","excerpt":"æ‘˜è¦\nBigtable æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥å¤„ç†æµ·é‡æ•°æ®:é€šå¸¸æ˜¯åˆ†å¸ƒåœ¨æ•°åƒå°æ™®é€šæœåŠ¡å™¨ä¸Šçš„ PB çº§çš„æ•°æ®ã€‚\nGoogle çš„å¾ˆå¤šé¡¹ç›®ä½¿ç”¨ Bigtable å­˜å‚¨æ•°æ®ï¼ŒåŒ…æ‹¬ Web ç´¢å¼•ã€Google Earthã€Google Financeã€‚è¿™äº›åº”ç”¨å¯¹ Bigtable æå‡ºçš„è¦æ±‚å·®å¼‚éå¸¸å¤§ï¼Œæ— è®ºæ˜¯åœ¨æ•°æ®é‡ä¸Š(ä» URL åˆ°ç½‘é¡µåˆ°å«æ˜Ÿå›¾åƒ)è¿˜æ˜¯åœ¨å“åº”é€Ÿåº¦ä¸Š(ä»åç«¯çš„æ‰¹é‡å¤„ç†åˆ°å®æ—¶æ•°æ®æœåŠ¡)ã€‚å°½ç®¡åº”ç”¨éœ€æ±‚å·®å¼‚å¾ˆå¤§ï¼Œä½†æ˜¯ï¼Œé’ˆå¯¹ Google çš„è¿™äº›äº§å“ï¼ŒBigtable è¿˜æ˜¯æˆåŠŸçš„æä¾›äº†ä¸€ä¸ªçµæ´»çš„ã€é«˜æ€§èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚\næœ¬è®ºæ–‡æè¿°äº† Bigtable æä¾›çš„ç®€å•çš„æ•°æ®æ¨¡å‹ã€‚åˆ©ç”¨è¿™ä¸ªæ¨¡å‹ï¼Œç”¨æˆ·å¯ä»¥åŠ¨æ€çš„æ§åˆ¶æ•°æ®çš„åˆ†å¸ƒå’Œæ ¼å¼ã€‚ æˆ‘ä»¬è¿˜å°†æè¿° Bigtable çš„è®¾è®¡å’Œå®ç°ã€‚","text":"æ‘˜è¦ Bigtable æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥å¤„ç†æµ·é‡æ•°æ®:é€šå¸¸æ˜¯åˆ†å¸ƒåœ¨æ•°åƒå°æ™®é€šæœåŠ¡å™¨ä¸Šçš„ PB çº§çš„æ•°æ®ã€‚ Google çš„å¾ˆå¤šé¡¹ç›®ä½¿ç”¨ Bigtable å­˜å‚¨æ•°æ®ï¼ŒåŒ…æ‹¬ Web ç´¢å¼•ã€Google Earthã€Google Financeã€‚è¿™äº›åº”ç”¨å¯¹ Bigtable æå‡ºçš„è¦æ±‚å·®å¼‚éå¸¸å¤§ï¼Œæ— è®ºæ˜¯åœ¨æ•°æ®é‡ä¸Š(ä» URL åˆ°ç½‘é¡µåˆ°å«æ˜Ÿå›¾åƒ)è¿˜æ˜¯åœ¨å“åº”é€Ÿåº¦ä¸Š(ä»åç«¯çš„æ‰¹é‡å¤„ç†åˆ°å®æ—¶æ•°æ®æœåŠ¡)ã€‚å°½ç®¡åº”ç”¨éœ€æ±‚å·®å¼‚å¾ˆå¤§ï¼Œä½†æ˜¯ï¼Œé’ˆå¯¹ Google çš„è¿™äº›äº§å“ï¼ŒBigtable è¿˜æ˜¯æˆåŠŸçš„æä¾›äº†ä¸€ä¸ªçµæ´»çš„ã€é«˜æ€§èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚ æœ¬è®ºæ–‡æè¿°äº† Bigtable æä¾›çš„ç®€å•çš„æ•°æ®æ¨¡å‹ã€‚åˆ©ç”¨è¿™ä¸ªæ¨¡å‹ï¼Œç”¨æˆ·å¯ä»¥åŠ¨æ€çš„æ§åˆ¶æ•°æ®çš„åˆ†å¸ƒå’Œæ ¼å¼ã€‚ æˆ‘ä»¬è¿˜å°†æè¿° Bigtable çš„è®¾è®¡å’Œå®ç°ã€‚ä»‹ç»åœ¨è¿‡å»ä¸¤å¹´åŠæ—¶é—´é‡Œï¼Œæˆ‘ä»¬è®¾è®¡ã€å®ç°å¹¶éƒ¨ç½²äº†ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨ç³»ç»Ÿ â€” åœ¨ Googleï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º Bigtableã€‚Bigtable çš„è®¾è®¡ç›®çš„æ˜¯å¯é çš„å¤„ç† PB çº§åˆ«çš„æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿéƒ¨ç½²åˆ°ä¸Šåƒå°æœºå™¨ä¸Šã€‚Bigtable å·²ç»å®ç°äº†ä¸‹é¢çš„å‡ ä¸ªç›®æ ‡:é€‚ç”¨æ€§å¹¿æ³›ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½å’Œé«˜å¯ç”¨æ€§ã€‚ Bigtable å·²ç»åœ¨è¶…è¿‡ 60 ä¸ª Google çš„äº§å“å’Œé¡¹ç›®ä¸Šå¾—åˆ°äº†åº”ç”¨ï¼ŒåŒ…æ‹¬ Google Analyticsã€Google Financeã€ Orkutã€Personalized Searchã€Writely å’Œ Google Earthã€‚è¿™äº›äº§å“å¯¹ Bigtable æå‡ºäº†è¿¥å¼‚çš„éœ€æ±‚ï¼Œæœ‰çš„éœ€è¦é«˜ååé‡çš„æ‰¹å¤„ç†ï¼Œæœ‰çš„åˆ™éœ€è¦åŠæ—¶å“åº”ï¼Œå¿«é€Ÿè¿”å›æ•°æ®ç»™æœ€ç»ˆç”¨æˆ·ã€‚å®ƒä»¬ä½¿ç”¨çš„ Bigtable é›†ç¾¤çš„é…ç½®ä¹Ÿæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œæœ‰çš„é›†ç¾¤åªæœ‰å‡ å°æœåŠ¡å™¨ï¼Œè€Œæœ‰çš„åˆ™éœ€è¦ä¸Šåƒå°æœåŠ¡å™¨ã€å­˜å‚¨å‡ ç™¾ TB çš„æ•°æ®ã€‚ åœ¨å¾ˆå¤šæ–¹é¢ï¼ŒBigtable å’Œæ•°æ®åº“å¾ˆç±»ä¼¼:å®ƒä½¿ç”¨äº†å¾ˆå¤šæ•°æ®åº“çš„å®ç°ç­–ç•¥ã€‚å¹¶è¡Œæ•°æ®åº“å’Œå†…å­˜æ•°æ®åº“å·²ç»å…·å¤‡å¯æ‰©å±•æ€§å’Œé«˜æ€§èƒ½ï¼Œä½†æ˜¯ Bigtable æä¾›äº†ä¸€ä¸ªå’Œè¿™äº›ç³»ç»Ÿå®Œå…¨ä¸åŒçš„æ¥å£ã€‚Bigtable ä¸æ”¯æŒå®Œæ•´çš„å…³ç³»æ•°æ®æ¨¡å‹;ä¸ä¹‹ç›¸åï¼ŒBigtable ä¸ºå®¢æˆ·æä¾›äº†ç®€å•çš„æ•°æ®æ¨¡å‹ï¼Œåˆ©ç”¨è¿™ä¸ªæ¨¡å‹ï¼Œå®¢æˆ·å¯ä»¥åŠ¨æ€æ§åˆ¶æ•°æ®çš„åˆ†å¸ƒå’Œæ ¼å¼ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±æ¨æµ‹åº•å±‚å­˜å‚¨æ•°æ®çš„ä½ç½®ç›¸å…³æ€§ã€‚æ•°æ®çš„ä¸‹æ ‡æ˜¯è¡Œå’Œåˆ—çš„åå­—ï¼Œåå­—å¯ä»¥æ˜¯ä»»æ„çš„å­—ç¬¦ä¸²ã€‚Bigtable å°†å­˜å‚¨çš„æ•°æ®éƒ½è§†ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ Bigtable æœ¬èº«ä¸å»è§£æè¿™äº›å­—ç¬¦ä¸²ï¼Œå®¢æˆ·ç¨‹åºé€šå¸¸ä¼šåœ¨æŠŠå„ç§ç»“æ„åŒ–æˆ–è€…åŠç»“æ„åŒ–çš„æ•°æ®ä¸²è¡ŒåŒ–åˆ°è¿™äº›å­—ç¬¦ä¸²é‡Œã€‚é€šè¿‡ä»”ç»†é€‰æ‹©æ•°æ®çš„æ¨¡å¼ï¼Œå®¢æˆ·å¯ä»¥æ§åˆ¶æ•°æ®çš„ä½ç½®ç›¸å…³æ€§ã€‚æœ€åï¼Œå¯ä»¥é€šè¿‡ BigTable çš„æ¨¡å¼å‚æ•°æ¥æ§åˆ¶æ•°æ®æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­è¿˜æ˜¯ç¡¬ç›˜ä¸Šã€‚ ç¬¬ 3 èŠ‚æè¿°å…³äºæ•°æ®æ¨¡å‹æ›´å¤šç»†èŠ‚æ–¹é¢çš„ä¸œè¥¿; ç¬¬ 4 èŠ‚æ¦‚è¦ä»‹ç»äº†å®¢æˆ·ç«¯ API; ç¬¬ 5 èŠ‚ç®€è¦ä»‹ç»äº† BigTable åº•å±‚ä½¿ç”¨çš„ Google çš„åŸºç¡€æ¡†æ¶; ç¬¬ 6 èŠ‚æè¿°äº† BigTable å®ç°çš„å…³é”®éƒ¨åˆ†; ç¬¬ 7 èŠ‚æè¿°äº†æˆ‘ä»¬ä¸ºäº†æé«˜ BigTable çš„æ€§èƒ½é‡‡ç”¨çš„ä¸€äº›ç²¾ç»†çš„è°ƒä¼˜æ–¹æ³•; ç¬¬ 8 èŠ‚æä¾›äº† BigTable çš„æ€§èƒ½æ•°æ®; ç¬¬ 9 èŠ‚è®²è¿°äº†å‡ ä¸ª Google å†…éƒ¨ä½¿ç”¨ BigTable çš„ä¾‹å­; ç¬¬ 10 èŠ‚æ˜¯æˆ‘ä»¬åœ¨è®¾è®¡å’ŒåæœŸæ”¯æŒè¿‡ç¨‹ä¸­å¾—åˆ°ä¸€äº›ç»éªŒå’Œæ•™è®­; æœ€åï¼Œåœ¨ç¬¬ 11 èŠ‚åˆ—å‡ºæˆ‘ä»¬çš„ç›¸å…³ç ”ç©¶å·¥ä½œï¼Œç¬¬ 12 èŠ‚æ˜¯æˆ‘ä»¬çš„ç»“è®ºã€‚æ•°æ®æ¨¡å‹Bigtable æ˜¯ä¸€ä¸ªç¨€ç–çš„ã€åˆ†å¸ƒå¼çš„ã€æŒä¹…åŒ–å­˜å‚¨çš„å¤šç»´åº¦æ’åº Mapã€‚Map çš„ç´¢å¼•æ˜¯è¡Œå…³é”®å­—ã€åˆ—å…³é”®å­—ä»¥åŠæ—¶é—´æˆ³;Map ä¸­çš„æ¯ä¸ª value éƒ½æ˜¯ä¸€ä¸ªæœªç»è§£æçš„ byte æ•°ç»„ã€‚(row:string, column:string,time:int64)-&gt;stringæˆ‘ä»¬åœ¨ä»”ç»†åˆ†æäº†ä¸€ä¸ªç±»ä¼¼ Bigtable çš„ç³»ç»Ÿçš„ç§ç§æ½œåœ¨ç”¨é€”ä¹‹åï¼Œå†³å®šä½¿ç”¨è¿™ä¸ªæ•°æ®æ¨¡å‹ã€‚æˆ‘ä»¬å…ˆä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œè¿™ä¸ªä¾‹å­ä¿ƒä½¿æˆ‘ä»¬åšäº†å¾ˆå¤šè®¾è®¡å†³ç­–;å‡è®¾æˆ‘ä»¬æƒ³è¦å­˜å‚¨æµ·é‡çš„ç½‘é¡µåŠç›¸å…³ä¿¡æ¯ï¼Œè¿™äº›æ•°æ®å¯ä»¥ç”¨äºå¾ˆå¤šä¸åŒçš„é¡¹ç›®ï¼Œæˆ‘ä»¬å§‘ä¸”ç§°è¿™ä¸ªç‰¹æ®Šçš„è¡¨ä¸º Webtableã€‚åœ¨ Webtable é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ URL ä½œä¸ºè¡Œå…³é”®å­—ï¼Œä½¿ç”¨ç½‘é¡µçš„æŸäº›å±æ€§ä½œä¸ºåˆ—åï¼Œç½‘é¡µçš„å†…å®¹å­˜åœ¨â€œcontents:â€åˆ—ä¸­ï¼Œå¹¶ç”¨è·å–è¯¥ç½‘é¡µçš„æ—¶é—´æˆ³ä½œä¸ºæ ‡è¯†,å¦‚å›¾ä¸€æ‰€ç¤ºã€‚è¡Œåæ˜¯ä¸€ä¸ªåå‘ URLã€‚contents åˆ—æ—å­˜æ”¾çš„æ˜¯ç½‘é¡µçš„å†…å®¹ï¼Œanchor åˆ—æ—å­˜æ”¾å¼•ç”¨è¯¥ç½‘é¡µçš„é”šé“¾æ¥æ–‡æœ¬ã€‚ CNN çš„ä¸»é¡µè¢« Sports Illustrator å’Œ MY-look çš„ä¸»é¡µå¼•ç”¨ï¼Œå› æ­¤è¯¥è¡ŒåŒ…å«äº†åä¸ºâ€œanchor:cnnsi.comâ€å’Œ â€œanchhor:my.look.caâ€çš„åˆ—ã€‚æ¯ä¸ªé”šé“¾æ¥åªæœ‰ä¸€ä¸ªç‰ˆæœ¬;è€Œ contents åˆ—åˆ™æœ‰ä¸‰ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«ç”±æ—¶é—´æˆ³ t3ï¼Œt5ï¼Œå’Œ t6 æ ‡è¯†ã€‚ è¡Œè¡¨ä¸­çš„è¡Œå…³é”®å­—å¯ä»¥æ˜¯ä»»æ„çš„å­—ç¬¦ä¸²(ç›®å‰æ”¯æŒæœ€å¤§ 64KB çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¯¹å¤§å¤šæ•°ç”¨æˆ·ï¼Œ10-100 ä¸ªå­— èŠ‚å°±è¶³å¤Ÿäº†)ã€‚å¯¹åŒä¸€ä¸ªè¡Œå…³é”®å­—çš„è¯»æˆ–è€…å†™æ“ä½œéƒ½æ˜¯åŸå­çš„(ä¸ç®¡è¯»æˆ–è€…å†™è¿™ä¸€è¡Œé‡Œå¤šå°‘ä¸ªä¸åŒåˆ—)ï¼Œè¿™ä¸ª è®¾è®¡å†³ç­–èƒ½å¤Ÿä½¿ç”¨æˆ·å¾ˆå®¹æ˜“çš„ç†è§£ç¨‹åºåœ¨å¯¹åŒä¸€ä¸ªè¡Œè¿›è¡Œå¹¶å‘æ›´æ–°æ“ä½œæ—¶çš„è¡Œä¸ºã€‚ Bigtable é€šè¿‡è¡Œå…³é”®å­—çš„å­—å…¸é¡ºåºæ¥ç»„ç»‡æ•°æ®ã€‚è¡¨ä¸­çš„æ¯ä¸ªè¡Œéƒ½å¯ä»¥åŠ¨æ€åˆ†åŒºã€‚æ¯ä¸ªåˆ†åŒºå«åšä¸€ä¸ªâ€Tabletâ€ï¼Œ Tablet æ˜¯æ•°æ®åˆ†å¸ƒå’Œè´Ÿè½½å‡è¡¡è°ƒæ•´çš„æœ€å°å•ä½ã€‚è¿™æ ·åšçš„ç»“æœæ˜¯ï¼Œå½“æ“ä½œåªè¯»å–è¡Œä¸­å¾ˆå°‘å‡ åˆ—çš„æ•°æ®æ—¶æ•ˆç‡å¾ˆ é«˜ï¼Œé€šå¸¸åªéœ€è¦å¾ˆå°‘å‡ æ¬¡æœºå™¨é—´çš„é€šä¿¡å³å¯å®Œæˆã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡é€‰æ‹©åˆé€‚çš„è¡Œå…³é”®å­—ï¼Œåœ¨æ•°æ®è®¿é—®æ—¶æœ‰æ•ˆåˆ© ç”¨æ•°æ®çš„ä½ç½®ç›¸å…³æ€§ï¼Œä»è€Œæ›´å¥½çš„åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ Webtable é‡Œï¼Œé€šè¿‡åè½¬ URL ä¸­ä¸»æœºåçš„æ–¹ å¼ï¼Œå¯ä»¥æŠŠåŒä¸€ä¸ªåŸŸåä¸‹çš„ç½‘é¡µèšé›†èµ·æ¥ç»„ç»‡æˆè¿ç»­çš„è¡Œã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ maps.google.com/index.html çš„æ•°æ®å­˜æ”¾åœ¨å…³é”®å­— com.google.maps/index.html ä¸‹ã€‚æŠŠç›¸åŒçš„åŸŸä¸­çš„ç½‘é¡µå­˜å‚¨åœ¨è¿ç»­çš„åŒºåŸŸå¯ä»¥è®©åŸºäºä¸»æœº å’ŒåŸŸåçš„åˆ†ææ›´åŠ æœ‰æ•ˆã€‚ åˆ—æ—åˆ—å…³é”®å­—ç»„æˆçš„é›†åˆå«åšâ€œåˆ—æ—â€œï¼Œåˆ—æ—æ˜¯è®¿é—®æ§åˆ¶çš„åŸºæœ¬å•ä½ã€‚å­˜æ”¾åœ¨åŒä¸€åˆ—æ—ä¸‹çš„æ‰€æœ‰æ•°æ®é€šå¸¸éƒ½ å±äºåŒä¸€ä¸ªç±»å‹(æˆ‘ä»¬å¯ä»¥æŠŠåŒä¸€ä¸ªåˆ—æ—ä¸‹çš„æ•°æ®å‹ç¼©åœ¨ä¸€èµ·)ã€‚åˆ—æ—åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»å…ˆåˆ›å»ºï¼Œç„¶åæ‰èƒ½åœ¨åˆ— æ—ä¸­ä»»ä½•çš„åˆ—å…³é”®å­—ä¸‹å­˜æ”¾æ•°æ®;åˆ—æ—åˆ›å»ºåï¼Œå…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªåˆ—å…³é”®å­—ä¸‹éƒ½å¯ä»¥å­˜æ”¾æ•°æ®ã€‚æ ¹æ®æˆ‘ä»¬çš„è®¾ è®¡æ„å›¾ï¼Œä¸€å¼ è¡¨ä¸­çš„åˆ—æ—ä¸èƒ½å¤ªå¤š(æœ€å¤šå‡ ç™¾ä¸ª)ï¼Œå¹¶ä¸”åˆ—æ—åœ¨è¿è¡ŒæœŸé—´å¾ˆå°‘æ”¹å˜ã€‚ä¸ä¹‹ç›¸å¯¹åº”çš„ï¼Œä¸€å¼ è¡¨å¯ ä»¥æœ‰æ— é™å¤šä¸ªåˆ—ã€‚ åˆ—å…³é”®å­—çš„å‘½åè¯­æ³•å¦‚ä¸‹:åˆ—æ—:é™å®šè¯ã€‚ åˆ—æ—çš„åå­—å¿…é¡»æ˜¯å¯æ‰“å°çš„å­—ç¬¦ä¸²ï¼Œè€Œé™å®šè¯çš„åå­—å¯ä»¥æ˜¯ ä»»æ„çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼ŒWebtable æœ‰ä¸ªåˆ—æ— languageï¼Œlanguage åˆ—æ—ç”¨æ¥å­˜æ”¾æ’°å†™ç½‘é¡µçš„è¯­è¨€ã€‚æˆ‘ä»¬åœ¨ language åˆ—æ—ä¸­åªä½¿ç”¨ä¸€ä¸ªåˆ—å…³é”®å­—ï¼Œç”¨æ¥å­˜æ”¾æ¯ä¸ªç½‘é¡µçš„è¯­è¨€æ ‡è¯† IDã€‚Webtable ä¸­å¦ä¸€ä¸ªæœ‰ç”¨çš„åˆ—æ—æ˜¯ anchor;è¿™ ä¸ªåˆ—æ—çš„æ¯ä¸€ä¸ªåˆ—å…³é”®å­—ä»£è¡¨ä¸€ä¸ªé”šé“¾æ¥ï¼Œå¦‚å›¾ä¸€æ‰€ç¤ºã€‚Anchor åˆ—æ—çš„é™å®šè¯æ˜¯å¼•ç”¨è¯¥ç½‘é¡µçš„ç«™ç‚¹å;Anchor åˆ—æ—æ¯åˆ—çš„æ•°æ®é¡¹å­˜æ”¾çš„æ˜¯é“¾æ¥æ–‡æœ¬ã€‚ è®¿é—®æ§åˆ¶ã€ç£ç›˜å’Œå†…å­˜çš„ä½¿ç”¨ç»Ÿè®¡éƒ½æ˜¯åœ¨åˆ—æ—å±‚é¢è¿›è¡Œçš„ã€‚åœ¨æˆ‘ä»¬çš„ Webtable çš„ä¾‹å­ä¸­ï¼Œä¸Šè¿°çš„æ§åˆ¶æƒ é™èƒ½å¸®åŠ©æˆ‘ä»¬ç®¡ç†ä¸åŒç±»å‹çš„åº”ç”¨:æˆ‘ä»¬å…è®¸ä¸€äº›åº”ç”¨å¯ä»¥æ·»åŠ æ–°çš„åŸºæœ¬æ•°æ®ã€ä¸€äº›åº”ç”¨å¯ä»¥è¯»å–åŸºæœ¬æ•°æ®å¹¶åˆ›å»ºç»§æ‰¿çš„åˆ—æ—ã€ä¸€äº›åº”ç”¨åˆ™åªå…è®¸æµè§ˆæ•°æ®(ç”šè‡³å¯èƒ½å› ä¸ºéšç§çš„åŸå› ä¸èƒ½æµè§ˆæ‰€æœ‰æ•°æ®)ã€‚ æ—¶é—´æˆ³åœ¨ Bigtable ä¸­ï¼Œè¡¨çš„æ¯ä¸€ä¸ªæ•°æ®é¡¹éƒ½å¯ä»¥åŒ…å«åŒä¸€ä»½æ•°æ®çš„ä¸åŒç‰ˆæœ¬;ä¸åŒç‰ˆæœ¬çš„æ•°æ®é€šè¿‡æ—¶é—´æˆ³æ¥ç´¢ å¼•ã€‚Bigtable æ—¶é—´æˆ³çš„ç±»å‹æ˜¯ 64 ä½æ•´å‹ã€‚Bigtable å¯ä»¥ç»™æ—¶é—´æˆ³èµ‹å€¼ï¼Œç”¨æ¥è¡¨ç¤ºç²¾ç¡®åˆ°æ¯«ç§’çš„â€œå®æ—¶â€æ—¶é—´; ç”¨æˆ·ç¨‹åºä¹Ÿå¯ä»¥ç»™æ—¶é—´æˆ³èµ‹å€¼ã€‚å¦‚æœåº”ç”¨ç¨‹åºéœ€è¦é¿å…æ•°æ®ç‰ˆæœ¬å†²çªï¼Œé‚£ä¹ˆå®ƒå¿…é¡»è‡ªå·±ç”Ÿæˆå…·æœ‰å”¯ä¸€æ€§çš„æ—¶ é—´æˆ³ã€‚æ•°æ®é¡¹ä¸­ï¼Œä¸åŒç‰ˆæœ¬çš„æ•°æ®æŒ‰ç…§æ—¶é—´æˆ³å€’åºæ’åºï¼Œå³æœ€æ–°çš„æ•°æ®æ’åœ¨æœ€å‰é¢ã€‚ ä¸ºäº†å‡è½»å¤šä¸ªç‰ˆæœ¬æ•°æ®çš„ç®¡ç†è´Ÿæ‹…ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªåˆ—æ—é…æœ‰ä¸¤ä¸ªè®¾ç½®å‚æ•°ï¼ŒBigtable é€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥ å¯¹åºŸå¼ƒç‰ˆæœ¬çš„æ•°æ®è‡ªåŠ¨è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚ç”¨æˆ·å¯ä»¥æŒ‡å®šåªä¿å­˜æœ€å n ä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œæˆ–è€…åªä¿å­˜â€œè¶³å¤Ÿæ–°â€çš„ ç‰ˆæœ¬çš„æ•°æ®(æ¯”å¦‚ï¼Œåªä¿å­˜æœ€è¿‘ 7 å¤©çš„å†…å®¹å†™å…¥çš„æ•°æ®)ã€‚ åœ¨ Webtable çš„ä¸¾ä¾‹é‡Œï¼Œcontents:åˆ—å­˜å‚¨çš„æ—¶é—´æˆ³ä¿¡æ¯æ˜¯ç½‘ç»œçˆ¬è™«æŠ“å–ä¸€ä¸ªé¡µé¢çš„æ—¶é—´ã€‚ä¸Šé¢æåŠçš„åƒåœ¾ æ”¶é›†æœºåˆ¶å¯ä»¥è®©æˆ‘ä»¬åªä¿ç•™æœ€è¿‘ä¸‰ä¸ªç‰ˆæœ¬çš„ç½‘é¡µæ•°æ®ã€‚APIBigtable æä¾›äº†å»ºç«‹å’Œåˆ é™¤è¡¨ä»¥åŠåˆ—æ—çš„ API å‡½æ•°ã€‚Bigtable è¿˜æä¾›äº†ä¿®æ”¹é›†ç¾¤ã€è¡¨å’Œåˆ—æ—çš„å…ƒæ•°æ®çš„ API ï¼Œæ¯”å¦‚ä¿®æ”¹è®¿é—®æƒé™ã€‚ // Open the table Table *T = OpenOrDie(â€œ/bigtable/web/webtableâ€); // Write a new anchor and delete an old anchor RowMutation r1(T, â€œcom.cnn.wwwâ€); r1.Set(â€œanchor:www.c-span.orgâ€, â€œCNNâ€); r1.Delete(â€œanchor:www.abc.comâ€); Operation op; Apply(&amp;op, &amp;r1); å®¢æˆ·ç¨‹åºå¯ä»¥å¯¹ Bigtable è¿›è¡Œå¦‚ä¸‹çš„æ“ä½œ:å†™å…¥æˆ–è€…åˆ é™¤ Bigtable ä¸­çš„å€¼ã€ä»æ¯ä¸ªè¡Œä¸­æŸ¥æ‰¾å€¼ã€æˆ–è€…éå†è¡¨ä¸­çš„ä¸€ä¸ªæ•°æ®å­é›†ã€‚å›¾ 2 ä¸­çš„C++ä»£ç ä½¿ç”¨ RowMutation æŠ½è±¡å¯¹è±¡è¿›è¡Œäº†ä¸€ç³»åˆ—çš„æ›´æ–°æ“ä½œã€‚(ä¸ºäº†ä¿æŒ ç¤ºä¾‹ä»£ç çš„ç®€æ´ï¼Œæˆ‘ä»¬å¿½ç•¥äº†ä¸€äº›ç»†èŠ‚ç›¸å…³ä»£ç )ã€‚è°ƒç”¨ Apply å‡½æ•°å¯¹Webtable è¿›è¡Œäº†ä¸€ä¸ªåŸå­ä¿®æ”¹æ“ä½œ:å®ƒä¸º www.cnn.com å¢åŠ äº†ä¸€ä¸ªé”šç‚¹ï¼ŒåŒæ—¶åˆ é™¤äº†å¦å¤–ä¸€ä¸ªé”šç‚¹ã€‚ Scanner scanner(T); ScanStream *stream; stream = scanner.FetchColumnFamily(â€œanchorâ€); stream-&gt;SetReturnAllVersions(); scanner.Lookup(â€œcom.cnn.wwwâ€); for (; !stream-&gt;Done(); stream-&gt;Next()) { printf(â€œ%s %s %lld %s\\nâ€, scanner.RowName(), stream-&gt;ColumnName(), stream-&gt;MicroTimestamp(), stream-&gt;Value()); } å›¾è¡¨ 3 Reading from Bigtable.å›¾ 3 ä¸­çš„ C++ä»£ç ä½¿ç”¨ Scanner æŠ½è±¡å¯¹è±¡éå†ä¸€ä¸ªè¡Œå†…çš„æ‰€æœ‰é”šç‚¹ã€‚å®¢æˆ·ç¨‹åºå¯ä»¥éå†å¤šä¸ªåˆ—æ—ï¼Œæœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¯¹æ‰«æè¾“å‡ºçš„è¡Œã€åˆ—å’Œæ—¶é—´æˆ³è¿›è¡Œé™åˆ¶ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶ä¸Šé¢çš„æ‰«æï¼Œè®©å®ƒåªè¾“å‡ºé‚£äº›åŒ¹é… æ­£åˆ™è¡¨è¾¾å¼*.cnn.com çš„é”šç‚¹ï¼Œæˆ–è€…é‚£äº›æ—¶é—´æˆ³åœ¨å½“å‰æ—¶é—´å‰ 10 å¤©çš„é”šç‚¹ã€‚ Bigtable è¿˜æ”¯æŒä¸€äº›å…¶å®ƒçš„ç‰¹æ€§ï¼Œåˆ©ç”¨è¿™äº›ç‰¹æ€§ï¼Œç”¨æˆ·å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ›´å¤æ‚çš„å¤„ç†ã€‚é¦–å…ˆï¼ŒBigtable æ”¯ æŒå•è¡Œä¸Šçš„äº‹åŠ¡å¤„ç†ï¼Œåˆ©ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥å¯¹å­˜å‚¨åœ¨ä¸€ä¸ªè¡Œå…³é”®å­—ä¸‹çš„æ•°æ®è¿›è¡ŒåŸå­æ€§çš„è¯»-æ›´æ–°-å†™æ“ä½œã€‚ è™½ç„¶ Bigtable æä¾›äº†ä¸€ä¸ªå…è®¸ç”¨æˆ·è·¨è¡Œæ‰¹é‡å†™å…¥æ•°æ®çš„æ¥å£ï¼Œä½†æ˜¯ï¼ŒBigtable ç›®å‰è¿˜ä¸æ”¯æŒé€šç”¨çš„è·¨è¡Œäº‹åŠ¡å¤„ ç†ã€‚å…¶æ¬¡ï¼ŒBigtable å…è®¸æŠŠæ•°æ®é¡¹ç”¨åšæ•´æ•°è®¡æ•°å™¨ã€‚æœ€åï¼ŒBigtable å…è®¸ç”¨æˆ·åœ¨æœåŠ¡å™¨çš„åœ°å€ç©ºé—´å†…æ‰§è¡Œè„šæœ¬ ç¨‹åºã€‚è„šæœ¬ç¨‹åºä½¿ç”¨ Google å¼€å‘çš„ Sawzallæ•°æ®å¤„ç†è¯­è¨€ã€‚è™½ç„¶ç›®å‰æˆ‘ä»¬åŸºäºçš„ Sawzall è¯­è¨€çš„ API å‡½æ•°è¿˜ä¸å…è®¸å®¢æˆ·çš„è„šæœ¬ç¨‹åºå†™å…¥æ•°æ®åˆ° Bigtableï¼Œä½†æ˜¯å®ƒå…è®¸å¤šç§å½¢å¼çš„æ•°æ®è½¬æ¢ã€åŸºäºä»»æ„è¡¨è¾¾å¼çš„æ•°æ® è¿‡æ»¤ã€ä»¥åŠä½¿ç”¨å¤šç§æ“ä½œç¬¦çš„è¿›è¡Œæ•°æ®æ±‡æ€»ã€‚ Bigtable å¯ä»¥å’Œ MapReduce ä¸€èµ·ä½¿ç”¨ï¼ŒMapReduce æ˜¯ Google å¼€å‘çš„å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—æ¡†æ¶ã€‚æˆ‘ä»¬å·² ç»å¼€å‘äº†ä¸€äº› Wrapper ç±»ï¼Œé€šè¿‡ä½¿ç”¨è¿™äº› Wrapper ç±»ï¼ŒBigtable å¯ä»¥ä½œä¸º MapReduce æ¡†æ¶çš„è¾“å…¥å’Œè¾“å‡ºã€‚BigTable æ„ä»¶Bigtableæ˜¯å»ºç«‹åœ¨å…¶å®ƒçš„å‡ ä¸ªGoogleåŸºç¡€æ„ä»¶ä¸Šçš„ã€‚BigTableä½¿ç”¨Googleçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ(GFSå­˜å‚¨æ—¥å¿—æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶ã€‚BigTable é›†ç¾¤é€šå¸¸è¿è¡Œåœ¨ä¸€ä¸ªå…±äº«çš„æœºå™¨æ± ä¸­ï¼Œæ± ä¸­çš„æœºå™¨è¿˜ä¼šè¿è¡Œå…¶å®ƒçš„å„ç§å„æ ·çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼ŒBigTable çš„è¿›ç¨‹ç»å¸¸è¦å’Œå…¶å®ƒåº”ç”¨çš„è¿›ç¨‹å…±äº«æœºå™¨ã€‚BigTable ä¾èµ–é›†ç¾¤ç®¡ç†ç³»ç»Ÿæ¥è°ƒåº¦ä»»åŠ¡ã€ç®¡ç†å…±äº«çš„æœºå™¨ä¸Šçš„èµ„æºã€å¤„ç†æœºå™¨çš„æ•…éšœã€ä»¥åŠç›‘è§†æœºå™¨çš„çŠ¶æ€ã€‚ BigTable å†…éƒ¨å­˜å‚¨æ•°æ®çš„æ–‡ä»¶æ˜¯ Google SSTable æ ¼å¼çš„ã€‚SSTable æ˜¯ä¸€ä¸ªæŒä¹…åŒ–çš„ã€æ’åºçš„ã€ä¸å¯æ›´æ”¹çš„ Map ç»“æ„ï¼Œè€Œ Map æ˜¯ä¸€ä¸ª key-value æ˜ å°„çš„æ•°æ®ç»“æ„ï¼Œkey å’Œ value çš„å€¼éƒ½æ˜¯ä»»æ„çš„ Byte ä¸²ã€‚å¯ä»¥å¯¹ SSTable è¿›è¡Œå¦‚ä¸‹çš„æ“ä½œ:æŸ¥è¯¢ä¸ä¸€ä¸ª key å€¼ç›¸å…³çš„ valueï¼Œæˆ–è€…éå†æŸä¸ª key å€¼èŒƒå›´å†…çš„æ‰€æœ‰çš„ key-value å¯¹ã€‚ä»å†… éƒ¨çœ‹ï¼ŒSSTable æ˜¯ä¸€ç³»åˆ—çš„æ•°æ®å—(é€šå¸¸æ¯ä¸ªå—çš„å¤§å°æ˜¯ 64KBï¼Œè¿™ä¸ªå¤§å°æ˜¯å¯ä»¥é…ç½®çš„)ã€‚SSTable ä½¿ç”¨å—ç´¢ å¼•(é€šå¸¸å­˜å‚¨åœ¨ SSTable çš„æœ€å)æ¥å®šä½æ•°æ®å—;åœ¨æ‰“å¼€ SSTable çš„æ—¶å€™ï¼Œç´¢å¼•è¢«åŠ è½½åˆ°å†…å­˜ã€‚æ¯æ¬¡æŸ¥æ‰¾éƒ½å¯ ä»¥é€šè¿‡ä¸€æ¬¡ç£ç›˜æœç´¢å®Œæˆ:é¦–å…ˆä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•åœ¨å†…å­˜ä¸­çš„ç´¢å¼•é‡Œæ‰¾åˆ°æ•°æ®å—çš„ä½ç½®ï¼Œç„¶åå†ä»ç¡¬ç›˜è¯»å–ç›¸ åº”çš„æ•°æ®å—ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©æŠŠæ•´ä¸ª SSTable éƒ½æ”¾åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·å°±ä¸å¿…è®¿é—®ç¡¬ç›˜äº†ã€‚ BigTable è¿˜ä¾èµ–ä¸€ä¸ªé«˜å¯ç”¨çš„ã€åºåˆ—åŒ–çš„åˆ†å¸ƒå¼é”æœåŠ¡ç»„ä»¶ï¼Œå«åš Chubbyã€8ã€‘ã€‚ä¸€ä¸ª Chubby æœåŠ¡åŒ…æ‹¬ äº† 5 ä¸ªæ´»åŠ¨çš„å‰¯æœ¬ï¼Œå…¶ä¸­çš„ä¸€ä¸ªå‰¯æœ¬è¢«é€‰ä¸º Masterï¼Œå¹¶ä¸”å¤„ç†è¯·æ±‚ã€‚åªæœ‰åœ¨å¤§å¤šæ•°å‰¯æœ¬éƒ½æ˜¯æ­£å¸¸è¿è¡Œçš„ï¼Œå¹¶ ä¸”å½¼æ­¤ä¹‹é—´èƒ½å¤Ÿäº’ç›¸é€šä¿¡çš„æƒ…å†µä¸‹ï¼ŒChubby æœåŠ¡æ‰æ˜¯å¯ç”¨çš„ã€‚å½“æœ‰å‰¯æœ¬å¤±æ•ˆçš„æ—¶å€™ï¼ŒChubby ä½¿ç”¨ Paxos ç®—æ³• ã€9,23ã€‘æ¥ä¿è¯å‰¯æœ¬çš„ä¸€è‡´æ€§ã€‚Chubby æä¾›äº†ä¸€ä¸ªåå­—ç©ºé—´ï¼Œé‡Œé¢åŒ…æ‹¬äº†ç›®å½•å’Œå°æ–‡ä»¶ã€‚æ¯ä¸ªç›®å½•æˆ–è€…æ–‡ä»¶ å¯ä»¥å½“æˆä¸€ä¸ªé”ï¼Œè¯»å†™æ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯åŸå­çš„ã€‚Chubby å®¢æˆ·ç¨‹åºåº“æä¾›å¯¹ Chubby æ–‡ä»¶çš„ä¸€è‡´æ€§ç¼“å­˜ã€‚æ¯ä¸ª Chubby å®¢æˆ·ç¨‹åºéƒ½ç»´æŠ¤ä¸€ä¸ªä¸ Chubby æœåŠ¡çš„ä¼šè¯ã€‚å¦‚æœå®¢æˆ·ç¨‹åºä¸èƒ½åœ¨ç§Ÿçº¦åˆ°æœŸçš„æ—¶é—´å†…é‡æ–°ç­¾è®¢ä¼šè¯çš„ ç§Ÿçº¦ï¼Œè¿™ä¸ªä¼šè¯å°±è¿‡æœŸå¤±æ•ˆäº†9ã€‚å½“ä¸€ä¸ªä¼šè¯å¤±æ•ˆæ—¶ï¼Œå®ƒæ‹¥æœ‰çš„é”å’Œæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„éƒ½å¤±æ•ˆäº†ã€‚Chubby å®¢æˆ· ç¨‹åºå¯ä»¥åœ¨æ–‡ä»¶å’Œç›®å½•ä¸Šæ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå½“æ–‡ä»¶æˆ–ç›®å½•æ”¹å˜ã€æˆ–è€…ä¼šè¯è¿‡æœŸæ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šé€šçŸ¥å®¢æˆ·ç¨‹åºã€‚ Bigtable ä½¿ç”¨ Chubby å®Œæˆä»¥ä¸‹çš„å‡ ä¸ªä»»åŠ¡: ç¡®ä¿åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´å†…æœ€å¤šåªæœ‰ä¸€ä¸ªæ´»åŠ¨çš„ Master å‰¯æœ¬; å­˜å‚¨ BigTable æ•°æ®çš„è‡ªå¼•å¯¼æŒ‡ä»¤çš„ä½ç½®(å‚è€ƒ 5.1 èŠ‚); æŸ¥æ‰¾ Tablet æœåŠ¡å™¨ï¼Œä»¥åŠåœ¨ Tablet æœåŠ¡å™¨å¤±æ•ˆæ—¶è¿›è¡Œå–„å(5.2 èŠ‚); å­˜å‚¨ BigTable çš„æ¨¡å¼ä¿¡æ¯(æ¯å¼ è¡¨çš„åˆ—æ—ä¿¡æ¯); ä»¥åŠå­˜å‚¨è®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚ å¦‚æœ Chubby é•¿æ—¶é—´æ— æ³•è®¿é—®ï¼ŒBigTable å°±ä¼šå¤±æ•ˆã€‚æœ€è¿‘æˆ‘ä»¬åœ¨ä½¿ç”¨ 11 ä¸ª Chubby æœåŠ¡å®ä¾‹çš„ 14 ä¸ª BigTableé›†ç¾¤ä¸Šæµ‹é‡äº†è¿™ä¸ªå½±å“ã€‚ç”±äº Chubby ä¸å¯ç”¨è€Œå¯¼è‡´ BigTable ä¸­çš„éƒ¨åˆ†æ•°æ®ä¸èƒ½è®¿é—®çš„å¹³å‡æ¯”ç‡æ˜¯ 0.0047% (Chubby ä¸èƒ½è®¿é—®çš„åŸå› å¯èƒ½æ˜¯ Chubby æœ¬èº«å¤±æ•ˆæˆ–è€…ç½‘ç»œé—®é¢˜)ã€‚å•ä¸ªé›†ç¾¤é‡Œï¼Œå— Chubby å¤±æ•ˆå½±å“æœ€å¤§çš„ ç™¾åˆ†æ¯”æ˜¯ 0.0326%10ã€‚ä»‹ç»Bigtable åŒ…æ‹¬äº†ä¸‰ä¸ªä¸»è¦çš„ç»„ä»¶:é“¾æ¥åˆ°å®¢æˆ·ç¨‹åºä¸­çš„åº“ã€ä¸€ä¸ª Master æœåŠ¡å™¨å’Œå¤šä¸ª Tablet æœåŠ¡å™¨ã€‚é’ˆ å¯¹ç³»ç»Ÿå·¥ä½œè´Ÿè½½çš„å˜åŒ–æƒ…å†µï¼ŒBigTable å¯ä»¥åŠ¨æ€çš„å‘é›†ç¾¤ä¸­æ·»åŠ (æˆ–è€…åˆ é™¤)Tablet æœåŠ¡å™¨ã€‚ Master æœåŠ¡å™¨ä¸»è¦è´Ÿè´£ä»¥ä¸‹å·¥ä½œ:ä¸º Tablet æœåŠ¡å™¨åˆ†é… Tabletsã€æ£€æµ‹æ–°åŠ å…¥çš„æˆ–è€…è¿‡æœŸå¤±æ•ˆçš„ Table æœ åŠ¡å™¨ã€å¯¹ Tablet æœåŠ¡å™¨è¿›è¡Œè´Ÿè½½å‡è¡¡ã€ä»¥åŠå¯¹ä¿å­˜åœ¨ GFS ä¸Šçš„æ–‡ä»¶è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å¤„ç†å¯¹æ¨¡ å¼çš„ç›¸å…³ä¿®æ”¹æ“ä½œï¼Œä¾‹å¦‚å»ºç«‹è¡¨å’Œåˆ—æ—ã€‚ æ¯ä¸ª Tablet æœåŠ¡å™¨éƒ½ç®¡ç†ä¸€ä¸ª Tablet çš„é›†åˆ(é€šå¸¸æ¯ä¸ªæœåŠ¡å™¨æœ‰å¤§çº¦æ•°åä¸ªè‡³ä¸Šåƒä¸ª Tablet)ã€‚æ¯ä¸ª Tablet æœåŠ¡å™¨è´Ÿè´£å¤„ç†å®ƒæ‰€åŠ è½½çš„ Tablet çš„è¯»å†™æ“ä½œï¼Œä»¥åŠåœ¨ Tablets è¿‡å¤§æ—¶ï¼Œå¯¹å…¶è¿›è¡Œåˆ†å‰²ã€‚ å’Œå¾ˆå¤š Single-Master ç±»å‹çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€17.21ã€‘ç±»ä¼¼ï¼Œå®¢æˆ·ç«¯è¯»å–çš„æ•°æ®éƒ½ä¸ç»è¿‡ Master æœåŠ¡å™¨: å®¢æˆ·ç¨‹åºç›´æ¥å’Œ Tablet æœåŠ¡å™¨é€šä¿¡è¿›è¡Œè¯»å†™æ“ä½œã€‚ç”±äº BigTable çš„å®¢æˆ·ç¨‹åºä¸å¿…é€šè¿‡ Master æœåŠ¡å™¨æ¥è·å– Tablet çš„ä½ç½®ä¿¡æ¯ï¼Œå› æ­¤ï¼Œå¤§å¤šæ•°å®¢æˆ·ç¨‹åºç”šè‡³å®Œå…¨ä¸éœ€è¦å’Œ Master æœåŠ¡å™¨é€šä¿¡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒMaster æœ åŠ¡å™¨çš„è´Ÿè½½æ˜¯å¾ˆè½»çš„ã€‚ ä¸€ä¸ª BigTable é›†ç¾¤å­˜å‚¨äº†å¾ˆå¤šè¡¨ï¼Œæ¯ä¸ªè¡¨åŒ…å«äº†ä¸€ä¸ª Tablet çš„é›†åˆï¼Œè€Œæ¯ä¸ª Tablet åŒ…å«äº†æŸä¸ªèŒƒå›´å†…çš„ è¡Œçš„æ‰€æœ‰ç›¸å…³æ•°æ®ã€‚åˆå§‹çŠ¶æ€ä¸‹ï¼Œä¸€ä¸ªè¡¨åªæœ‰ä¸€ä¸ª Tabletã€‚éšç€è¡¨ä¸­æ•°æ®çš„å¢é•¿ï¼Œå®ƒè¢«è‡ªåŠ¨åˆ†å‰²æˆå¤šä¸ª Tabletï¼Œ ç¼ºçœæƒ…å†µä¸‹ï¼Œæ¯ä¸ª Tablet çš„å°ºå¯¸å¤§çº¦æ˜¯ 100MB åˆ° 200MBã€‚ Tablet çš„ä½ç½®æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªä¸‰å±‚çš„ã€ç±»ä¼¼B+æ ‘[10]çš„ç»“æ„å­˜å‚¨ Tablet çš„ä½ç½®ä¿¡æ¯(å¦‚å›¾ 4)ã€‚ç¬¬ä¸€å±‚æ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨ Chubby ä¸­çš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº† Root Tablet çš„ä½ç½®ä¿¡æ¯ã€‚Root Tablet åŒ…å«äº†ä¸€ä¸ªç‰¹æ®Š çš„ METADATA è¡¨é‡Œæ‰€æœ‰çš„ Tablet çš„ä½ç½®ä¿¡æ¯ã€‚METADATA è¡¨çš„æ¯ä¸ª Tablet åŒ…å«äº†ä¸€ä¸ªç”¨æˆ· Tablet çš„é›†åˆã€‚ Root Tablet å®é™…ä¸Šæ˜¯ METADATA è¡¨çš„ç¬¬ä¸€ä¸ª Tabletï¼Œåªä¸è¿‡å¯¹å®ƒçš„å¤„ç†æ¯”è¾ƒç‰¹æ®Š â€” Root Tablet æ°¸è¿œä¸ä¼šè¢« åˆ†å‰² â€” è¿™å°±ä¿è¯äº† Tablet çš„ä½ç½®ä¿¡æ¯å­˜å‚¨ç»“æ„ä¸ä¼šè¶…è¿‡ä¸‰å±‚ã€‚ åœ¨ METADATA è¡¨é‡Œé¢ï¼Œæ¯ä¸ª Tablet çš„ä½ç½®ä¿¡æ¯éƒ½å­˜æ”¾åœ¨ä¸€ä¸ªè¡Œå…³é”®å­—ä¸‹é¢ï¼Œè€Œè¿™ä¸ªè¡Œå…³é”®å­—æ˜¯ç”± Tablet æ‰€åœ¨çš„è¡¨çš„æ ‡è¯†ç¬¦å’Œ Tablet çš„æœ€åä¸€è¡Œç¼–ç è€Œæˆçš„ã€‚METADATA çš„æ¯ä¸€è¡Œéƒ½å­˜å‚¨äº†å¤§çº¦ 1KB çš„å†…å­˜æ•°æ®ã€‚ åœ¨ä¸€ä¸ªå¤§å°é€‚ä¸­çš„ã€å®¹é‡é™åˆ¶ä¸º 128MB çš„ METADATA Tablet ä¸­ï¼Œé‡‡ç”¨è¿™ç§ä¸‰å±‚ç»“æ„çš„å­˜å‚¨æ¨¡å¼ï¼Œå¯ä»¥æ ‡è¯† 2^34 ä¸ª Tablet çš„åœ°å€(å¦‚æœæ¯ä¸ª Tablet å­˜å‚¨ 128MB æ•°æ®ï¼Œé‚£ä¹ˆä¸€å…±å¯ä»¥å­˜å‚¨ 2^61 å­—èŠ‚æ•°æ®)ã€‚ å®¢æˆ·ç¨‹åºä½¿ç”¨çš„åº“ä¼šç¼“å­˜ Tablet çš„ä½ç½®ä¿¡æ¯ã€‚å¦‚æœå®¢æˆ·ç¨‹åºæ²¡æœ‰ç¼“å­˜æŸä¸ª Tablet çš„åœ°å€ä¿¡æ¯ï¼Œæˆ–è€…å‘ç° å®ƒç¼“å­˜çš„åœ°å€ä¿¡æ¯ä¸æ­£ç¡®ï¼Œå®¢æˆ·ç¨‹åºå°±åœ¨æ ‘çŠ¶çš„å­˜å‚¨ç»“æ„ä¸­é€’å½’çš„æŸ¥è¯¢ Tablet ä½ç½®ä¿¡æ¯;å¦‚æœå®¢æˆ·ç«¯ç¼“å­˜æ˜¯ ç©ºçš„ï¼Œé‚£ä¹ˆå¯»å€ç®—æ³•éœ€è¦é€šè¿‡ä¸‰æ¬¡ç½‘ç»œæ¥å›é€šä¿¡å¯»å€ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬äº†ä¸€æ¬¡ Chubby è¯»æ“ä½œ;å¦‚æœå®¢æˆ·ç«¯ç¼“å­˜çš„ åœ°å€ä¿¡æ¯è¿‡æœŸäº†ï¼Œé‚£ä¹ˆå¯»å€ç®—æ³•å¯èƒ½éœ€è¦æœ€å¤š6æ¬¡ç½‘ç»œæ¥å›é€šä¿¡æ‰èƒ½æ›´æ–°æ•°æ®ï¼Œå› ä¸ºåªæœ‰åœ¨ç¼“å­˜ä¸­æ²¡æœ‰æŸ¥åˆ° æ•°æ®çš„æ—¶å€™æ‰èƒ½å‘ç°æ•°æ®è¿‡æœŸ11ã€‚å°½ç®¡ Tablet çš„åœ°å€ä¿¡æ¯æ˜¯å­˜æ”¾åœ¨å†…å­˜é‡Œçš„ï¼Œå¯¹å®ƒçš„æ“ä½œä¸å¿…è®¿é—® GFS æ–‡ä»¶ ç³»ç»Ÿï¼Œä½†æ˜¯ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šé€šè¿‡é¢„å– Tablet åœ°å€æ¥è¿›ä¸€æ­¥çš„å‡å°‘è®¿é—®çš„å¼€é”€:æ¯æ¬¡éœ€è¦ä» METADATA è¡¨ä¸­è¯»å–ä¸€ä¸ª Tablet çš„å…ƒæ•°æ®çš„æ—¶å€™ï¼Œå®ƒéƒ½ä¼šå¤šè¯»å–å‡ ä¸ª Tablet çš„å…ƒæ•°æ®ã€‚ åœ¨ METADATA è¡¨ä¸­è¿˜å­˜å‚¨äº†æ¬¡çº§ä¿¡æ¯12ï¼ŒåŒ…æ‹¬æ¯ä¸ª Tablet çš„äº‹ä»¶æ—¥å¿—(ä¾‹å¦‚ï¼Œä»€ä¹ˆæ—¶å€™ä¸€ä¸ªæœåŠ¡å™¨å¼€å§‹ä¸ºè¯¥ Tablet æä¾›æœåŠ¡)ã€‚è¿™äº›ä¿¡æ¯æœ‰åŠ©äºæ’æŸ¥é”™è¯¯å’Œæ€§èƒ½åˆ†æã€‚ Tablet åˆ†é…åœ¨ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œä¸€ä¸ª Tablet åªèƒ½åˆ†é…ç»™ä¸€ä¸ª Tablet æœåŠ¡å™¨ã€‚Master æœåŠ¡å™¨è®°å½•äº†å½“å‰æœ‰å“ªäº›æ´»è·ƒçš„ Tablet æœåŠ¡å™¨ã€å“ªäº› Tablet åˆ†é…ç»™äº†å“ªäº› Tablet æœåŠ¡å™¨ã€å“ªäº› Tablet è¿˜æ²¡æœ‰è¢«åˆ†é…ã€‚å½“ä¸€ä¸ª Tablet è¿˜æ²¡æœ‰è¢«åˆ†é…ã€ å¹¶ä¸”åˆšå¥½æœ‰ä¸€ä¸ª Tablet æœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„ç©ºé—²ç©ºé—´è£…è½½è¯¥ Tablet æ—¶ï¼ŒMaster æœåŠ¡å™¨ä¼šç»™è¿™ä¸ª Tablet æœåŠ¡å™¨å‘é€ ä¸€ä¸ªè£…è½½è¯·æ±‚ï¼ŒæŠŠ Tablet åˆ†é…ç»™è¿™ä¸ªæœåŠ¡å™¨ã€‚ BigTable ä½¿ç”¨ Chubby è·Ÿè¸ªè®°å½• Tablet æœåŠ¡å™¨çš„çŠ¶æ€ã€‚å½“ä¸€ä¸ª Tablet æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå®ƒåœ¨ Chubby çš„ä¸€ä¸ª æŒ‡å®šç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªæœ‰å”¯ä¸€æ€§åå­—çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è·å–è¯¥æ–‡ä»¶çš„ç‹¬å é”ã€‚Master æœåŠ¡å™¨å®æ—¶ç›‘æ§ç€è¿™ä¸ªç›®å½•(æœ åŠ¡å™¨ç›®å½•)ï¼Œå› æ­¤ Master æœåŠ¡å™¨èƒ½å¤ŸçŸ¥é“æœ‰æ–°çš„ Tablet æœåŠ¡å™¨åŠ å…¥äº†ã€‚å¦‚æœ Tablet æœåŠ¡å™¨ä¸¢å¤±äº† Chubby ä¸Šçš„ ç‹¬å é” â€” æ¯”å¦‚ç”±äºç½‘ç»œæ–­å¼€å¯¼è‡´ Tablet æœåŠ¡å™¨å’Œ Chubby çš„ä¼šè¯ä¸¢å¤± â€” å®ƒå°±åœæ­¢å¯¹ Tablet æä¾›æœåŠ¡ã€‚ (Chubby æä¾›äº†ä¸€ç§é«˜æ•ˆçš„æœºåˆ¶ï¼Œåˆ©ç”¨è¿™ç§æœºåˆ¶ï¼ŒTablet æœåŠ¡å™¨èƒ½å¤Ÿåœ¨ä¸å¢åŠ ç½‘ç»œè´Ÿæ‹…çš„æƒ…å†µä¸‹çŸ¥é“å®ƒæ˜¯å¦ è¿˜æŒæœ‰é”)ã€‚åªè¦æ–‡ä»¶è¿˜å­˜åœ¨ï¼ŒTablet æœåŠ¡å™¨å°±ä¼šè¯•å›¾é‡æ–°è·å¾—å¯¹è¯¥æ–‡ä»¶çš„ç‹¬å é”;å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨äº†ï¼Œé‚£ä¹ˆ Tablet æœåŠ¡å™¨å°±ä¸èƒ½å†æä¾›æœåŠ¡äº†ï¼Œå®ƒä¼šè‡ªè¡Œé€€å‡º13ã€‚å½“ Tablet æœåŠ¡å™¨ç»ˆæ­¢æ—¶(æ¯”å¦‚ï¼Œé›†ç¾¤çš„ç®¡ç†ç³»ç»Ÿå°†è¿è¡Œ è¯¥ Tablet æœåŠ¡å™¨çš„ä¸»æœºä»é›†ç¾¤ä¸­ç§»é™¤)ï¼Œå®ƒä¼šå°è¯•é‡Šæ”¾å®ƒæŒæœ‰çš„æ–‡ä»¶é”ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒMaster æœåŠ¡å™¨å°±èƒ½å°½å¿«æŠŠ Tablet åˆ†é…åˆ°å…¶å®ƒçš„ Tablet æœåŠ¡å™¨ã€‚ Master æœåŠ¡å™¨è´Ÿè´£æ£€æŸ¥ä¸€ä¸ª Tablet æœåŠ¡å™¨æ˜¯å¦å·²ç»ä¸å†ä¸ºå®ƒçš„ Tablet æä¾›æœåŠ¡äº†ï¼Œå¹¶ä¸”è¦å°½å¿«é‡æ–°åˆ†é… å®ƒåŠ è½½çš„ Tabletã€‚Master æœåŠ¡å™¨é€šè¿‡è½®è¯¢ Tablet æœåŠ¡å™¨æ–‡ä»¶é”çš„çŠ¶æ€æ¥æ£€æµ‹ä½•æ—¶ Tablet æœåŠ¡å™¨ä¸å†ä¸º Tablet æä¾›æœåŠ¡ã€‚å¦‚æœä¸€ä¸ª Tablet æœåŠ¡å™¨æŠ¥å‘Šå®ƒä¸¢å¤±äº†æ–‡ä»¶é”ï¼Œæˆ–è€… Master æœåŠ¡å™¨æœ€è¿‘å‡ æ¬¡å°è¯•å’Œå®ƒé€šä¿¡éƒ½æ²¡æœ‰å¾—åˆ°å“åº”ï¼ŒMaster æœåŠ¡å™¨å°±ä¼šå°è¯•è·å–è¯¥ Tablet æœåŠ¡å™¨æ–‡ä»¶çš„ç‹¬å é”;å¦‚æœ Master æœåŠ¡å™¨æˆåŠŸè·å–äº†ç‹¬å é”ï¼Œ é‚£ä¹ˆå°±è¯´æ˜ Chubby æ˜¯æ­£å¸¸è¿è¡Œçš„ï¼Œè€Œ Tablet æœåŠ¡å™¨è¦ä¹ˆæ˜¯å®•æœºäº†ã€è¦ä¹ˆæ˜¯ä¸èƒ½å’Œ Chubby é€šä¿¡äº†ï¼Œå› æ­¤ï¼ŒMaster æœåŠ¡å™¨å°±åˆ é™¤è¯¥ Tablet æœåŠ¡å™¨åœ¨ Chubby ä¸Šçš„æœåŠ¡å™¨æ–‡ä»¶ä»¥ç¡®ä¿å®ƒä¸å†ç»™ Tablet æä¾›æœåŠ¡ã€‚ä¸€æ—¦ Tablet æœåŠ¡å™¨ åœ¨ Chubby ä¸Šçš„æœåŠ¡å™¨æ–‡ä»¶è¢«åˆ é™¤äº†ï¼ŒMaster æœåŠ¡å™¨å°±æŠŠä¹‹å‰åˆ†é…ç»™å®ƒçš„æ‰€æœ‰çš„ Tablet æ”¾å…¥æœªåˆ†é…çš„ Tablet é›†åˆä¸­ã€‚ä¸ºäº†ç¡®ä¿ Bigtable é›†ç¾¤åœ¨ Master æœåŠ¡å™¨å’Œ Chubby ä¹‹é—´ç½‘ç»œå‡ºç°æ•…éšœçš„æ—¶å€™ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼ŒMaster æœåŠ¡å™¨åœ¨å®ƒçš„ Chubby ä¼šè¯è¿‡æœŸåä¸»åŠ¨é€€å‡ºã€‚ä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œå¦‚åŒæˆ‘ä»¬å‰é¢æ‰€æè¿°çš„ï¼ŒMaster æœåŠ¡å™¨çš„æ•…éšœä¸ ä¼šæ”¹å˜ç°æœ‰ Tablet åœ¨ Tablet æœåŠ¡å™¨ä¸Šçš„åˆ†é…çŠ¶æ€ã€‚ å½“é›†ç¾¤ç®¡ç†ç³»ç»Ÿå¯åŠ¨äº†ä¸€ä¸ª Master æœåŠ¡å™¨ä¹‹åï¼ŒMaster æœåŠ¡å™¨é¦–å…ˆè¦äº†è§£å½“å‰ Tablet çš„åˆ†é…çŠ¶æ€ï¼Œä¹‹å æ‰èƒ½å¤Ÿä¿®æ”¹åˆ†é…çŠ¶æ€ã€‚Master æœåŠ¡å™¨åœ¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œä»¥ä¸‹æ­¥éª¤: Master æœåŠ¡å™¨ä» Chubby è·å–ä¸€ä¸ªå”¯ä¸€çš„ Master é”ï¼Œç”¨æ¥é˜»æ­¢åˆ›å»ºå…¶å®ƒçš„ Master æœåŠ¡å™¨å®ä¾‹; Master æœåŠ¡å™¨æ‰«æ Chubby çš„æœåŠ¡å™¨æ–‡ä»¶é”å­˜å‚¨ç›®å½•ï¼Œè·å–å½“å‰æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨åˆ—è¡¨; Master æœåŠ¡å™¨å’Œæ‰€æœ‰çš„æ­£åœ¨è¿è¡Œçš„ Tablet è¡¨æœåŠ¡å™¨é€šä¿¡ï¼Œè·å–æ¯ä¸ª Tablet æœåŠ¡å™¨ä¸Š Tablet çš„åˆ†é…ä¿¡æ¯; Master æœåŠ¡å™¨æ‰«æ METADATA è¡¨è·å–æ‰€æœ‰çš„ Tablet çš„é›†åˆã€‚ åœ¨æ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œå½“ Master æœåŠ¡å™¨å‘ç°äº†ä¸€ä¸ªè¿˜æ²¡æœ‰åˆ†é…çš„ Tabletï¼ŒMaster æœåŠ¡å™¨å°±å°†è¿™ä¸ª Tablet åŠ å…¥æœªåˆ†é…çš„ Tablet é›†åˆç­‰å¾…åˆé€‚çš„æ—¶æœºåˆ†é…ã€‚ å¯èƒ½ä¼šé‡åˆ°ä¸€ç§å¤æ‚çš„æƒ…å†µ:åœ¨ METADATA è¡¨çš„ Tablet è¿˜æ²¡æœ‰è¢«åˆ†é…ä¹‹å‰æ˜¯ä¸èƒ½å¤Ÿæ‰«æå®ƒçš„ã€‚å› æ­¤ï¼Œåœ¨å¼€å§‹æ‰«æä¹‹å‰(æ­¥éª¤ 4)ï¼Œå¦‚æœåœ¨ç¬¬ä¸‰æ­¥çš„æ‰«æè¿‡ç¨‹ä¸­å‘ç° Root Tablet è¿˜æ²¡æœ‰åˆ†é…ï¼ŒMaster æœåŠ¡å™¨å°±æŠŠ Root Tablet åŠ å…¥åˆ°æœªåˆ†é…çš„ Tablet é›†åˆã€‚è¿™ä¸ªé™„åŠ æ“ä½œç¡®ä¿äº† Root Tablet ä¼šè¢«åˆ†é…ã€‚ç”±äº Root Tablet åŒ…æ‹¬äº†æ‰€æœ‰ METADATA çš„ Tablet çš„åå­—ï¼Œå› æ­¤ Master æœåŠ¡å™¨æ‰«æå®Œ Root Tablet ä»¥åï¼Œå°±å¾—åˆ°äº†æ‰€æœ‰çš„ METADATA è¡¨ çš„ Tablet çš„åå­—äº†ã€‚ ä¿å­˜ç°æœ‰ Tablet çš„é›†åˆåªæœ‰åœ¨ä»¥ä¸‹äº‹ä»¶å‘ç”Ÿæ—¶æ‰ä¼šæ”¹å˜:å»ºç«‹äº†ä¸€ä¸ªæ–°è¡¨æˆ–è€…åˆ é™¤äº†ä¸€ä¸ªæ—§è¡¨ã€ä¸¤ä¸ª Tablet è¢«åˆå¹¶äº†ã€æˆ–è€…ä¸€ä¸ª Tablet è¢«åˆ†å‰²æˆä¸¤ä¸ªå°çš„ Tabletã€‚Master æœåŠ¡å™¨å¯ä»¥è·Ÿè¸ªè®°å½•æ‰€æœ‰è¿™äº›äº‹ä»¶ï¼Œå› ä¸º é™¤äº†æœ€åä¸€ä¸ªäº‹ä»¶å¤–çš„ä¸¤ä¸ªäº‹ä»¶éƒ½æ˜¯ç”±å®ƒå¯åŠ¨çš„ã€‚Tablet åˆ†å‰²äº‹ä»¶éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå› ä¸ºå®ƒæ˜¯ç”± Tablet æœåŠ¡å™¨å¯ åŠ¨ã€‚åœ¨åˆ†å‰²æ“ä½œå®Œæˆä¹‹åï¼ŒTablet æœåŠ¡å™¨é€šè¿‡åœ¨ METADATA è¡¨ä¸­è®°å½•æ–°çš„ Tablet çš„ä¿¡æ¯æ¥æäº¤è¿™ä¸ªæ“ä½œ;å½“ åˆ†å‰²æ“ä½œæäº¤ä¹‹åï¼ŒTablet æœåŠ¡å™¨ä¼šé€šçŸ¥ Master æœåŠ¡å™¨ã€‚å¦‚æœåˆ†å‰²æ“ä½œå·²æäº¤çš„ä¿¡æ¯æ²¡æœ‰é€šçŸ¥åˆ° Master æœåŠ¡ å™¨(å¯èƒ½ä¸¤ä¸ªæœåŠ¡å™¨ä¸­æœ‰ä¸€ä¸ªå®•æœºäº†)ï¼ŒMaster æœåŠ¡å™¨åœ¨è¦æ±‚ Tablet æœåŠ¡å™¨è£…è½½å·²ç»è¢«åˆ†å‰²çš„å­è¡¨çš„æ—¶å€™ä¼šå‘ç°ä¸€ä¸ªæ–°çš„ Tabletã€‚é€šè¿‡å¯¹æ¯” METADATA è¡¨ä¸­ Tablet çš„ä¿¡æ¯ï¼ŒTablet æœåŠ¡å™¨ä¼šå‘ç° Master æœåŠ¡å™¨è¦æ±‚å…¶è£…è½½çš„ Tablet å¹¶ä¸å®Œæ•´ï¼Œå› æ­¤ï¼ŒTablet æœåŠ¡å™¨ä¼šé‡æ–°å‘ Master æœåŠ¡å™¨å‘é€é€šçŸ¥ä¿¡æ¯ã€‚ Tablet æœåŠ¡å¦‚å›¾ 5 æ‰€ç¤ºï¼ŒTablet çš„æŒä¹…åŒ–çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨ GFS ä¸Šã€‚æ›´æ–°æ“ä½œæäº¤åˆ° REDO æ—¥å¿—ä¸­14ã€‚åœ¨è¿™äº›æ›´æ–°æ“ ä½œä¸­ï¼Œæœ€è¿‘æäº¤çš„é‚£äº›å­˜æ”¾åœ¨ä¸€ä¸ªæ’åºçš„ç¼“å­˜ä¸­ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªç¼“å­˜ä¸º memtable;è¾ƒæ—©çš„æ›´æ–°å­˜æ”¾åœ¨ä¸€ç³»åˆ— SSTable ä¸­ã€‚ä¸ºäº†æ¢å¤ä¸€ä¸ª Tabletï¼ŒTablet æœåŠ¡å™¨é¦–å…ˆä» METADATA è¡¨ä¸­è¯»å–å®ƒçš„å…ƒæ•°æ®ã€‚Tablet çš„å…ƒæ•°æ®åŒ… å«äº†ç»„æˆè¿™ä¸ª Tablet çš„ SSTable çš„åˆ—è¡¨ï¼Œä»¥åŠä¸€ç³»åˆ—çš„ Redo Point15ï¼Œè¿™äº› Redo Point æŒ‡å‘å¯èƒ½å«æœ‰è¯¥ Tablet æ•°æ®çš„å·²æäº¤çš„æ—¥å¿—è®°å½•ã€‚Tablet æœåŠ¡å™¨æŠŠ SSTable çš„ç´¢å¼•è¯»è¿›å†…å­˜ï¼Œä¹‹åé€šè¿‡é‡å¤ Redo Point ä¹‹åæäº¤çš„æ›´ æ–°æ¥é‡å»º memtableã€‚ å½“å¯¹ Tablet æœåŠ¡å™¨è¿›è¡Œå†™æ“ä½œæ—¶ï¼ŒTablet æœåŠ¡å™¨é¦–å…ˆè¦æ£€æŸ¥è¿™ä¸ªæ“ä½œæ ¼å¼æ˜¯å¦æ­£ç¡®ã€æ“ä½œå‘èµ·è€…æ˜¯å¦æœ‰æ‰§ è¡Œè¿™ä¸ªæ“ä½œçš„æƒé™ã€‚æƒé™éªŒè¯çš„æ–¹æ³•æ˜¯é€šè¿‡ä»ä¸€ä¸ª Chubby æ–‡ä»¶é‡Œè¯»å–å‡ºæ¥çš„å…·æœ‰å†™æƒé™çš„æ“ä½œè€…åˆ—è¡¨æ¥è¿›è¡Œ éªŒè¯(è¿™ä¸ªæ–‡ä»¶å‡ ä¹ä¸€å®šä¼šå­˜æ”¾åœ¨ Chubby å®¢æˆ·ç¼“å­˜é‡Œ)ã€‚æˆåŠŸçš„ä¿®æ”¹æ“ä½œä¼šè®°å½•åœ¨æäº¤æ—¥å¿—é‡Œã€‚å¯ä»¥é‡‡ç”¨æ‰¹ é‡æäº¤æ–¹å¼16æ¥æé«˜åŒ…å«å¤§é‡å°çš„ä¿®æ”¹æ“ä½œçš„åº”ç”¨ç¨‹åºçš„ååé‡ã€13ï¼Œ16ã€‘ã€‚å½“ä¸€ä¸ªå†™æ“ä½œæäº¤åï¼Œå†™çš„å†…å®¹ æ’å…¥åˆ° memtable é‡Œé¢ã€‚ å½“å¯¹ Tablet æœåŠ¡å™¨è¿›è¡Œè¯»æ“ä½œæ—¶ï¼ŒTablet æœåŠ¡å™¨ä¼šä½œç±»ä¼¼çš„å®Œæ•´æ€§å’Œæƒé™æ£€æŸ¥ã€‚ä¸€ä¸ªæœ‰æ•ˆçš„è¯»æ“ä½œåœ¨ä¸€ä¸ª ç”±ä¸€ç³»åˆ— SSTable å’Œ memtable åˆå¹¶çš„è§†å›¾é‡Œæ‰§è¡Œã€‚ç”±äº SSTable å’Œ memtable æ˜¯æŒ‰å­—å…¸æ’åºçš„æ•°æ®ç»“æ„ï¼Œå› æ­¤ å¯ä»¥é«˜æ•ˆç”Ÿæˆåˆå¹¶è§†å›¾ã€‚ å½“è¿›è¡Œ Tablet çš„åˆå¹¶å’Œåˆ†å‰²æ—¶ï¼Œæ­£åœ¨è¿›è¡Œçš„è¯»å†™æ“ä½œèƒ½å¤Ÿç»§ç»­è¿›è¡Œã€‚ ç©ºé—´æ”¶ç¼©éšç€å†™æ“ä½œçš„æ‰§è¡Œï¼Œmemtable çš„å¤§å°ä¸æ–­å¢åŠ ã€‚å½“ memtable çš„å°ºå¯¸åˆ°è¾¾ä¸€ä¸ªé—¨é™å€¼çš„æ—¶å€™ï¼Œè¿™ä¸ª memtable å°±ä¼šè¢«å†»ç»“ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ memtable;è¢«å†»ç»“ä½ memtable ä¼šè¢«è½¬æ¢æˆ SSTableï¼Œç„¶åå†™å…¥ GFS18ã€‚Minor Compaction è¿‡ç¨‹æœ‰ä¸¤ä¸ªç›®çš„:shrink 19Tablet æœåŠ¡å™¨ä½¿ç”¨çš„å†…å­˜ï¼Œä»¥åŠåœ¨æœåŠ¡å™¨ç¾éš¾æ¢å¤è¿‡ç¨‹ä¸­ï¼Œå‡å°‘å¿…é¡»ä» æäº¤æ—¥å¿—é‡Œè¯»å–çš„æ•°æ®é‡ã€‚åœ¨ Compaction è¿‡ç¨‹ä¸­ï¼Œæ­£åœ¨è¿›è¡Œçš„è¯»å†™æ“ä½œä»èƒ½ç»§ç»­ã€‚ æ¯ä¸€æ¬¡ Minor Compaction éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ SSTableã€‚å¦‚æœ Minor Compaction è¿‡ç¨‹ä¸åœæ»çš„æŒç»­è¿›è¡Œä¸‹ å»ï¼Œè¯»æ“ä½œå¯èƒ½éœ€è¦åˆå¹¶æ¥è‡ªå¤šä¸ª SSTable çš„æ›´æ–°;å¦åˆ™ï¼Œæˆ‘ä»¬é€šè¿‡å®šæœŸåœ¨åå°æ‰§è¡Œ Merging Compaction è¿‡ ç¨‹åˆå¹¶æ–‡ä»¶ï¼Œé™åˆ¶è¿™ç±»æ–‡ä»¶çš„æ•°é‡ã€‚Merging Compaction è¿‡ç¨‹è¯»å–ä¸€äº› SSTable å’Œ memtable çš„å†…å®¹ï¼Œåˆå¹¶æˆ ä¸€ä¸ªæ–°çš„ SSTableã€‚åªè¦ Merging Compaction è¿‡ç¨‹å®Œæˆäº†ï¼Œè¾“å…¥çš„è¿™äº› SSTable å’Œ memtable å°±å¯ä»¥åˆ é™¤äº†ã€‚ åˆå¹¶æ‰€æœ‰çš„ SSTable å¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ SSTable çš„ Merging Compaction è¿‡ç¨‹å«ä½œ Major Compactionã€‚ç”±é Major Compaction äº§ç”Ÿçš„ SSTable å¯èƒ½å«æœ‰ç‰¹æ®Šçš„åˆ é™¤æ¡ç›®ï¼Œè¿™äº›åˆ é™¤æ¡ç›®èƒ½å¤Ÿéšè—åœ¨æ—§çš„ã€ä½†æ˜¯ä¾ç„¶æœ‰æ•ˆçš„ SSTable ä¸­å·²ç»åˆ é™¤çš„æ•°æ®20ã€‚è€Œ Major Compaction è¿‡ç¨‹ç”Ÿæˆçš„ SSTable ä¸åŒ…å«å·²ç»åˆ é™¤çš„ä¿¡æ¯æˆ–æ•°æ®ã€‚Bigtable å¾ªç¯æ‰«æå®ƒæ‰€æœ‰çš„ Tabletï¼Œå¹¶ä¸”å®šæœŸå¯¹å®ƒä»¬æ‰§è¡Œ Major Compactionã€‚Major Compaction æœºåˆ¶å…è®¸ Bigtable å›æ”¶ å·²ç»åˆ é™¤çš„æ•°æ®å æœ‰çš„èµ„æºï¼Œå¹¶ä¸”ç¡®ä¿ BigTable èƒ½åŠæ—¶æ¸…é™¤å·²ç»åˆ é™¤çš„æ•°æ®21ï¼Œè¿™å¯¹å­˜æ”¾æ•æ„Ÿæ•°æ®çš„æœåŠ¡æ˜¯ éå¸¸é‡è¦ã€‚ä¼˜åŒ–ä¸Šä¸€ç« æˆ‘ä»¬æè¿°äº† Bigtable çš„å®ç°ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¾ˆå¤šä¼˜åŒ–å·¥ä½œæ‰èƒ½ä½¿ Bigtable åˆ°è¾¾ç”¨æˆ·è¦æ±‚çš„é«˜æ€§èƒ½ã€ é«˜å¯ç”¨æ€§å’Œé«˜å¯é æ€§ã€‚æœ¬ç« æè¿°äº† Bigtable å®ç°çš„å…¶å®ƒéƒ¨åˆ†ï¼Œä¸ºäº†æ›´å¥½çš„å¼ºè°ƒè¿™äº›ä¼˜åŒ–å·¥ä½œï¼Œæˆ‘ä»¬å°†æ·±å…¥ç»† èŠ‚ã€‚ å±€éƒ¨æ€§ç¾¤ç»„å®¢æˆ·ç¨‹åºå¯ä»¥å°†å¤šä¸ªåˆ—æ—ç»„åˆæˆä¸€ä¸ªå±€éƒ¨æ€§ç¾¤æ—ã€‚å¯¹ Tablet ä¸­çš„æ¯ä¸ªå±€éƒ¨æ€§ç¾¤ç»„éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„SSTableã€‚å°†é€šå¸¸ä¸ä¼šä¸€èµ·è®¿é—®çš„åˆ—æ—åˆ†å‰²æˆä¸åŒçš„å±€éƒ¨æ€§ç¾¤ç»„å¯ä»¥æé«˜è¯»å–æ“ä½œçš„æ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ Webtableè¡¨ä¸­ï¼Œç½‘é¡µçš„å…ƒæ•°æ®(æ¯”å¦‚è¯­è¨€å’Œ Checksum)å¯ä»¥åœ¨ä¸€ä¸ªå±€éƒ¨æ€§ç¾¤ç»„ä¸­ï¼Œç½‘é¡µçš„å†…å®¹å¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªç¾¤ç»„: å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºè¦è¯»å–ç½‘é¡µçš„å…ƒæ•°æ®çš„æ—¶å€™ï¼Œå®ƒæ²¡æœ‰å¿…è¦å»è¯»å–æ‰€æœ‰çš„é¡µé¢å†…å®¹ã€‚ æ­¤å¤–ï¼Œå¯ä»¥ä»¥å±€éƒ¨æ€§ç¾¤ç»„ä¸ºå•ä½è®¾å®šä¸€äº›æœ‰ç”¨çš„è°ƒè¯•å‚æ•°ã€‚æ¯”å¦‚ï¼Œå¯ä»¥æŠŠä¸€ä¸ªå±€éƒ¨æ€§ç¾¤ç»„è®¾å®šä¸ºå…¨éƒ¨å­˜ å‚¨åœ¨å†…å­˜ä¸­ã€‚Tablet æœåŠ¡å™¨ä¾ç…§æƒ°æ€§åŠ è½½çš„ç­–ç•¥å°†è®¾å®šä¸ºæ”¾å…¥å†…å­˜çš„å±€éƒ¨æ€§ç¾¤ç»„çš„ SSTable è£…è½½è¿›å†…å­˜ã€‚åŠ è½½ å®Œæˆä¹‹åï¼Œè®¿é—®å±äºè¯¥å±€éƒ¨æ€§ç¾¤ç»„çš„åˆ—æ—çš„æ—¶å€™å°±ä¸å¿…è¯»å–ç¡¬ç›˜äº†ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºéœ€è¦é¢‘ç¹è®¿é—®çš„å°å—æ•°æ® ç‰¹åˆ«æœ‰ç”¨:åœ¨ Bigtable å†…éƒ¨ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æé«˜ METADATA è¡¨ä¸­å…·æœ‰ä½ç½®ç›¸å…³æ€§çš„åˆ—æ—çš„è®¿é—®é€Ÿåº¦ã€‚ å‹ç¼©å®¢æˆ·ç¨‹åºå¯ä»¥æ§åˆ¶ä¸€ä¸ªå±€éƒ¨æ€§ç¾¤ç»„çš„ SSTable æ˜¯å¦éœ€è¦å‹ç¼©;å¦‚æœéœ€è¦å‹ç¼©ï¼Œé‚£ä¹ˆä»¥ä»€ä¹ˆæ ¼å¼æ¥å‹ç¼©ã€‚ æ¯ä¸ª SSTable çš„å—(å—çš„å¤§å°ç”±å±€éƒ¨æ€§ç¾¤ç»„çš„ä¼˜åŒ–å‚æ•°æŒ‡å®š)éƒ½ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„å‹ç¼©æ ¼å¼æ¥å‹ç¼©ã€‚è™½ç„¶åˆ†å— å‹ç¼©æµªè´¹äº†å°‘é‡ç©ºé—´22ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨åªè¯»å– SSTable çš„ä¸€å°éƒ¨åˆ†æ•°æ®çš„æ—¶å€™å°±ä¸å¿…è§£å‹æ•´ä¸ªæ–‡ä»¶äº†ã€‚å¾ˆå¤šå®¢ æˆ·ç¨‹åºä½¿ç”¨äº†â€œä¸¤éâ€çš„ã€å¯å®šåˆ¶çš„å‹ç¼©æ–¹å¼ã€‚ç¬¬ä¸€éé‡‡ç”¨ Bentley and McIlroyâ€™s æ–¹å¼[6]ï¼Œè¿™ç§æ–¹å¼åœ¨ä¸€ä¸ª å¾ˆå¤§çš„æ‰«æçª—å£é‡Œå¯¹å¸¸è§çš„é•¿å­—ç¬¦ä¸²è¿›è¡Œå‹ç¼©;ç¬¬äºŒéæ˜¯é‡‡ç”¨å¿«é€Ÿå‹ç¼©ç®—æ³•ï¼Œå³åœ¨ä¸€ä¸ª 16KB çš„å°æ‰«æçª—å£ ä¸­å¯»æ‰¾é‡å¤æ•°æ®ã€‚ä¸¤ä¸ªå‹ç¼©çš„ç®—æ³•éƒ½å¾ˆå¿«ï¼Œåœ¨ç°åœ¨çš„æœºå™¨ä¸Šï¼Œå‹ç¼©çš„é€Ÿç‡è¾¾åˆ° 100-200MB/sï¼Œè§£å‹çš„é€Ÿç‡è¾¾ åˆ° 400-1000MB/sã€‚ è™½ç„¶æˆ‘ä»¬åœ¨é€‰æ‹©å‹ç¼©ç®—æ³•çš„æ—¶å€™é‡ç‚¹è€ƒè™‘çš„æ˜¯é€Ÿåº¦è€Œä¸æ˜¯å‹ç¼©çš„ç©ºé—´ï¼Œä½†æ˜¯è¿™ç§ä¸¤éçš„å‹ç¼©æ–¹å¼åœ¨ç©ºé—´ å‹ç¼©ç‡ä¸Šçš„è¡¨ç°ä¹Ÿæ˜¯ä»¤äººæƒŠå¹ã€‚æ¯”å¦‚ï¼Œåœ¨ Webtable çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ç§å‹ç¼©æ–¹å¼æ¥å­˜å‚¨ç½‘é¡µå†…å®¹ã€‚åœ¨ä¸€ æ¬¡æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå‹ç¼©çš„å±€éƒ¨æ€§ç¾¤ç»„ä¸­å­˜å‚¨äº†å¤§é‡çš„ç½‘é¡µã€‚é’ˆå¯¹å®éªŒçš„ç›®çš„ï¼Œæˆ‘ä»¬æ²¡æœ‰å­˜å‚¨æ¯ä¸ªæ–‡æ¡£æ‰€ æœ‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œæˆ‘ä»¬ä»…ä»…å­˜å‚¨äº†ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚è¯¥æ¨¡å¼çš„ç©ºé—´å‹ç¼©æ¯”è¾¾åˆ°äº† 10:1ã€‚è¿™æ¯”ä¼ ç»Ÿçš„ Gzip åœ¨å‹ç¼© HTML é¡µé¢æ—¶ 3:1 æˆ–è€… 4:1 çš„ç©ºé—´å‹ç¼©æ¯”å¥½çš„å¤š;â€œä¸¤éâ€çš„å‹ç¼©æ¨¡å¼å¦‚æ­¤é«˜æ•ˆçš„åŸå› æ˜¯ç”±äº Webtable çš„è¡Œçš„ å­˜æ”¾æ–¹å¼:ä»åŒä¸€ä¸ªä¸»æœºè·å–çš„é¡µé¢éƒ½å­˜åœ¨ä¸´è¿‘çš„åœ°æ–¹ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼ŒBentley-McIlroy ç®—æ³•å¯ä»¥ä»æ¥è‡ªåŒ ä¸€ä¸ªä¸»æœºçš„é¡µé¢é‡Œæ‰¾åˆ°å¤§é‡çš„é‡å¤å†…å®¹ã€‚ä¸ä»…ä»…æ˜¯ Webtableï¼Œå…¶å®ƒçš„å¾ˆå¤šåº”ç”¨ç¨‹åºä¹Ÿé€šè¿‡é€‰æ‹©åˆé€‚çš„è¡Œåæ¥ å°†ç›¸ä¼¼çš„æ•°æ®èšç°‡åœ¨ä¸€èµ·ï¼Œä»¥è·å–è¾ƒé«˜çš„å‹ç¼©ç‡ã€‚å½“æˆ‘ä»¬åœ¨ Bigtable ä¸­å­˜å‚¨åŒä¸€ä»½æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬çš„æ—¶å€™ï¼Œ å‹ç¼©æ•ˆç‡ä¼šæ›´é«˜ã€‚ é€šè¿‡ç¼“å­˜æé«˜è¯»æ“ä½œçš„æ€§èƒ½ä¸ºäº†æé«˜è¯»æ“ä½œçš„æ€§èƒ½ï¼ŒTablet æœåŠ¡å™¨ä½¿ç”¨äºŒçº§ç¼“å­˜çš„ç­–ç•¥ã€‚æ‰«æç¼“å­˜æ˜¯ç¬¬ä¸€çº§ç¼“å­˜ï¼Œä¸»è¦ç¼“å­˜ TabletæœåŠ¡å™¨é€šè¿‡ SSTable æ¥å£è·å–çš„ Key-Value å¯¹;Block ç¼“å­˜æ˜¯äºŒçº§ç¼“å­˜ï¼Œç¼“å­˜çš„æ˜¯ä» GFS è¯»å–çš„ SSTable çš„ Blockã€‚å¯¹äºç»å¸¸è¦é‡å¤è¯»å–ç›¸åŒæ•°æ®çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæ‰«æç¼“å­˜éå¸¸æœ‰æ•ˆ;å¯¹äºç»å¸¸è¦è¯»å–åˆšåˆšè¯»è¿‡çš„æ•°æ® é™„è¿‘çš„æ•°æ®çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼ŒBlock ç¼“å­˜æ›´æœ‰ç”¨(ä¾‹å¦‚ï¼Œé¡ºåºè¯»ï¼Œæˆ–è€…åœ¨ä¸€ä¸ªçƒ­ç‚¹çš„è¡Œçš„å±€éƒ¨æ€§ç¾¤ç»„ä¸­éšæœºè¯»å–ä¸åŒçš„åˆ—)ã€‚ Bloom è¿‡æ»¤å™¨å¦‚ 6.3 èŠ‚æ‰€è¿°ï¼Œä¸€ä¸ªè¯»æ“ä½œå¿…é¡»è¯»å–æ„æˆ Tablet çŠ¶æ€çš„æ‰€æœ‰ SSTable çš„æ•°æ®ã€‚å¦‚æœè¿™äº› SSTable ä¸åœ¨å†…å­˜ ä¸­ï¼Œé‚£ä¹ˆå°±éœ€è¦å¤šæ¬¡è®¿é—®ç¡¬ç›˜ã€‚æˆ‘ä»¬é€šè¿‡å…è®¸å®¢æˆ·ç¨‹åºå¯¹ç‰¹å®šå±€éƒ¨æ€§ç¾¤ç»„çš„ SSTable æŒ‡å®š Bloom è¿‡æ»¤å™¨ã€7ã€‘ï¼Œ æ¥å‡å°‘ç¡¬ç›˜è®¿é—®çš„æ¬¡æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Bloom è¿‡æ»¤å™¨æŸ¥è¯¢ä¸€ä¸ª SSTable æ˜¯å¦åŒ…å«äº†ç‰¹å®šè¡Œå’Œåˆ—çš„æ•°æ®ã€‚å¯¹äº æŸäº›ç‰¹å®šåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬åªä»˜å‡ºäº†å°‘é‡çš„ã€ç”¨äºå­˜å‚¨ Bloom è¿‡æ»¤å™¨çš„å†…å­˜çš„ä»£ä»·ï¼Œå°±æ¢æ¥äº†è¯»æ“ä½œæ˜¾è‘—å‡å°‘ çš„ç£ç›˜è®¿é—®çš„æ¬¡æ•°ã€‚ä½¿ç”¨ Bloom è¿‡æ»¤å™¨ä¹Ÿéšå¼çš„è¾¾åˆ°äº†å½“åº”ç”¨ç¨‹åºè®¿é—®ä¸å­˜åœ¨çš„è¡Œæˆ–åˆ—æ—¶ï¼Œå¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ éƒ½ä¸éœ€è¦è®¿é—®ç¡¬ç›˜çš„ç›®çš„ã€‚ Commit æ—¥å¿—çš„å®ç°å¦‚æœæˆ‘ä»¬æŠŠå¯¹æ¯ä¸ª Tablet çš„æ“ä½œçš„ Commit æ—¥å¿—éƒ½å­˜åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå¤§é‡çš„æ–‡ä»¶ï¼Œ å¹¶ä¸”è¿™äº›æ–‡ä»¶ä¼šå¹¶è¡Œçš„å†™å…¥ GFSã€‚æ ¹æ® GFS æœåŠ¡å™¨åº•å±‚æ–‡ä»¶ç³»ç»Ÿå®ç°çš„æ–¹æ¡ˆï¼Œè¦æŠŠè¿™äº›æ–‡ä»¶å†™å…¥ä¸åŒçš„ç£ç›˜ æ—¥å¿—æ–‡ä»¶æ—¶24ï¼Œä¼šæœ‰å¤§é‡çš„ç£ç›˜ Seek æ“ä½œã€‚å¦å¤–ï¼Œç”±äºæ‰¹é‡æäº¤25ä¸­æ“ä½œçš„æ•°ç›®ä¸€èˆ¬æ¯”è¾ƒå°‘ï¼Œå› æ­¤ï¼Œå¯¹æ¯ä¸ª Tablet è®¾ç½®å•ç‹¬çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿä¼šç»™æ‰¹é‡æäº¤æœ¬åº”å…·æœ‰çš„ä¼˜åŒ–æ•ˆæœå¸¦æ¥å¾ˆå¤§çš„è´Ÿé¢å½±å“ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œæˆ‘ ä»¬è®¾ç½®æ¯ä¸ª Tablet æœåŠ¡å™¨ä¸€ä¸ª Commit æ—¥å¿—æ–‡ä»¶ï¼ŒæŠŠä¿®æ”¹æ“ä½œçš„æ—¥å¿—ä»¥è¿½åŠ æ–¹å¼å†™å…¥åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå› æ­¤ ä¸€ä¸ªå®é™…çš„æ—¥å¿—æ–‡ä»¶ä¸­æ··åˆäº†å¯¹å¤šä¸ª Tablet ä¿®æ”¹çš„æ—¥å¿—è®°å½•ã€‚ ä½¿ç”¨å•ä¸ªæ—¥å¿—æ˜¾è‘—æé«˜äº†æ™®é€šæ“ä½œçš„æ€§èƒ½ï¼Œä½†æ˜¯å°†æ¢å¤çš„å·¥ä½œå¤æ‚åŒ–äº†ã€‚å½“ä¸€ä¸ª Tablet æœåŠ¡å™¨å®•æœºæ—¶ï¼Œ å®ƒåŠ è½½çš„ Tablet å°†ä¼šè¢«ç§»åˆ°å¾ˆå¤šå…¶å®ƒçš„ Tablet æœåŠ¡å™¨ä¸Š:æ¯ä¸ª Tablet æœåŠ¡å™¨éƒ½è£…è½½å¾ˆå°‘çš„å‡ ä¸ªåŸæ¥çš„æœåŠ¡å™¨ çš„ Tabletã€‚å½“æ¢å¤ä¸€ä¸ª Tablet çš„çŠ¶æ€çš„æ—¶å€™ï¼Œæ–°çš„ Tablet æœåŠ¡å™¨è¦ä»åŸæ¥çš„ Tablet æœåŠ¡å™¨å†™çš„æ—¥å¿—ä¸­æå–ä¿®æ”¹ æ“ä½œçš„ä¿¡æ¯ï¼Œå¹¶é‡æ–°æ‰§è¡Œã€‚ç„¶è€Œï¼Œè¿™äº› Tablet ä¿®æ”¹æ“ä½œçš„æ—¥å¿—è®°å½•éƒ½æ··åˆåœ¨åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­çš„ã€‚ä¸€ç§æ–¹æ³• æ–°çš„ Tablet æœåŠ¡å™¨è¯»å–å®Œæ•´çš„ Commit æ—¥å¿—æ–‡ä»¶ï¼Œç„¶ååªé‡å¤æ‰§è¡Œå®ƒéœ€è¦æ¢å¤çš„ Tablet çš„ç›¸å…³ä¿®æ”¹æ“ä½œã€‚ä½¿ ç”¨è¿™ç§æ–¹æ³•ï¼Œå‡å¦‚æœ‰ 100 å° Tablet æœåŠ¡å™¨ï¼Œæ¯å°éƒ½åŠ è½½äº†å¤±æ•ˆçš„ Tablet æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ª Tabletï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ—¥ å¿—æ–‡ä»¶å°±è¦è¢«è¯»å– 100 æ¬¡(æ¯ä¸ªæœåŠ¡å™¨è¯»å–ä¸€æ¬¡)ã€‚ ä¸ºäº†é¿å…å¤šæ¬¡è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘ä»¬é¦–å…ˆæŠŠæ—¥å¿—æŒ‰ç…§å…³é”®å­—(tableï¼Œrow nameï¼Œlog sequence number)æ’åºã€‚ æ’åºä¹‹åï¼Œå¯¹åŒä¸€ä¸ª Tablet çš„ä¿®æ”¹æ“ä½œçš„æ—¥å¿—è®°å½•å°±è¿ç»­å­˜æ”¾åœ¨äº†ä¸€èµ·ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªè¦ä¸€æ¬¡ç£ç›˜ Seek æ“ä½œã€ä¹‹åé¡ºåºè¯»å–å°±å¯ä»¥äº†ã€‚ä¸ºäº†å¹¶è¡Œæ’åºï¼Œæˆ‘ä»¬å…ˆå°†æ—¥å¿—åˆ†å‰²æˆ 64MB çš„æ®µï¼Œä¹‹ååœ¨ä¸åŒçš„ Tablet æœåŠ¡å™¨å¯¹æ®µ è¿›è¡Œå¹¶è¡Œæ’åºã€‚è¿™ä¸ªæ’åºå·¥ä½œç”± Master æœåŠ¡å™¨æ¥ååŒå¤„ç†ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ª Tablet æœåŠ¡å™¨è¡¨æ˜è‡ªå·±éœ€è¦ä» Commit æ—¥å¿—æ–‡ä»¶æ¢å¤ Tablet æ—¶å¼€å§‹æ‰§è¡Œã€‚ åœ¨å‘ GFS ä¸­å†™ Commit æ—¥å¿—çš„æ—¶å€™å¯èƒ½ä¼šå¼•èµ·ç³»ç»Ÿé¢ ç°¸ï¼ŒåŸå› æ˜¯å¤šç§å¤šæ ·çš„(æ¯”å¦‚ï¼Œå†™æ“ä½œæ­£åœ¨è¿›è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ª GFS æœåŠ¡å™¨å®•æœºäº†;æˆ–è€…è¿æ¥ä¸‰ä¸ª GFS å‰¯æœ¬æ‰€åœ¨çš„æœåŠ¡å™¨çš„ç½‘ç»œæ‹¥å¡æˆ–è€…è¿‡è½½äº†)ã€‚ä¸ºäº†ç¡®ä¿åœ¨ GFS è´Ÿè½½é«˜å³°æ—¶ä¿®æ”¹æ“ä½œè¿˜èƒ½é¡ºåˆ©è¿›è¡Œï¼Œæ¯ä¸ª Tablet æœåŠ¡å™¨å®é™…ä¸Šæœ‰ä¸¤ä¸ªæ—¥å¿—å†™å…¥çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å†™è‡ªå·± çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ä»»ä½•æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ˜¯å·¥ä½œçš„ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„åœ¨å†™å…¥çš„æ—¶å€™æ•ˆç‡å¾ˆä½ï¼ŒTablet æœåŠ¡ å™¨å°±åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹ï¼Œä¿®æ”¹æ“ä½œçš„æ—¥å¿—è®°å½•å°±å†™å…¥åˆ°è¿™ä¸ªçº¿ç¨‹å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚æ¯ä¸ªæ—¥å¿—è®°å½•éƒ½æœ‰ä¸€ ä¸ªåºåˆ—å·ï¼Œå› æ­¤ï¼Œåœ¨æ¢å¤çš„æ—¶å€™ï¼ŒTablet æœåŠ¡å™¨èƒ½å¤Ÿæ£€æµ‹å‡ºå¹¶å¿½ç•¥æ‰é‚£äº›ç”±äºçº¿ç¨‹åˆ‡æ¢è€Œå¯¼è‡´çš„é‡å¤çš„è®°å½•ã€‚ Tablet æ¢å¤æé€Ÿå½“ Master æœåŠ¡å™¨å°†ä¸€ä¸ª Tablet ä»ä¸€ä¸ª Tablet æœåŠ¡å™¨ç§»åˆ°å¦å¤–ä¸€ä¸ª Tablet æœåŠ¡å™¨æ—¶ï¼Œæº Tablet æœåŠ¡å™¨ä¼šå¯¹ è¿™ä¸ª Tablet åšä¸€æ¬¡ Minor Compactionã€‚è¿™ä¸ª Compaction æ“ä½œå‡å°‘äº† Tablet æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶ä¸­æ²¡æœ‰å½’å¹¶çš„è®° å½•ï¼Œä»è€Œå‡å°‘äº†æ¢å¤çš„æ—¶é—´ã€‚Compaction å®Œæˆä¹‹åï¼Œè¯¥æœåŠ¡å™¨å°±åœæ­¢ä¸ºè¯¥ Tablet æä¾›æœåŠ¡ã€‚åœ¨å¸è½½ Tablet ä¹‹ å‰ï¼Œæº Tablet æœåŠ¡å™¨è¿˜ä¼šå†åšä¸€æ¬¡(é€šå¸¸ä¼šå¾ˆå¿«)Minor Compactionï¼Œä»¥æ¶ˆé™¤å‰é¢åœ¨ä¸€æ¬¡å‹ç¼©è¿‡ç¨‹ä¸­åˆäº§ç”Ÿçš„ æœªå½’å¹¶çš„è®°å½•ã€‚ç¬¬äºŒæ¬¡ Minor Compaction å®Œæˆä»¥åï¼ŒTablet å°±å¯ä»¥è¢«è£…è½½åˆ°æ–°çš„ Tablet æœåŠ¡å™¨ä¸Šäº†ï¼Œå¹¶ä¸”ä¸ éœ€è¦ä»æ—¥å¿—ä¸­è¿›è¡Œæ¢å¤ã€‚ åˆ©ç”¨ä¸å˜æ€§æˆ‘ä»¬åœ¨ä½¿ç”¨ Bigtable æ—¶ï¼Œé™¤äº† SSTable ç¼“å­˜ä¹‹å¤–çš„å…¶å®ƒéƒ¨åˆ†äº§ç”Ÿçš„ SSTable éƒ½æ˜¯ä¸å˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ ä¸€ç‚¹å¯¹ç³»ç»Ÿè¿›è¡Œç®€åŒ–ã€‚ä¾‹å¦‚ï¼Œå½“ä» SSTable è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¿…å¯¹æ–‡ä»¶ç³»ç»Ÿè®¿é—®æ“ä½œè¿›è¡ŒåŒæ­¥ã€‚è¿™æ · ä¸€æ¥ï¼Œå°±å¯ä»¥éå¸¸é«˜æ•ˆçš„å®ç°å¯¹è¡Œçš„å¹¶è¡Œæ“ä½œã€‚memtable æ˜¯å”¯ä¸€ä¸€ä¸ªèƒ½è¢«è¯»å’Œå†™æ“ä½œåŒæ—¶è®¿é—®çš„å¯å˜æ•°æ®ç»“ æ„ã€‚ä¸ºäº†å‡å°‘åœ¨è¯»æ“ä½œæ—¶çš„ç«äº‰ï¼Œæˆ‘ä»¬å¯¹å†…å­˜è¡¨é‡‡ç”¨ COW(Copy-on-write)æœºåˆ¶ï¼Œè¿™æ ·å°±å…è®¸è¯»å†™æ“ä½œå¹¶è¡Œæ‰§ è¡Œã€‚ å› ä¸º SSTable æ˜¯ä¸å˜çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ°¸ä¹…åˆ é™¤è¢«æ ‡è®°ä¸ºâ€œåˆ é™¤â€çš„æ•°æ®çš„é—®é¢˜ï¼Œè½¬æ¢æˆå¯¹åºŸå¼ƒçš„ SSTable è¿›è¡Œåƒåœ¾æ”¶é›†çš„é—®é¢˜äº†ã€‚æ¯ä¸ª Tablet çš„ SSTable éƒ½åœ¨ METADATA è¡¨ä¸­æ³¨å†Œäº†ã€‚Master æœåŠ¡å™¨é‡‡ç”¨â€œæ ‡ è®°-åˆ é™¤â€çš„åƒåœ¾å›æ”¶æ–¹å¼åˆ é™¤ SSTable é›†åˆä¸­åºŸå¼ƒçš„ SSTableã€25ã€‘ï¼ŒMETADATA è¡¨åˆ™ä¿å­˜äº† Root SSTable çš„é›†åˆã€‚ æœ€åï¼ŒSSTable çš„ä¸å˜æ€§ä½¿å¾—åˆ†å‰² Tablet çš„æ“ä½œéå¸¸å¿«æ·ã€‚æˆ‘ä»¬ä¸å¿…ä¸ºæ¯ä¸ªåˆ†å‰²å‡ºæ¥çš„ Tablet å»ºç«‹æ–°çš„ SSTable é›†åˆï¼Œè€Œæ˜¯å…±äº«åŸæ¥çš„ Tablet çš„ SSTable é›†åˆã€‚æ€§èƒ½è¯„ä¼°ä¸ºäº†æµ‹è¯• Bigtable çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªåŒ…æ‹¬ N å° Tablet æœåŠ¡å™¨çš„ Bigtable é›†ç¾¤ï¼Œè¿™é‡Œ N æ˜¯å¯å˜çš„ã€‚æ¯å° Tablet æœåŠ¡å™¨é…ç½®äº† 1GB çš„å†…å­˜ï¼Œæ•°æ®å†™å…¥åˆ°ä¸€ä¸ªåŒ…æ‹¬ 1786 å°æœºå™¨ã€æ¯å°æœºå™¨æœ‰ 2 ä¸ª IDE ç¡¬ç›˜çš„ GFS é›†ç¾¤ä¸Šã€‚æˆ‘ä»¬ä½¿ç”¨ N å°å®¢æˆ·æœºç”Ÿæˆå·¥ä½œè´Ÿè½½æµ‹è¯• Bigtableã€‚(æˆ‘ä»¬ä½¿ç”¨å’Œ Tablet æœåŠ¡å™¨ç›¸åŒæ•°ç›®çš„ å®¢æˆ·æœºä»¥ç¡®ä¿å®¢æˆ·æœºä¸ä¼šæˆä¸ºç“¶é¢ˆã€‚) æ¯å°å®¢æˆ·æœºé…ç½® 2GZ åŒæ ¸ Opteron å¤„ç†å™¨ï¼Œé…ç½®äº†è¶³ä»¥å®¹çº³æ‰€æœ‰è¿›ç¨‹ å·¥ä½œæ•°æ®é›†çš„ç‰©ç†å†…å­˜ï¼Œä»¥åŠä¸€å¼  Gigabit çš„ä»¥å¤ªç½‘å¡ã€‚è¿™äº›æœºå™¨éƒ½è¿å…¥ä¸€ä¸ªä¸¤å±‚çš„ã€æ ‘çŠ¶çš„äº¤æ¢ç½‘ç»œé‡Œï¼Œåœ¨ æ ¹èŠ‚ç‚¹ä¸Šçš„å¸¦å®½åŠ èµ·æ¥æœ‰å¤§çº¦ 100-200Gbpsã€‚æ‰€æœ‰çš„æœºå™¨é‡‡ç”¨ç›¸åŒçš„è®¾å¤‡ï¼Œå› æ­¤ï¼Œä»»ä½•ä¸¤å°æœºå™¨é—´ç½‘ç»œæ¥å›ä¸€ æ¬¡çš„æ—¶é—´éƒ½å°äº 1msã€‚ Tablet æœåŠ¡å™¨ã€Master æœåŠ¡å™¨ã€æµ‹è¯•æœºã€ä»¥åŠ GFS æœåŠ¡å™¨éƒ½è¿è¡Œåœ¨åŒä¸€ç»„æœºå™¨ä¸Šã€‚æ¯å°æœºå™¨éƒ½è¿è¡Œä¸€ä¸ª GFS çš„æœåŠ¡å™¨ã€‚å…¶å®ƒçš„æœºå™¨è¦ä¹ˆè¿è¡Œ Tablet æœåŠ¡å™¨ã€è¦ä¹ˆè¿è¡Œå®¢æˆ·ç¨‹åºã€è¦ä¹ˆè¿è¡Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨è¿™ç»„ æœºå™¨çš„å…¶å®ƒçš„ä»»åŠ¡å¯åŠ¨çš„è¿›ç¨‹ã€‚ R æ˜¯æµ‹è¯•è¿‡ç¨‹ä¸­ï¼ŒBigtable åŒ…å«çš„ä¸åŒçš„åˆ—å…³é”®å­—çš„æ•°é‡ã€‚æˆ‘ä»¬ç²¾å¿ƒé€‰æ‹© R çš„å€¼ï¼Œä¿è¯æ¯æ¬¡åŸºå‡†æµ‹è¯•å¯¹æ¯ å° Tablet æœåŠ¡å™¨è¯»/å†™çš„æ•°æ®é‡éƒ½åœ¨ 1GB å·¦å³ã€‚ åœ¨åºåˆ—å†™çš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„åˆ—å…³é”®å­—çš„èŒƒå›´æ˜¯ 0 åˆ° R-1ã€‚è¿™ä¸ªèŒƒå›´åˆè¢«åˆ’åˆ†ä¸º 10N ä¸ªå¤§å°ç›¸åŒ çš„åŒºé—´ã€‚æ ¸å¿ƒè°ƒåº¦ç¨‹åºæŠŠè¿™äº›åŒºé—´åˆ†é…ç»™ N ä¸ªå®¢æˆ·ç«¯ï¼Œåˆ†é…æ–¹å¼æ˜¯:åªè¦å®¢æˆ·ç¨‹åºå¤„ç†å®Œä¸Šä¸€ä¸ªåŒºé—´çš„æ•°æ®ï¼Œ è°ƒåº¦ç¨‹åºå°±æŠŠåç»­çš„ã€å°šæœªå¤„ç†çš„åŒºé—´åˆ†é…ç»™å®ƒã€‚è¿™ç§åŠ¨æ€åˆ†é…çš„æ–¹å¼æœ‰åŠ©äºå‡å°‘å®¢æˆ·æœºä¸ŠåŒæ—¶è¿è¡Œçš„å…¶å®ƒ è¿›ç¨‹å¯¹æ€§èƒ½çš„å½±å“ã€‚æˆ‘ä»¬åœ¨æ¯ä¸ªåˆ—å…³é”®å­—ä¸‹å†™å…¥ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ä¸²ã€‚æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯éšæœºç”Ÿæˆçš„ã€å› æ­¤ä¹Ÿæ²¡ æœ‰è¢«å‹ç¼©26ã€‚å¦å¤–ï¼Œä¸åŒåˆ—å…³é”®å­—ä¸‹çš„å­—ç¬¦ä¸²ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå› æ­¤ä¹Ÿå°±ä¸å­˜åœ¨è·¨è¡Œçš„å‹ç¼©ã€‚éšæœºå†™å…¥åŸºå‡†æµ‹è¯•é‡‡ ç”¨ç±»ä¼¼çš„æ–¹æ³•ï¼Œé™¤äº†è¡Œå…³é”®å­—åœ¨å†™å…¥å‰å…ˆåš Hashï¼ŒHash é‡‡ç”¨æŒ‰ R å–æ¨¡çš„æ–¹å¼ï¼Œè¿™æ ·å°±ä¿è¯äº†åœ¨æ•´ä¸ªåŸºå‡†æµ‹ è¯•æŒç»­çš„æ—¶é—´å†…ï¼Œå†™å…¥çš„å·¥ä½œè´Ÿè½½å‡åŒ€çš„åˆ†å¸ƒåœ¨åˆ—å­˜å‚¨ç©ºé—´å†…ã€‚ åºåˆ—è¯»çš„åŸºå‡†æµ‹è¯•ç”Ÿæˆåˆ—å…³é”®å­—çš„æ–¹å¼ä¸åºåˆ—å†™ç›¸åŒï¼Œä¸åŒäºåºåˆ—å†™åœ¨åˆ—å…³é”®å­—ä¸‹å†™å…¥å­—ç¬¦ä¸²çš„æ˜¯ï¼Œåº åˆ—è¯»æ˜¯è¯»å–åˆ—å…³é”®å­—ä¸‹çš„å­—ç¬¦ä¸²(è¿™äº›å­—ç¬¦ä¸²ç”±ä¹‹å‰åºåˆ—å†™åŸºå‡†æµ‹è¯•ç¨‹åºå†™å…¥)ã€‚åŒæ ·çš„ï¼Œéšæœºè¯»çš„åŸºå‡†æµ‹è¯• å’Œéšæœºå†™æ˜¯ç±»ä¼¼çš„ã€‚ æ‰«æåŸºå‡†æµ‹è¯•å’Œåºåˆ—è¯»ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯ BigTable æä¾›çš„ã€ä»ä¸€ä¸ªåˆ—èŒƒå›´å†…æ‰«ææ‰€æœ‰çš„ value å€¼çš„ APIã€‚ ç”±äºä¸€æ¬¡ RPC è°ƒç”¨å°±ä»ä¸€ä¸ª Tablet æœåŠ¡å™¨å–å›äº†å¤§é‡çš„ Value å€¼ï¼Œå› æ­¤ï¼Œä½¿ç”¨æ‰«ææ–¹å¼çš„åŸºå‡†æµ‹è¯•ç¨‹åºå¯ä»¥ å‡å°‘ RPC è°ƒç”¨çš„æ¬¡æ•°ã€‚ éšæœºè¯»(å†…å­˜)åŸºå‡†æµ‹è¯•å’Œéšæœºè¯»ç±»ä¼¼ï¼Œé™¤äº†åŒ…å«åŸºå‡†æµ‹è¯•æ•°æ®çš„å±€éƒ¨æ€§ç¾¤ç»„è¢«è®¾ç½®ä¸ºâ€œin-memoryâ€ï¼Œ å› æ­¤ï¼Œè¯»æ“ä½œç›´æ¥ä» Tablet æœåŠ¡å™¨çš„å†…å­˜ä¸­è¯»å–æ•°æ®ï¼Œä¸éœ€è¦ä» GFS è¯»å–æ•°æ®ã€‚é’ˆå¯¹è¿™ä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬æŠŠæ¯å°Tablet æœåŠ¡å™¨å­˜å‚¨çš„æ•°æ®ä» 1GB å‡å°‘åˆ° 100MBï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ•°æ®å…¨éƒ¨åŠ è½½åˆ° Tablet æœåŠ¡å™¨çš„å†…å­˜ä¸­äº†ã€‚å›¾ 6 ä¸­æœ‰ä¸¤ä¸ªè§†å›¾ï¼Œæ˜¾ç¤ºäº†æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•çš„æ€§èƒ½;å›¾ä¸­çš„æ•°æ®å’Œæ›²çº¿æ˜¯è¯»/å†™ 1000-byte value å€¼æ—¶å–å¾— çš„ã€‚å›¾ä¸­çš„è¡¨æ ¼æ˜¾ç¤ºäº†æ¯ä¸ª Tablet æœåŠ¡å™¨æ¯ç§’é’Ÿè¿›è¡Œçš„æ“ä½œçš„æ¬¡æ•°;å›¾ä¸­çš„æ›²çº¿æ˜¾ç¤ºäº†æ¯ç§’ç§æ‰€æœ‰çš„ Tablet æœåŠ¡å™¨ä¸Šæ“ä½œæ¬¡æ•°çš„æ€»å’Œã€‚ å•ä¸ª Tablet æœåŠ¡å™¨çš„æ€§èƒ½æˆ‘ä»¬é¦–å…ˆåˆ†æä¸‹å•ä¸ª Tablet æœåŠ¡å™¨çš„æ€§èƒ½ã€‚éšæœºè¯»çš„æ€§èƒ½æ¯”å…¶å®ƒæ“ä½œæ…¢ä¸€ä¸ªæ•°é‡çº§æˆ–ä»¥ä¸Š27ã€‚ æ¯ä¸ªéšæœº è¯»æ“ä½œéƒ½è¦é€šè¿‡ç½‘ç»œä» GFS ä¼ è¾“ 64KB çš„ SSTable åˆ° Tablet æœåŠ¡å™¨ï¼Œè€Œæˆ‘ä»¬åªä½¿ç”¨å…¶ä¸­å¤§å°æ˜¯ 1000 byte çš„ä¸€ ä¸ª value å€¼ã€‚Tablet æœåŠ¡å™¨æ¯ç§’å¤§çº¦æ‰§è¡Œ 1200 æ¬¡è¯»æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ¯ç§’å¤§çº¦ä» GFS è¯»å– 75MB çš„æ•°æ®ã€‚è¿™ä¸ªä¼  è¾“å¸¦å®½è¶³ä»¥å æ»¡ Tablet æœåŠ¡å™¨çš„ CPU æ—¶é—´ï¼Œå› ä¸ºå…¶ä¸­åŒ…æ‹¬äº†ç½‘ç»œåè®®æ ˆçš„æ¶ˆè€—ã€SSTable è§£æã€ä»¥åŠ BigTable ä»£ç æ‰§è¡Œ;è¿™ä¸ªå¸¦å®½ä¹Ÿè¶³ä»¥å æ»¡æˆ‘ä»¬ç³»ç»Ÿä¸­ç½‘ç»œçš„é“¾æ¥å¸¦å®½ã€‚å¤§å¤šæ•°é‡‡ç”¨è¿™ç§è®¿é—®æ¨¡å¼ BigTable åº”ç”¨ç¨‹åºä¼š å‡å° Block çš„å¤§å°ï¼Œé€šå¸¸ä¼šå‡åˆ° 8KBã€‚ å†…å­˜ä¸­çš„éšæœºè¯»æ“ä½œé€Ÿåº¦å¿«å¾ˆå¤šï¼ŒåŸå› æ˜¯ï¼Œæ‰€æœ‰ 1000-byte çš„è¯»æ“ä½œéƒ½æ˜¯ä» Tablet æœåŠ¡å™¨çš„æœ¬åœ°å†…å­˜ä¸­è¯» å–æ•°æ®ï¼Œä¸éœ€è¦ä» GFS è¯»å– 64KB çš„ Blockã€‚ éšæœºå’Œåºåˆ—å†™æ“ä½œçš„æ€§èƒ½æ¯”éšæœºè¯»è¦å¥½äº›ï¼ŒåŸå› æ˜¯æ¯ä¸ª Tablet æœåŠ¡å™¨ç›´æ¥æŠŠå†™å…¥æ“ä½œçš„å†…å®¹è¿½åŠ åˆ°ä¸€ä¸ª Commit æ—¥å¿—æ–‡ä»¶çš„å°¾éƒ¨ï¼Œå¹¶ä¸”é‡‡ç”¨æ‰¹é‡æäº¤çš„æ–¹å¼ï¼Œé€šè¿‡æŠŠæ•°æ®ä»¥æµçš„æ–¹å¼å†™å…¥åˆ° GFS æ¥æé«˜æ€§èƒ½ã€‚éšæœº å†™å’Œåºåˆ—å†™åœ¨æ€§èƒ½ä¸Šæ²¡æœ‰å¤ªå¤§çš„å·®å¼‚ï¼Œè¿™ä¸¤ç§æ–¹å¼çš„å†™æ“ä½œå®é™…ä¸Šéƒ½æ˜¯æŠŠæ“ä½œå†…å®¹è®°å½•åˆ°åŒä¸€ä¸ª Tablet æœåŠ¡ å™¨çš„ Commit æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ åºåˆ—è¯»çš„æ€§èƒ½å¥½äºéšæœºè¯»ï¼Œå› ä¸ºæ¯å–å‡º 64KB çš„ SSTable çš„ Block åï¼Œè¿™äº›æ•°æ®ä¼šç¼“å­˜åˆ° Block ç¼“å­˜ä¸­ï¼Œ åç»­çš„ 64 æ¬¡è¯»æ“ä½œç›´æ¥ä»ç¼“å­˜è¯»å–æ•°æ®ã€‚ æ‰«æçš„æ€§èƒ½æ›´é«˜ï¼Œè¿™æ˜¯ç”±äºå®¢æˆ·ç¨‹åºæ¯ä¸€æ¬¡ RPC è°ƒç”¨éƒ½ä¼šè¿”å›å¤§é‡çš„ value çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼ŒRPC è°ƒç”¨çš„ æ¶ˆè€—åŸºæœ¬æŠµæ¶ˆäº†ã€‚ æ€§èƒ½æå‡éšç€æˆ‘ä»¬å°†ç³»ç»Ÿä¸­çš„ Tablet æœåŠ¡å™¨ä» 1 å°å¢åŠ åˆ° 500 å°ï¼Œç³»ç»Ÿçš„æ•´ä½“ååé‡æœ‰äº†æ¢¦å¹»èˆ¬çš„å¢é•¿ï¼Œå¢é•¿çš„ å€ç‡è¶…è¿‡äº† 100ã€‚æ¯”å¦‚ï¼Œéšç€ Tablet æœåŠ¡å™¨çš„æ•°é‡å¢åŠ äº† 500 å€ï¼Œå†…å­˜ä¸­çš„éšæœºè¯»æ“ä½œçš„æ€§èƒ½å¢åŠ äº† 300 å€ã€‚ ä¹‹æ‰€ä»¥ä¼šæœ‰è¿™æ ·çš„æ€§èƒ½æå‡ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™ä¸ªåŸºå‡†æµ‹è¯•çš„ç“¶é¢ˆæ˜¯å•å° Tablet æœåŠ¡å™¨çš„ CPUã€‚ å°½ç®¡å¦‚æ­¤ï¼Œæ€§èƒ½çš„æå‡è¿˜ä¸æ˜¯çº¿æ€§çš„ã€‚åœ¨å¤§å¤šæ•°çš„åŸºå‡†æµ‹è¯•ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œå½“ Tablet æœåŠ¡å™¨çš„æ•°é‡ä» 1 å° å¢åŠ åˆ° 50 å°æ—¶ï¼Œæ¯å°æœåŠ¡å™¨çš„ååé‡ä¼šæœ‰ä¸€ä¸ªæ˜æ˜¾çš„ä¸‹é™ã€‚è¿™æ˜¯ç”±äºå¤šå°æœåŠ¡å™¨é—´çš„è´Ÿè½½ä¸å‡è¡¡é€ æˆçš„ï¼Œå¤§ å¤šæ•°æƒ…å†µä¸‹æ˜¯ç”±äºå…¶å®ƒçš„ç¨‹åºæŠ¢å äº† CPUã€‚ æˆ‘ä»¬è´Ÿè½½å‡è¡¡çš„ç®—æ³•ä¼šå°½é‡é¿å…è¿™ç§ä¸å‡è¡¡ï¼Œä½†æ˜¯åŸºäºä¸¤ä¸ªä¸»è¦ åŸå› ï¼Œè¿™ä¸ªç®—æ³•å¹¶ä¸èƒ½å®Œç¾çš„å·¥ä½œ:ä¸€ä¸ªæ˜¯å°½é‡å‡å°‘ Tablet çš„ç§»åŠ¨å¯¼è‡´é‡æ–°è´Ÿè½½å‡è¡¡èƒ½åŠ›å—é™(å¦‚æœ Tablet è¢«ç§»åŠ¨äº†ï¼Œé‚£ä¹ˆåœ¨çŸ­æ—¶é—´å†… â€” ä¸€èˆ¬æ˜¯ 1 ç§’å†… â€” è¿™ä¸ª Tablet æ˜¯ä¸å¯ç”¨çš„)ï¼Œå¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•ç¨‹åºäº§ ç”Ÿçš„è´Ÿè½½ä¼šæœ‰æ³¢åŠ¨28ã€‚ éšæœºè¯»åŸºå‡†æµ‹è¯•çš„æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼Œéšæœºè¯»çš„æ€§èƒ½éš Tablet æœåŠ¡å™¨æ•°é‡å¢åŠ çš„æå‡å¹…åº¦æœ€å°(æ•´ä½“ååé‡ åªæå‡äº† 100 å€ï¼Œè€ŒæœåŠ¡å™¨çš„æ•°é‡å´å¢åŠ äº† 500 å€)ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ª 1000-byte çš„è¯»æ“ä½œéƒ½ä¼šå¯¼è‡´ä¸€ä¸ª 64KB å¤§çš„ Block åœ¨ç½‘ç»œä¸Šä¼ è¾“ã€‚è¿™æ ·çš„ç½‘ç»œä¼ è¾“é‡æ¶ˆè€—äº†æˆ‘ä»¬ç½‘ç»œä¸­å„ç§å…±äº«çš„ 1GB çš„é“¾è·¯ï¼Œç»“æœå¯¼è‡´éšç€æˆ‘ä»¬ å¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œæ¯å°æœåŠ¡å™¨ä¸Šçš„ååé‡æ€¥å‰§ä¸‹é™ã€‚å®é™…åº”ç”¨æˆªæ­¢åˆ° 2006 å¹´ 8 æœˆï¼ŒGoogle å†…éƒ¨ä¸€å…±æœ‰ 388 ä¸ªéæµ‹è¯•ç”¨çš„ Bigtable é›†ç¾¤è¿è¡Œåœ¨å„ç§å„æ ·çš„æœåŠ¡å™¨é›†ç¾¤ä¸Šï¼Œ åˆè®¡å¤§çº¦æœ‰ 24500 ä¸ª Tablet æœåŠ¡å™¨ã€‚è¡¨ 1 æ˜¾ç¤ºäº†æ¯ä¸ªé›†ç¾¤ä¸Š Tablet æœåŠ¡å™¨çš„å¤§è‡´åˆ†å¸ƒæƒ…å†µã€‚è¿™äº›é›†ç¾¤ä¸­ï¼Œè®¸ å¤šç”¨äºå¼€å‘ç›®çš„ï¼Œå› æ­¤ä¼šæœ‰ä¸€æ®µæ—¶æœŸæ¯”è¾ƒç©ºé—²ã€‚é€šè¿‡è§‚å¯Ÿä¸€ä¸ªç”± 14 ä¸ªé›†ç¾¤ã€8069 ä¸ª Tablet æœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤ ç»„ï¼Œæˆ‘ä»¬çœ‹åˆ°æ•´ä½“çš„ååé‡è¶…è¿‡äº†æ¯ç§’ 1200000 æ¬¡è¯·æ±‚ï¼Œå‘é€åˆ°ç³»ç»Ÿçš„ RPC è¯·æ±‚å¯¼è‡´çš„ç½‘ç»œè´Ÿè½½è¾¾åˆ°äº† 741MB/sï¼Œç³»ç»Ÿå‘å‡ºçš„ RPC è¯·æ±‚ç½‘ç»œè´Ÿè½½å¤§çº¦æ˜¯ 16GB/sã€‚è¡¨ 2 æä¾›äº†ä¸€äº›ç›®å‰æ­£åœ¨ä½¿ç”¨çš„è¡¨çš„ç›¸å…³æ•°æ®ã€‚ä¸€äº›è¡¨å­˜å‚¨çš„æ˜¯ç”¨æˆ·ç›¸å…³çš„æ•°æ®ï¼Œå¦å¤–ä¸€äº›å­˜å‚¨çš„åˆ™æ˜¯ ç”¨äºæ‰¹å¤„ç†çš„æ•°æ®;è¿™äº›è¡¨åœ¨æ€»çš„å¤§å°ã€ æ¯ä¸ªæ•°æ®é¡¹çš„å¹³å‡å¤§å°ã€ä»å†…å­˜ä¸­è¯»å–çš„æ•°æ®çš„æ¯”ä¾‹ã€è¡¨çš„ Schema çš„å¤æ‚ç¨‹åº¦ä¸Šéƒ½æœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä¸»è¦æè¿°ä¸‰ä¸ªäº§å“ç ”å‘å›¢é˜Ÿå¦‚ä½•ä½¿ç”¨ Bigtable çš„ã€‚ Google AnalyticsGoogle Analytics æ˜¯ç”¨æ¥å¸®åŠ© Web ç«™ç‚¹çš„ç®¡ç†å‘˜åˆ†æä»–ä»¬ç½‘ç«™çš„æµé‡æ¨¡å¼çš„æœåŠ¡ã€‚å®ƒæä¾›äº†æ•´ä½“çŠ¶å†µçš„ç»Ÿ è®¡æ•°æ®ï¼Œæ¯”å¦‚æ¯å¤©çš„ç‹¬ç«‹è®¿é—®çš„ç”¨æˆ·æ•°é‡ã€æ¯å¤©æ¯ä¸ª URL çš„æµè§ˆæ¬¡æ•°;å®ƒè¿˜æä¾›äº†ç”¨æˆ·ä½¿ç”¨ç½‘ç«™çš„è¡Œä¸ºæŠ¥å‘Šï¼Œ æ¯”å¦‚æ ¹æ®ç”¨æˆ·ä¹‹å‰è®¿é—®çš„æŸäº›é¡µé¢ï¼Œç»Ÿè®¡å‡ºå‡ æˆçš„ç”¨æˆ·è´­ä¹°äº†å•†å“ã€‚ ä¸ºäº†ä½¿ç”¨è¿™ä¸ªæœåŠ¡ï¼ŒWeb ç«™ç‚¹çš„ç®¡ç†å‘˜åªéœ€è¦åœ¨ä»–ä»¬çš„ Web é¡µé¢ä¸­åµŒå…¥ä¸€å°æ®µ JavaScript è„šæœ¬å°±å¯ä»¥äº†ã€‚ è¿™ä¸ª Javascript ç¨‹åºåœ¨é¡µé¢è¢«è®¿é—®çš„æ—¶å€™è°ƒç”¨ã€‚å®ƒè®°å½•äº†å„ç§ Google Analytics éœ€è¦ä½¿ç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„ æ ‡è¯†ã€è·å–çš„ç½‘é¡µçš„ç›¸å…³ä¿¡æ¯ã€‚Google Analytics æ±‡æ€»è¿™äº›æ•°æ®ï¼Œä¹‹åæä¾›ç»™ Web ç«™ç‚¹çš„ç®¡ç†å‘˜ã€‚ æˆ‘ä»¬ç²—ç•¥çš„æè¿°ä¸€ä¸‹ Google Analytics ä½¿ç”¨çš„ä¸¤ä¸ªè¡¨ã€‚Row Click è¡¨(å¤§çº¦æœ‰ 200TB æ•°æ®)çš„æ¯ä¸€è¡Œå­˜æ”¾ äº†ä¸€ä¸ªæœ€ç»ˆç”¨æˆ·çš„ä¼šè¯ã€‚è¡Œçš„åå­—æ˜¯ä¸€ä¸ªåŒ…å« Web ç«™ç‚¹åå­—ä»¥åŠç”¨æˆ·ä¼šè¯åˆ›å»ºæ—¶é—´çš„å…ƒç»„ã€‚è¿™ç§æ¨¡å¼ä¿è¯äº† å¯¹åŒä¸€ä¸ª Web ç«™ç‚¹çš„è®¿é—®ä¼šè¯æ˜¯é¡ºåºçš„ï¼Œä¼šè¯æŒ‰æ—¶é—´é¡ºåºå­˜å‚¨ã€‚è¿™ä¸ªè¡¨å¯ä»¥å‹ç¼©åˆ°åŸæ¥å°ºå¯¸çš„ 14%ã€‚ Summary è¡¨(å¤§çº¦æœ‰ 20TB çš„æ•°æ®)åŒ…å«äº†å…³äºæ¯ä¸ª Web ç«™ç‚¹çš„ã€å„ç§ç±»å‹çš„é¢„å®šä¹‰æ±‡æ€»ä¿¡æ¯ã€‚ä¸€ä¸ªå‘¨ æœŸæ€§è¿è¡Œçš„ MapReduce ä»»åŠ¡æ ¹æ® Raw Click è¡¨çš„æ•°æ®ç”Ÿæˆ Summary è¡¨çš„æ•°æ®ã€‚æ¯ä¸ª MapReduce å·¥ä½œè¿›ç¨‹éƒ½ ä» Raw Click è¡¨ä¸­æå–æœ€æ–°çš„ä¼šè¯æ•°æ®ã€‚ç³»ç»Ÿçš„æ•´ä½“ååé‡å—é™äº GFS çš„ååé‡ã€‚è¿™ä¸ªè¡¨çš„èƒ½å¤Ÿå‹ç¼©åˆ°åŸæœ‰ å°ºå¯¸çš„ 29%ã€‚ Google EarthGoogle é€šè¿‡ä¸€ç»„æœåŠ¡ä¸ºç”¨æˆ·æä¾›äº†é«˜åˆ†è¾¨ç‡çš„åœ°çƒè¡¨é¢å«æ˜Ÿå›¾åƒï¼Œè®¿é—®çš„æ–¹å¼å¯ä»¥ä½¿é€šè¿‡åŸºäº Web çš„ Google Maps è®¿é—®æ¥å£(maps.google.com)ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Google Earth å®šåˆ¶çš„å®¢æˆ·ç«¯è½¯ä»¶è®¿é—®ã€‚è¿™äº›è½¯ä»¶äº§å“ å…è®¸ç”¨æˆ·æµè§ˆåœ°çƒè¡¨é¢çš„å›¾åƒ:ç”¨æˆ·å¯ä»¥åœ¨ä¸åŒçš„åˆ†è¾¨ç‡ä¸‹å¹³ç§»ã€æŸ¥çœ‹å’Œæ³¨é‡Šè¿™äº›å«æ˜Ÿå›¾åƒã€‚è¿™ä¸ªç³»ç»Ÿä½¿ç”¨ä¸€ä¸ªè¡¨å­˜å‚¨é¢„å¤„ç†æ•°æ®ï¼Œä½¿ç”¨å¦å¤–ä¸€ç»„è¡¨å­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚ æ•°æ®é¢„å¤„ç†æµæ°´çº¿ä½¿ç”¨ä¸€ä¸ªè¡¨å­˜å‚¨åŸå§‹å›¾åƒã€‚åœ¨é¢„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå›¾åƒè¢«æ¸…é™¤ï¼Œå›¾åƒæ•°æ®åˆå¹¶åˆ°æœ€ç»ˆçš„æœåŠ¡æ•°æ®ä¸­ã€‚è¿™ä¸ªè¡¨åŒ…å«äº†å¤§çº¦ 70TB çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ä»ç£ç›˜è¯»å–æ•°æ®ã€‚å›¾åƒå·²ç»è¢«é«˜æ•ˆå‹ç¼©è¿‡äº†ï¼Œå› æ­¤å­˜ å‚¨åœ¨ Bigtable åä¸éœ€è¦å†å‹ç¼©äº†ã€‚ Imagery è¡¨çš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨äº†ä¸€ä¸ªå•ç‹¬çš„åœ°ç†åŒºåŸŸã€‚è¡Œéƒ½æœ‰åç§°ï¼Œä»¥ç¡®ä¿æ¯—é‚»çš„åŒºåŸŸå­˜å‚¨åœ¨äº†ä¸€èµ·ã€‚ Imagery è¡¨ä¸­æœ‰ä¸€ä¸ªåˆ—æ—ç”¨æ¥è®°å½•æ¯ä¸ªåŒºåŸŸçš„æ•°æ®æºã€‚è¿™ä¸ªåˆ—æ—åŒ…å«äº†å¤§é‡çš„åˆ—:åŸºæœ¬ä¸Šå¸‚æ¯ä¸ªåˆ—å¯¹åº”ä¸€ä¸ªåŸ å§‹å›¾ç‰‡çš„æ•°æ®ã€‚ç”±äºæ¯ä¸ªåœ°ç†åŒºåŸŸéƒ½æ˜¯ç”±å¾ˆå°‘çš„å‡ å¼ å›¾ç‰‡æ„æˆçš„ï¼Œå› æ­¤è¿™ä¸ªåˆ—æ—æ˜¯éå¸¸ç¨€ç–çš„ã€‚ æ•°æ®é¢„å¤„ç†æµæ°´çº¿é«˜åº¦ä¾èµ–è¿è¡Œåœ¨ Bigtable ä¸Šçš„ MapReduce ä»»åŠ¡ä¼ è¾“æ•°æ®ã€‚åœ¨è¿è¡ŒæŸäº› MapReduce ä»»åŠ¡ çš„æ—¶å€™ï¼Œæ•´ä¸ªç³»ç»Ÿä¸­æ¯å° Tablet æœåŠ¡å™¨çš„æ•°æ®å¤„ç†é€Ÿåº¦æ˜¯ 1MB/sã€‚ è¿™ä¸ªæœåŠ¡ç³»ç»Ÿä½¿ç”¨ä¸€ä¸ªè¡¨æ¥ç´¢å¼• GFS ä¸­çš„æ•°æ®ã€‚è¿™ä¸ªè¡¨ç›¸å¯¹è¾ƒå°(å¤§çº¦æ˜¯ 500GB)ï¼Œä½†æ˜¯è¿™ä¸ªè¡¨å¿…é¡»åœ¨ ä¿è¯è¾ƒä½çš„å“åº”å»¶æ—¶çš„å‰æä¸‹ï¼Œé’ˆå¯¹æ¯ä¸ªæ•°æ®ä¸­å¿ƒï¼Œæ¯ç§’å¤„ç†å‡ ä¸‡ä¸ªæŸ¥è¯¢è¯·æ±‚ã€‚ å› æ­¤ï¼Œè¿™ä¸ªè¡¨å¿…é¡»åœ¨ä¸Šç™¾ä¸ª Tablet æœåŠ¡å™¨ä¸Šå­˜å‚¨æ•°æ®ï¼Œå¹¶ä¸”ä½¿ç”¨ in-memory çš„åˆ—æ—ã€‚ ä¸ªæ€§åŒ–æŸ¥è¯¢ä¸ªæ€§åŒ–æŸ¥è¯¢(www.google.com/psearch)æ˜¯ä¸€ä¸ªåŒå‘æœåŠ¡;è¿™ä¸ªæœåŠ¡è®°å½•ç”¨æˆ·çš„æŸ¥è¯¢å’Œç‚¹å‡»ï¼Œæ¶‰åŠåˆ°å„ç§ Google çš„æœåŠ¡ï¼Œæ¯”å¦‚ Web æŸ¥è¯¢ã€å›¾åƒå’Œæ–°é—»ã€‚ç”¨æˆ·å¯ä»¥æµè§ˆä»–ä»¬æŸ¥è¯¢çš„å†å²ï¼Œé‡å¤ä»–ä»¬ä¹‹å‰çš„æŸ¥è¯¢å’Œç‚¹å‡»; ç”¨æˆ·ä¹Ÿå¯ä»¥å®šåˆ¶åŸºäº Google å†å²ä½¿ç”¨ä¹ æƒ¯æ¨¡å¼çš„ä¸ªæ€§åŒ–æŸ¥è¯¢ç»“æœã€‚ ä¸ªæ€§åŒ–æŸ¥è¯¢ä½¿ç”¨ Bigtable å­˜å‚¨æ¯ä¸ªç”¨æˆ·çš„æ•°æ®ã€‚æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ· idï¼Œæ¯ä¸ªç”¨æˆ· id å’Œä¸€ä¸ªåˆ— åç»‘å®šã€‚ä¸€ä¸ªå•ç‹¬çš„åˆ—æ—è¢«ç”¨æ¥å­˜å‚¨å„ç§ç±»å‹çš„è¡Œä¸º(æ¯”å¦‚ï¼Œæœ‰ä¸ªåˆ—æ—å¯èƒ½æ˜¯ç”¨æ¥å­˜å‚¨æ‰€æœ‰çš„ Web æŸ¥è¯¢çš„)ã€‚ æ¯ä¸ªæ•°æ®é¡¹éƒ½è¢«ç”¨ä½œ Bigtable çš„æ—¶é—´æˆ³ï¼Œè®°å½•äº†ç›¸åº”çš„ç”¨æˆ·è¡Œä¸ºå‘ç”Ÿçš„æ—¶é—´ã€‚ä¸ªæ€§åŒ–æŸ¥è¯¢ä½¿ç”¨ä»¥ Bigtable ä¸º å­˜å‚¨çš„ MapReduce ä»»åŠ¡ç”Ÿæˆç”¨æˆ·çš„æ•°æ®å›¾è¡¨ã€‚è¿™äº›ç”¨æˆ·æ•°æ®å›¾è¡¨ç”¨æ¥ä¸ªæ€§åŒ–å½“å‰çš„æŸ¥è¯¢ç»“æœã€‚ ä¸ªæ€§åŒ–æŸ¥è¯¢çš„æ•°æ®ä¼šå¤åˆ¶åˆ°å‡ ä¸ª Bigtable çš„é›†ç¾¤ä¸Šï¼Œè¿™æ ·å°±å¢å¼ºäº†æ•°æ®å¯ç”¨æ€§ï¼ŒåŒæ—¶å‡å°‘äº†ç”±å®¢æˆ·ç«¯å’Œ Bigtable é›†ç¾¤é—´çš„â€œè·ç¦»â€é€ æˆçš„å»¶æ—¶ã€‚ä¸ªæ€§åŒ–æŸ¥è¯¢çš„å¼€å‘å›¢é˜Ÿæœ€åˆå»ºç«‹äº†ä¸€ä¸ªåŸºäº Bigtable çš„ã€â€œå®¢æˆ·ä¾§â€ çš„å¤åˆ¶æœºåˆ¶ä¸ºæ‰€æœ‰çš„å¤åˆ¶èŠ‚ç‚¹æä¾›ä¸€è‡´æ€§ä¿éšœã€‚ç°åœ¨çš„ç³»ç»Ÿåˆ™ä½¿ç”¨äº†å†…å»ºçš„å¤åˆ¶å­ç³»ç»Ÿã€‚ ä¸ªæ€§åŒ–æŸ¥è¯¢å­˜å‚¨ç³»ç»Ÿçš„è®¾è®¡å…è®¸å…¶å®ƒçš„å›¢é˜Ÿåœ¨å®ƒä»¬è‡ªå·±çš„åˆ—ä¸­åŠ å…¥æ–°çš„ç”¨æˆ·æ•°æ®ï¼Œå› æ­¤ï¼Œå¾ˆå¤š Google æœ åŠ¡ä½¿ç”¨ä¸ªæ€§åŒ–æŸ¥è¯¢å­˜å‚¨ç³»ç»Ÿä¿å­˜ç”¨æˆ·çº§çš„é…ç½®å‚æ•°å’Œè®¾ç½®ã€‚åœ¨å¤šä¸ªå›¢é˜Ÿä¹‹é—´åˆ†äº«æ•°æ®çš„ç»“æœæ˜¯äº§ç”Ÿäº†å¤§é‡çš„ åˆ—æ—ã€‚ä¸ºäº†æ›´å¥½çš„æ”¯æŒæ•°æ®å…±äº«ï¼Œæˆ‘ä»¬åŠ å…¥äº†ä¸€ä¸ªç®€å•çš„é…é¢æœºåˆ¶29é™åˆ¶ç”¨æˆ·åœ¨å…±äº«è¡¨ä¸­ä½¿ç”¨çš„ç©ºé—´;é…é¢ä¹Ÿ ä¸ºä½¿ç”¨ä¸ªæ€§åŒ–æŸ¥è¯¢ç³»ç»Ÿå­˜å‚¨ç”¨æˆ·çº§ä¿¡æ¯çš„äº§å“å›¢ä½“æä¾›äº†éš”ç¦»æœºåˆ¶ã€‚ ç»éªŒæ•™è®­ åœ¨è®¾è®¡ã€å®ç°ã€ç»´æŠ¤å’Œæ”¯æŒ Bigtable çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°äº†å¾ˆå¤šæœ‰ç”¨çš„ç»éªŒå’Œä¸€äº›æœ‰è¶£çš„æ•™è®­ã€‚ä¸€ä¸ªæ•™è®­æ˜¯ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šç±»å‹çš„é”™è¯¯éƒ½ä¼šå¯¼è‡´å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿå—æŸï¼Œè¿™äº›é”™è¯¯ä¸ä»…ä»…æ˜¯é€šå¸¸çš„ç½‘ç»œ ä¸­æ–­ã€æˆ–è€…å¾ˆå¤šåˆ†å¸ƒå¼åè®®ä¸­è®¾æƒ³çš„ fail-stop ç±»å‹çš„é”™è¯¯30ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬é‡åˆ°è¿‡ä¸‹é¢è¿™äº›ç±»å‹çš„é”™è¯¯å¯¼è‡´çš„é—® é¢˜:å†…å­˜æ•°æ®æŸåã€ç½‘ç»œä¸­æ–­ã€æ—¶é’Ÿåå·®ã€æœºå™¨æŒ‚èµ·ã€æ‰©å±•çš„å’Œéå¯¹ç§°çš„ç½‘ç»œåˆ†åŒº31ã€æˆ‘ä»¬ä½¿ç”¨çš„å…¶å®ƒç³»ç»Ÿçš„ Bug(æ¯”å¦‚ Chubby)ã€GFS é…é¢æº¢å‡ºã€è®¡åˆ’å†…å’Œè®¡åˆ’å¤–çš„ç¡¬ä»¶ç»´æŠ¤ã€‚æˆ‘ä»¬åœ¨è§£å†³è¿™äº›é—®é¢˜çš„è¿‡ç¨‹ä¸­å­¦åˆ°äº†å¾ˆå¤š ç»éªŒï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹åè®®æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ RPC æœºåˆ¶ä¸­åŠ å…¥äº† Checksumã€‚æˆ‘ä»¬åœ¨è®¾è®¡ ç³»ç»Ÿçš„éƒ¨åˆ†åŠŸèƒ½æ—¶ï¼Œä¸å¯¹å…¶å®ƒéƒ¨åˆ†åŠŸèƒ½åšä»»ä½•çš„å‡è®¾ï¼Œè¿™æ ·çš„åšæ³•è§£å†³äº†å…¶å®ƒçš„ä¸€äº›é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä¸å† å‡è®¾ä¸€ä¸ªç‰¹å®šçš„ Chubby æ“ä½œåªè¿”å›é”™è¯¯ç é›†åˆä¸­çš„ä¸€ä¸ªå€¼ã€‚ å¦å¤–ä¸€ä¸ªæ•™è®­æ˜¯ï¼Œæˆ‘ä»¬æ˜ç™½äº†åœ¨å½»åº•äº†è§£ä¸€ä¸ªæ–°ç‰¹æ€§ä¼šè¢«å¦‚ä½•ä½¿ç”¨ä¹‹åï¼Œå†å†³å®šæ˜¯å¦æ·»åŠ è¿™ä¸ªæ–°ç‰¹æ€§æ˜¯ éå¸¸é‡è¦çš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¼€å§‹è®¡åˆ’åœ¨æˆ‘ä»¬çš„ API ä¸­æ”¯æŒé€šå¸¸æ–¹å¼çš„äº‹åŠ¡å¤„ç†ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬è¿˜ä¸ä¼šé©¬ä¸Šç”¨åˆ° è¿™ä¸ªåŠŸèƒ½ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å»å®ç°å®ƒã€‚ç°åœ¨ï¼ŒBigtable ä¸Šå·²ç»æœ‰äº†å¾ˆå¤šçš„å®é™…åº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬çœŸå® çš„éœ€æ±‚;æˆ‘ä»¬å‘ç°ï¼Œå¤§å¤šæ˜¯åº”ç”¨ç¨‹åºéƒ½åªæ˜¯éœ€è¦å•ä¸ªè¡Œä¸Šçš„äº‹åŠ¡åŠŸèƒ½ã€‚æœ‰äº›åº”ç”¨éœ€è¦åˆ†å¸ƒå¼çš„äº‹åŠ¡åŠŸèƒ½ï¼Œåˆ† å¸ƒå¼äº‹åŠ¡å¤§å¤šæ•°æƒ…å†µä¸‹ç”¨äºç»´æŠ¤äºŒçº§ç´¢å¼•ï¼Œå› æ­¤æˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„æœºåˆ¶å»æ»¡è¶³è¿™ä¸ªéœ€æ±‚ã€‚æ–°çš„æœºåˆ¶åœ¨é€š ç”¨æ€§ä¸Šæ¯”åˆ†å¸ƒå¼äº‹åŠ¡å·®å¾ˆå¤šï¼Œä½†æ˜¯å®ƒæ›´æœ‰æ•ˆ(ç‰¹åˆ«æ˜¯åœ¨æ›´æ–°æ“ä½œçš„æ¶‰åŠä¸Šç™¾è¡Œæ•°æ®çš„æ—¶å€™)ï¼Œè€Œä¸”éå¸¸ç¬¦åˆæˆ‘ ä»¬çš„â€œè·¨æ•°æ®ä¸­å¿ƒâ€å¤åˆ¶æ–¹æ¡ˆçš„ä¼˜åŒ–ç­–ç•¥ã€‚ è¿˜æœ‰ä¸€ä¸ªå…·æœ‰å®è·µæ„ä¹‰çš„ç»éªŒ:æˆ‘ä»¬å‘ç°ç³»ç»Ÿçº§çš„ç›‘æ§å¯¹ Bigtable éå¸¸é‡è¦(æ¯”å¦‚ï¼Œç›‘æ§ Bigtable è‡ªèº« ä»¥åŠä½¿ç”¨ Bigtable çš„å®¢æˆ·ç¨‹åº)ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æ‰©å±•äº†æˆ‘ä»¬çš„ RPC ç³»ç»Ÿï¼Œå› æ­¤å¯¹äºä¸€ä¸ª RPC è°ƒç”¨çš„ä¾‹å­ï¼Œå®ƒå¯ ä»¥è¯¦ç»†è®°å½•ä»£è¡¨äº† RPC è°ƒç”¨çš„å¾ˆå¤šé‡è¦æ“ä½œã€‚è¿™ä¸ªç‰¹æ€§å…è®¸æˆ‘ä»¬æ£€æµ‹å’Œä¿®æ­£å¾ˆå¤šçš„é—®é¢˜ï¼Œæ¯”å¦‚ Tablet æ•°æ®ç»“ æ„ä¸Šçš„é”çš„å†…å®¹ã€åœ¨ä¿®æ”¹æ“ä½œæäº¤æ—¶å¯¹ GFS çš„å†™å…¥éå¸¸æ…¢çš„é—®é¢˜ã€ä»¥åŠåœ¨ METADATA è¡¨çš„ Tablet ä¸å¯ç”¨æ—¶ï¼Œ å¯¹ METADATA è¡¨çš„è®¿é—®æŒ‚èµ·çš„é—®é¢˜ã€‚å…³äºç›‘æ§çš„ç”¨é€”çš„å¦å¤–ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œæ¯ä¸ª Bigtable é›†ç¾¤éƒ½åœ¨ Chubby ä¸­ æ³¨å†Œäº†ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·Ÿè¸ªæ‰€æœ‰çš„é›†ç¾¤çŠ¶æ€ã€ç›‘æ§å®ƒä»¬çš„å¤§å°ã€æ£€æŸ¥é›†ç¾¤è¿è¡Œçš„æˆ‘ä»¬è½¯ä»¶çš„ç‰ˆæœ¬ã€ç›‘æ§é›† ç¾¤æµå…¥æ•°æ®çš„æµé‡ï¼Œä»¥åŠæ£€æŸ¥æ˜¯å¦æœ‰å¼•å‘é›†ç¾¤é«˜å»¶æ—¶çš„æ½œåœ¨å› ç´ ã€‚ å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæœ€å®è´µçš„ç»éªŒæ˜¯ç®€å•è®¾è®¡çš„ä»·å€¼ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬ç³»ç»Ÿçš„ä»£ç é‡(å¤§çº¦ 100000 è¡Œç”Ÿäº§ä»£ç 32)ï¼Œ ä»¥åŠéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ–°çš„ä»£ç ä»¥å„ç§éš¾ä»¥é¢„æ–™çš„æ–¹å¼åŠ å…¥ç³»ç»Ÿï¼Œæˆ‘ä»¬å‘ç°ç®€æ´çš„è®¾è®¡å’Œç¼–ç ç»™ç»´æŠ¤å’Œè°ƒè¯• å¸¦æ¥çš„å·¨å¤§å¥½å¤„ã€‚è¿™æ–¹é¢çš„ä¸€ä¸ªä¾‹å­æ˜¯æˆ‘ä»¬çš„ Tablet æœåŠ¡å™¨æˆå‘˜åè®®ã€‚æˆ‘ä»¬ç¬¬ä¸€ç‰ˆçš„åè®®å¾ˆç®€å•:Master æœåŠ¡å™¨å‘¨æœŸæ€§çš„å’Œ Tablet æœåŠ¡å™¨ç­¾è®¢ç§Ÿçº¦ï¼ŒTablet æœåŠ¡å™¨åœ¨ç§Ÿçº¦è¿‡æœŸçš„æ—¶å€™ Kill æ‰è‡ªå·±çš„è¿›ç¨‹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ ä¸ªåè®®åœ¨é‡åˆ°ç½‘ç»œé—®é¢˜æ—¶ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œä¹Ÿä¼šå¤§å¤§å¢åŠ  Master æœåŠ¡å™¨æ¢å¤çš„æ—¶é—´ã€‚æˆ‘ä»¬å¤šæ¬¡é‡æ–° è®¾è®¡è¿™ä¸ªåè®®ï¼Œç›´åˆ°å®ƒèƒ½å¤Ÿå¾ˆå¥½çš„å¤„ç†ä¸Šè¿°é—®é¢˜ã€‚ä½†æ˜¯ï¼Œæ›´ä¸å¹¸çš„æ˜¯ï¼Œæœ€ç»ˆçš„åè®®è¿‡äºå¤æ‚äº†ï¼Œå¹¶ä¸”ä¾èµ–ä¸€ äº› Chubby å¾ˆå°‘è¢«ç”¨åˆ°çš„ç‰¹æ€§ã€‚æˆ‘ä»¬å‘ç°æˆ‘ä»¬æµªè´¹äº†å¤§é‡çš„æ—¶é—´åœ¨è°ƒè¯•ä¸€äº›å¤æ€ªçš„é—®é¢˜33ï¼Œæœ‰äº›æ˜¯ Bigtable ä»£ ç çš„é—®é¢˜ï¼Œæœ‰äº›æ˜¯ Chubby ä»£ç çš„é—®é¢˜ã€‚æœ€åï¼Œæˆ‘ä»¬åªå¥½åºŸå¼ƒäº†è¿™ä¸ªåè®®ï¼Œé‡æ–°åˆ¶è®¢äº†ä¸€ä¸ªæ–°çš„ã€æ›´ç®€å•ã€åªä½¿ç”¨ Chubby æœ€å¹¿æ³›ä½¿ç”¨çš„ç‰¹æ€§çš„åè®®ã€‚ç›¸å…³å·¥ä½œBoxwood é¡¹ç›®çš„æœ‰äº›ç»„ä»¶åœ¨æŸäº›æ–¹é¢å’Œ Chubbyã€GFS ä»¥åŠ Bigtable ç±»ä¼¼ï¼Œå› ä¸ºå®ƒä¹Ÿæä¾›äº†è¯¸å¦‚åˆ† å¸ƒå¼åè®®ã€é”ã€åˆ†å¸ƒå¼ Chunk å­˜å‚¨ä»¥åŠåˆ†å¸ƒå¼ B-tree å­˜å‚¨ã€‚Boxwood ä¸ Google çš„æŸäº›ç»„ä»¶å°½ç®¡åŠŸèƒ½ç±»ä¼¼ï¼Œ ä½†æ˜¯ Boxwood çš„ç»„ä»¶æä¾›æ›´åº•å±‚çš„æœåŠ¡ã€‚Boxwood é¡¹ç›®çš„ç›®çš„æ˜¯æä¾›åˆ›å»ºç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ç­‰é«˜çº§æœåŠ¡ çš„åŸºç¡€æ„ä»¶ï¼Œè€Œ Bigtable çš„ç›®çš„æ˜¯ç›´æ¥ä¸ºå®¢æˆ·ç¨‹åºçš„æ•°æ®å­˜å‚¨éœ€æ±‚æä¾›æ”¯æŒã€‚ ç°åœ¨æœ‰ä¸å°‘é¡¹ç›®å·²ç»æ”»å…‹äº†å¾ˆå¤šéš¾é¢˜ï¼Œå®ç°äº†åœ¨å¹¿åŸŸç½‘ä¸Šçš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨æˆ–è€…é«˜çº§æœåŠ¡ï¼Œé€šå¸¸æ˜¯ â€œInternet è§„æ¨¡â€çš„ã€‚è¿™å…¶ä¸­åŒ…æ‹¬äº†åˆ†å¸ƒå¼çš„ Hash è¡¨ï¼Œè¿™é¡¹å·¥ä½œç”±ä¸€äº›ç±»ä¼¼ CANã€29ã€‘ã€Chordã€32ã€‘ã€Tapestry ã€37ã€‘å’Œ Pastryã€30ã€‘çš„é¡¹ç›®ç‡å…ˆå‘èµ·ã€‚è¿™äº›ç³»ç»Ÿçš„ä¸»è¦å…³æ³¨ç‚¹å’Œ Bigtable ä¸åŒï¼Œæ¯”å¦‚åº”å¯¹å„ç§ä¸åŒçš„ä¼ è¾“å¸¦ å®½ã€ä¸å¯ä¿¡çš„åä½œè€…ã€é¢‘ç¹çš„æ›´æ”¹é…ç½®ç­‰;å¦å¤–ï¼Œå»ä¸­å¿ƒåŒ–å’Œ Byzantine ç¾éš¾å†—ä½™ä¹Ÿä¸æ˜¯ Bigtable çš„ç›®çš„ã€‚ å°±æä¾›ç»™åº”ç”¨ç¨‹åºå¼€å‘è€…çš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨æ¨¡å‹è€Œè¨€ï¼Œæˆ‘ä»¬ç›¸ä¿¡ï¼Œåˆ†å¸ƒå¼ B-Tree æˆ–è€…åˆ†å¸ƒå¼ Hash è¡¨æ ä¾›çš„ Key-value pair æ–¹å¼çš„æ¨¡å‹æœ‰å¾ˆå¤§çš„å±€é™æ€§ã€‚Key-value pair æ¨¡å‹æ˜¯å¾ˆæœ‰ç”¨çš„ç»„ä»¶ï¼Œä½†æ˜¯å®ƒä»¬ä¸åº”è¯¥æ˜¯æä¾›ç»™å¼€å‘è€…å”¯ä¸€çš„ç»„ä»¶ã€‚æˆ‘ä»¬é€‰æ‹©çš„æ¨¡å‹æä¾›çš„ç»„ä»¶æ¯”ç®€å•çš„ Key-value pair ä¸°å¯Œçš„å¤šï¼Œå®ƒæ”¯æŒç¨€ç–çš„ã€åŠç»“æ„ åŒ–çš„æ•°æ®ã€‚å¦å¤–ï¼Œå®ƒä¹Ÿè¶³å¤Ÿç®€å•ï¼Œèƒ½å¤Ÿé«˜æ•ˆçš„å¤„ç†å¹³é¢æ–‡ä»¶;å®ƒä¹Ÿæ˜¯é€æ˜çš„(é€šè¿‡å±€éƒ¨æ€§ç¾¤ç»„)ï¼Œå…è®¸æˆ‘ä»¬çš„ ä½¿ç”¨è€…å¯¹ç³»ç»Ÿçš„é‡è¦è¡Œä¸ºè¿›è¡Œè°ƒæ•´ã€‚ æœ‰äº›æ•°æ®åº“å‚å•†å·²ç»å¼€å‘å‡ºäº†å¹¶è¡Œçš„æ•°æ®åº“ç³»ç»Ÿï¼Œèƒ½å¤Ÿå­˜å‚¨æµ·é‡çš„æ•°æ®ã€‚Oracle çš„ RACã€27ã€‘ä½¿ç”¨å…±äº« ç£ç›˜å­˜å‚¨æ•°æ®(Bigtable ä½¿ç”¨ GFS)ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªåˆ†å¸ƒå¼çš„é”ç®¡ç†ç³»ç»Ÿ(Bigtable ä½¿ç”¨ Chubby)ã€‚IBM å¹¶è¡Œç‰ˆ æœ¬çš„ DB2ã€4ã€‘åŸºäºä¸€ç§ç±»ä¼¼äº Bigtable çš„ã€ä¸å…±äº«ä»»ä½•ä¸œè¥¿çš„æ¶æ„35ã€33ã€‘ã€‚æ¯ä¸ª DB2 çš„æœåŠ¡å™¨éƒ½è´Ÿè´£å¤„ç† å­˜å‚¨åœ¨ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ä¸­çš„è¡Œçš„ä¸€ä¸ªå­é›†ã€‚è¿™äº›äº§å“éƒ½æä¾›äº†ä¸€ä¸ªå¸¦æœ‰äº‹åŠ¡åŠŸèƒ½çš„å®Œæ•´çš„å…³ç³»æ¨¡å‹ã€‚ Bigtable é‡‡ç”¨ memtable å’Œ SSTable å­˜å‚¨å¯¹è¡¨çš„æ›´æ–°çš„æ–¹æ³•ä¸ Log-Structured Merge Treeã€26ã€‘å­˜å‚¨ç´¢å¼•æ•°æ®æ›´æ–°çš„æ–¹æ³•ç±»ä¼¼ã€‚è¿™ä¸¤ä¸ªç³»ç»Ÿä¸­ï¼Œæ’åºçš„æ•°æ®åœ¨å†™å…¥åˆ°ç£ç›˜å‰éƒ½å…ˆå­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œè¯»å–æ“ä½œå¿…é¡»ä»å†…å­˜å’Œç£ç›˜ä¸­åˆå¹¶æ•°æ®äº§ç”Ÿæœ€ç»ˆçš„ç»“æœé›†ã€‚ C-Store å’Œ Bigtable æœ‰å¾ˆå¤šç›¸ä¼¼ç‚¹:ä¸¤ä¸ªç³»ç»Ÿéƒ½é‡‡ç”¨ Shared-nothing æ¶æ„ï¼Œéƒ½æœ‰ä¸¤ç§ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä¸€ ç§ç”¨äºå½“å‰çš„å†™æ“ä½œï¼Œå¦å¤–ä¸€ç§å­˜æ”¾â€œé•¿æ—¶é—´ä½¿ç”¨â€çš„æ•°æ®ï¼Œå¹¶ä¸”æä¾›ä¸€ç§æœºåˆ¶åœ¨ä¸¤ä¸ªå­˜å‚¨ç»“æ„é—´æ¬è¿æ•°æ®ã€‚ ä¸¤ä¸ªç³»ç»Ÿåœ¨ API æ¥å£å‡½æ•°ä¸Šæœ‰å¾ˆå¤§çš„ä¸åŒ:C-Store æ“ä½œæ›´åƒå…³ç³»å‹æ•°æ®åº“ï¼Œè€Œ Bigtable æä¾›äº†ä½å±‚æ¬¡çš„è¯»å†™ æ“ä½œæ¥å£ï¼Œå¹¶ä¸”è®¾è®¡çš„ç›®æ ‡æ˜¯èƒ½å¤Ÿæ”¯æŒæ¯å°æœåŠ¡å™¨æ¯ç§’æ•°åƒæ¬¡æ“ä½œã€‚C-Store åŒæ—¶ä¹Ÿæ˜¯ä¸ªâ€œè¯»æ€§èƒ½ä¼˜åŒ–çš„å…³ç³» å‹æ•°æ®åº“â€ï¼Œè€Œ Bigtable å¯¹è¯»å’Œå†™å¯†é›†å‹åº”ç”¨éƒ½æä¾›äº†å¾ˆå¥½çš„æ€§èƒ½ã€‚ Bigtable ä¹Ÿå¿…é¡»è§£å†³æ‰€æœ‰çš„ Shared-nothing æ•°æ®åº“éœ€è¦é¢å¯¹çš„ã€ç±»å‹ç›¸ä¼¼çš„ä¸€äº›è´Ÿè½½å’Œå†…å­˜å‡è¡¡æ–¹é¢çš„éš¾ é¢˜(æ¯”å¦‚ï¼Œã€11ï¼Œ35ã€‘)ã€‚æˆ‘ä»¬çš„é—®é¢˜åœ¨æŸç§ç¨‹åº¦ä¸Šç®€å•ä¸€äº›: æˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘åŒä¸€ä»½æ•°æ®å¯èƒ½æœ‰å¤šä¸ªæ‹·è´çš„é—®é¢˜ï¼ŒåŒä¸€ä»½æ•°æ®å¯èƒ½ç”±äºè§†å›¾æˆ–ç´¢å¼•çš„åŸå› ä»¥ä¸åŒ çš„å½¢å¼è¡¨ç°å‡ºæ¥; æˆ‘ä»¬è®©ç”¨æˆ·å†³å®šå“ªäº›æ•°æ®åº”è¯¥æ”¾åœ¨å†…å­˜é‡Œã€å“ªäº›æ”¾åœ¨ç£ç›˜ä¸Šï¼Œè€Œä¸æ˜¯ç”±ç³»ç»ŸåŠ¨æ€çš„åˆ¤æ–­; 3. æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ²¡æœ‰å¤æ‚çš„æŸ¥è¯¢æ‰§è¡Œæˆ–ä¼˜åŒ–å·¥ä½œã€‚ ç»“è®º æˆ‘ä»¬å·²ç»è®²è¿°å®Œäº† Bigtableï¼ŒGoogle çš„ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨ç³»ç»Ÿã€‚Bigtable çš„é›†ç¾¤ä» 2005 å¹´ 4 æœˆå¼€å§‹å·²ç»æŠ•å…¥ä½¿ç”¨äº†ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬èŠ±äº†å¤§çº¦ 7 äººå¹´è®¾è®¡å’Œå®ç°è¿™ä¸ªç³»ç»Ÿã€‚æˆªæ­¢åˆ° 2006 å¹´ 4 æœˆï¼Œå·²ç»æœ‰ è¶…è¿‡ 60 ä¸ªé¡¹ç›®ä½¿ç”¨ Bigtable äº†ã€‚æˆ‘ä»¬çš„ç”¨æˆ·å¯¹ Bigtable æä¾›çš„é«˜æ€§èƒ½å’Œé«˜å¯ç”¨æ€§å¾ˆæ»¡æ„ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œ ä»–ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿå¯¹èµ„æºçš„éœ€æ±‚å¢åŠ æƒ…å†µï¼Œé€šè¿‡ç®€å•çš„å¢åŠ æœºå™¨ï¼Œæ‰©å±•ç³»ç»Ÿçš„æ‰¿è½½èƒ½åŠ›ã€‚ ç”±äº Bigtable æä¾›çš„ç¼–ç¨‹æ¥å£å¹¶ä¸å¸¸è§ï¼Œä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æ˜¯:æˆ‘ä»¬çš„ç”¨æˆ·é€‚åº”æ–°çš„æ¥å£æœ‰å¤šéš¾?æ–°çš„ä½¿ ç”¨è€…æœ‰æ—¶ä¸å¤ªç¡®å®šä½¿ç”¨ Bigtable æ¥å£çš„æœ€ä½³æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨ä»–ä»¬å·²ç»ä¹ æƒ¯äºä½¿ç”¨æ”¯æŒé€šç”¨äº‹åŠ¡çš„å…³ç³»å‹æ•°æ® åº“çš„æ¥å£çš„æƒ…å†µä¸‹ã€‚ä½†æ˜¯ï¼ŒGoogle å†…éƒ¨å¾ˆå¤šäº§å“éƒ½æˆåŠŸçš„ä½¿ç”¨äº† Bigtable çš„äº‹å®è¯æ˜äº†ï¼Œæˆ‘ä»¬çš„è®¾è®¡åœ¨å®è·µ ä¸­è¡Œä¹‹æœ‰æ•ˆã€‚ æˆ‘ä»¬ç°åœ¨æ­£åœ¨å¯¹ Bigtable åŠ å…¥ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æ”¯æŒäºŒçº§ç´¢å¼•ï¼Œä»¥åŠæ”¯æŒå¤š Master èŠ‚ç‚¹çš„ã€è·¨æ•°æ®ä¸­å¿ƒå¤åˆ¶çš„ Bigtable çš„åŸºç¡€æ„ä»¶ã€‚æˆ‘ä»¬ç°åœ¨å·²ç»å¼€å§‹å°† Bigtable éƒ¨ç½²ä¸ºæœåŠ¡ä¾›å…¶å®ƒçš„äº§å“å›¢é˜Ÿä½¿ç”¨ï¼Œè¿™æ ·ä¸åŒ çš„äº§å“å›¢é˜Ÿå°±ä¸éœ€è¦ç»´æŠ¤ä»–ä»¬è‡ªå·±çš„ Bigtable é›†ç¾¤äº†ã€‚éšç€æœåŠ¡é›†ç¾¤çš„æ‰©å±•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Bigtable ç³»ç»Ÿå†…éƒ¨å¤„ç†æ›´å¤šçš„å…³äºèµ„æºå…±äº«çš„é—®é¢˜äº†ã€3ï¼Œ5ã€‘ã€‚ æœ€åï¼Œæˆ‘ä»¬å‘ç°ï¼Œå»ºè®¾ Google è‡ªå·±çš„å­˜å‚¨è§£å†³æ–¹æ¡ˆå¸¦æ¥äº†å¾ˆå¤šä¼˜åŠ¿ã€‚é€šè¿‡ä¸º Bigtable è®¾è®¡æˆ‘ä»¬è‡ªå·±çš„æ•°æ®æ¨¡å‹ï¼Œæ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿæå…·çµæ´»æ€§ã€‚å¦å¤–ï¼Œç”±äºæˆ‘ä»¬å…¨é¢æ§åˆ¶ç€ Bigtable çš„å®ç°è¿‡ç¨‹ï¼Œä»¥åŠ Bigtable ä½¿ç”¨åˆ° çš„å…¶å®ƒçš„ Google çš„åŸºç¡€æ„ä»¶ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬åœ¨ç³»ç»Ÿå‡ºç°ç“¶é¢ˆæˆ–æ•ˆç‡ä½ä¸‹çš„æƒ…å†µæ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„è§£å†³è¿™äº›é—® é¢˜ã€‚AcknowledgementsWe thank the anonymous reviewers, David Nagle, and our shepherd Brad Calder, for their feedback on this paper.The Bigtable system has benefited greatly from the feedback of our many users within Google. In addition,we thank the following people for their contributions to Bigtable: Dan Aguayo, Sameer Ajmani, Zhifeng Chen,Bill Coughran, Mike Epstein, Healfdene Goguen, Robert Griesemer, Jeremy Hylton, Josh Hyman, Alex Khesin,Joanna Kulik, Alberto Lerner, Sherry Listgarten, Mike Maloney, Eduardo Pinheiro, Kathy Polizzi, Frank Yellin,and Arthur Zwiegincew.References[1] ABADI, D. J., MADDEN, S. R., AND FERREIRA, M. C. Integrating compression and execution in columnoriented database systems. Proc. of SIGMOD (2006).[2] AILAMAKI, A., DEWITT, D. J., HILL, M. D., AND SKOUNAKIS, M. Weaving relations for cache performance.In The VLDB Journal (2001), pp. 169-180.[3] BANGA, G., DRUSCHEL, P., AND MOGUL, J. C. Resource containers: A new facility for resource management in server systems. In Proc. of the 3rd OSDI (Feb. 1999), pp. 45-58.[4] BARU, C. K., FECTEAU, G., GOYAL, A., HSIAO, H., JHINGRAN, A., PADMANABHAN, S., COPELAND,G. P., AND WILSON, W. G. DB2 parallel edition. IBM Systems Journal 34, 2 (1995), 292-322.[5] BAVIER, A., BOWMAN, M., CHUN, B., CULLER, D., KARLIN, S., PETERSON, L., ROSCOE, T., SPALINK, T., AND WAWRZONIAK, M. Operating system support for planetary-scale network services. In Proc. of the 1st NSDI(Mar. 2004), pp. 253-266.[6] BENTLEY, J. L., AND MCILROY, M. D. Data compression using long common strings. In Data Compression Conference (1999), pp. 287-295.[7] BLOOM, B. H. Space/time trade-offs in hash coding with allowable errors. CACM 13, 7 (1970), 422-426.[8] BURROWS, M. The Chubby lock service for looselycoupled distributed systems. In Proc. of the 7th OSDI (Nov. 2006).[9] CHANDRA, T., GRIESEMER, R., AND REDSTONE, J.Paxos made live ? An engineering perspective. In Proc. of PODC (2007).[10] COMER, D. Ubiquitous B-tree. Computing Surveys 11, 2 (June 1979), 121-137.[11] COPELAND, G. P., ALEXANDER, W., BOUGHTER, E. E., AND KELLER, T. W. Data placement in Bubba. In Proc. of SIGMOD (1988), pp. 99-108.[12] DEAN, J., AND GHEMAWAT, S. MapReduce: Simplified data processing on large clusters. In Proc. of the 6th OSDI (Dec. 2004), pp. 137-150.[13] DEWITT, D., KATZ, R., OLKEN, F., SHAPIRO, L., STONEBRAKER, M., AND WOOD, D. Implementation techniques for main memory database systems. In Proc. of SIGMOD (June 1984), pp. 1-8.[14] DEWITT, D. J., AND GRAY, J. Parallel database systems: The future of high performance database systems. CACM 35, 6 (June 1992), 85-98.[15] FRENCH, C. D. One size ts all database architectures do not work for DSS. In Proc. of SIGMOD (May 1995), pp. 449-450.[16] GAWLICK, D., AND KINKADE, D. Varieties of concurrency control in IMS/VS fast path. Database Engineering Bulletin 8, 2 (1985), 3-10.[17] GHEMAWAT, S., GOBIOFF, H., AND LEUNG, S.-T. The Google file system. In Proc. of the 19th ACM SOSP (Dec.2003), pp. 29-43.[18] GRAY, J. Notes on database operating systems. In Operating Systems ? An Advanced Course, vol. 60 of Lecture Notes in Computer Science. Springer-Verlag, 1978.[19] GREER, R. Daytona and the fourth-generation language Cymbal. In Proc. of SIGMOD (1999), pp. 525-526.[20] HAGMANN, R. Reimplementing the Cedar file system using logging and group commit. In Proc. of the 11th SOSP (Dec. 1987), pp. 155-162.[21] HARTMAN, J. H., AND OUSTERHOUT, J. K. The Zebra striped network file system. In Proc. of the 14th SOSP(Asheville, NC, 1993), pp. 29-43.[22] KX.COM. kx.com/products/database.php. Product page.[23] LAMPORT, L. The part-time parliament. ACM TOCS 16,2 (1998), 133-169.[24] MACCORMICK, J., MURPHY, N., NAJORK, M., THEKKATH, C. A., AND ZHOU, L.Boxwood:Abstractions as the foundation for storage infrastructure. In Proc. of the 6th OSDI (Dec. 2004), pp. 105-120.[25] MCCARTHY, J. Recursive functions of symbolic expressions and their computation by machine. CACM 3,4 (Apr. 1960), 184-195.[26] Oâ€™NEIL, P., CHENG, E., GAWLICK, D., AND Oâ€™NEIL, E. The log-structured merge-tree (LSM-tree).Acta Inf. 33, 4 (1996), 351-385.[27] ORACLE.COM. www.oracle.com/technology/products/database/clustering/index.html. Product page.[28] PIKE, R., DORWARD, S., GRIESEMER, R., AND QUINLAN, S. Interpreting the data: Parallel analysiswith Sawzall. Scientific Programming Journal 13, 4 (2005), 227-298.[29] RATNASAMY, S., FRANCIS, P., HANDLEY, M., KARP, R., AND SHENKER, S. A scalablecontent-addressable network. In Proc. of SIGCOMM (Aug. 2001), pp. 161-172.[30] ROWSTRON, A., AND DRUSCHEL, P. Pastry: Scalable, distributed object location and routing forlargescale peer-to-peer systems. In Proc. of Middleware 2001(Nov. 2001), pp. 329-350.[31] SENSAGE.COM. sensage.com/products-sensage.htm. Product page.[32] STOICA, I., MORRIS, R., KARGER, D., KAASHOEK, M. F., AND BALAKRISHNAN, H. Chord: Ascalable peer-to-peer lookup service for Internet applications. In Proc. of SIGCOMM (Aug. 2001), pp. 149-160.[33] STONEBRAKER, M. The case for shared nothing. Database Engineering Bulletin 9, 1 (Mar. 1986), 4-9. [34] STONEBRAKER,M., ABADI, D. J., BATKIN, A., CHEN, X., CHERNIACK, M., FERREIRA, M., LAU,E., LIN, A., MADDEN, S., Oâ€™NEIL, E., Oâ€™NEIL, P., RASIN, A., TRAN, N., AND ZDONIK, S. C-Store: A columnoriented DBMS. In Proc. of VLDB (Aug. 2005), pp. 553-564.[35] STONEBRAKER, M., AOKI, P. M., DEVINE, R., LITWIN, W., AND OLSON, M. A. Mariposa: A new architecture for distributed data. In Proc. of the Tenth ICDE(1994), IEEE Computer Society, pp. 54-65.[36] SYBASE.COM. www.sybase.com/products/databaseservers/sybaseiq. Product page.[37] ZHAO, B. Y., KUBIATOWICZ, J., AND JOSEPH, A. D. Tapestry: An infrastructure for fault-tolerant wide-area location and routing. Tech. Rep. UCB/CSD-01-1141, CS Division, UC Berkeley, Apr. 2001.[38] ZUKOWSKI, M., BONCZ, P. A., NES, N., AND HEMAN, S. MonetDB/X100 ?A DBMS in the CPU cache. IEEE Data Eng. Bull. 28, 2 (2005), 17-22.","raw":null,"content":null,"categories":[{"name":"paper","slug":"paper","permalink":"https://stanxia.github.io/categories/paper/"}],"tags":[{"name":"paper","slug":"paper","permalink":"https://stanxia.github.io/tags/paper/"}]},{"title":"Google MapReduce ä¸­æ–‡ç‰ˆ","slug":"Google-MapReduce-ä¸­æ–‡ç‰ˆ","date":"2017-12-16T10:06:41.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/16/Google-MapReduce-ä¸­æ–‡ç‰ˆ/","link":"","permalink":"https://stanxia.github.io/2017/12/16/Google-MapReduce-ä¸­æ–‡ç‰ˆ/","excerpt":"æ‘˜è¦\nMapReduce æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¤„ç†å’Œç”Ÿæˆè¶…å¤§æ•°æ®é›†çš„ç®—æ³•æ¨¡å‹çš„ç›¸å…³å®ç°ã€‚ç”¨æˆ·é¦–å…ˆåˆ›å»ºä¸€ ä¸ª Map å‡½æ•°å¤„ç†ä¸€ä¸ªåŸºäº key/value pair çš„æ•°æ®é›†åˆï¼Œè¾“å‡ºä¸­é—´çš„åŸºäº key/value pair çš„æ•°æ®é›†åˆ;ç„¶åå†åˆ›å»º ä¸€ä¸ª Reduce å‡½æ•°ç”¨æ¥åˆå¹¶æ‰€æœ‰çš„å…·æœ‰ç›¸åŒä¸­é—´ key å€¼çš„ä¸­é—´ value å€¼ã€‚ç°å®ä¸–ç•Œä¸­æœ‰å¾ˆå¤šæ»¡è¶³ä¸Šè¿°å¤„ç†æ¨¡å‹ çš„ä¾‹å­ï¼Œæœ¬è®ºæ–‡å°†è¯¦ç»†æè¿°è¿™ä¸ªæ¨¡å‹ã€‚\nMapReduce æ¶æ„çš„ç¨‹åºèƒ½å¤Ÿåœ¨å¤§é‡çš„æ™®é€šé…ç½®çš„è®¡ç®—æœºä¸Šå®ç°å¹¶è¡ŒåŒ–å¤„ç†ã€‚è¿™ä¸ªç³»ç»Ÿåœ¨è¿è¡Œæ—¶åªå…³å¿ƒ: å¦‚ä½•åˆ†å‰²è¾“å…¥æ•°æ®ï¼Œåœ¨å¤§é‡è®¡ç®—æœºç»„æˆçš„é›†ç¾¤ä¸Šçš„è°ƒåº¦ï¼Œé›†ç¾¤ä¸­è®¡ç®—æœºçš„é”™è¯¯å¤„ç†ï¼Œç®¡ç†é›†ç¾¤ä¸­è®¡ç®—æœºä¹‹é—´ å¿…è¦çš„é€šä¿¡ã€‚é‡‡ç”¨ MapReduce æ¶æ„å¯ä»¥ä½¿é‚£äº›æ²¡æœ‰å¹¶è¡Œè®¡ç®—å’Œåˆ†å¸ƒå¼å¤„ç†ç³»ç»Ÿå¼€å‘ç»éªŒçš„ç¨‹åºå‘˜æœ‰æ•ˆåˆ©ç”¨åˆ† å¸ƒå¼ç³»ç»Ÿçš„ä¸°å¯Œèµ„æºã€‚\næˆ‘ä»¬çš„ MapReduce å®ç°è¿è¡Œåœ¨è§„æ¨¡å¯ä»¥çµæ´»è°ƒæ•´çš„ç”±æ™®é€šæœºå™¨ç»„æˆçš„é›†ç¾¤ä¸Š:ä¸€ä¸ªå…¸å‹çš„ MapReduce è®¡ç®—å¾€å¾€ç”±å‡ åƒå°æœºå™¨ç»„æˆã€å¤„ç†ä»¥ TB è®¡ç®—çš„æ•°æ®ã€‚ç¨‹åºå‘˜å‘ç°è¿™ä¸ªç³»ç»Ÿéå¸¸å¥½ç”¨:å·²ç»å®ç°äº†æ•°ä»¥ç™¾è®¡ çš„ MapReduce ç¨‹åºï¼Œåœ¨ Google çš„é›†ç¾¤ä¸Šï¼Œæ¯å¤©éƒ½æœ‰ 1000 å¤šä¸ª MapReduce ç¨‹åºåœ¨æ‰§è¡Œã€‚","text":"æ‘˜è¦ MapReduce æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¤„ç†å’Œç”Ÿæˆè¶…å¤§æ•°æ®é›†çš„ç®—æ³•æ¨¡å‹çš„ç›¸å…³å®ç°ã€‚ç”¨æˆ·é¦–å…ˆåˆ›å»ºä¸€ ä¸ª Map å‡½æ•°å¤„ç†ä¸€ä¸ªåŸºäº key/value pair çš„æ•°æ®é›†åˆï¼Œè¾“å‡ºä¸­é—´çš„åŸºäº key/value pair çš„æ•°æ®é›†åˆ;ç„¶åå†åˆ›å»º ä¸€ä¸ª Reduce å‡½æ•°ç”¨æ¥åˆå¹¶æ‰€æœ‰çš„å…·æœ‰ç›¸åŒä¸­é—´ key å€¼çš„ä¸­é—´ value å€¼ã€‚ç°å®ä¸–ç•Œä¸­æœ‰å¾ˆå¤šæ»¡è¶³ä¸Šè¿°å¤„ç†æ¨¡å‹ çš„ä¾‹å­ï¼Œæœ¬è®ºæ–‡å°†è¯¦ç»†æè¿°è¿™ä¸ªæ¨¡å‹ã€‚ MapReduce æ¶æ„çš„ç¨‹åºèƒ½å¤Ÿåœ¨å¤§é‡çš„æ™®é€šé…ç½®çš„è®¡ç®—æœºä¸Šå®ç°å¹¶è¡ŒåŒ–å¤„ç†ã€‚è¿™ä¸ªç³»ç»Ÿåœ¨è¿è¡Œæ—¶åªå…³å¿ƒ: å¦‚ä½•åˆ†å‰²è¾“å…¥æ•°æ®ï¼Œåœ¨å¤§é‡è®¡ç®—æœºç»„æˆçš„é›†ç¾¤ä¸Šçš„è°ƒåº¦ï¼Œé›†ç¾¤ä¸­è®¡ç®—æœºçš„é”™è¯¯å¤„ç†ï¼Œç®¡ç†é›†ç¾¤ä¸­è®¡ç®—æœºä¹‹é—´ å¿…è¦çš„é€šä¿¡ã€‚é‡‡ç”¨ MapReduce æ¶æ„å¯ä»¥ä½¿é‚£äº›æ²¡æœ‰å¹¶è¡Œè®¡ç®—å’Œåˆ†å¸ƒå¼å¤„ç†ç³»ç»Ÿå¼€å‘ç»éªŒçš„ç¨‹åºå‘˜æœ‰æ•ˆåˆ©ç”¨åˆ† å¸ƒå¼ç³»ç»Ÿçš„ä¸°å¯Œèµ„æºã€‚ æˆ‘ä»¬çš„ MapReduce å®ç°è¿è¡Œåœ¨è§„æ¨¡å¯ä»¥çµæ´»è°ƒæ•´çš„ç”±æ™®é€šæœºå™¨ç»„æˆçš„é›†ç¾¤ä¸Š:ä¸€ä¸ªå…¸å‹çš„ MapReduce è®¡ç®—å¾€å¾€ç”±å‡ åƒå°æœºå™¨ç»„æˆã€å¤„ç†ä»¥ TB è®¡ç®—çš„æ•°æ®ã€‚ç¨‹åºå‘˜å‘ç°è¿™ä¸ªç³»ç»Ÿéå¸¸å¥½ç”¨:å·²ç»å®ç°äº†æ•°ä»¥ç™¾è®¡ çš„ MapReduce ç¨‹åºï¼Œåœ¨ Google çš„é›†ç¾¤ä¸Šï¼Œæ¯å¤©éƒ½æœ‰ 1000 å¤šä¸ª MapReduce ç¨‹åºåœ¨æ‰§è¡Œã€‚ ä»‹ç»åœ¨è¿‡å»çš„ 5 å¹´é‡Œï¼ŒåŒ…æ‹¬æœ¬æ–‡ä½œè€…åœ¨å†…çš„ Google çš„å¾ˆå¤šç¨‹åºå‘˜ï¼Œä¸ºäº†å¤„ç†æµ·é‡çš„åŸå§‹æ•°æ®ï¼Œå·²ç»å®ç°äº†æ•° ä»¥ç™¾è®¡çš„ã€ä¸“ç”¨çš„è®¡ç®—æ–¹æ³•ã€‚è¿™äº›è®¡ç®—æ–¹æ³•ç”¨æ¥å¤„ç†å¤§é‡çš„åŸå§‹æ•°æ®ï¼Œæ¯”å¦‚ï¼Œæ–‡æ¡£æŠ“å–(ç±»ä¼¼ç½‘ç»œçˆ¬è™«çš„ç¨‹ åº)ã€Web è¯·æ±‚æ—¥å¿—ç­‰ç­‰;ä¹Ÿä¸ºäº†è®¡ç®—å¤„ç†å„ç§ç±»å‹çš„è¡ç”Ÿæ•°æ®ï¼Œæ¯”å¦‚å€’æ’ç´¢å¼•ã€Web æ–‡æ¡£çš„å›¾ç»“æ„çš„å„ç§è¡¨ ç¤ºå½¢åŠ¿ã€æ¯å°ä¸»æœºä¸Šç½‘ç»œçˆ¬è™«æŠ“å–çš„é¡µé¢æ•°é‡çš„æ±‡æ€»ã€æ¯å¤©è¢«è¯·æ±‚çš„æœ€å¤šçš„æŸ¥è¯¢çš„é›†åˆç­‰ç­‰ã€‚å¤§å¤šæ•°è¿™æ ·çš„ æ•°æ®å¤„ç†è¿ç®—åœ¨æ¦‚å¿µä¸Šå¾ˆå®¹æ˜“ç†è§£ã€‚ç„¶è€Œç”±äºè¾“å…¥çš„æ•°æ®é‡å·¨å¤§ï¼Œå› æ­¤è¦æƒ³åœ¨å¯æ¥å—çš„æ—¶é—´å†…å®Œæˆè¿ç®—ï¼Œåª æœ‰å°†è¿™äº›è®¡ç®—åˆ†å¸ƒåœ¨æˆç™¾ä¸Šåƒçš„ä¸»æœºä¸Šã€‚å¦‚ä½•å¤„ç†å¹¶è¡Œè®¡ç®—ã€å¦‚ä½•åˆ†å‘æ•°æ®ã€å¦‚ä½•å¤„ç†é”™è¯¯?æ‰€æœ‰è¿™äº›é—®é¢˜ ç»¼åˆåœ¨ä¸€èµ·ï¼Œéœ€è¦å¤§é‡çš„ä»£ç å¤„ç†ï¼Œå› æ­¤ä¹Ÿä½¿å¾—åŸæœ¬ç®€å•çš„è¿ç®—å˜å¾—éš¾ä»¥å¤„ç†ã€‚ ä¸ºäº†è§£å†³ä¸Šè¿°å¤æ‚çš„é—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªæ–°çš„æŠ½è±¡æ¨¡å‹ï¼Œä½¿ç”¨è¿™ä¸ªæŠ½è±¡æ¨¡å‹ï¼Œæˆ‘ä»¬åªè¦è¡¨è¿°æˆ‘ä»¬æƒ³è¦æ‰§ è¡Œçš„ç®€å•è¿ç®—å³å¯ï¼Œè€Œä¸å¿…å…³å¿ƒå¹¶è¡Œè®¡ç®—ã€å®¹é”™ã€æ•°æ®åˆ†å¸ƒã€è´Ÿè½½å‡è¡¡ç­‰å¤æ‚çš„ç»†èŠ‚ï¼Œè¿™äº›é—®é¢˜éƒ½è¢«å°è£…åœ¨ äº†ä¸€ä¸ªåº“é‡Œé¢ã€‚è®¾è®¡è¿™ä¸ªæŠ½è±¡æ¨¡å‹çš„çµæ„Ÿæ¥è‡ª Lisp å’Œè®¸å¤šå…¶ä»–å‡½æ•°å¼è¯­è¨€çš„ Map å’Œ Reduce çš„åŸè¯­ã€‚æˆ‘ä»¬æ„ è¯†åˆ°æˆ‘ä»¬å¤§å¤šæ•°çš„è¿ç®—éƒ½åŒ…å«è¿™æ ·çš„æ“ä½œ:åœ¨è¾“å…¥æ•°æ®çš„â€œé€»è¾‘â€è®°å½•ä¸Šåº”ç”¨ Map æ“ä½œå¾—å‡ºä¸€ä¸ªä¸­é—´ key/value pair é›†åˆï¼Œç„¶ååœ¨æ‰€æœ‰å…·æœ‰ç›¸åŒ key å€¼çš„ value å€¼ä¸Šåº”ç”¨ Reduce æ“ä½œï¼Œä»è€Œè¾¾åˆ°åˆå¹¶ä¸­é—´çš„æ•°æ®ï¼Œå¾—åˆ°ä¸€ä¸ªæƒ³è¦çš„ç»“æœçš„ç›®çš„ã€‚ä½¿ç”¨ MapReduce æ¨¡å‹ï¼Œå†ç»“åˆç”¨æˆ·å®ç°çš„ Map å’Œ Reduce å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥éå¸¸å®¹æ˜“çš„ å®ç°å¤§è§„æ¨¡å¹¶è¡ŒåŒ–è®¡ç®—;é€šè¿‡ MapReduce æ¨¡å‹è‡ªå¸¦çš„â€œå†æ¬¡æ‰§è¡Œâ€(re-execution)åŠŸèƒ½ï¼Œä¹Ÿæä¾›äº†åˆçº§çš„å®¹ç¾å®ç°æ–¹æ¡ˆã€‚ è¿™ä¸ªå·¥ä½œ(å®ç°ä¸€ä¸ª MapReduce æ¡†æ¶æ¨¡å‹)çš„ä¸»è¦è´¡çŒ®æ˜¯é€šè¿‡ç®€å•çš„æ¥å£æ¥å®ç°è‡ªåŠ¨çš„å¹¶è¡ŒåŒ–å’Œå¤§è§„æ¨¡çš„åˆ†å¸ƒå¼è®¡ç®—ï¼Œé€šè¿‡ä½¿ç”¨ MapReduce æ¨¡å‹æ¥å£å®ç°åœ¨å¤§é‡æ™®é€šçš„ PC æœºä¸Šé«˜æ€§èƒ½è®¡ç®—ã€‚ ç¬¬äºŒéƒ¨åˆ†æè¿°åŸºæœ¬çš„ç¼–ç¨‹æ¨¡å‹å’Œä¸€äº›ä½¿ç”¨æ¡ˆä¾‹ã€‚ ç¬¬ä¸‰éƒ¨åˆ†æè¿°äº†ä¸€ä¸ªç»è¿‡è£å‰ªçš„ã€é€‚åˆæˆ‘ä»¬çš„åŸºäºé›†ç¾¤çš„è®¡ç®—ç¯å¢ƒçš„ MapReduce å®ç°ã€‚ ç¬¬å››éƒ¨åˆ†æè¿°æˆ‘ä»¬è®¤ä¸ºåœ¨ MapReduce ç¼–ç¨‹æ¨¡å‹ä¸­ä¸€äº›å®ç”¨çš„æŠ€å·§ã€‚ ç¬¬äº”éƒ¨åˆ†å¯¹äºå„ç§ä¸åŒçš„ä»»åŠ¡ï¼Œæµ‹é‡æˆ‘ä»¬ MapReduce å®ç°çš„æ€§èƒ½ã€‚ ç¬¬å…­éƒ¨åˆ†æ­ç¤ºäº†åœ¨ Google å†…éƒ¨å¦‚ä½•ä½¿ç”¨ MapReduce ä½œä¸ºåŸºç¡€é‡å†™æˆ‘ä»¬çš„ç´¢å¼•ç³»ç»Ÿäº§å“ï¼ŒåŒ…æ‹¬å…¶å®ƒä¸€äº› ä½¿ç”¨ MapReduce çš„ç»éªŒã€‚ ç¬¬ä¸ƒéƒ¨åˆ†è®¨è®ºç›¸å…³çš„å’Œæœªæ¥çš„å·¥ä½œã€‚ ç¼–ç¨‹æ¨¡å‹ MapReduce ç¼–ç¨‹æ¨¡å‹çš„åŸç†æ˜¯:åˆ©ç”¨ä¸€ä¸ªè¾“å…¥ key/value pair é›†åˆæ¥äº§ç”Ÿä¸€ä¸ªè¾“å‡ºçš„ key/value pair é›†åˆã€‚ MapReduce åº“çš„ç”¨æˆ·ç”¨ä¸¤ä¸ªå‡½æ•°è¡¨è¾¾è¿™ä¸ªè®¡ç®—:Map å’Œ Reduceã€‚ ç”¨æˆ·è‡ªå®šä¹‰çš„ Map å‡½æ•°æ¥å—ä¸€ä¸ªè¾“å…¥çš„ key/value pair å€¼ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ªä¸­é—´ key/value pair å€¼çš„é›†åˆã€‚ MapReduce åº“æŠŠæ‰€æœ‰å…·æœ‰ç›¸åŒä¸­é—´ key å€¼ I çš„ä¸­é—´ value å€¼é›†åˆåœ¨ä¸€èµ·åä¼ é€’ç»™ reduce å‡½æ•°ã€‚ ç”¨æˆ·è‡ªå®šä¹‰çš„ Reduce å‡½æ•°æ¥å—ä¸€ä¸ªä¸­é—´ key çš„å€¼ I å’Œç›¸å…³çš„ä¸€ä¸ª value å€¼çš„é›†åˆã€‚Reduce å‡½æ•°åˆå¹¶è¿™äº› value å€¼ï¼Œå½¢æˆä¸€ä¸ªè¾ƒå°çš„ value å€¼çš„é›†åˆã€‚ä¸€èˆ¬çš„ï¼Œæ¯æ¬¡ Reduce å‡½æ•°è°ƒç”¨åªäº§ç”Ÿ 0 æˆ– 1 ä¸ªè¾“å‡º value å€¼ã€‚é€š å¸¸æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨æŠŠä¸­é—´ value å€¼æä¾›ç»™ Reduce å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¤„ç†æ— æ³•å…¨éƒ¨æ”¾å…¥å†…å­˜ä¸­çš„å¤§é‡ çš„ value å€¼çš„é›†åˆã€‚ ä¾‹å­ä¾‹å¦‚ï¼Œè®¡ç®—ä¸€ä¸ªå¤§çš„æ–‡æ¡£é›†åˆä¸­æ¯ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°ï¼Œä¸‹é¢æ˜¯ä¼ªä»£ç æ®µ: `map(String key, String value): // key: document name // value: document contents for each word w in value: EmitIntermediate(w, â€œ1â€²â€²); reduce(String key, Iterator values): // key: a word // values: a list of counts int result = 0; for each v in values: result += ParseInt(v); Emit(AsString(result));12Map å‡½æ•°è¾“å‡ºæ–‡æ¡£ä¸­çš„æ¯ä¸ªè¯ã€ä»¥åŠè¿™ä¸ªè¯çš„å‡ºç°æ¬¡æ•°(åœ¨è¿™ä¸ªç®€å•çš„ä¾‹å­é‡Œå°±æ˜¯ 1)ã€‚Reduce å‡½æ•°æŠŠ Map å‡½æ•°äº§ç”Ÿçš„æ¯ä¸€ä¸ªç‰¹å®šçš„è¯çš„è®¡æ•°ç´¯åŠ èµ·æ¥ã€‚ å¦å¤–ï¼Œç”¨æˆ·ç¼–å†™ä»£ç ï¼Œä½¿ç”¨è¾“å…¥å’Œè¾“å‡ºæ–‡ä»¶çš„åå­—ã€å¯é€‰çš„è°ƒèŠ‚å‚æ•°æ¥å®Œæˆä¸€ä¸ªç¬¦åˆ MapReduce æ¨¡å‹è§„ èŒƒçš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ MapReduce å‡½æ•°ï¼Œå¹¶æŠŠè¿™ä¸ªè§„èŒƒå¯¹è±¡ä¼ é€’ç»™å®ƒã€‚ç”¨æˆ·çš„ä»£ç å’Œ MapReduce åº“é“¾æ¥åœ¨ä¸€èµ· (ç”¨ C++å®ç°)ã€‚é™„å½• A åŒ…å«äº†è¿™ä¸ªå®ä¾‹çš„å…¨éƒ¨ç¨‹åºä»£ç ã€‚ ### ç±»å‹ å°½ç®¡åœ¨å‰é¢ä¾‹å­çš„ä¼ªä»£ç ä¸­ä½¿ç”¨äº†ä»¥å­—ç¬¦ä¸²è¡¨ç¤ºçš„è¾“å…¥è¾“å‡ºå€¼ï¼Œä½†æ˜¯åœ¨æ¦‚å¿µä¸Šï¼Œç”¨æˆ·å®šä¹‰çš„ Map å’Œ Reduce å‡½æ•°éƒ½æœ‰ç›¸å…³è”çš„ç±»å‹: map(k1,v1) -&gt;list(k2,v2)reduce(k2,list(v2)) -&gt;list(v2)1234567891011121314 æ¯”å¦‚ï¼Œè¾“å…¥çš„ key å’Œ value å€¼ä¸è¾“å‡ºçš„ key å’Œ value å€¼åœ¨ç±»å‹ä¸Šæ¨å¯¼çš„åŸŸä¸åŒã€‚æ­¤å¤–ï¼Œä¸­é—´ key å’Œ value å€¼ä¸è¾“å‡º key å’Œ value å€¼åœ¨ç±»å‹ä¸Šæ¨å¯¼çš„åŸŸç›¸åŒã€‚ æˆ‘ä»¬çš„ C++ä¸­ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹ä½œä¸ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°çš„è¾“å…¥è¾“å‡ºï¼Œç”¨æˆ·åœ¨è‡ªå·±çš„ä»£ç ä¸­å¯¹å­—ç¬¦ä¸²è¿›è¡Œé€‚å½“ çš„ç±»å‹è½¬æ¢ã€‚ ### æ›´å¤šçš„ä¾‹å­ è¿™é‡Œè¿˜æœ‰ä¸€äº›æœ‰è¶£çš„ç®€å•ä¾‹å­ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„ä½¿ç”¨ MapReduce æ¨¡å‹æ¥è¡¨ç¤º: åˆ†å¸ƒå¼çš„ Grep:Map å‡½æ•°è¾“å‡ºåŒ¹é…æŸä¸ªæ¨¡å¼çš„ä¸€è¡Œï¼ŒReduce å‡½æ•°æ˜¯ä¸€ä¸ªæ’ç­‰å‡½æ•°ï¼Œå³æŠŠä¸­é—´æ•°æ®å¤åˆ¶åˆ° è¾“å‡ºã€‚ è®¡ç®— URL è®¿é—®é¢‘ç‡:Map å‡½æ•°å¤„ç†æ—¥å¿—ä¸­ web é¡µé¢è¯·æ±‚çš„è®°å½•ï¼Œç„¶åè¾“å‡º(URL,1)ã€‚Reduce å‡½æ•°æŠŠç›¸åŒURL çš„ value å€¼éƒ½ç´¯åŠ èµ·æ¥ï¼Œäº§ç”Ÿ(URL,è®°å½•æ€»æ•°)ç»“æœã€‚ å€’è½¬ç½‘ç»œé“¾æ¥å›¾:Map å‡½æ•°åœ¨æºé¡µé¢(source)ä¸­æœç´¢æ‰€æœ‰çš„é“¾æ¥ç›®æ ‡(target)å¹¶è¾“å‡ºä¸º(target,source)ã€‚Reduce å‡½æ•°æŠŠç»™å®šé“¾æ¥ç›®æ ‡(target)çš„é“¾æ¥ç»„åˆæˆä¸€ä¸ªåˆ—è¡¨ï¼Œè¾“å‡º(target,list(source))ã€‚ æ¯ä¸ªä¸»æœºçš„æ£€ç´¢è¯å‘é‡:æ£€ç´¢è¯å‘é‡ç”¨ä¸€ä¸ª(è¯,é¢‘ç‡)åˆ—è¡¨æ¥æ¦‚è¿°å‡ºç°åœ¨æ–‡æ¡£æˆ–æ–‡æ¡£é›†ä¸­çš„æœ€é‡è¦çš„ä¸€äº› è¯ã€‚Map å‡½æ•°ä¸ºæ¯ä¸€ä¸ªè¾“å…¥æ–‡æ¡£è¾“å‡º(ä¸»æœºå,æ£€ç´¢è¯å‘é‡)ï¼Œå…¶ä¸­ä¸»æœºåæ¥è‡ªæ–‡æ¡£çš„ URLã€‚Reduce å‡½æ•°æ¥æ”¶ç»™ å®šä¸»æœºçš„æ‰€æœ‰æ–‡æ¡£çš„æ£€ç´¢è¯å‘é‡ï¼Œå¹¶æŠŠè¿™äº›æ£€ç´¢è¯å‘é‡åŠ åœ¨ä¸€èµ·ï¼Œä¸¢å¼ƒæ‰ä½é¢‘çš„æ£€ç´¢è¯ï¼Œè¾“å‡ºä¸€ä¸ªæœ€ç»ˆçš„(ä¸» æœºå,æ£€ç´¢è¯å‘é‡)ã€‚ å€’æ’ç´¢å¼•:Map å‡½æ•°åˆ†ææ¯ä¸ªæ–‡æ¡£è¾“å‡ºä¸€ä¸ª(è¯,æ–‡æ¡£å·)çš„åˆ—è¡¨ï¼ŒReduce å‡½æ•°çš„è¾“å…¥æ˜¯ä¸€ä¸ªç»™å®šè¯çš„æ‰€æœ‰ (è¯ï¼Œæ–‡æ¡£å·)ï¼Œæ’åºæ‰€æœ‰çš„æ–‡æ¡£å·ï¼Œè¾“å‡º(è¯,list(æ–‡æ¡£å·))ã€‚æ‰€æœ‰çš„è¾“å‡ºé›†åˆå½¢æˆä¸€ä¸ªç®€å•çš„å€’æ’ç´¢å¼•ï¼Œå®ƒ ä»¥ä¸€ç§ç®€å•çš„ç®—æ³•è·Ÿè¸ªè¯åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®ã€‚ åˆ†å¸ƒå¼æ’åº:Map å‡½æ•°ä»æ¯ä¸ªè®°å½•æå– keyï¼Œè¾“å‡º(key,record)ã€‚Reduce å‡½æ•°ä¸æ”¹å˜ä»»ä½•çš„å€¼ã€‚è¿™ä¸ªè¿ç®— ä¾èµ–åˆ†åŒºæœºåˆ¶(åœ¨ 4.1 æè¿°)å’Œæ’åºå±æ€§(åœ¨ 4.2 æè¿°)ã€‚ &#123;% note info %&#125;## å®ç° &#123;% endnote %&#125; MapReduce æ¨¡å‹å¯ä»¥æœ‰å¤šç§ä¸åŒçš„å®ç°æ–¹å¼ã€‚å¦‚ä½•æ­£ç¡®é€‰æ‹©å–å†³äºå…·ä½“çš„ç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œä¸€ç§å®ç°æ–¹å¼é€‚ ç”¨äºå°å‹çš„å…±äº«å†…å­˜æ–¹å¼çš„æœºå™¨ï¼Œå¦å¤–ä¸€ç§å®ç°æ–¹å¼åˆ™é€‚ç”¨äºå¤§å‹ NUMA æ¶æ„çš„å¤šå¤„ç†å™¨çš„ä¸»æœºï¼Œè€Œæœ‰çš„å® ç°æ–¹å¼æ›´é€‚åˆå¤§å‹çš„ç½‘ç»œè¿æ¥é›†ç¾¤ã€‚ æœ¬ç« èŠ‚æè¿°ä¸€ä¸ªé€‚ç”¨äº Google å†…éƒ¨å¹¿æ³›ä½¿ç”¨çš„è¿ç®—ç¯å¢ƒçš„å®ç°:ç”¨ä»¥å¤ªç½‘äº¤æ¢æœºè¿æ¥ã€ç”±æ™®é€š PC æœºç»„ æˆçš„å¤§å‹é›†ç¾¤ã€‚åœ¨æˆ‘ä»¬çš„ç¯å¢ƒé‡ŒåŒ…æ‹¬: 1. x86 æ¶æ„ã€è¿è¡Œ Linux æ“ä½œç³»ç»Ÿã€åŒå¤„ç†å™¨ã€2-4GB å†…å­˜çš„æœºå™¨ã€‚ 2. æ™®é€šçš„ç½‘ç»œç¡¬ä»¶è®¾å¤‡ï¼Œæ¯ä¸ªæœºå™¨çš„å¸¦å®½ä¸ºç™¾å…†æˆ–è€…åƒå…†ï¼Œä½†æ˜¯è¿œå°äºç½‘ç»œçš„å¹³å‡å¸¦å®½çš„ä¸€åŠã€‚ 3. é›†ç¾¤ä¸­åŒ…å«æˆç™¾ä¸Šåƒçš„æœºå™¨ï¼Œå› æ­¤ï¼Œæœºå™¨æ•…éšœæ˜¯å¸¸æ€ã€‚ 4. å­˜å‚¨ä¸ºå»‰ä»·çš„å†…ç½® IDE ç¡¬ç›˜ã€‚ä¸€ä¸ªå†…éƒ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿç”¨æ¥ç®¡ç†å­˜å‚¨åœ¨è¿™äº›ç£ç›˜ä¸Šçš„æ•°æ®ã€‚æ–‡ä»¶ç³» ç»Ÿé€šè¿‡æ•°æ®å¤åˆ¶æ¥åœ¨ä¸å¯é çš„ç¡¬ä»¶ä¸Šä¿è¯æ•°æ®çš„å¯é æ€§å’Œæœ‰æ•ˆæ€§ã€‚ 5. ç”¨æˆ·æäº¤å·¥ä½œ(job)ç»™è°ƒåº¦ç³»ç»Ÿã€‚æ¯ä¸ªå·¥ä½œ(job)éƒ½åŒ…å«ä¸€ç³»åˆ—çš„ä»»åŠ¡(task)ï¼Œè°ƒåº¦ç³»ç»Ÿå°†è¿™äº›ä»» åŠ¡è°ƒåº¦åˆ°é›†ç¾¤ä¸­å¤šå°å¯ç”¨çš„æœºå™¨ä¸Šã€‚ ### æ‰§è¡Œæ¦‚æ‹¬ é€šè¿‡å°† Map è°ƒç”¨çš„è¾“å…¥æ•°æ®è‡ªåŠ¨åˆ†å‰²ä¸º M ä¸ªæ•°æ®ç‰‡æ®µçš„é›†åˆï¼ŒMap è°ƒç”¨è¢«åˆ†å¸ƒåˆ°å¤šå°æœºå™¨ä¸Šæ‰§è¡Œã€‚è¾“ å…¥çš„æ•°æ®ç‰‡æ®µèƒ½å¤Ÿåœ¨ä¸åŒçš„æœºå™¨ä¸Šå¹¶è¡Œå¤„ç†ã€‚ä½¿ç”¨åˆ†åŒºå‡½æ•°å°† Map è°ƒç”¨äº§ç”Ÿçš„ä¸­é—´ key å€¼åˆ†æˆ R ä¸ªä¸åŒåˆ†åŒº(ä¾‹å¦‚ï¼Œhash(key) mod R)ï¼ŒReduce è°ƒç”¨ä¹Ÿè¢«åˆ†å¸ƒåˆ°å¤šå°æœºå™¨ä¸Šæ‰§è¡Œã€‚åˆ†åŒºæ•°é‡(R)å’Œåˆ†åŒºå‡½æ•°ç”±ç”¨æˆ·æ¥æŒ‡å®šã€‚![](http://oliji9s3j.bkt.clouddn.com/15133908393351.jpg) å›¾ 1 å±•ç¤ºäº†æˆ‘ä»¬çš„ MapReduce å®ç°ä¸­æ“ä½œçš„å…¨éƒ¨æµç¨‹ã€‚å½“ç”¨æˆ·è°ƒç”¨ MapReduce å‡½æ•°æ—¶ï¼Œå°†å‘ç”Ÿä¸‹é¢çš„ä¸€ ç³»åˆ—åŠ¨ä½œ(ä¸‹é¢çš„åºå·å’Œå›¾ 1 ä¸­çš„åºå·ä¸€ä¸€å¯¹åº”): 1. ç”¨æˆ·ç¨‹åºé¦–å…ˆè°ƒç”¨çš„ MapReduce åº“å°†è¾“å…¥æ–‡ä»¶åˆ†æˆ M ä¸ªæ•°æ®ç‰‡åº¦ï¼Œæ¯ä¸ªæ•°æ®ç‰‡æ®µçš„å¤§å°ä¸€èˆ¬ä» 16MB åˆ° 64MB(å¯ä»¥é€šè¿‡å¯é€‰çš„å‚æ•°æ¥æ§åˆ¶æ¯ä¸ªæ•°æ®ç‰‡æ®µçš„å¤§å°)ã€‚ç„¶åç”¨æˆ·ç¨‹åºåœ¨æœºç¾¤ä¸­åˆ›å»ºå¤§é‡ çš„ç¨‹åºå‰¯æœ¬ã€‚ 2. è¿™äº›ç¨‹åºå‰¯æœ¬ä¸­çš„æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç¨‹åºâ€“masterã€‚å‰¯æœ¬ä¸­å…¶å®ƒçš„ç¨‹åºéƒ½æ˜¯ worker ç¨‹åºï¼Œç”± master åˆ†é… ä»»åŠ¡ã€‚æœ‰ M ä¸ª Map ä»»åŠ¡å’Œ R ä¸ª Reduce ä»»åŠ¡å°†è¢«åˆ†é…ï¼Œmaster å°†ä¸€ä¸ª Map ä»»åŠ¡æˆ– Reduce ä»»åŠ¡åˆ†é… ç»™ä¸€ä¸ªç©ºé—²çš„ workerã€‚ 3. è¢«åˆ†é…äº† map ä»»åŠ¡çš„ worker ç¨‹åºè¯»å–ç›¸å…³çš„è¾“å…¥æ•°æ®ç‰‡æ®µï¼Œä»è¾“å…¥çš„æ•°æ®ç‰‡æ®µä¸­è§£æå‡º key/value pairï¼Œç„¶åæŠŠ key/value pair ä¼ é€’ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„ Map å‡½æ•°ï¼Œç”± Map å‡½æ•°ç”Ÿæˆå¹¶è¾“å‡ºçš„ä¸­é—´ key/value pairï¼Œå¹¶ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ 4. ç¼“å­˜ä¸­çš„ key/value pair é€šè¿‡åˆ†åŒºå‡½æ•°åˆ†æˆ R ä¸ªåŒºåŸŸï¼Œä¹‹åå‘¨æœŸæ€§çš„å†™å…¥åˆ°æœ¬åœ°ç£ç›˜ä¸Šã€‚ç¼“å­˜çš„ key/value pair åœ¨æœ¬åœ°ç£ç›˜ä¸Šçš„å­˜å‚¨ä½ç½®å°†è¢«å›ä¼ ç»™ masterï¼Œç”± master è´Ÿè´£æŠŠè¿™äº›å­˜å‚¨ä½ç½®å†ä¼ é€ç»™ Reduce workerã€‚ 5. å½“ Reduce worker ç¨‹åºæ¥æ”¶åˆ° master ç¨‹åºå‘æ¥çš„æ•°æ®å­˜å‚¨ä½ç½®ä¿¡æ¯åï¼Œä½¿ç”¨ RPC ä» Map worker æ‰€åœ¨ ä¸»æœºçš„ç£ç›˜ä¸Šè¯»å–è¿™äº›ç¼“å­˜æ•°æ®ã€‚å½“ Reduce worker è¯»å–äº†æ‰€æœ‰çš„ä¸­é—´æ•°æ®åï¼Œé€šè¿‡å¯¹ key è¿›è¡Œæ’åºåä½¿å¾—å…·æœ‰ç›¸åŒ key å€¼çš„æ•°æ®èšåˆåœ¨ä¸€èµ·ã€‚ç”±äºè®¸å¤šä¸åŒçš„ key å€¼ä¼šæ˜ å°„åˆ°ç›¸åŒçš„ Reduce ä»»åŠ¡ä¸Šï¼Œå› æ­¤å¿…é¡»è¿›è¡Œæ’åºã€‚å¦‚æœä¸­é—´æ•°æ®å¤ªå¤§æ— æ³•åœ¨å†…å­˜ä¸­å®Œæˆæ’åºï¼Œé‚£ä¹ˆå°±è¦åœ¨å¤–éƒ¨è¿›è¡Œæ’åºã€‚ 6. Reduce worker ç¨‹åºéå†æ’åºåçš„ä¸­é—´æ•°æ®ï¼Œå¯¹äºæ¯ä¸€ä¸ªå”¯ä¸€çš„ä¸­é—´ key å€¼ï¼ŒReduce worker ç¨‹åºå°†è¿™ ä¸ª key å€¼å’Œå®ƒç›¸å…³çš„ä¸­é—´ value å€¼çš„é›†åˆä¼ é€’ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„ Reduce å‡½æ•°ã€‚Reduce å‡½æ•°çš„è¾“å‡ºè¢«è¿½åŠ åˆ°æ‰€å±åˆ†åŒºçš„è¾“å‡ºæ–‡ä»¶ã€‚ 7. å½“æ‰€æœ‰çš„ Map å’Œ Reduce ä»»åŠ¡éƒ½å®Œæˆä¹‹åï¼Œmaster å”¤é†’ç”¨æˆ·ç¨‹åºã€‚åœ¨è¿™ä¸ªæ—¶å€™ï¼Œåœ¨ç”¨æˆ·ç¨‹åºé‡Œçš„å¯¹MapReduce è°ƒç”¨æ‰è¿”å›ã€‚ åœ¨æˆåŠŸå®Œæˆä»»åŠ¡ä¹‹åï¼ŒMapReduce çš„è¾“å‡ºå­˜æ”¾åœ¨ R ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­(å¯¹åº”æ¯ä¸ª Reduce ä»»åŠ¡äº§ç”Ÿä¸€ä¸ªè¾“å‡º æ–‡ä»¶ï¼Œæ–‡ä»¶åç”±ç”¨æˆ·æŒ‡å®š)ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¸éœ€è¦å°†è¿™ R ä¸ªè¾“å‡ºæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶â€“ä»–ä»¬ç»å¸¸æŠŠè¿™äº›æ–‡ ä»¶ä½œä¸ºå¦å¤–ä¸€ä¸ª MapReduce çš„è¾“å…¥ï¼Œæˆ–è€…åœ¨å¦å¤–ä¸€ä¸ªå¯ä»¥å¤„ç†å¤šä¸ªåˆ†å‰²æ–‡ä»¶çš„åˆ†å¸ƒå¼åº”ç”¨ä¸­ä½¿ç”¨ã€‚ ### Master æ•°æ®ç»“æ„ Master æŒæœ‰ä¸€äº›æ•°æ®ç»“æ„ï¼Œå®ƒå­˜å‚¨æ¯ä¸€ä¸ª Map å’Œ Reduce ä»»åŠ¡çš„çŠ¶æ€(ç©ºé—²ã€å·¥ä½œä¸­æˆ–å®Œæˆ)ï¼Œä»¥åŠ Worker æœºå™¨(éç©ºé—²ä»»åŠ¡çš„æœºå™¨)çš„æ ‡è¯†ã€‚ Master å°±åƒä¸€ä¸ªæ•°æ®ç®¡é“ï¼Œä¸­é—´æ–‡ä»¶å­˜å‚¨åŒºåŸŸçš„ä½ç½®ä¿¡æ¯é€šè¿‡è¿™ä¸ªç®¡é“ä» Map ä¼ é€’åˆ° Reduceã€‚å› æ­¤ï¼Œ å¯¹äºæ¯ä¸ªå·²ç»å®Œæˆçš„ Map ä»»åŠ¡ï¼Œmaster å­˜å‚¨äº† Map ä»»åŠ¡äº§ç”Ÿçš„ R ä¸ªä¸­é—´æ–‡ä»¶å­˜å‚¨åŒºåŸŸçš„å¤§å°å’Œä½ç½®ã€‚å½“ Map ä»»åŠ¡å®Œæˆæ—¶ï¼ŒMaster æ¥æ”¶åˆ°ä½ç½®å’Œå¤§å°çš„æ›´æ–°ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«é€æ­¥é€’å¢çš„æ¨é€ç»™é‚£äº›æ­£åœ¨å·¥ä½œçš„ Reduce ä»» åŠ¡ã€‚ ### å®¹é”™ å› ä¸º MapReduce åº“çš„è®¾è®¡åˆè¡·æ˜¯ä½¿ç”¨ç”±æˆç™¾ä¸Šåƒçš„æœºå™¨ç»„æˆçš„é›†ç¾¤æ¥å¤„ç†è¶…å¤§è§„æ¨¡çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ª åº“å¿…é¡»è¦èƒ½å¾ˆå¥½çš„å¤„ç†æœºå™¨æ•…éšœã€‚ #### worker æ•…éšœ master å‘¨æœŸæ€§çš„ ping æ¯ä¸ª workerã€‚å¦‚æœåœ¨ä¸€ä¸ªçº¦å®šçš„æ—¶é—´èŒƒå›´å†…æ²¡æœ‰æ”¶åˆ° worker è¿”å›çš„ä¿¡æ¯ï¼Œmaster å°† æŠŠè¿™ä¸ª worker æ ‡è®°ä¸ºå¤±æ•ˆã€‚æ‰€æœ‰ç”±è¿™ä¸ªå¤±æ•ˆçš„ worker å®Œæˆçš„ Map ä»»åŠ¡è¢«é‡è®¾ä¸ºåˆå§‹çš„ç©ºé—²çŠ¶æ€ï¼Œä¹‹åè¿™äº› ä»»åŠ¡å°±å¯ä»¥è¢«å®‰æ’ç»™å…¶ä»–çš„ workerã€‚åŒæ ·çš„ï¼Œworker å¤±æ•ˆæ—¶æ­£åœ¨è¿è¡Œçš„ Map æˆ– Reduce ä»»åŠ¡ä¹Ÿå°†è¢«é‡æ–°ç½®ä¸º ç©ºé—²çŠ¶æ€ï¼Œç­‰å¾…é‡æ–°è°ƒåº¦ã€‚ å½“ worker æ•…éšœæ—¶ï¼Œç”±äºå·²ç»å®Œæˆçš„ Map ä»»åŠ¡çš„è¾“å‡ºå­˜å‚¨åœ¨è¿™å°æœºå™¨ä¸Šï¼ŒMap ä»»åŠ¡çš„è¾“å‡ºå·²ä¸å¯è®¿é—®äº†,å› æ­¤å¿…é¡»é‡æ–°æ‰§è¡Œã€‚è€Œå·²ç»å®Œæˆçš„ Reduce ä»»åŠ¡çš„è¾“å‡ºå­˜å‚¨åœ¨å…¨å±€æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œå› æ­¤ä¸éœ€è¦å†æ¬¡æ‰§è¡Œã€‚ å½“ä¸€ä¸ª Map ä»»åŠ¡é¦–å…ˆè¢« worker A æ‰§è¡Œï¼Œä¹‹åç”±äº worker A å¤±æ•ˆäº†åˆè¢«è°ƒåº¦åˆ° worker B æ‰§è¡Œï¼Œè¿™ä¸ªâ€œé‡ æ–°æ‰§è¡Œâ€çš„åŠ¨ä½œä¼šè¢«é€šçŸ¥ç»™æ‰€æœ‰æ‰§è¡Œ Reduce ä»»åŠ¡çš„ workerã€‚ä»»ä½•è¿˜æ²¡æœ‰ä» worker A è¯»å–æ•°æ®çš„ Reduce ä»»åŠ¡ å°†ä» worker B è¯»å–æ•°æ®ã€‚ MapReduce å¯ä»¥å¤„ç†å¤§è§„æ¨¡ worker å¤±æ•ˆçš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ª MapReduce æ“ä½œæ‰§è¡ŒæœŸé—´ï¼Œåœ¨æ­£åœ¨è¿è¡Œ çš„é›†ç¾¤ä¸Šè¿›è¡Œç½‘ç»œç»´æŠ¤å¼•èµ· 80 å°æœºå™¨åœ¨å‡ åˆ†é’Ÿå†…ä¸å¯è®¿é—®äº†ï¼ŒMapReduce master åªéœ€è¦ç®€å•çš„å†æ¬¡æ‰§è¡Œé‚£äº› ä¸å¯è®¿é—®çš„ worker å®Œæˆçš„å·¥ä½œï¼Œä¹‹åç»§ç»­æ‰§è¡Œæœªå®Œæˆçš„ä»»åŠ¡ï¼Œç›´åˆ°æœ€ç»ˆå®Œæˆè¿™ä¸ª MapReduce æ“ä½œã€‚ #### master å¤±è´¥ ä¸€ä¸ªç®€å•çš„è§£å†³åŠæ³•æ˜¯è®© master å‘¨æœŸæ€§çš„å°†ä¸Šé¢æè¿°çš„æ•°æ®ç»“æ„(alex æ³¨:æŒ‡ 3.2 èŠ‚)çš„å†™å…¥ç£ç›˜ï¼Œå³ æ£€æŸ¥ç‚¹(checkpoint)ã€‚å¦‚æœè¿™ä¸ª master ä»»åŠ¡å¤±æ•ˆäº†ï¼Œå¯ä»¥ä»æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹(checkpoint)å¼€å§‹å¯åŠ¨å¦ä¸€ä¸ª master è¿›ç¨‹ã€‚ç„¶è€Œï¼Œç”±äºåªæœ‰ä¸€ä¸ª master è¿›ç¨‹ï¼Œmaster å¤±æ•ˆåå†æ¢å¤æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå› æ­¤æˆ‘ä»¬ç°åœ¨çš„å®ç°æ˜¯ å¦‚æœ master å¤±æ•ˆï¼Œå°±ä¸­æ­¢ MapReduce è¿ç®—ã€‚å®¢æˆ·å¯ä»¥æ£€æŸ¥åˆ°è¿™ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦é‡æ–°æ‰§è¡Œ MapReduce æ“ä½œã€‚ #### åœ¨å¤±æ•ˆæ–¹é¢çš„å¤„ç†æœºåˆ¶ (æ³¨:åŸæ–‡ä¸ºâ€semantics in the presence of failuresâ€) å½“ç”¨æˆ·æä¾›çš„ Map å’Œ Reduce æ“ä½œæ˜¯è¾“å…¥ç¡®å®šæ€§å‡½æ•°(å³ç›¸åŒçš„è¾“å…¥äº§ç”Ÿç›¸åŒçš„è¾“å‡º)æ—¶ï¼Œæˆ‘ä»¬çš„åˆ†å¸ƒ å¼å®ç°åœ¨ä»»ä½•æƒ…å†µä¸‹çš„è¾“å‡ºéƒ½å’Œæ‰€æœ‰ç¨‹åºæ²¡æœ‰å‡ºç°ä»»ä½•é”™è¯¯ã€é¡ºåºçš„æ‰§è¡Œäº§ç”Ÿçš„è¾“å‡ºæ˜¯ä¸€æ ·çš„ã€‚ æˆ‘ä»¬ä¾èµ–å¯¹ Map å’Œ Reduce ä»»åŠ¡çš„è¾“å‡ºæ˜¯åŸå­æäº¤çš„æ¥å®Œæˆè¿™ä¸ªç‰¹æ€§ã€‚æ¯ä¸ªå·¥ä½œä¸­çš„ä»»åŠ¡æŠŠå®ƒçš„è¾“å‡ºå†™ åˆ°ç§æœ‰çš„ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚æ¯ä¸ª Reduce ä»»åŠ¡ç”Ÿæˆä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶ï¼Œè€Œæ¯ä¸ª Map ä»»åŠ¡åˆ™ç”Ÿæˆ R ä¸ªè¿™æ ·çš„æ–‡ä»¶(ä¸€ ä¸ª Reduce ä»»åŠ¡å¯¹åº”ä¸€ä¸ªæ–‡ä»¶)ã€‚å½“ä¸€ä¸ª Map ä»»åŠ¡å®Œæˆçš„æ—¶ï¼Œworker å‘é€ä¸€ä¸ªåŒ…å« R ä¸ªä¸´æ—¶æ–‡ä»¶åçš„å®Œæˆæ¶ˆæ¯ ç»™ masterã€‚å¦‚æœ master ä»ä¸€ä¸ªå·²ç»å®Œæˆçš„ Map ä»»åŠ¡å†æ¬¡æ¥æ”¶åˆ°åˆ°ä¸€ä¸ªå®Œæˆæ¶ˆæ¯ï¼Œmaster å°†å¿½ç•¥è¿™ä¸ªæ¶ˆæ¯;å¦ åˆ™ï¼Œmaster å°†è¿™ R ä¸ªæ–‡ä»¶çš„åå­—è®°å½•åœ¨æ•°æ®ç»“æ„é‡Œã€‚ å½“ Reduce ä»»åŠ¡å®Œæˆæ—¶ï¼ŒReduce worker è¿›ç¨‹ä»¥åŸå­çš„æ–¹å¼æŠŠä¸´æ—¶æ–‡ä»¶é‡å‘½åä¸ºæœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶ã€‚å¦‚æœåŒ ä¸€ä¸ª Reduce ä»»åŠ¡åœ¨å¤šå°æœºå™¨ä¸Šæ‰§è¡Œï¼Œé’ˆå¯¹åŒä¸€ä¸ªæœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶å°†æœ‰å¤šä¸ªé‡å‘½åæ“ä½œæ‰§è¡Œã€‚æˆ‘ä»¬ä¾èµ–åº•å±‚æ–‡ ä»¶ç³»ç»Ÿæä¾›çš„é‡å‘½åæ“ä½œçš„åŸå­æ€§æ¥ä¿è¯æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»ŸçŠ¶æ€ä»…ä»…åŒ…å«ä¸€ä¸ª Reduce ä»»åŠ¡äº§ç”Ÿçš„æ•°æ®ã€‚ ä½¿ç”¨ MapReduce æ¨¡å‹çš„ç¨‹åºå‘˜å¯ä»¥å¾ˆå®¹æ˜“çš„ç†è§£ä»–ä»¬ç¨‹åºçš„è¡Œä¸ºï¼Œå› ä¸ºæˆ‘ä»¬ç»å¤§å¤šæ•°çš„ Map å’Œ Reduce æ“ä½œæ˜¯ç¡®å®šæ€§çš„ï¼Œè€Œä¸”å­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªäº‹å®:æˆ‘ä»¬çš„å¤±æ•ˆå¤„ç†æœºåˆ¶ç­‰ä»·äºä¸€ä¸ªé¡ºåºçš„æ‰§è¡Œçš„æ“ä½œã€‚å½“ Map æˆ– /å’Œ Reduce æ“ä½œæ˜¯ä¸ç¡®å®šæ€§çš„æ—¶å€™ï¼Œæˆ‘ä»¬æä¾›è™½ç„¶è¾ƒå¼±ä½†æ˜¯ä¾ç„¶åˆç†çš„å¤„ç†æœºåˆ¶ã€‚å½“ä½¿ç”¨éç¡®å®šæ“ä½œçš„æ—¶å€™ï¼Œ ä¸€ä¸ª Reduce ä»»åŠ¡ R1 çš„è¾“å‡ºç­‰ä»·äºä¸€ä¸ªéç¡®å®šæ€§ç¨‹åºé¡ºåºæ‰§è¡Œäº§ç”Ÿæ—¶çš„è¾“å‡ºã€‚ä½†æ˜¯ï¼Œå¦ä¸€ä¸ª Reduce ä»»åŠ¡ R2 çš„è¾“å‡ºä¹Ÿè®¸ç¬¦åˆä¸€ä¸ªä¸åŒçš„éç¡®å®šé¡ºåºç¨‹åºæ‰§è¡Œäº§ç”Ÿçš„ R2 çš„è¾“å‡ºã€‚ è€ƒè™‘ Map ä»»åŠ¡ M å’Œ Reduce ä»»åŠ¡ R1ã€R2 çš„æƒ…å†µã€‚æˆ‘ä»¬è®¾å®š e(Ri)æ˜¯ Ri å·²ç»æäº¤çš„æ‰§è¡Œè¿‡ç¨‹(æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªè¿™æ ·çš„æ‰§è¡Œè¿‡ç¨‹)ã€‚å½“ e(R1)è¯»å–äº†ç”± M ä¸€æ¬¡æ‰§è¡Œäº§ç”Ÿçš„è¾“å‡ºï¼Œè€Œ e(R2)è¯»å–äº†ç”± M çš„å¦ä¸€æ¬¡æ‰§è¡Œäº§ç”Ÿçš„ è¾“å‡ºï¼Œå¯¼è‡´äº†è¾ƒå¼±çš„å¤±æ•ˆå¤„ç†ã€‚ ### å­˜å‚¨ä½ç½® åœ¨æˆ‘ä»¬çš„è®¡ç®—è¿è¡Œç¯å¢ƒä¸­ï¼Œç½‘ç»œå¸¦å®½æ˜¯ä¸€ä¸ªç›¸å½“åŒ®ä¹çš„èµ„æºã€‚æˆ‘ä»¬é€šè¿‡å°½é‡æŠŠè¾“å…¥æ•°æ®(ç”± GFS ç®¡ç†)å­˜ å‚¨åœ¨é›†ç¾¤ä¸­æœºå™¨çš„æœ¬åœ°ç£ç›˜ä¸Šæ¥èŠ‚çœç½‘ç»œå¸¦å®½ã€‚GFS æŠŠæ¯ä¸ªæ–‡ä»¶æŒ‰ 64MB ä¸€ä¸ª Block åˆ†éš”ï¼Œæ¯ä¸ª Block ä¿å­˜ åœ¨å¤šå°æœºå™¨ä¸Šï¼Œç¯å¢ƒä¸­å°±å­˜æ”¾äº†å¤šä»½æ‹·è´(ä¸€èˆ¬æ˜¯ 3 ä¸ªæ‹·è´)ã€‚MapReduce çš„ master åœ¨è°ƒåº¦ Map ä»»åŠ¡æ—¶ä¼šè€ƒè™‘ è¾“å…¥æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯ï¼Œå°½é‡å°†ä¸€ä¸ª Map ä»»åŠ¡è°ƒåº¦åœ¨åŒ…å«ç›¸å…³è¾“å…¥æ•°æ®æ‹·è´çš„æœºå™¨ä¸Šæ‰§è¡Œ;å¦‚æœä¸Šè¿°åŠªåŠ›å¤±è´¥ äº†ï¼Œmaster å°†å°è¯•åœ¨ä¿å­˜æœ‰è¾“å…¥æ•°æ®æ‹·è´çš„æœºå™¨é™„è¿‘çš„æœºå™¨ä¸Šæ‰§è¡Œ Map ä»»åŠ¡(ä¾‹å¦‚ï¼Œåˆ†é…åˆ°ä¸€ä¸ªå’ŒåŒ…å«è¾“å…¥æ•° æ®çš„æœºå™¨åœ¨ä¸€ä¸ª switch é‡Œçš„ worker æœºå™¨ä¸Šæ‰§è¡Œ)ã€‚å½“åœ¨ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ cluster é›†ç¾¤ä¸Šè¿è¡Œå¤§å‹ MapReduce æ“ä½œ çš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†çš„è¾“å…¥æ•°æ®éƒ½èƒ½ä»æœ¬åœ°æœºå™¨è¯»å–ï¼Œå› æ­¤æ¶ˆè€—éå¸¸å°‘çš„ç½‘ç»œå¸¦å®½ã€‚ ### ä»»åŠ¡ç²’åº¦ å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬æŠŠ Map æ‹†åˆ†æˆäº† M ä¸ªç‰‡æ®µã€æŠŠ Reduce æ‹†åˆ†æˆ R ä¸ªç‰‡æ®µæ‰§è¡Œã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ŒM å’Œ R åº”å½“ æ¯”é›†ç¾¤ä¸­ worker çš„æœºå™¨æ•°é‡è¦å¤šå¾—å¤šã€‚åœ¨æ¯å° worker æœºå™¨éƒ½æ‰§è¡Œå¤§é‡çš„ä¸åŒä»»åŠ¡èƒ½å¤Ÿæé«˜é›†ç¾¤çš„åŠ¨æ€çš„è´Ÿè½½ å‡è¡¡èƒ½åŠ›ï¼Œå¹¶ä¸”èƒ½å¤ŸåŠ å¿«æ•…éšœæ¢å¤çš„é€Ÿåº¦:å¤±æ•ˆæœºå™¨ä¸Šæ‰§è¡Œçš„å¤§é‡ Map ä»»åŠ¡éƒ½å¯ä»¥åˆ†å¸ƒåˆ°æ‰€æœ‰å…¶ä»–çš„ worker æœºå™¨ä¸Šå»æ‰§è¡Œã€‚ ä½†æ˜¯å®é™…ä¸Šï¼Œåœ¨æˆ‘ä»¬çš„å…·ä½“å®ç°ä¸­å¯¹ M å’Œ R çš„å–å€¼éƒ½æœ‰ä¸€å®šçš„å®¢è§‚é™åˆ¶ï¼Œå› ä¸º master å¿…é¡»æ‰§è¡Œ O(M+R) æ¬¡è°ƒåº¦ï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­ä¿å­˜ O(M*R)ä¸ªçŠ¶æ€(å¯¹å½±å“å†…å­˜ä½¿ç”¨çš„å› ç´ è¿˜æ˜¯æ¯”è¾ƒå°çš„:O(M*R)å—çŠ¶æ€ï¼Œå¤§æ¦‚æ¯ å¯¹ Map ä»»åŠ¡/Reduce ä»»åŠ¡ 1 ä¸ªå­—èŠ‚å°±å¯ä»¥äº†)ã€‚ æ›´è¿›ä¸€æ­¥ï¼ŒR å€¼é€šå¸¸æ˜¯ç”±ç”¨æˆ·æŒ‡å®šçš„ï¼Œå› ä¸ºæ¯ä¸ª Reduce ä»»åŠ¡æœ€ç»ˆéƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„è¾“å‡ºæ–‡ä»¶ã€‚å®é™…ä½¿ ç”¨æ—¶æˆ‘ä»¬ä¹Ÿå€¾å‘äºé€‰æ‹©åˆé€‚çš„ M å€¼ï¼Œä»¥ä½¿å¾—æ¯ä¸€ä¸ªç‹¬ç«‹ä»»åŠ¡éƒ½æ˜¯å¤„ç†å¤§çº¦ 16M åˆ° 64M çš„è¾“å…¥æ•°æ®(è¿™æ ·ï¼Œ ä¸Šé¢æå†™çš„è¾“å…¥æ•°æ®æœ¬åœ°å­˜å‚¨ä¼˜åŒ–ç­–ç•¥æ‰æœ€æœ‰æ•ˆ)ï¼Œå¦å¤–ï¼Œæˆ‘ä»¬æŠŠ R å€¼è®¾ç½®ä¸ºæˆ‘ä»¬æƒ³ä½¿ç”¨çš„ worker æœºå™¨æ•°é‡ çš„å°çš„å€æ•°ã€‚æˆ‘ä»¬é€šå¸¸ä¼šç”¨è¿™æ ·çš„æ¯”ä¾‹æ¥æ‰§è¡Œ MapReduce:M=200000ï¼ŒR=5000ï¼Œä½¿ç”¨ 2000 å° worker æœºå™¨ã€‚ ### å¤‡ç”¨ä»»åŠ¡ å½±å“ä¸€ä¸ª MapReduce çš„æ€»æ‰§è¡Œæ—¶é—´æœ€é€šå¸¸çš„å› ç´ æ˜¯â€œè½ä¼è€…â€:åœ¨è¿ç®—è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ä¸€å°æœºå™¨èŠ±äº†å¾ˆ é•¿çš„æ—¶é—´æ‰å®Œæˆæœ€åå‡ ä¸ª Map æˆ– Reduce ä»»åŠ¡ï¼Œå¯¼è‡´ MapReduce æ“ä½œæ€»çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡é¢„æœŸã€‚å‡ºç°â€œè½ä¼è€…â€ çš„åŸå› éå¸¸å¤šã€‚æ¯”å¦‚:å¦‚æœä¸€ä¸ªæœºå™¨çš„ç¡¬ç›˜å‡ºäº†é—®é¢˜ï¼Œåœ¨è¯»å–çš„æ—¶å€™è¦ç»å¸¸çš„è¿›è¡Œè¯»å–çº é”™æ“ä½œï¼Œå¯¼è‡´è¯»å–æ•°æ®çš„é€Ÿåº¦ä» 30M/s é™ä½åˆ° 1M/sã€‚å¦‚æœ cluster çš„è°ƒåº¦ç³»ç»Ÿåœ¨è¿™å°æœºå™¨ä¸Šåˆè°ƒåº¦äº†å…¶ä»–çš„ä»»åŠ¡ï¼Œç”±äº CPUã€å†… å­˜ã€æœ¬åœ°ç¡¬ç›˜å’Œç½‘ç»œå¸¦å®½ç­‰ç«äº‰å› ç´ çš„å­˜åœ¨ï¼Œå¯¼è‡´æ‰§è¡Œ MapReduce ä»£ç çš„æ‰§è¡Œæ•ˆç‡æ›´åŠ ç¼“æ…¢ã€‚æˆ‘ä»¬æœ€è¿‘é‡åˆ° çš„ä¸€ä¸ªé—®é¢˜æ˜¯ç”±äºæœºå™¨çš„åˆå§‹åŒ–ä»£ç æœ‰ bugï¼Œå¯¼è‡´å…³é—­äº†çš„å¤„ç†å™¨çš„ç¼“å­˜:åœ¨è¿™äº›æœºå™¨ä¸Šæ‰§è¡Œä»»åŠ¡çš„æ€§èƒ½å’Œ æ­£å¸¸æƒ…å†µç›¸å·®ä¸Šç™¾å€ã€‚ æˆ‘ä»¬æœ‰ä¸€ä¸ªé€šç”¨çš„æœºåˆ¶æ¥å‡å°‘â€œè½ä¼è€…â€å‡ºç°çš„æƒ…å†µã€‚å½“ä¸€ä¸ª MapReduce æ“ä½œæ¥è¿‘å®Œæˆçš„æ—¶å€™ï¼Œmaster è°ƒåº¦å¤‡ç”¨(backup)ä»»åŠ¡è¿›ç¨‹æ¥æ‰§è¡Œå‰©ä¸‹çš„ã€å¤„äºå¤„ç†ä¸­çŠ¶æ€(in-progress)çš„ä»»åŠ¡ã€‚æ— è®ºæ˜¯æœ€åˆçš„æ‰§è¡Œè¿›ç¨‹ã€ è¿˜æ˜¯å¤‡ç”¨(backup)ä»»åŠ¡è¿›ç¨‹å®Œæˆäº†ä»»åŠ¡ï¼Œæˆ‘ä»¬éƒ½æŠŠè¿™ä¸ªä»»åŠ¡æ ‡è®°æˆä¸ºå·²ç»å®Œæˆã€‚æˆ‘ä»¬è°ƒä¼˜äº†è¿™ä¸ªæœºåˆ¶ï¼Œé€š å¸¸åªä¼šå ç”¨æ¯”æ­£å¸¸æ“ä½œå¤šå‡ ä¸ªç™¾åˆ†ç‚¹çš„è®¡ç®—èµ„æºã€‚æˆ‘ä»¬å‘ç°é‡‡ç”¨è¿™æ ·çš„æœºåˆ¶å¯¹äºå‡å°‘è¶…å¤§ MapReduce æ“ä½œçš„ æ€»å¤„ç†æ—¶é—´æ•ˆæœæ˜¾è‘—ã€‚ä¾‹å¦‚ï¼Œåœ¨ 5.3 èŠ‚æè¿°çš„æ’åºä»»åŠ¡ï¼Œåœ¨å…³é—­æ‰å¤‡ç”¨ä»»åŠ¡çš„æƒ…å†µä¸‹è¦å¤šèŠ± 44%çš„æ—¶é—´å®Œæˆ æ’åºä»»åŠ¡ã€‚ &#123;% note info %&#125;## æŠ€å·§ &#123;% endnote %&#125; è™½ç„¶ç®€å•çš„ Map å’Œ Reduce å‡½æ•°æä¾›çš„åŸºæœ¬åŠŸèƒ½å·²ç»èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†çš„è®¡ç®—éœ€è¦ï¼Œæˆ‘ä»¬è¿˜æ˜¯å‘æ˜å‡ºäº†ä¸€ äº›æœ‰ä»·å€¼çš„æ‰©å±•åŠŸèƒ½ã€‚æœ¬èŠ‚å°†æè¿°è¿™äº›æ‰©å±•åŠŸèƒ½ã€‚ ### åˆ†åŒºå‡½æ•° MapReduce çš„ä½¿ç”¨è€…é€šå¸¸ä¼šæŒ‡å®š Reduce ä»»åŠ¡å’Œ Reduce ä»»åŠ¡è¾“å‡ºæ–‡ä»¶çš„æ•°é‡(R)ã€‚æˆ‘ä»¬åœ¨ä¸­é—´ key ä¸Šä½¿ ç”¨åˆ†åŒºå‡½æ•°æ¥å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œä¹‹åå†è¾“å…¥åˆ°åç»­ä»»åŠ¡æ‰§è¡Œè¿›ç¨‹ã€‚ä¸€ä¸ªç¼ºçœçš„åˆ†åŒºå‡½æ•°æ˜¯ä½¿ç”¨ hash æ–¹æ³•(æ¯”å¦‚ï¼Œ hash(key) mod R)è¿›è¡Œåˆ†åŒºã€‚hash æ–¹æ³•èƒ½äº§ç”Ÿéå¸¸å¹³è¡¡çš„åˆ†åŒºã€‚ç„¶è€Œï¼Œæœ‰çš„æ—¶å€™ï¼Œå…¶å®ƒçš„ä¸€äº›åˆ†åŒºå‡½æ•°å¯¹ key å€¼è¿›è¡Œçš„åˆ†åŒºå°†éå¸¸æœ‰ç”¨ã€‚æ¯”å¦‚ï¼Œè¾“å‡ºçš„ key å€¼æ˜¯ URLsï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªä¸»æœºçš„æ‰€æœ‰æ¡ç›®ä¿æŒåœ¨åŒä¸€ä¸ªè¾“å‡ºæ–‡ ä»¶ä¸­ã€‚ä¸ºäº†æ”¯æŒç±»ä¼¼çš„æƒ…å†µï¼ŒMapReduce åº“çš„ç”¨æˆ·éœ€è¦æä¾›ä¸“é—¨çš„åˆ†åŒºå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨â€œhash(Hostname(urlkey)) mod Râ€ä½œä¸ºåˆ†åŒºå‡½æ•°å°±å¯ä»¥æŠŠæ‰€æœ‰æ¥è‡ªåŒä¸€ä¸ªä¸»æœºçš„ URLs ä¿å­˜åœ¨åŒä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­ã€‚ ### é¡ºåºä¿è¯ æˆ‘ä»¬ç¡®ä¿åœ¨ç»™å®šçš„åˆ†åŒºä¸­ï¼Œä¸­é—´ key/value pair æ•°æ®çš„å¤„ç†é¡ºåºæ˜¯æŒ‰ç…§ key å€¼å¢é‡é¡ºåºå¤„ç†çš„ã€‚è¿™æ ·çš„é¡º åºä¿è¯å¯¹æ¯ä¸ªåˆ†æˆç”Ÿæˆä¸€ä¸ªæœ‰åºçš„è¾“å‡ºæ–‡ä»¶ï¼Œè¿™å¯¹äºéœ€è¦å¯¹è¾“å‡ºæ–‡ä»¶æŒ‰ key å€¼éšæœºå­˜å–çš„åº”ç”¨éå¸¸æœ‰æ„ä¹‰ï¼Œ å¯¹åœ¨æ’åºè¾“å‡ºçš„æ•°æ®é›†ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚ ### Combiner å‡½æ•° åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒMap å‡½æ•°äº§ç”Ÿçš„ä¸­é—´ key å€¼çš„é‡å¤æ•°æ®ä¼šå å¾ˆå¤§çš„æ¯”é‡ï¼Œå¹¶ä¸”ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„ Reduce å‡½ æ•°æ»¡è¶³ç»“åˆå¾‹å’Œäº¤æ¢å¾‹ã€‚åœ¨ 2.1 èŠ‚çš„è¯æ•°ç»Ÿè®¡ç¨‹åºæ˜¯ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ç”±äºè¯é¢‘ç‡å€¾å‘äºä¸€ä¸ª zipf åˆ†å¸ƒ(é½å¤«åˆ†å¸ƒ)ï¼Œæ¯ä¸ª Map ä»»åŠ¡å°†äº§ç”Ÿæˆåƒä¸Šä¸‡ä¸ªè¿™æ ·çš„è®°å½•&lt;the,1&gt;ã€‚æ‰€æœ‰çš„è¿™äº›è®°å½•å°†é€šè¿‡ç½‘ç»œè¢«å‘é€åˆ°ä¸€ä¸ªå•ç‹¬çš„ Reduce ä»»åŠ¡ï¼Œç„¶åç”±è¿™ä¸ª Reduce ä»»åŠ¡æŠŠæ‰€æœ‰è¿™äº›è®°å½•ç´¯åŠ èµ·æ¥äº§ç”Ÿä¸€ä¸ªæ•°å­—ã€‚æˆ‘ä»¬å…è®¸ç”¨æˆ·æŒ‡å®šä¸€ä¸ªå¯é€‰ çš„ combiner å‡½æ•°ï¼Œcombiner å‡½æ•°é¦–å…ˆåœ¨æœ¬åœ°å°†è¿™äº›è®°å½•è¿›è¡Œä¸€æ¬¡åˆå¹¶ï¼Œç„¶åå°†åˆå¹¶çš„ç»“æœå†é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ã€‚ Combiner å‡½æ•°åœ¨æ¯å°æ‰§è¡Œ Map ä»»åŠ¡çš„æœºå™¨ä¸Šéƒ½ä¼šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒCombiner å’Œ Reduce å‡½æ•°æ˜¯ä¸€æ ·çš„ã€‚Combiner å‡½æ•°å’Œ Reduce å‡½æ•°ä¹‹é—´å”¯ä¸€çš„åŒºåˆ«æ˜¯ MapReduce åº“æ€æ ·æ§åˆ¶å‡½æ•°çš„è¾“å‡ºã€‚Reduce å‡½æ•°çš„ è¾“å‡ºè¢«ä¿å­˜åœ¨æœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶é‡Œï¼Œè€Œ Combiner å‡½æ•°çš„è¾“å‡ºè¢«å†™åˆ°ä¸­é—´æ–‡ä»¶é‡Œï¼Œç„¶åè¢«å‘é€ç»™ Reduce ä»»åŠ¡ã€‚ éƒ¨åˆ†çš„åˆå¹¶ä¸­é—´ç»“æœå¯ä»¥æ˜¾è‘—çš„æé«˜ä¸€äº› MapReduce æ“ä½œçš„é€Ÿåº¦ã€‚é™„å½• A åŒ…å«ä¸€ä¸ªä½¿ç”¨ combiner å‡½æ•° çš„ä¾‹å­ã€‚ ### è¾“å…¥å’Œè¾“å‡ºçš„ç±»å‹ MapReduce åº“æ”¯æŒå‡ ç§ä¸åŒçš„æ ¼å¼çš„è¾“å…¥æ•°æ®ã€‚æ¯”å¦‚ï¼Œæ–‡æœ¬æ¨¡å¼çš„è¾“å…¥æ•°æ®çš„æ¯ä¸€è¡Œè¢«è§†ä¸ºæ˜¯ä¸€ä¸ª key/value pairã€‚key æ˜¯æ–‡ä»¶çš„åç§»é‡ï¼Œvalue æ˜¯é‚£ä¸€è¡Œçš„å†…å®¹ã€‚å¦å¤–ä¸€ç§å¸¸è§çš„æ ¼å¼æ˜¯ä»¥ key è¿›è¡Œæ’åºæ¥å­˜å‚¨ çš„ key/value pair çš„åºåˆ—ã€‚æ¯ç§è¾“å…¥ç±»å‹çš„å®ç°éƒ½å¿…é¡»èƒ½å¤ŸæŠŠè¾“å…¥æ•°æ®åˆ†å‰²æˆæ•°æ®ç‰‡æ®µï¼Œè¯¥æ•°æ®ç‰‡æ®µèƒ½å¤Ÿç”±å• ç‹¬çš„ Map ä»»åŠ¡æ¥è¿›è¡Œåç»­å¤„ç†(ä¾‹å¦‚ï¼Œæ–‡æœ¬æ¨¡å¼çš„èŒƒå›´åˆ†å‰²å¿…é¡»ç¡®ä¿ä»…ä»…åœ¨æ¯è¡Œçš„è¾¹ç•Œè¿›è¡ŒèŒƒå›´åˆ†å‰²)ã€‚è™½ç„¶ å¤§å¤šæ•° MapReduce çš„ä½¿ç”¨è€…ä»…ä»…ä½¿ç”¨å¾ˆå°‘çš„é¢„å®šä¹‰è¾“å…¥ç±»å‹å°±æ»¡è¶³è¦æ±‚äº†ï¼Œä½†æ˜¯ä½¿ç”¨è€…ä¾ç„¶å¯ä»¥é€šè¿‡æä¾›ä¸€ ä¸ªç®€å•çš„ Reader æ¥å£å®ç°å°±èƒ½å¤Ÿæ”¯æŒä¸€ä¸ªæ–°çš„è¾“å…¥ç±»å‹ã€‚ Reader å¹¶éä¸€å®šè¦ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°ä¸€ä¸ªä»æ•°æ®åº“é‡Œè¯»è®°å½•çš„ Readerï¼Œ æˆ–è€…ä»å†…å­˜ä¸­çš„æ•°æ®ç»“æ„è¯»å–æ•°æ®çš„ Readerã€‚ ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€äº›é¢„å®šä¹‰çš„è¾“å‡ºæ•°æ®çš„ç±»å‹ï¼Œé€šè¿‡è¿™äº›é¢„å®šä¹‰ç±»å‹èƒ½å¤Ÿäº§ç”Ÿä¸åŒæ ¼å¼çš„æ•°æ®ã€‚ç”¨ æˆ·é‡‡ç”¨ç±»ä¼¼æ·»åŠ æ–°çš„è¾“å…¥æ•°æ®ç±»å‹çš„æ–¹å¼å¢åŠ æ–°çš„è¾“å‡ºç±»å‹ã€‚ ### å‰¯ä½œç”¨ åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒMapReduce çš„ä½¿ç”¨è€…å‘ç°ï¼Œå¦‚æœåœ¨ Map å’Œ/æˆ– Reduce æ“ä½œè¿‡ç¨‹ä¸­å¢åŠ è¾…åŠ©çš„è¾“å‡ºæ–‡ä»¶ä¼š æ¯”è¾ƒçœäº‹ã€‚æˆ‘ä»¬ä¾é ç¨‹åº writer æŠŠè¿™ç§â€œå‰¯ä½œç”¨â€å˜æˆåŸå­çš„å’Œå¹‚ç­‰çš„3ã€‚é€šå¸¸åº”ç”¨ç¨‹åºé¦–å…ˆæŠŠè¾“å‡ºç»“æœå†™åˆ° ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œåœ¨è¾“å‡ºå…¨éƒ¨æ•°æ®ä¹‹åï¼Œåœ¨ä½¿ç”¨ç³»ç»Ÿçº§çš„åŸå­æ“ä½œ rename é‡æ–°å‘½åè¿™ä¸ªä¸´æ—¶æ–‡ä»¶ã€‚ å¦‚æœä¸€ä¸ªä»»åŠ¡äº§ç”Ÿäº†å¤šä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾›ç±»ä¼¼ä¸¤é˜¶æ®µæäº¤çš„åŸå­æ“ä½œæ”¯æŒè¿™ç§æƒ…å†µã€‚å› æ­¤ï¼Œå¯¹ äºä¼šäº§ç”Ÿå¤šä¸ªè¾“å‡ºæ–‡ä»¶ã€å¹¶ä¸”å¯¹äºè·¨æ–‡ä»¶æœ‰ä¸€è‡´æ€§è¦æ±‚çš„ä»»åŠ¡ï¼Œéƒ½å¿…é¡»æ˜¯ç¡®å®šæ€§çš„ä»»åŠ¡ã€‚ä½†æ˜¯åœ¨å®é™…åº”ç”¨è¿‡ ç¨‹ä¸­ï¼Œè¿™ä¸ªé™åˆ¶è¿˜æ²¡æœ‰ç»™æˆ‘ä»¬å¸¦æ¥è¿‡éº»çƒ¦ã€‚### è·³è¿‡æŸåçš„è®°å½• æœ‰æ—¶å€™ï¼Œç”¨æˆ·ç¨‹åºä¸­çš„ bug å¯¼è‡´ Map æˆ–è€… Reduce å‡½æ•°åœ¨å¤„ç†æŸäº›è®°å½•çš„æ—¶å€™ crash æ‰ï¼ŒMapReduce æ“ä½œ æ— æ³•é¡ºåˆ©å®Œæˆã€‚æƒ¯å¸¸çš„åšæ³•æ˜¯ä¿®å¤ bug åå†æ¬¡æ‰§è¡Œ MapReduce æ“ä½œï¼Œä½†æ˜¯ï¼Œæœ‰æ—¶å€™æ‰¾å‡ºè¿™äº› bug å¹¶ä¿®å¤å®ƒä»¬ ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…;è¿™äº› bug ä¹Ÿè®¸æ˜¯åœ¨ç¬¬ä¸‰æ–¹åº“é‡Œè¾¹ï¼Œè€Œæˆ‘ä»¬æ‰‹å¤´æ²¡æœ‰è¿™äº›åº“çš„æºä»£ç ã€‚è€Œä¸”åœ¨å¾ˆå¤šæ—¶å€™ï¼Œ å¿½ç•¥ä¸€äº›æœ‰é—®é¢˜çš„è®°å½•ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªå·¨å¤§çš„æ•°æ®é›†ä¸Šè¿›è¡Œç»Ÿè®¡åˆ†æçš„æ—¶å€™ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ç§ æ‰§è¡Œæ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œä¸ºäº†ä¿è¯ä¿è¯æ•´ä¸ªå¤„ç†èƒ½ç»§ç»­è¿›è¡Œï¼ŒMapReduce ä¼šæ£€æµ‹å“ªäº›è®°å½•å¯¼è‡´ç¡®å®šæ€§çš„ crashï¼Œ å¹¶ä¸”è·³è¿‡è¿™äº›è®°å½•ä¸å¤„ç†ã€‚ æ¯ä¸ª worker è¿›ç¨‹éƒ½è®¾ç½®äº†ä¿¡å·å¤„ç†å‡½æ•°æ•è·å†…å­˜æ®µå¼‚å¸¸(segmentation violation)å’Œæ€»çº¿é”™è¯¯(bus error)ã€‚ åœ¨æ‰§è¡Œ Map æˆ–è€… Reduce æ“ä½œä¹‹å‰ï¼ŒMapReduce åº“é€šè¿‡å…¨å±€å˜é‡ä¿å­˜è®°å½•åºå·ã€‚å¦‚æœç”¨æˆ·ç¨‹åºè§¦å‘äº†ä¸€ä¸ªç³» ç»Ÿä¿¡å·ï¼Œæ¶ˆæ¯å¤„ç†å‡½æ•°å°†ç”¨â€œæœ€åä¸€å£æ°”â€é€šè¿‡ UDP åŒ…å‘ master å‘é€å¤„ç†çš„æœ€åä¸€æ¡è®°å½•çš„åºå·ã€‚å½“ master çœ‹åˆ°åœ¨å¤„ç†æŸæ¡ç‰¹å®šè®°å½•ä¸æ­¢å¤±è´¥ä¸€æ¬¡æ—¶ï¼Œmaster å°±æ ‡å¿—ç€æ¡è®°å½•éœ€è¦è¢«è·³è¿‡ï¼Œå¹¶ä¸”åœ¨ä¸‹æ¬¡é‡æ–°æ‰§è¡Œç›¸å…³çš„ Map æˆ–è€… Reduce ä»»åŠ¡çš„æ—¶å€™è·³è¿‡è¿™æ¡è®°å½•ã€‚ ### æœ¬åœ°æ‰§è¡Œ è°ƒè¯• Map å’Œ Reduce å‡½æ•°çš„ bug æ˜¯éå¸¸å›°éš¾çš„ï¼Œå› ä¸ºå®é™…æ‰§è¡Œæ“ä½œæ—¶ä¸ä½†æ˜¯åˆ†å¸ƒåœ¨ç³»ç»Ÿä¸­æ‰§è¡Œçš„ï¼Œè€Œä¸” é€šå¸¸æ˜¯åœ¨å¥½å‡ åƒå°è®¡ç®—æœºä¸Šæ‰§è¡Œï¼Œå…·ä½“çš„æ‰§è¡Œä½ç½®æ˜¯ç”± master è¿›è¡ŒåŠ¨æ€è°ƒåº¦çš„ï¼Œè¿™åˆå¤§å¤§å¢åŠ äº†è°ƒè¯•çš„éš¾åº¦ã€‚ ä¸ºäº†ç®€åŒ–è°ƒè¯•ã€profile å’Œå°è§„æ¨¡æµ‹è¯•ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€å¥— MapReduce åº“çš„æœ¬åœ°å®ç°ç‰ˆæœ¬ï¼Œé€šè¿‡ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬çš„ MapReduce åº“ï¼ŒMapReduce æ“ä½œåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šé¡ºåºçš„æ‰§è¡Œã€‚ç”¨æˆ·å¯ä»¥æ§åˆ¶ MapReduce æ“ä½œçš„æ‰§è¡Œï¼Œå¯ä»¥æŠŠ æ“ä½œé™åˆ¶åˆ°ç‰¹å®šçš„ Map ä»»åŠ¡ä¸Šã€‚ç”¨æˆ·é€šè¿‡è®¾å®šç‰¹åˆ«çš„æ ‡å¿—æ¥åœ¨æœ¬åœ°æ‰§è¡Œä»–ä»¬çš„ç¨‹åºï¼Œä¹‹åå°±å¯ä»¥å¾ˆå®¹æ˜“çš„ä½¿ ç”¨æœ¬åœ°è°ƒè¯•å’Œæµ‹è¯•å·¥å…·(æ¯”å¦‚ gdb)ã€‚ ### çŠ¶æ€ä¿¡æ¯ master ä½¿ç”¨åµŒå…¥å¼çš„ HTTP æœåŠ¡å™¨(å¦‚ Jetty)æ˜¾ç¤ºä¸€ç»„çŠ¶æ€ä¿¡æ¯é¡µé¢ï¼Œç”¨æˆ·å¯ä»¥ç›‘æ§å„ç§æ‰§è¡ŒçŠ¶æ€ã€‚çŠ¶ æ€ä¿¡æ¯é¡µé¢æ˜¾ç¤ºäº†åŒ…æ‹¬è®¡ç®—æ‰§è¡Œçš„è¿›åº¦ï¼Œæ¯”å¦‚å·²ç»å®Œæˆäº†å¤šå°‘ä»»åŠ¡ã€æœ‰å¤šå°‘ä»»åŠ¡æ­£åœ¨å¤„ç†ã€è¾“å…¥çš„å­—èŠ‚æ•°ã€ ä¸­é—´æ•°æ®çš„å­—èŠ‚æ•°ã€è¾“å‡ºçš„å­—èŠ‚æ•°ã€å¤„ç†ç™¾åˆ†æ¯”ç­‰ç­‰ã€‚é¡µé¢è¿˜åŒ…å«äº†æŒ‡å‘æ¯ä¸ªä»»åŠ¡çš„ stderr å’Œ stdout æ–‡ä»¶çš„é“¾ æ¥ã€‚ç”¨æˆ·æ ¹æ®è¿™äº›æ•°æ®é¢„æµ‹è®¡ç®—éœ€è¦æ‰§è¡Œå¤§çº¦å¤šé•¿æ—¶é—´ã€æ˜¯å¦éœ€è¦å¢åŠ é¢å¤–çš„è®¡ç®—èµ„æºã€‚è¿™äº›é¡µé¢ä¹Ÿå¯ä»¥ç”¨ æ¥åˆ†æä»€ä¹ˆæ—¶å€™è®¡ç®—æ‰§è¡Œçš„æ¯”é¢„æœŸçš„è¦æ…¢ã€‚ å¦å¤–ï¼Œå¤„äºæœ€é¡¶å±‚çš„çŠ¶æ€é¡µé¢æ˜¾ç¤ºäº†å“ªäº› worker å¤±æ•ˆäº†ï¼Œä»¥åŠä»–ä»¬å¤±æ•ˆçš„æ—¶å€™æ­£åœ¨è¿è¡Œçš„ Map å’Œ Reduce ä»»åŠ¡ã€‚è¿™äº›ä¿¡æ¯å¯¹äºè°ƒè¯•ç”¨æˆ·ä»£ç ä¸­çš„ bug å¾ˆæœ‰å¸®åŠ©ã€‚### è®¡æ•°å™¨ MapReduce åº“ä½¿ç”¨è®¡æ•°å™¨ç»Ÿè®¡ä¸åŒäº‹ä»¶å‘ç”Ÿæ¬¡æ•°ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·å¯èƒ½æƒ³ç»Ÿè®¡å·²ç»å¤„ç†äº†å¤šå°‘ä¸ªå•è¯ã€å·²ç» ç´¢å¼•çš„å¤šå°‘ç¯‡ German æ–‡æ¡£ç­‰ç­‰ã€‚ ä¸ºäº†ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œç”¨æˆ·åœ¨ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªå‘½åçš„è®¡æ•°å™¨å¯¹è±¡ï¼Œåœ¨ Map å’Œ Reduce å‡½æ•°ä¸­ç›¸åº”çš„å¢åŠ è®¡ æ•°å™¨çš„å€¼ã€‚ä¾‹å¦‚: Counter* uppercase;uppercase = GetCounter(â€œuppercaseâ€);map(String name, String contents): for each word w in contents: if (IsCapitalized(w)): uppercase-&gt;Increment(); EmitIntermediate(w, â€œ1â€²â€²);1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798 è¿™äº›è®¡æ•°å™¨çš„å€¼å‘¨æœŸæ€§çš„ä»å„ä¸ªå•ç‹¬çš„ worker æœºå™¨ä¸Šä¼ é€’ç»™ maste(r é™„åŠ åœ¨ ping çš„åº”ç­”åŒ…ä¸­ä¼ é€’)ã€‚master æŠŠæ‰§è¡ŒæˆåŠŸçš„ Map å’Œ Reduce ä»»åŠ¡çš„è®¡æ•°å™¨å€¼è¿›è¡Œç´¯è®¡ï¼Œå½“ MapReduce æ“ä½œå®Œæˆä¹‹åï¼Œè¿”å›ç»™ç”¨æˆ·ä»£ç ã€‚ è®¡æ•°å™¨å½“å‰çš„å€¼ä¹Ÿä¼šæ˜¾ç¤ºåœ¨ master çš„çŠ¶æ€é¡µé¢ä¸Šï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥çœ‹åˆ°å½“å‰è®¡ç®—çš„è¿›åº¦ã€‚å½“ç´¯åŠ è®¡æ•°å™¨ çš„å€¼çš„æ—¶å€™ï¼Œmaster è¦æ£€æŸ¥é‡å¤è¿è¡Œçš„ Map æˆ–è€… Reduce ä»»åŠ¡ï¼Œé¿å…é‡å¤ç´¯åŠ (ä¹‹å‰æåˆ°çš„å¤‡ç”¨ä»»åŠ¡å’Œå¤±æ•ˆ åé‡æ–°æ‰§è¡Œä»»åŠ¡è¿™ä¸¤ç§æƒ…å†µä¼šå¯¼è‡´ç›¸åŒçš„ä»»åŠ¡è¢«å¤šæ¬¡æ‰§è¡Œ)ã€‚ æœ‰äº›è®¡æ•°å™¨çš„å€¼æ˜¯ç”± MapReduce åº“è‡ªåŠ¨ç»´æŒçš„ï¼Œæ¯”å¦‚å·²ç»å¤„ç†çš„è¾“å…¥çš„ key/value pair çš„æ•°é‡ã€è¾“å‡ºçš„ key/value pair çš„æ•°é‡ç­‰ç­‰ã€‚ è®¡æ•°å™¨æœºåˆ¶å¯¹äº MapReduce æ“ä½œçš„å®Œæ•´æ€§æ£€æŸ¥éå¸¸æœ‰ç”¨ã€‚æ¯”å¦‚ï¼Œåœ¨æŸäº› MapReduce æ“ä½œä¸­ï¼Œç”¨æˆ·éœ€è¦ç¡® ä¿è¾“å‡ºçš„ key value pair ç²¾ç¡®çš„ç­‰äºè¾“å…¥çš„ key value pairï¼Œæˆ–è€…å¤„ç†çš„ German æ–‡æ¡£æ•°é‡åœ¨å¤„ç†çš„æ•´ä¸ªæ–‡æ¡£æ•° é‡ä¸­å±äºåˆç†èŒƒå›´ã€‚ &#123;% note info %&#125;## æ€§èƒ½&#123;% endnote %&#125; æœ¬èŠ‚æˆ‘ä»¬ç”¨åœ¨ä¸€ä¸ªå¤§å‹é›†ç¾¤ä¸Šè¿è¡Œçš„ä¸¤ä¸ªè®¡ç®—æ¥è¡¡é‡ MapReduce çš„æ€§èƒ½ã€‚ä¸€ä¸ªè®¡ç®—åœ¨å¤§çº¦ 1TB çš„æ•°æ®ä¸­ è¿›è¡Œç‰¹å®šçš„æ¨¡å¼åŒ¹é…ï¼Œå¦ä¸€ä¸ªè®¡ç®—å¯¹å¤§çº¦ 1TB çš„æ•°æ®è¿›è¡Œæ’åºã€‚ è¿™ä¸¤ä¸ªç¨‹åºåœ¨å¤§é‡çš„ä½¿ç”¨ MapReduce çš„å®é™…åº”ç”¨ä¸­æ˜¯éå¸¸å…¸å‹çš„ â€” ä¸€ç±»æ˜¯å¯¹æ•°æ®æ ¼å¼è¿›è¡Œè½¬æ¢ï¼Œä»ä¸€ ç§è¡¨ç°å½¢å¼è½¬æ¢ä¸ºå¦å¤–ä¸€ç§è¡¨ç°å½¢å¼;å¦ä¸€ç±»æ˜¯ä»æµ·é‡æ•°æ®ä¸­æŠ½å–å°‘éƒ¨åˆ†çš„ç”¨æˆ·æ„Ÿå…´è¶£çš„æ•°æ®ã€‚ ### é›†ç¾¤é…ç½® æ‰€æœ‰è¿™äº›ç¨‹åºéƒ½è¿è¡Œåœ¨ä¸€ä¸ªå¤§çº¦ç”± 1800 å°æœºå™¨æ„æˆçš„é›†ç¾¤ä¸Šã€‚æ¯å°æœºå™¨é…ç½® 2 ä¸ª 2G ä¸»é¢‘ã€æ”¯æŒè¶…çº¿ç¨‹ çš„ Intel Xeon å¤„ç†å™¨ï¼Œ4GB çš„ç‰©ç†å†…å­˜ï¼Œä¸¤ä¸ª 160GB çš„ IDE ç¡¬ç›˜å’Œä¸€ä¸ªåƒå…†ä»¥å¤ªç½‘å¡ã€‚è¿™äº›æœºå™¨éƒ¨ç½²åœ¨ä¸€ä¸ª ä¸¤å±‚çš„æ ‘å½¢äº¤æ¢ç½‘ç»œä¸­ï¼Œåœ¨ root èŠ‚ç‚¹å¤§æ¦‚æœ‰ 100-200GBPS çš„ä¼ è¾“å¸¦å®½ã€‚æ‰€æœ‰è¿™äº›æœºå™¨éƒ½é‡‡ç”¨ç›¸åŒçš„éƒ¨ç½²(å¯¹ ç­‰éƒ¨ç½²)ï¼Œå› æ­¤ä»»æ„ä¸¤ç‚¹ä¹‹é—´çš„ç½‘ç»œæ¥å›æ—¶é—´å°äº 1 æ¯«ç§’ã€‚ åœ¨ 4GB å†…å­˜é‡Œï¼Œå¤§æ¦‚æœ‰ 1-1.5G ç”¨äºè¿è¡Œåœ¨é›†ç¾¤ä¸Šçš„å…¶ä»–ä»»åŠ¡ã€‚æµ‹è¯•ç¨‹åºåœ¨å‘¨æœ«ä¸‹åˆå¼€å§‹æ‰§è¡Œï¼Œè¿™æ—¶ä¸»æœº çš„ CPUã€ç£ç›˜å’Œç½‘ç»œåŸºæœ¬ä¸Šå¤„äºç©ºé—²çŠ¶æ€ã€‚ ### GREP è¿™ä¸ªåˆ†å¸ƒå¼çš„ grep ç¨‹åºéœ€è¦æ‰«æå¤§æ¦‚ 10 çš„ 10 æ¬¡æ–¹ä¸ªç”± 100 ä¸ªå­—èŠ‚ç»„æˆçš„è®°å½•ï¼ŒæŸ¥æ‰¾å‡ºç°æ¦‚ç‡è¾ƒå°çš„ 3 ä¸ªå­—ç¬¦çš„æ¨¡å¼(è¿™ä¸ªæ¨¡å¼åœ¨ 92337 ä¸ªè®°å½•ä¸­å‡ºç°)ã€‚è¾“å…¥æ•°æ®è¢«æ‹†åˆ†æˆå¤§çº¦ 64M çš„ Block(M=15000)ï¼Œæ•´ä¸ª è¾“å‡ºæ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­(R=1)ã€‚![](http://oliji9s3j.bkt.clouddn.com/15133914679471.jpg) å›¾ 2 æ˜¾ç¤ºäº†è¿™ä¸ªè¿ç®—éšæ—¶é—´çš„å¤„ç†è¿‡ç¨‹ã€‚å…¶ä¸­ Y è½´è¡¨ç¤ºè¾“å…¥æ•°æ®çš„å¤„ç†é€Ÿåº¦ã€‚å¤„ç†é€Ÿåº¦éšç€å‚ä¸ MapReduce è®¡ç®—çš„æœºå™¨æ•°é‡çš„å¢åŠ è€Œå¢åŠ ï¼Œå½“ 1764 å° worker å‚ä¸è®¡ç®—çš„æ—¶ï¼Œå¤„ç†é€Ÿåº¦è¾¾åˆ°äº† 30GB/sã€‚å½“ Map ä»»åŠ¡ç»“æŸçš„æ—¶å€™ï¼Œå³åœ¨è®¡ç®—å¼€å§‹å 80 ç§’ï¼Œè¾“å…¥çš„å¤„ç†é€Ÿåº¦é™åˆ° 0ã€‚æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ä»å¼€å§‹åˆ°ç»“æŸä¸€å…±èŠ±äº† å¤§æ¦‚ 150 ç§’ã€‚è¿™åŒ…æ‹¬äº†å¤§çº¦ä¸€åˆ†é’Ÿçš„åˆå§‹å¯åŠ¨é˜¶æ®µã€‚åˆå§‹å¯åŠ¨é˜¶æ®µæ¶ˆè€—çš„æ—¶é—´åŒ…æ‹¬äº†æ˜¯æŠŠè¿™ä¸ªç¨‹åºä¼ é€åˆ°å„ ä¸ª worker æœºå™¨ä¸Šçš„æ—¶é—´ã€ç­‰å¾… GFS æ–‡ä»¶ç³»ç»Ÿæ‰“å¼€ 1000 ä¸ªè¾“å…¥æ–‡ä»¶é›†åˆçš„æ—¶é—´ã€è·å–ç›¸å…³çš„æ–‡ä»¶æœ¬åœ°ä½ç½®ä¼˜ åŒ–ä¿¡æ¯çš„æ—¶é—´ã€‚ ### æ’åº æ’åºç¨‹åºå¤„ç† 10 çš„ 10 æ¬¡æ–¹ä¸ª 100 ä¸ªå­—èŠ‚ç»„æˆçš„è®°å½•(å¤§æ¦‚ 1TB çš„æ•°æ®)ã€‚è¿™ä¸ªç¨‹åºæ¨¡ä»¿ TeraSort benchmark[10]ã€‚ æ’åºç¨‹åºç”±ä¸åˆ° 50 è¡Œä»£ç ç»„æˆã€‚åªæœ‰ä¸‰è¡Œçš„ Map å‡½æ•°ä»æ–‡æœ¬è¡Œä¸­è§£æå‡º 10 ä¸ªå­—èŠ‚çš„ key å€¼ä½œä¸ºæ’åºçš„ keyï¼Œå¹¶ä¸”æŠŠè¿™ä¸ª key å’ŒåŸå§‹æ–‡æœ¬è¡Œä½œä¸ºä¸­é—´çš„ key/value pair å€¼è¾“å‡ºã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå†…ç½®çš„æ’ç­‰å‡½æ•°ä½œä¸º Reduce æ“ä½œå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æŠŠä¸­é—´çš„ key/value pair å€¼ä¸ä½œä»»ä½•æ”¹å˜è¾“å‡ºã€‚æœ€ç»ˆæ’åºç»“æœè¾“å‡ºåˆ°ä¸¤è·¯å¤åˆ¶çš„GFS æ–‡ä»¶ç³»ç»Ÿ(ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºè¾“å‡º 2TB çš„æ•°æ®)ã€‚ å¦‚å‰æ‰€è¿°ï¼Œè¾“å…¥æ•°æ®è¢«åˆ†æˆ 64MB çš„ Block(M=15000)ã€‚æˆ‘ä»¬æŠŠæ’åºåçš„è¾“å‡ºç»“æœåˆ†åŒºåå­˜å‚¨åˆ° 4000 ä¸ªæ–‡ä»¶(R=4000)ã€‚åˆ†åŒºå‡½æ•°ä½¿ç”¨ key çš„åŸå§‹å­—èŠ‚æ¥æŠŠæ•°æ®åˆ†åŒºåˆ° R ä¸ªç‰‡æ®µä¸­ã€‚ åœ¨è¿™ä¸ª benchmark æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„åˆ†åŒºå‡½æ•°çŸ¥é“ key çš„åˆ†åŒºæƒ…å†µã€‚é€šå¸¸å¯¹äºæ’åºç¨‹åºæ¥è¯´ï¼Œæˆ‘ä»¬ä¼š å¢åŠ ä¸€ä¸ªé¢„å¤„ç†çš„ MapReduce æ“ä½œç”¨äºé‡‡æ · key å€¼çš„åˆ†å¸ƒæƒ…å†µï¼Œé€šè¿‡é‡‡æ ·çš„æ•°æ®æ¥è®¡ç®—å¯¹æœ€ç»ˆæ’åºå¤„ç†çš„åˆ† åŒºç‚¹ã€‚![](http://oliji9s3j.bkt.clouddn.com/15133915176963.jpg) å›¾ä¸‰(a)æ˜¾ç¤ºäº†è¿™ä¸ªæ’åºç¨‹åºçš„æ­£å¸¸æ‰§è¡Œè¿‡ç¨‹ã€‚å·¦ä¸Šçš„å›¾æ˜¾ç¤ºäº†è¾“å…¥æ•°æ®è¯»å–çš„é€Ÿåº¦ã€‚æ•°æ®è¯»å–é€Ÿåº¦å³° å€¼ä¼šè¾¾åˆ° 13GB/sï¼Œå¹¶ä¸”æ‰€æœ‰ Map ä»»åŠ¡å®Œæˆä¹‹åï¼Œå³å¤§çº¦ 200 ç§’ä¹‹åè¿…é€Ÿæ»‘è½åˆ° 0ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ’åºç¨‹åº è¾“å…¥æ•°æ®è¯»å–é€Ÿåº¦å°äºåˆ†å¸ƒå¼ grep ç¨‹åºã€‚è¿™æ˜¯å› ä¸ºæ’åºç¨‹åºçš„ Map ä»»åŠ¡èŠ±äº†å¤§çº¦ä¸€åŠçš„å¤„ç†æ—¶é—´å’Œ I/O å¸¦å®½ æŠŠä¸­é—´è¾“å‡ºç»“æœå†™åˆ°æœ¬åœ°ç¡¬ç›˜ã€‚ç›¸åº”çš„åˆ†å¸ƒå¼ grep ç¨‹åºçš„ä¸­é—´ç»“æœè¾“å‡ºå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ å·¦è¾¹ä¸­é—´çš„å›¾æ˜¾ç¤ºäº†ä¸­é—´æ•°æ®ä» Map ä»»åŠ¡å‘é€åˆ° Reduce ä»»åŠ¡çš„ç½‘ç»œé€Ÿåº¦ã€‚è¿™ä¸ªè¿‡ç¨‹ä»ç¬¬ä¸€ä¸ª Map ä»»åŠ¡ å®Œæˆä¹‹åå°±å¼€å§‹ç¼“æ…¢å¯åŠ¨äº†ã€‚å›¾ç¤ºçš„ç¬¬ä¸€ä¸ªé«˜å³°æ˜¯å¯åŠ¨äº†ç¬¬ä¸€æ‰¹å¤§æ¦‚ 1700 ä¸ª Reduce ä»»åŠ¡(æ•´ä¸ª MapReduce åˆ†å¸ƒåˆ°å¤§æ¦‚ 1700 å°æœºå™¨ä¸Šï¼Œæ¯å°æœºå™¨ 1 æ¬¡æœ€å¤šæ‰§è¡Œ 1 ä¸ª Reduce ä»»åŠ¡)ã€‚æ’åºç¨‹åºè¿è¡Œå¤§çº¦ 300 ç§’åï¼Œç¬¬ä¸€æ‰¹ å¯åŠ¨çš„ Reduce ä»»åŠ¡æœ‰äº›å®Œæˆäº†ï¼Œæˆ‘ä»¬å¼€å§‹æ‰§è¡Œå‰©ä¸‹çš„ Reduce ä»»åŠ¡ã€‚æ‰€æœ‰çš„å¤„ç†åœ¨å¤§çº¦ 600 ç§’åç»“æŸã€‚å·¦ä¸‹å›¾è¡¨ç¤º Reduce ä»»åŠ¡æŠŠæ’åºåçš„æ•°æ®å†™åˆ°æœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶çš„é€Ÿåº¦ã€‚åœ¨ç¬¬ä¸€ä¸ªæ’åºé˜¶æ®µç»“æŸå’Œæ•°æ®å¼€å§‹ å†™å…¥ç£ç›˜ä¹‹é—´æœ‰ä¸€ä¸ªå°çš„å»¶æ—¶ï¼Œè¿™æ˜¯å› ä¸º worker æœºå™¨æ­£åœ¨å¿™äºæ’åºä¸­é—´æ•°æ®ã€‚ç£ç›˜å†™å…¥é€Ÿåº¦åœ¨ 2-4GB/s æŒç»­ ä¸€æ®µæ—¶é—´ã€‚è¾“å‡ºæ•°æ®å†™å…¥ç£ç›˜å¤§çº¦æŒç»­ 850 ç§’ã€‚è®¡å…¥åˆå§‹å¯åŠ¨éƒ¨åˆ†çš„æ—¶é—´ï¼Œæ•´ä¸ªè¿ç®—æ¶ˆè€—äº† 891 ç§’ã€‚è¿™ä¸ªé€Ÿ åº¦å’Œ TeraSort benchmark[18]çš„æœ€é«˜çºªå½• 1057 ç§’ç›¸å·®ä¸å¤šã€‚ è¿˜æœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„ç°è±¡:è¾“å…¥æ•°æ®çš„è¯»å–é€Ÿåº¦æ¯”æ’åºé€Ÿåº¦å’Œè¾“å‡ºæ•°æ®å†™å…¥ç£ç›˜é€Ÿåº¦è¦é«˜ä¸å°‘ï¼Œè¿™æ˜¯å›  ä¸ºæˆ‘ä»¬çš„è¾“å…¥æ•°æ®æœ¬åœ°åŒ–ä¼˜åŒ–ç­–ç•¥èµ·äº†ä½œç”¨ â€” ç»å¤§éƒ¨åˆ†æ•°æ®éƒ½æ˜¯ä»æœ¬åœ°ç¡¬ç›˜è¯»å–çš„ï¼Œä»è€ŒèŠ‚çœäº†ç½‘ç»œå¸¦å®½ã€‚ æ’åºé€Ÿåº¦æ¯”è¾“å‡ºæ•°æ®å†™å…¥åˆ°ç£ç›˜çš„é€Ÿåº¦å¿«ï¼Œè¿™æ˜¯å› ä¸ºè¾“å‡ºæ•°æ®å†™äº†ä¸¤ä»½(æˆ‘ä»¬ä½¿ç”¨äº† 2 è·¯çš„ GFS æ–‡ä»¶ç³»ç»Ÿï¼Œ å†™å…¥å¤åˆ¶èŠ‚ç‚¹çš„åŸå› æ˜¯ä¸ºäº†ä¿è¯æ•°æ®å¯é æ€§å’Œå¯ç”¨æ€§)ã€‚æˆ‘ä»¬æŠŠè¾“å‡ºæ•°æ®å†™å…¥åˆ°ä¸¤ä¸ªå¤åˆ¶èŠ‚ç‚¹çš„åŸå› æ˜¯å› ä¸ºè¿™ æ˜¯åº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„ä¿è¯æ•°æ®å¯é æ€§å’Œå¯ç”¨æ€§çš„å®ç°æœºåˆ¶ã€‚å¦‚æœåº•å±‚æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ç±»ä¼¼å®¹é”™ç¼–ç [14](erasure coding)çš„æ–¹å¼è€Œä¸æ˜¯å¤åˆ¶çš„æ–¹å¼ä¿è¯æ•°æ®çš„å¯é æ€§å’Œå¯ç”¨æ€§ï¼Œé‚£ä¹ˆåœ¨è¾“å‡ºæ•°æ®å†™å…¥ç£ç›˜çš„æ—¶å€™ï¼Œå°±å¯ä»¥é™ä½ ç½‘ç»œå¸¦å®½çš„ä½¿ç”¨ã€‚ ### é«˜æ•ˆçš„ backup ä»»åŠ¡ å›¾ä¸‰(b)æ˜¾ç¤ºäº†å…³é—­äº†å¤‡ç”¨ä»»åŠ¡åæ’åºç¨‹åºæ‰§è¡Œæƒ…å†µã€‚æ‰§è¡Œçš„è¿‡ç¨‹å’Œå›¾ 3(a)å¾ˆç›¸ä¼¼ï¼Œé™¤äº†è¾“å‡ºæ•°æ®å†™ ç£ç›˜çš„åŠ¨ä½œåœ¨æ—¶é—´ä¸Šæ‹–äº†ä¸€ä¸ªå¾ˆé•¿çš„å°¾å·´ï¼Œè€Œä¸”åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œå‡ ä¹æ²¡æœ‰ä»€ä¹ˆå†™å…¥åŠ¨ä½œã€‚åœ¨ 960 ç§’åï¼Œåªæœ‰ 5 ä¸ª Reduce ä»»åŠ¡æ²¡æœ‰å®Œæˆã€‚è¿™äº›æ‹–åè…¿çš„ä»»åŠ¡åˆæ‰§è¡Œäº† 300 ç§’æ‰å®Œæˆã€‚æ•´ä¸ªè®¡ç®—æ¶ˆè€—äº† 1283 ç§’ï¼Œå¤šäº† 44% çš„æ‰§è¡Œæ—¶é—´ã€‚ ### å¤±æ•ˆçš„æœºå™¨ åœ¨å›¾ä¸‰(c)ä¸­æ¼”ç¤ºçš„æ’åºç¨‹åºæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ç¨‹åºå¼€å§‹åå‡ åˆ†é’Ÿæœ‰æ„çš„ kill äº† 1746 ä¸ª worker ä¸­ çš„ 200 ä¸ªã€‚é›†ç¾¤åº•å±‚çš„è°ƒåº¦ç«‹åˆ»åœ¨è¿™äº›æœºå™¨ä¸Šé‡æ–°å¼€å§‹æ–°çš„ worker å¤„ç†è¿›ç¨‹(å› ä¸ºåªæ˜¯ worker æœºå™¨ä¸Šçš„å¤„ç† è¿›ç¨‹è¢« kill äº†ï¼Œæœºå™¨æœ¬èº«è¿˜åœ¨å·¥ä½œ)ã€‚ å›¾ä¸‰(c)æ˜¾ç¤ºå‡ºäº†ä¸€ä¸ªâ€œè´Ÿâ€çš„è¾“å…¥æ•°æ®è¯»å–é€Ÿåº¦ï¼Œè¿™æ˜¯å› ä¸ºä¸€äº›å·²ç»å®Œæˆçš„ Map ä»»åŠ¡ä¸¢å¤±äº†(ç”±äº ç›¸åº”çš„æ‰§è¡Œ Map ä»»åŠ¡çš„ worker è¿›ç¨‹è¢« kill äº†)ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚ç›¸å…³ Map ä»»åŠ¡å¾ˆå¿«å°±è¢«é‡æ–°æ‰§è¡Œäº†ã€‚ æ•´ä¸ªè¿ç®—åœ¨ 933 ç§’å†…å®Œæˆï¼ŒåŒ…æ‹¬äº†åˆå§‹å¯åŠ¨æ—¶é—´(åªæ¯”æ­£å¸¸æ‰§è¡Œå¤šæ¶ˆè€—äº† 5%çš„æ—¶é—´)ã€‚ &#123;% note info %&#125;## ç»éªŒ &#123;% endnote %&#125; æˆ‘ä»¬åœ¨ 2003 å¹´ 1 æœˆå®Œæˆäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ MapReduce åº“ï¼Œåœ¨ 2003 å¹´ 8 æœˆçš„ç‰ˆæœ¬æœ‰äº†æ˜¾è‘—çš„å¢å¼ºï¼Œè¿™åŒ…æ‹¬ äº†è¾“å…¥æ•°æ®æœ¬åœ°ä¼˜åŒ–ã€worker æœºå™¨ä¹‹é—´çš„åŠ¨æ€è´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚ä»é‚£ä»¥åï¼Œæˆ‘ä»¬æƒŠå–œçš„å‘ç°ï¼ŒMapReduce åº“èƒ½ å¹¿æ³›åº”ç”¨äºæˆ‘ä»¬æ—¥å¸¸å·¥ä½œä¸­é‡åˆ°çš„å„ç±»é—®é¢˜ã€‚å®ƒç°åœ¨åœ¨ Google å†…éƒ¨å„ä¸ªé¢†åŸŸå¾—åˆ°å¹¿æ³›åº”ç”¨ï¼ŒåŒ…æ‹¬: 1. å¤§è§„æ¨¡æœºå™¨å­¦ä¹ é—®é¢˜2. Google News å’Œ Froogle äº§å“çš„é›†ç¾¤é—®é¢˜ 3. ä»å…¬ä¼—æŸ¥è¯¢äº§å“(æ¯”å¦‚ Google çš„ Zeitgeist)çš„æŠ¥å‘Šä¸­æŠ½å–æ•°æ®ã€‚ 4. ä»å¤§é‡çš„æ–°åº”ç”¨å’Œæ–°äº§å“çš„ç½‘é¡µä¸­æå–æœ‰ç”¨ä¿¡æ¯(æ¯”å¦‚ï¼Œä»å¤§é‡çš„ä½ç½®æœç´¢ç½‘é¡µä¸­æŠ½å–åœ°ç†ä½ç½®ä¿¡æ¯)ã€‚ 5. å¤§è§„æ¨¡çš„å›¾å½¢è®¡ç®—ã€‚![](http://oliji9s3j.bkt.clouddn.com/15133916089336.jpg) å›¾å››æ˜¾ç¤ºäº†åœ¨æˆ‘ä»¬çš„æºä»£ç ç®¡ç†ç³»ç»Ÿä¸­ï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œç‹¬ç«‹çš„ MapReduce ç¨‹åºæ•°é‡çš„æ˜¾è‘—å¢åŠ ã€‚ä» 2003 å¹´æ—©äº›æ—¶å€™çš„ 0 ä¸ªå¢é•¿åˆ° 2004 å¹´ 9 æœˆä»½çš„å·®ä¸å¤š 900 ä¸ªä¸åŒçš„ç¨‹åºã€‚MapReduce çš„æˆåŠŸå–å†³äºé‡‡ç”¨ MapReduce åº“èƒ½å¤Ÿåœ¨ä¸åˆ°åŠä¸ªå°æ—¶æ—¶é—´å†…å†™å‡ºä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œè¿™ä¸ªç®€å•çš„ç¨‹åºèƒ½å¤Ÿåœ¨ä¸Šåƒå°æœºå™¨çš„ç»„æˆçš„é›†ç¾¤ä¸Šåšå¤§ è§„æ¨¡å¹¶å‘å¤„ç†ï¼Œè¿™æå¤§çš„åŠ å¿«äº†å¼€å‘å’ŒåŸå½¢è®¾è®¡çš„å‘¨æœŸã€‚å¦å¤–ï¼Œé‡‡ç”¨ MapReduce åº“ï¼Œå¯ä»¥è®©å®Œå…¨æ²¡æœ‰åˆ†å¸ƒå¼ å’Œ/æˆ–å¹¶è¡Œç³»ç»Ÿå¼€å‘ç»éªŒçš„ç¨‹åºå‘˜å¾ˆå®¹æ˜“çš„åˆ©ç”¨å¤§é‡çš„èµ„æºï¼Œå¼€å‘å‡ºåˆ†å¸ƒå¼å’Œ/æˆ–å¹¶è¡Œå¤„ç†çš„åº”ç”¨ã€‚![](http://oliji9s3j.bkt.clouddn.com/15133916531743.jpg) åœ¨æ¯ä¸ªä»»åŠ¡ç»“æŸçš„æ—¶å€™ï¼ŒMapReduce åº“ç»Ÿè®¡è®¡ç®—èµ„æºçš„ä½¿ç”¨çŠ¶å†µã€‚åœ¨è¡¨ 1ï¼Œæˆ‘ä»¬åˆ—å‡ºäº† 2004 å¹´ 8 æœˆä»½ MapReduce è¿è¡Œçš„ä»»åŠ¡æ‰€å ç”¨çš„ç›¸å…³èµ„æºã€‚ ### å¤§è§„æ¨¡ç´¢å¼• åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒMapReduce æœ€æˆåŠŸçš„åº”ç”¨å°±æ˜¯é‡å†™äº† Google ç½‘ç»œæœç´¢æœåŠ¡æ‰€ä½¿ç”¨åˆ°çš„ index ç³»ç»Ÿã€‚ç´¢å¼•ç³» ç»Ÿçš„è¾“å…¥æ•°æ®æ˜¯ç½‘ç»œçˆ¬è™«æŠ“å–å›æ¥çš„æµ·é‡çš„æ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£æ•°æ®éƒ½ä¿å­˜åœ¨ GFS æ–‡ä»¶ç³»ç»Ÿé‡Œã€‚è¿™äº›æ–‡æ¡£åŸå§‹å†… å®¹4çš„å¤§å°è¶…è¿‡äº† 20TBã€‚ç´¢å¼•ç¨‹åºæ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ MapReduce æ“ä½œ(å¤§çº¦ 5 åˆ° 10 æ¬¡)æ¥å»ºç«‹ç´¢å¼•ã€‚ä½¿ç”¨ MapReduce(æ›¿æ¢ä¸Šä¸€ä¸ªç‰¹åˆ«è®¾è®¡çš„ã€åˆ†å¸ƒå¼å¤„ç†çš„ç´¢å¼•ç¨‹åº)å¸¦æ¥è¿™äº›å¥½å¤„: å®ç°ç´¢å¼•éƒ¨åˆ†çš„ä»£ç ç®€å•ã€å°å·§ã€å®¹æ˜“ç†è§£ï¼Œå› ä¸ºå¯¹äºå®¹é”™ã€åˆ†å¸ƒå¼ä»¥åŠå¹¶è¡Œè®¡ç®—çš„å¤„ç†éƒ½æ˜¯ MapReduce åº“æä¾›çš„ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨ MapReduce åº“ï¼Œè®¡ç®—çš„ä»£ç è¡Œæ•°ä»åŸæ¥çš„ 3800 è¡Œ C++ä»£ç å‡å°‘åˆ°å¤§æ¦‚ 700 è¡Œä»£ç ã€‚ MapReduce åº“çš„æ€§èƒ½å·²ç»è¶³å¤Ÿå¥½äº†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠåœ¨æ¦‚å¿µä¸Šä¸ç›¸å…³çš„è®¡ç®—æ­¥éª¤åˆ†å¼€å¤„ç†ï¼Œè€Œä¸æ˜¯æ··åœ¨ ä¸€èµ·ä»¥æœŸå‡å°‘æ•°æ®ä¼ é€’çš„é¢å¤–æ¶ˆè€—ã€‚æ¦‚å¿µä¸Šä¸ç›¸å…³çš„è®¡ç®—æ­¥éª¤çš„éš”ç¦»ä¹Ÿä½¿å¾—æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æ”¹å˜ç´¢å¼•å¤„ç†æ–¹ å¼ã€‚æ¯”å¦‚ï¼Œå¯¹ä¹‹å‰çš„ç´¢å¼•ç³»ç»Ÿçš„ä¸€ä¸ªå°æ›´æ”¹å¯èƒ½è¦è€—è´¹å¥½å‡ ä¸ªæœˆçš„æ—¶é—´ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ MapReduce çš„æ–°ç³»ç»Ÿä¸Šï¼Œ è¿™æ ·çš„æ›´æ”¹åªéœ€è¦èŠ±å‡ å¤©æ—¶é—´å°±å¯ä»¥äº†ã€‚ ç´¢å¼•ç³»ç»Ÿçš„æ“ä½œç®¡ç†æ›´å®¹æ˜“äº†ã€‚å› ä¸ºç”±æœºå™¨å¤±æ•ˆã€æœºå™¨å¤„ç†é€Ÿåº¦ç¼“æ…¢ã€ä»¥åŠç½‘ç»œçš„ç¬é—´é˜»å¡ç­‰å¼•èµ·çš„ç» å¤§éƒ¨åˆ†é—®é¢˜éƒ½å·²ç»ç”± MapReduce åº“è§£å†³äº†ï¼Œä¸å†éœ€è¦æ“ä½œäººå‘˜çš„ä»‹å…¥äº†ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç´¢å¼•ç³»ç»Ÿé›† ç¾¤ä¸­å¢åŠ æœºå™¨çš„ç®€å•æ–¹æ³•æé«˜æ•´ä½“å¤„ç†æ€§èƒ½ã€‚ &#123;% note info %&#125;## ç›¸å…³å·¥ä½œ &#123;% endnote %&#125;å¾ˆå¤šç³»ç»Ÿéƒ½æä¾›äº†ä¸¥æ ¼çš„ç¼–ç¨‹æ¨¡å¼ï¼Œå¹¶ä¸”é€šè¿‡å¯¹ç¼–ç¨‹çš„ä¸¥æ ¼é™åˆ¶æ¥å®ç°å¹¶è¡Œè®¡ç®—ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç»“åˆå‡½æ•°å¯ä»¥é€šè¿‡æŠŠ N ä¸ªå…ƒç´ çš„æ•°ç»„çš„å‰ç¼€åœ¨ N ä¸ªå¤„ç†å™¨ä¸Šä½¿ç”¨å¹¶è¡Œå‰ç¼€ç®—æ³•ï¼Œåœ¨ log N çš„æ—¶é—´å†…è®¡ç®—å®Œ[6ï¼Œ9ï¼Œ13]5ã€‚ MapReduce å¯ä»¥çœ‹ä½œæ˜¯æˆ‘ä»¬ç»“åˆåœ¨çœŸå®ç¯å¢ƒä¸‹å¤„ç†æµ·é‡æ•°æ®çš„ç»éªŒï¼Œå¯¹è¿™äº›ç»å…¸æ¨¡å‹è¿›è¡Œç®€åŒ–å’Œèƒå–çš„æˆæœã€‚ æ›´åŠ å€¼å¾—éª„å‚²çš„æ˜¯ï¼Œæˆ‘ä»¬è¿˜å®ç°äº†åŸºäºä¸Šåƒå°å¤„ç†å™¨çš„é›†ç¾¤çš„å®¹é”™å¤„ç†ã€‚ç›¸æ¯”è€Œè¨€ï¼Œå¤§éƒ¨åˆ†å¹¶å‘å¤„ç†ç³»ç»Ÿéƒ½ åªåœ¨å°è§„æ¨¡çš„é›†ç¾¤ä¸Šå®ç°ï¼Œå¹¶ä¸”æŠŠå®¹é”™å¤„ç†äº¤ç»™äº†ç¨‹åºå‘˜ã€‚ Bulk Synchronous Programming[17]å’Œä¸€äº› MPI åŸè¯­[11]æä¾›äº†æ›´é«˜çº§åˆ«çš„å¹¶è¡Œå¤„ç†æŠ½è±¡ï¼Œå¯ä»¥æ›´å®¹æ˜“å†™ å‡ºå¹¶è¡Œå¤„ç†çš„ç¨‹åºã€‚MapReduce å’Œè¿™äº›ç³»ç»Ÿçš„å…³é”®ä¸åŒä¹‹å¤„åœ¨äºï¼ŒMapReduce åˆ©ç”¨é™åˆ¶æ€§ç¼–ç¨‹æ¨¡å¼å®ç°äº†ç”¨ æˆ·ç¨‹åºçš„è‡ªåŠ¨å¹¶å‘å¤„ç†ï¼Œå¹¶ä¸”æä¾›äº†é€æ˜çš„å®¹é”™å¤„ç†ã€‚ æˆ‘ä»¬æ•°æ®æœ¬åœ°ä¼˜åŒ–ç­–ç•¥çš„çµæ„Ÿæ¥æºäº active disks[12,15]ç­‰æŠ€æœ¯ï¼Œåœ¨ active disks ä¸­ï¼Œè®¡ç®—ä»»åŠ¡æ˜¯å°½é‡æ¨é€ åˆ°æ•°æ®å­˜å‚¨çš„èŠ‚ç‚¹å¤„ç†6ï¼Œè¿™æ ·å°±å‡å°‘äº†ç½‘ç»œå’Œ IO å­ç³»ç»Ÿçš„ååé‡ã€‚æˆ‘ä»¬åœ¨æŒ‚è½½å‡ ä¸ªç¡¬ç›˜çš„æ™®é€šæœºå™¨ä¸Šæ‰§è¡Œ æˆ‘ä»¬çš„è¿ç®—ï¼Œè€Œä¸æ˜¯åœ¨ç£ç›˜å¤„ç†å™¨ä¸Šæ‰§è¡Œæˆ‘ä»¬çš„å·¥ä½œï¼Œä½†æ˜¯è¾¾åˆ°çš„ç›®çš„ä¸€æ ·çš„ã€‚ æˆ‘ä»¬çš„å¤‡ç”¨ä»»åŠ¡æœºåˆ¶å’Œ Charlotte System[3]æå‡ºçš„ eager è°ƒåº¦æœºåˆ¶æ¯”è¾ƒç±»ä¼¼ã€‚Eager è°ƒåº¦æœºåˆ¶çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ å¦‚æœä¸€ä¸ªä»»åŠ¡åå¤å¤±æ•ˆï¼Œé‚£ä¹ˆæ•´ä¸ªè®¡ç®—å°±ä¸èƒ½å®Œæˆã€‚æˆ‘ä»¬é€šè¿‡å¿½ç•¥å¼•èµ·æ•…éšœçš„è®°å½•çš„æ–¹å¼åœ¨æŸç§ç¨‹åº¦ä¸Šè§£å†³ äº†è¿™ä¸ªé—®é¢˜ã€‚ MapReduce çš„å®ç°ä¾èµ–äºä¸€ä¸ªå†…éƒ¨çš„é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œè¿™ä¸ªé›†ç¾¤ç®¡ç†ç³»ç»Ÿè´Ÿè´£åœ¨ä¸€ä¸ªè¶…å¤§çš„ã€å…±äº«æœºå™¨çš„ é›†ç¾¤ä¸Šåˆ†å¸ƒå’Œè¿è¡Œç”¨æˆ·ä»»åŠ¡ã€‚è™½ç„¶è¿™ä¸ªä¸æ˜¯æœ¬è®ºæ–‡çš„é‡ç‚¹ï¼Œä½†æ˜¯æœ‰å¿…è¦æä¸€ä¸‹ï¼Œè¿™ä¸ªé›†ç¾¤ç®¡ç†ç³»ç»Ÿåœ¨ç†å¿µä¸Š å’Œå…¶å®ƒç³»ç»Ÿï¼Œå¦‚ Condor[16]æ˜¯ä¸€æ ·ã€‚ MapReduce åº“çš„æ’åºæœºåˆ¶å’Œ NOW-Sort[1]çš„æ“ä½œä¸Šå¾ˆç±»ä¼¼ã€‚è¯»å–è¾“å…¥æºçš„æœºå™¨(map workers)æŠŠå¾…æ’åº çš„æ•°æ®è¿›è¡Œåˆ†åŒºåï¼Œå‘é€åˆ° R ä¸ª Reduce worker ä¸­çš„ä¸€ä¸ªè¿›è¡Œå¤„ç†ã€‚æ¯ä¸ª Reduce worker åœ¨æœ¬åœ°å¯¹æ•°æ®è¿›è¡Œæ’ åº(å°½å¯èƒ½åœ¨å†…å­˜ä¸­æ’åº)ã€‚å½“ç„¶ï¼ŒNOW-Sort æ²¡æœ‰ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„ Map å’Œ Reduce å‡½æ•°çš„æœºä¼šï¼Œå› æ­¤ä¸å…·å¤‡ MapReduce åº“å¹¿æ³›çš„å®ç”¨æ€§ã€‚ River[2]æä¾›äº†ä¸€ä¸ªç¼–ç¨‹æ¨¡å‹:å¤„ç†è¿›ç¨‹é€šè¿‡åˆ†å¸ƒå¼é˜Ÿåˆ—ä¼ é€æ•°æ®çš„æ–¹å¼è¿›è¡Œäº’ç›¸é€šè®¯ã€‚å’Œ MapReduce ç±»ä¼¼ï¼ŒRiver ç³»ç»Ÿå°è¯•åœ¨ä¸å¯¹ç­‰çš„ç¡¬ä»¶ç¯å¢ƒä¸‹ï¼Œæˆ–è€…åœ¨ç³»ç»Ÿé¢ ç°¸çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æä¾›è¿‘ä¼¼å¹³å‡çš„æ€§èƒ½ã€‚River æ˜¯ é€šè¿‡ç²¾å¿ƒè°ƒåº¦ç¡¬ç›˜å’Œç½‘ç»œçš„é€šè®¯æ¥å¹³è¡¡ä»»åŠ¡çš„å®Œæˆæ—¶é—´ã€‚MapReduce åº“é‡‡ç”¨äº†å…¶å®ƒçš„æ–¹æ³•ã€‚é€šè¿‡å¯¹ç¼–ç¨‹æ¨¡å‹ è¿›è¡Œé™åˆ¶ï¼ŒMapReduce æ¡†æ¶æŠŠé—®é¢˜åˆ†è§£æˆä¸ºå¤§é‡çš„â€œå°â€ä»»åŠ¡ã€‚è¿™äº›ä»»åŠ¡åœ¨å¯ç”¨çš„ worker é›†ç¾¤ä¸ŠåŠ¨æ€çš„è°ƒåº¦ï¼Œ è¿™æ ·å¿«é€Ÿçš„ worker å°±å¯ä»¥æ‰§è¡Œæ›´å¤šçš„ä»»åŠ¡ã€‚é€šè¿‡å¯¹ç¼–ç¨‹æ¨¡å‹è¿›è¡Œé™åˆ¶ï¼Œæˆ‘ä»¬å¯ç”¨åœ¨å·¥ä½œæ¥è¿‘å®Œæˆçš„æ—¶å€™è°ƒåº¦ å¤‡ç”¨ä»»åŠ¡ï¼Œç¼©çŸ­åœ¨ç¡¬ä»¶é…ç½®ä¸å‡è¡¡çš„æƒ…å†µä¸‹ç¼©å°æ•´ä¸ªæ“ä½œå®Œæˆçš„æ—¶é—´(æ¯”å¦‚æœ‰çš„æœºå™¨æ€§èƒ½å·®ã€æˆ–è€…æœºå™¨è¢«æŸ äº›æ“ä½œé˜»å¡äº†)ã€‚ BAD-FS[5]é‡‡ç”¨äº†å’Œ MapReduce å®Œå…¨ä¸åŒçš„ç¼–ç¨‹æ¨¡å¼ï¼Œå®ƒæ˜¯é¢å‘å¹¿åŸŸç½‘(alex æ³¨:wide-area network)çš„ã€‚ä¸è¿‡ï¼Œè¿™ä¸¤ä¸ªç³»ç»Ÿæœ‰ä¸¤ä¸ªåŸºç¡€åŠŸèƒ½å¾ˆç±»ä¼¼ã€‚1. ä¸¤ä¸ªç³»ç»Ÿé‡‡ç”¨é‡æ–°æ‰§è¡Œçš„æ–¹å¼æ¥é˜²æ­¢ç”±äºå¤±æ•ˆå¯¼è‡´çš„æ•°æ®ä¸¢ å¤±ã€‚2. ä¸¤ä¸ªéƒ½ä½¿ç”¨æ•°æ®æœ¬åœ°åŒ–è°ƒåº¦ç­–ç•¥ï¼Œå‡å°‘ç½‘ç»œé€šè®¯çš„æ•°æ®é‡ã€‚ TACC[7]æ˜¯ä¸€ä¸ªç”¨äºç®€åŒ–æ„é€ é«˜å¯ç”¨æ€§ç½‘ç»œæœåŠ¡çš„ç³»ç»Ÿã€‚å’Œ MapReduce ä¸€æ ·ï¼Œå®ƒä¹Ÿä¾é é‡æ–°æ‰§è¡Œæœºåˆ¶æ¥ å®ç°çš„å®¹é”™å¤„ç†ã€‚ &#123;% note info %&#125;## ç»“æŸè¯­ &#123;% endnote %&#125; MapReduce ç¼–ç¨‹æ¨¡å‹åœ¨ Google å†…éƒ¨æˆåŠŸåº”ç”¨äºå¤šä¸ªé¢†åŸŸã€‚æˆ‘ä»¬æŠŠè¿™ç§æˆåŠŸå½’ç»“ä¸ºå‡ ä¸ªæ–¹é¢:é¦–å…ˆï¼Œç”±äº MapReduce å°è£…äº†å¹¶è¡Œå¤„ç†ã€å®¹é”™å¤„ç†ã€æ•°æ®æœ¬åœ°åŒ–ä¼˜åŒ–ã€è´Ÿè½½å‡è¡¡ç­‰ç­‰æŠ€æœ¯éš¾ç‚¹çš„ç»†èŠ‚ï¼Œè¿™ä½¿å¾— MapReduce åº“æ˜“äºä½¿ç”¨ã€‚å³ä¾¿å¯¹äºå®Œå…¨æ²¡æœ‰å¹¶è¡Œæˆ–è€…åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘ç»éªŒçš„ç¨‹åºå‘˜è€Œè¨€;å…¶æ¬¡ï¼Œå¤§é‡ä¸åŒç±»å‹çš„é—®é¢˜éƒ½ å¯ä»¥é€šè¿‡ MapReduce ç®€å•çš„è§£å†³ã€‚æ¯”å¦‚ï¼ŒMapReduce ç”¨äºç”Ÿæˆ Google çš„ç½‘ç»œæœç´¢æœåŠ¡æ‰€éœ€è¦çš„æ•°æ®ã€ç”¨æ¥ æ’åºã€ç”¨æ¥æ•°æ®æŒ–æ˜ã€ç”¨äºæœºå™¨å­¦ä¹ ï¼Œä»¥åŠå¾ˆå¤šå…¶å®ƒçš„ç³»ç»Ÿ;ç¬¬ä¸‰ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåœ¨æ•°åƒå°è®¡ç®—æœºç»„æˆçš„ å¤§å‹é›†ç¾¤ä¸Šçµæ´»éƒ¨ç½²è¿è¡Œçš„ MapReduceã€‚è¿™ä¸ªå®ç°ä½¿å¾—æœ‰æ•ˆåˆ©ç”¨è¿™äº›ä¸°å¯Œçš„è®¡ç®—èµ„æºå˜å¾—éå¸¸ç®€å•ï¼Œå› æ­¤ä¹Ÿ é€‚åˆç”¨æ¥è§£å†³ Google é‡åˆ°çš„å…¶ä»–å¾ˆå¤šéœ€è¦å¤§é‡è®¡ç®—çš„é—®é¢˜ã€‚ æˆ‘ä»¬ä¹Ÿä» MapReduce å¼€å‘è¿‡ç¨‹ä¸­å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ã€‚é¦–å…ˆï¼Œçº¦æŸç¼–ç¨‹æ¨¡å¼ä½¿å¾—å¹¶è¡Œå’Œåˆ†å¸ƒå¼è®¡ç®—éå¸¸å®¹æ˜“ï¼Œ ä¹Ÿæ˜“äºæ„é€ å®¹é”™çš„è®¡ç®—ç¯å¢ƒ;å…¶æ¬¡ï¼Œç½‘ç»œå¸¦å®½æ˜¯ç¨€æœ‰èµ„æºã€‚å¤§é‡çš„ç³»ç»Ÿä¼˜åŒ–æ˜¯é’ˆå¯¹å‡å°‘ç½‘ç»œä¼ è¾“é‡ä¸ºç›®çš„çš„: æœ¬åœ°ä¼˜åŒ–ç­–ç•¥ä½¿å¤§é‡çš„æ•°æ®ä»æœ¬åœ°ç£ç›˜è¯»å–ï¼Œä¸­é—´æ–‡ä»¶å†™å…¥æœ¬åœ°ç£ç›˜ã€å¹¶ä¸”åªå†™ä¸€ä»½ä¸­é—´æ–‡ä»¶ä¹ŸèŠ‚çº¦äº†ç½‘ç»œ å¸¦å®½;ç¬¬ä¸‰ï¼Œå¤šæ¬¡æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡å¯ä»¥å‡å°‘æ€§èƒ½ç¼“æ…¢çš„æœºå™¨å¸¦æ¥çš„è´Ÿé¢å½±å“(alex æ³¨:å³ç¡¬ä»¶é…ç½®çš„ä¸å¹³è¡¡)ï¼Œ åŒæ—¶è§£å†³äº†ç”±äºæœºå™¨å¤±æ•ˆå¯¼è‡´çš„æ•°æ®ä¸¢å¤±é—®é¢˜ã€‚ &#123;% note info %&#125;## æ„Ÿè°¢ &#123;% endnote %&#125; Josh Levenberg has been instrumental in revising and extending the user-level MapReduce API with a number of new features based on his experience with using MapReduce and other peopleâ€™s suggestions for enhancements. MapReduce reads its input from and writes its output to the Google File System [8]. We would like to thank Mohit Aron, Howard Gobioff, Markus Gutschke, David Kramer, Shun-Tak Leung, and Josh Redstone for their work in developing GFS. We would also like to thank Percy Liang and Olcan Sercinoglu for their work in developing the cluster management system used by MapReduce. Mike Burrows, Wilson Hsieh, Josh Levenberg, Sharon Perl, Rob Pike, and Debby Wallach provided helpful comments on earlier drafts of this paper.The anonymous OSDI reviewers, and our shepherd, Eric Brewer, provided many useful suggestions of areas where the paper could be improved. Finally, we thank all the users of MapReduce within Googleâ€™s engineering organization for providing helpful feedback, suggestions, and bug reports. &#123;% note info %&#125;## å‚è€ƒèµ„æ–™ &#123;% endnote %&#125; [1] Andrea C. Arpaci-Dusseau, Remzi H. Arpaci-Dusseau,David E. Culler, Joseph M. Hellerstein, and David A. Patterson.High-performance sorting on networks of workstations.In Proceedings of the 1997 ACM SIGMOD InternationalConference on Management of Data, Tucson,Arizona, May 1997. [2] Remzi H. Arpaci-Dusseau, Eric Anderson, NoahTreuhaft, David E. Culler, Joseph M. Hellerstein, David Patterson, and Kathy Yelick. Cluster I/O with River:Making the fast case common. In Proceedings of the Sixth Workshop on Input/Output in Parallel and Distributed Systems (IOPADS â€™99), pages 10.22, Atlanta, Georgia, May 1999. [3] Arash Baratloo, Mehmet Karaul, Zvi Kedem, and Peter Wyckoff. Charlotte: Metacomputing on the web. In Proceedings of the 9th International Conference on Parallel and Distributed Computing Systems, 1996. [4] Luiz A. Barroso, Jeffrey Dean, and Urs H Ìˆolzle. Web search for a planet: The Google cluster architecture. IEEE Micro, 23(2):22.28, April 2003. [5] John Bent, Douglas Thain, Andrea C.Arpaci-Dusseau, Remzi H. Arpaci-Dusseau, and Miron Livny. Explicit control in a batch-aware distributed file system. In Proceedings of the 1st USENIX Symposium on Networked Systems Design and Implementation NSDI, March 2004. [6] Guy E. Blelloch. Scans as primitive parallel operations.IEEE Transactions on Computers, C-38(11), November 1989. [7] Armando Fox, Steven D. Gribble, Yatin Chawathe, Eric A. Brewer, and Paul Gauthier. Cluster-based scalable network services. In Proceedings of the 16th ACM Symposium on Operating System Principles, pages 78. 91, Saint-Malo, France, 1997. [8] Sanjay Ghemawat, Howard Gobioff, and Shun-Tak Leung. The Google file system. In 19th Symposium on Operating Systems Principles, pages 29.43, Lake George, New York, 2003. To appear in OSDI 2004 12 [9] S. Gorlatch. Systematic efficient parallelization of scan and other list homomorphisms. In L. Bouge, P. Fraigniaud, A. Mignotte, and Y. Robert, editors, Euro-Parâ€™96. Parallel Processing, Lecture Notes in Computer Science 1124, pages 401.408. Springer-Verlag, 1996. [10] Jim Gray. Sort benchmark home page. http://research.microsoft.com/barc/SortBenchmark/. [11] William Gropp, Ewing Lusk, and Anthony Skjellum. Using MPI: Portable Parallel Programming with the Message-Passing Interface. MIT Press, Cambridge, MA, 1999. [12] L. Huston, R. Sukthankar, R.Wickremesinghe, M. Satyanarayanan, G. R. Ganger, E. Riedel, and A. Ailamaki. Diamond: A storage architecture for early discard in interactive search. In Proceedings of the 2004USENIX File and Storage Technologies FAST Conference, April 2004. [13] Richard E. Ladner and Michael J. Fischer. Parallel prefix computation. Journal of the ACM, 27(4):831.838, 1980. [14] Michael O. Rabin. Efficient dispersal of information for security, load balancing and fault tolerance. Journal of the ACM, 36(2):335.348, 1989. [15] Erik Riedel, Christos Faloutsos, Garth A. Gibson, and David Nagle. Active disks for large-scale data processing. IEEE Computer, pages 68.74, June 2001. [16] Douglas Thain, Todd Tannenbaum, and Miron Livny. Distributed computing in practice: The Condor experience. Concurrency and Computation: Practice and Experience, 2004. [17] L. G. Valiant. A bridging model for parallel computation. Communications of the ACM, 33(8):103.111, 1997. [18] Jim Wyllie. Spsort: How to sort a terabyte quickly. http://alme1.almaden.ibm.com/cs/spsort.pdf.&#123;% note info %&#125;## é™„å½• A-å•è¯é¢‘ç‡ç»Ÿè®¡ &#123;% endnote %&#125;æœ¬èŠ‚åŒ…å«äº†ä¸€ä¸ªå®Œæ•´çš„ç¨‹åºï¼Œç”¨äºç»Ÿè®¡åœ¨ä¸€ç»„å‘½ä»¤è¡ŒæŒ‡å®šçš„è¾“å…¥æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€ä¸ªä¸åŒçš„å•è¯å‡ºç°é¢‘ç‡ã€‚```python#include â€œmapreduce/mapreduce.hâ€ // Userâ€™s map functionclass WordCounter :public Mapper&#123;public: virtual void Map(const MapInput&amp;input)&#123; const string&amp;text=input.value(); const int n=text.size(); for(int i=0;i&lt;n; )&#123;// Skip past leading whitespace while((i&lt;n)&amp;&amp;isspace(text[i]))i++;// Find word end int start=i; while((i&lt;n)&amp;&amp;!isspace(text[i]))i++; if(start&lt;i)Emit(text.substr(start,i-start),â€1â€²â€²); &#125;&#125; &#125;; REGISTER_MAPPER(WordCounter);// Userâ€™s reduce functionclass Adder :public Reducer&#123; virtual void Reduce(ReduceInput*input)&#123; // Iterate over all entries with the// same key and add the values int64 value=0; while(!input-&gt;done())&#123; value+=StringToInt(input-&gt;value());input-&gt;NextValue(); &#125;// Emit sum for input-&gt;key() Emit(IntToString(value));&#125; &#125;; REGISTER_REDUCER(Adder); int main(int argc,char**argv)&#123;ParseCommandLineFlags(argc,argv); MapReduceSpecification spec;// Store list of input files into â€œspecâ€ for(int i=1;i&lt;argc; i++)&#123; MapReduceInput*input=spec.add_input(); input-&gt;set_format(â€œtextâ€); input-&gt;set_filepattern(argv[i]); input-&gt;set_mapper_class(â€œWordCounterâ€); &#125;// Specify the output files:// /gfs/test/freq-00000-of-00100// /gfs/test/freq-00001-of-00100// ... MapReduceOutput*out=spec.output(); out-&gt;set_filebase(â€œ/gfs/test/freqâ€); out-&gt;set_num_tasks(100); out-&gt;set_format(â€œtextâ€); out-&gt;set_reducer_class(â€œAdderâ€);// Optional: do partial sums within map tasks to save network bandwidth out-&gt;set_combiner_class(â€œAdderâ€);// Tuning parameters: use at most 2000// machines and 100 MB of memory per task spec.set_machines(2000); spec.set_map_megabytes(100); spec.set_reduce_megabytes(100);// Now run it MapReduceResult result; if(!MapReduce(spec,&amp;result))abort();// Done: â€˜resultâ€™ structure contains info about counters, time taken, number of machines used, etc. return 0; &#125;","raw":null,"content":null,"categories":[{"name":"paper","slug":"paper","permalink":"https://stanxia.github.io/categories/paper/"}],"tags":[{"name":"paper","slug":"paper","permalink":"https://stanxia.github.io/tags/paper/"}]},{"title":"Google File System ä¸­æ–‡ç‰ˆ","slug":"Google-File-System-ä¸­æ–‡ç‰ˆ","date":"2017-12-14T12:38:00.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/14/Google-File-System-ä¸­æ–‡ç‰ˆ/","link":"","permalink":"https://stanxia.github.io/2017/12/14/Google-File-System-ä¸­æ–‡ç‰ˆ/","excerpt":"æ‘˜è¦\næˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº† Google GFS æ–‡ä»¶ç³»ç»Ÿï¼Œä¸€ä¸ªé¢å‘å¤§è§„æ¨¡æ•°æ®å¯†é›†å‹åº”ç”¨çš„ã€å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚GFS è™½ç„¶è¿è¡Œåœ¨å»‰ä»·çš„æ™®éç¡¬ä»¶è®¾å¤‡ä¸Šï¼Œä½†æ˜¯å®ƒä¾ç„¶äº†æä¾›ç¾éš¾å†—ä½™çš„èƒ½åŠ›ï¼Œä¸ºå¤§é‡å®¢æˆ·æœºæä¾›äº†é«˜æ€§èƒ½çš„æœåŠ¡ã€‚\nè™½ç„¶ GFS çš„è®¾è®¡ç›®æ ‡ä¸è®¸å¤šä¼ ç»Ÿçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæœ‰å¾ˆå¤šç›¸åŒä¹‹å¤„ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è®¾è®¡è¿˜æ˜¯ä»¥æˆ‘ä»¬å¯¹è‡ªå·±çš„åº”ç”¨çš„è´Ÿè½½æƒ…å†µå’ŒæŠ€æœ¯ç¯å¢ƒçš„åˆ†æä¸ºåŸºç¡€çš„ï¼Œä¸ç®¡ç°åœ¨è¿˜æ˜¯å°†æ¥ï¼ŒGFS å’Œæ—©æœŸçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„è®¾æƒ³éƒ½æœ‰æ˜æ˜¾çš„ä¸åŒã€‚æ‰€ä»¥æˆ‘ä»¬é‡æ–°å®¡è§†äº†ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿåœ¨è®¾è®¡ä¸Šçš„æŠ˜è¡·é€‰æ‹©ï¼Œè¡ç”Ÿå‡ºäº†å®Œå…¨ä¸åŒçš„è®¾è®¡æ€è·¯ã€‚\nGFS å®Œå…¨æ»¡è¶³äº†æˆ‘ä»¬å¯¹å­˜å‚¨çš„éœ€æ±‚ã€‚GFS ä½œä¸ºå­˜å‚¨å¹³å°å·²ç»è¢«å¹¿æ³›çš„éƒ¨ç½²åœ¨ Google å†…éƒ¨ï¼Œå­˜å‚¨æˆ‘ä»¬çš„æœåŠ¡äº§ç”Ÿå’Œå¤„ç†çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜ç”¨äºé‚£äº›éœ€è¦å¤§è§„æ¨¡æ•°æ®é›†çš„ç ”ç©¶å’Œå¼€å‘å·¥ä½œã€‚ç›®å‰ä¸ºæ­¢ï¼Œæœ€å¤§çš„ä¸€ä¸ªé›†ç¾¤åˆ©ç”¨æ•°åƒå°æœºå™¨çš„æ•°åƒä¸ªç¡¬ç›˜ï¼Œæä¾›äº†æ•°ç™¾ TB çš„å­˜å‚¨ç©ºé—´ï¼ŒåŒæ—¶ä¸ºæ•°ç™¾ä¸ªå®¢æˆ·æœºæœåŠ¡ã€‚åœ¨æœ¬è®ºæ–‡ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†èƒ½å¤Ÿæ”¯æŒåˆ†å¸ƒå¼åº”ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ¥å£çš„æ‰©å±•ï¼Œè®¨è®ºæˆ‘ä»¬è®¾è®¡çš„è®¸å¤šæ–¹é¢ï¼Œæœ€ååˆ—å‡ºäº†å°è§„æ¨¡æ€§èƒ½æµ‹è¯•ä»¥åŠçœŸå®ç”Ÿäº§ç³»ç»Ÿä¸­æ€§èƒ½ç›¸å…³æ•°æ®ã€‚","text":"æ‘˜è¦ æˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº† Google GFS æ–‡ä»¶ç³»ç»Ÿï¼Œä¸€ä¸ªé¢å‘å¤§è§„æ¨¡æ•°æ®å¯†é›†å‹åº”ç”¨çš„ã€å¯ä¼¸ç¼©çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚GFS è™½ç„¶è¿è¡Œåœ¨å»‰ä»·çš„æ™®éç¡¬ä»¶è®¾å¤‡ä¸Šï¼Œä½†æ˜¯å®ƒä¾ç„¶äº†æä¾›ç¾éš¾å†—ä½™çš„èƒ½åŠ›ï¼Œä¸ºå¤§é‡å®¢æˆ·æœºæä¾›äº†é«˜æ€§èƒ½çš„æœåŠ¡ã€‚ è™½ç„¶ GFS çš„è®¾è®¡ç›®æ ‡ä¸è®¸å¤šä¼ ç»Ÿçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæœ‰å¾ˆå¤šç›¸åŒä¹‹å¤„ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è®¾è®¡è¿˜æ˜¯ä»¥æˆ‘ä»¬å¯¹è‡ªå·±çš„åº”ç”¨çš„è´Ÿè½½æƒ…å†µå’ŒæŠ€æœ¯ç¯å¢ƒçš„åˆ†æä¸ºåŸºç¡€çš„ï¼Œä¸ç®¡ç°åœ¨è¿˜æ˜¯å°†æ¥ï¼ŒGFS å’Œæ—©æœŸçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„è®¾æƒ³éƒ½æœ‰æ˜æ˜¾çš„ä¸åŒã€‚æ‰€ä»¥æˆ‘ä»¬é‡æ–°å®¡è§†äº†ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿåœ¨è®¾è®¡ä¸Šçš„æŠ˜è¡·é€‰æ‹©ï¼Œè¡ç”Ÿå‡ºäº†å®Œå…¨ä¸åŒçš„è®¾è®¡æ€è·¯ã€‚ GFS å®Œå…¨æ»¡è¶³äº†æˆ‘ä»¬å¯¹å­˜å‚¨çš„éœ€æ±‚ã€‚GFS ä½œä¸ºå­˜å‚¨å¹³å°å·²ç»è¢«å¹¿æ³›çš„éƒ¨ç½²åœ¨ Google å†…éƒ¨ï¼Œå­˜å‚¨æˆ‘ä»¬çš„æœåŠ¡äº§ç”Ÿå’Œå¤„ç†çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜ç”¨äºé‚£äº›éœ€è¦å¤§è§„æ¨¡æ•°æ®é›†çš„ç ”ç©¶å’Œå¼€å‘å·¥ä½œã€‚ç›®å‰ä¸ºæ­¢ï¼Œæœ€å¤§çš„ä¸€ä¸ªé›†ç¾¤åˆ©ç”¨æ•°åƒå°æœºå™¨çš„æ•°åƒä¸ªç¡¬ç›˜ï¼Œæä¾›äº†æ•°ç™¾ TB çš„å­˜å‚¨ç©ºé—´ï¼ŒåŒæ—¶ä¸ºæ•°ç™¾ä¸ªå®¢æˆ·æœºæœåŠ¡ã€‚åœ¨æœ¬è®ºæ–‡ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†èƒ½å¤Ÿæ”¯æŒåˆ†å¸ƒå¼åº”ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ¥å£çš„æ‰©å±•ï¼Œè®¨è®ºæˆ‘ä»¬è®¾è®¡çš„è®¸å¤šæ–¹é¢ï¼Œæœ€ååˆ—å‡ºäº†å°è§„æ¨¡æ€§èƒ½æµ‹è¯•ä»¥åŠçœŸå®ç”Ÿäº§ç³»ç»Ÿä¸­æ€§èƒ½ç›¸å…³æ•°æ®ã€‚ç®€ä»‹ ä¸ºäº†æ»¡è¶³ Google è¿…é€Ÿå¢é•¿çš„æ•°æ®å¤„ç†éœ€æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº† Google æ–‡ä»¶ç³»ç»Ÿ(Google File System â€“GFS)ã€‚GFS ä¸ä¼ ç»Ÿçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæœ‰ç€å¾ˆå¤šç›¸åŒçš„è®¾è®¡ç›®æ ‡ï¼Œæ¯”å¦‚ï¼Œæ€§èƒ½ã€å¯ä¼¸ç¼©æ€§ã€å¯é æ€§ä»¥åŠå¯ç”¨æ€§ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è®¾è®¡è¿˜åŸºäºæˆ‘ä»¬å¯¹æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨çš„è´Ÿè½½æƒ…å†µå’ŒæŠ€æœ¯ç¯å¢ƒçš„è§‚å¯Ÿçš„å½±å“ï¼Œä¸ç®¡ç°åœ¨è¿˜æ˜¯å°†æ¥ï¼ŒGFS å’Œæ—©æœŸæ–‡ä»¶ç³»ç»Ÿçš„å‡è®¾éƒ½æœ‰æ˜æ˜¾çš„ä¸åŒã€‚æ‰€ä»¥æˆ‘ä»¬é‡æ–°å®¡è§†äº†ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿåœ¨è®¾è®¡ä¸Šçš„æŠ˜è¡·é€‰æ‹©ï¼Œè¡ç”Ÿå‡ºäº†å®Œå…¨ä¸åŒçš„è®¾è®¡æ€è·¯ã€‚ é¦–å…ˆï¼Œç»„ä»¶å¤±æ•ˆè¢«è®¤ä¸ºæ˜¯å¸¸æ€äº‹ä»¶ï¼Œè€Œä¸æ˜¯æ„å¤–äº‹ä»¶ã€‚GFS åŒ…æ‹¬å‡ ç™¾ç”šè‡³å‡ åƒå°æ™®é€šçš„å»‰ä»·è®¾å¤‡ç»„è£…çš„å­˜å‚¨æœºå™¨ï¼ŒåŒæ—¶è¢«ç›¸å½“æ•°é‡çš„å®¢æˆ·æœºè®¿é—®ã€‚GFS ç»„ä»¶çš„æ•°é‡å’Œè´¨é‡å¯¼è‡´åœ¨äº‹å®ä¸Šï¼Œä»»ä½•ç»™å®šæ—¶é—´å†…éƒ½æœ‰å¯èƒ½å‘ç”ŸæŸäº›ç»„ä»¶æ— æ³•å·¥ä½œï¼ŒæŸäº›ç»„ä»¶æ— æ³•ä»å®ƒä»¬ç›®å‰çš„å¤±æ•ˆçŠ¶æ€ä¸­æ¢å¤ã€‚æˆ‘ä»¬é‡åˆ°è¿‡å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚åº”ç”¨ç¨‹åº bugã€æ“ä½œç³»ç»Ÿçš„ bugã€äººä¸ºå¤±è¯¯ï¼Œç”šè‡³è¿˜æœ‰ç¡¬ç›˜ã€å†…å­˜ã€è¿æ¥å™¨ã€ç½‘ç»œä»¥åŠç”µæºå¤±æ•ˆç­‰é€ æˆçš„é—®é¢˜ã€‚æ‰€ä»¥ï¼ŒæŒç»­çš„ç›‘æ§ã€é”™è¯¯ä¾¦æµ‹ã€ç¾éš¾å†—ä½™ä»¥åŠè‡ªåŠ¨æ¢å¤çš„æœºåˆ¶å¿…é¡»é›†æˆåœ¨ GFS ä¸­ã€‚ å…¶æ¬¡ï¼Œä»¥é€šå¸¸çš„æ ‡å‡†è¡¡é‡ï¼Œæˆ‘ä»¬çš„æ–‡ä»¶éå¸¸å·¨å¤§ã€‚æ•° GB çš„æ–‡ä»¶éå¸¸æ™®éã€‚æ¯ä¸ªæ–‡ä»¶é€šå¸¸éƒ½åŒ…å«è®¸å¤šåº”ç”¨ç¨‹åºå¯¹è±¡ï¼Œæ¯”å¦‚ web æ–‡æ¡£ã€‚å½“æˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†å¿«é€Ÿå¢é•¿çš„ã€å¹¶ä¸”ç”±æ•°äº¿ä¸ªå¯¹è±¡æ„æˆçš„ã€æ•°ä»¥ TB çš„æ•°æ®é›†æ—¶ï¼Œé‡‡ç”¨ç®¡ç†æ•°äº¿ä¸ª KB å¤§å°çš„å°æ–‡ä»¶çš„æ–¹å¼æ˜¯éå¸¸ä¸æ˜æ™ºçš„ï¼Œå°½ç®¡æœ‰äº›æ–‡ä»¶ç³»ç»Ÿæ”¯æŒè¿™æ ·çš„ç®¡ç†æ–¹å¼ã€‚å› æ­¤ï¼Œè®¾è®¡çš„å‡è®¾æ¡ä»¶å’Œå‚æ•°ï¼Œæ¯”å¦‚ I/O æ“ä½œå’Œ Block çš„å°ºå¯¸éƒ½éœ€è¦é‡æ–°è€ƒè™‘ã€‚ ç¬¬ä¸‰ï¼Œç»å¤§éƒ¨åˆ†æ–‡ä»¶çš„ä¿®æ”¹æ˜¯é‡‡ç”¨åœ¨æ–‡ä»¶å°¾éƒ¨è¿½åŠ æ•°æ®ï¼Œè€Œä¸æ˜¯è¦†ç›–åŸæœ‰æ•°æ®çš„æ–¹å¼ã€‚å¯¹æ–‡ä»¶çš„éšæœºå†™å…¥æ“ä½œåœ¨å®é™…ä¸­å‡ ä¹ä¸å­˜åœ¨ã€‚ä¸€æ—¦å†™å®Œä¹‹åï¼Œå¯¹æ–‡ä»¶çš„æ“ä½œå°±åªæœ‰è¯»ï¼Œè€Œä¸”é€šå¸¸æ˜¯æŒ‰é¡ºåºè¯»ã€‚å¤§é‡çš„æ•°æ®ç¬¦åˆè¿™äº›ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼šæ•°æ®åˆ†æç¨‹åºæ‰«æçš„è¶…å¤§çš„æ•°æ®é›†ï¼›æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºç”Ÿæˆçš„è¿ç»­çš„æ•°æ®æµï¼›å­˜æ¡£çš„æ•°æ®ï¼›ç”±ä¸€å°æœºå™¨ç”Ÿæˆã€å¦å¤–ä¸€å°æœºå™¨å¤„ç†çš„ä¸­é—´æ•°æ®ï¼Œè¿™äº›ä¸­é—´æ•°æ®çš„å¤„ç†å¯èƒ½æ˜¯åŒæ—¶è¿›è¡Œçš„ã€ä¹Ÿå¯èƒ½æ˜¯åç»­æ‰å¤„ç†çš„ã€‚å¯¹äºè¿™ç§é’ˆå¯¹æµ·é‡æ–‡ä»¶çš„è®¿é—®æ¨¡å¼ï¼Œå®¢æˆ·ç«¯å¯¹æ•°æ®å—ç¼“å­˜æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ•°æ®çš„è¿½åŠ æ“ä½œæ˜¯æ€§èƒ½ä¼˜åŒ–å’ŒåŸå­æ€§ä¿è¯çš„ä¸»è¦è€ƒé‡å› ç´ ã€‚ ç¬¬å››ï¼Œåº”ç”¨ç¨‹åºå’Œæ–‡ä»¶ç³»ç»Ÿ API çš„ååŒè®¾è®¡æé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„çµæ´»æ€§ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æ”¾æ¾äº†å¯¹ GFS ä¸€è‡´æ€§æ¨¡å‹çš„è¦æ±‚ï¼Œè¿™æ ·å°±å‡è½»äº†æ–‡ä»¶ç³»ç»Ÿå¯¹åº”ç”¨ç¨‹åºçš„è‹›åˆ»è¦æ±‚ï¼Œå¤§å¤§ç®€åŒ–äº† GFS çš„è®¾è®¡ã€‚æˆ‘ä»¬å¼•å…¥äº†åŸå­æ€§çš„è®°å½•è¿½åŠ æ“ä½œï¼Œä»è€Œä¿è¯å¤šä¸ªå®¢æˆ·ç«¯èƒ½å¤ŸåŒæ—¶è¿›è¡Œè¿½åŠ æ“ä½œï¼Œä¸éœ€è¦é¢å¤–çš„åŒæ­¥æ“ä½œæ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚æœ¬æ–‡åé¢è¿˜æœ‰å¯¹è¿™äº›é—®é¢˜çš„ç»†èŠ‚çš„è¯¦ç»†è®¨è®ºã€‚ Google å·²ç»é’ˆå¯¹ä¸åŒçš„åº”ç”¨éƒ¨ç½²äº†å¤šå¥— GFS é›†ç¾¤ã€‚æœ€å¤§çš„ä¸€ä¸ªé›†ç¾¤æ‹¥æœ‰è¶…è¿‡ 1000 ä¸ªå­˜å‚¨èŠ‚ç‚¹ï¼Œè¶…è¿‡300TB çš„ç¡¬ç›˜ç©ºé—´ï¼Œè¢«ä¸åŒæœºå™¨ä¸Šçš„æ•°ç™¾ä¸ªå®¢æˆ·ç«¯è¿ç»­ä¸æ–­çš„é¢‘ç¹è®¿é—®ã€‚ è®¾è®¡æ¦‚è¿° è®¾è®¡é¢„æœŸåœ¨è®¾è®¡æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„æ–‡ä»¶ç³»ç»Ÿæ—¶å€™ï¼Œæˆ‘ä»¬çš„è®¾è®¡ç›®æ ‡æ—¢æœ‰æœºä¼šã€åˆæœ‰æŒ‘æˆ˜ã€‚ä¹‹å‰æˆ‘ä»¬å·²ç»æåˆ°äº†ä¸€äº›éœ€è¦å…³æ³¨çš„å…³é”®ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬å°†è®¾è®¡çš„é¢„æœŸç›®æ ‡çš„ç»†èŠ‚å±•å¼€è®¨è®ºã€‚ ç³»ç»Ÿç”±è®¸å¤šå»‰ä»·çš„æ™®é€šç»„ä»¶ç»„æˆï¼Œç»„ä»¶å¤±æ•ˆæ˜¯ä¸€ç§å¸¸æ€ã€‚ç³»ç»Ÿå¿…é¡»æŒç»­ç›‘æ§è‡ªèº«çš„çŠ¶æ€ï¼Œå®ƒå¿…é¡»å°†ç»„ä»¶å¤±æ•ˆä½œä¸ºä¸€ç§å¸¸æ€ï¼Œèƒ½å¤Ÿè¿…é€Ÿåœ°ä¾¦æµ‹ã€å†—ä½™å¹¶æ¢å¤å¤±æ•ˆçš„ç»„ä»¶ã€‚ ç³»ç»Ÿå­˜å‚¨ä¸€å®šæ•°é‡çš„å¤§æ–‡ä»¶ã€‚æˆ‘ä»¬é¢„æœŸä¼šæœ‰å‡ ç™¾ä¸‡æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å¤§å°é€šå¸¸åœ¨ 100MB æˆ–è€…ä»¥ä¸Šã€‚æ•°ä¸ª GBå¤§å°çš„æ–‡ä»¶ä¹Ÿæ˜¯æ™®éå­˜åœ¨ï¼Œå¹¶ä¸”è¦èƒ½å¤Ÿè¢«æœ‰æ•ˆçš„ç®¡ç†ã€‚ç³»ç»Ÿä¹Ÿå¿…é¡»æ”¯æŒå°æ–‡ä»¶ï¼Œä½†æ˜¯ä¸éœ€è¦é’ˆå¯¹å°æ–‡ä»¶åšä¸“é—¨çš„ä¼˜åŒ–ã€‚ ç³»ç»Ÿçš„å·¥ä½œè´Ÿè½½ä¸»è¦ç”±ä¸¤ç§è¯»æ“ä½œç»„æˆï¼šå¤§è§„æ¨¡çš„æµå¼è¯»å–å’Œå°è§„æ¨¡çš„éšæœºè¯»å–ã€‚å¤§è§„æ¨¡çš„æµå¼è¯»å–é€šå¸¸ä¸€æ¬¡è¯»å–æ•°ç™¾ KB çš„æ•°æ®ï¼Œæ›´å¸¸è§çš„æ˜¯ä¸€æ¬¡è¯»å– 1MB ç”šè‡³æ›´å¤šçš„æ•°æ®ã€‚æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·æœºçš„è¿ç»­æ“ä½œé€šå¸¸æ˜¯è¯»å–åŒä¸€ä¸ªæ–‡ä»¶ä¸­è¿ç»­çš„ä¸€ä¸ªåŒºåŸŸã€‚å°è§„æ¨¡çš„éšæœºè¯»å–é€šå¸¸æ˜¯åœ¨æ–‡ä»¶æŸä¸ªéšæœºçš„ä½ç½®è¯»å–å‡ ä¸ª KB æ•°æ®ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯¹æ€§èƒ½éå¸¸å…³æ³¨ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æŠŠå°è§„æ¨¡çš„éšæœºè¯»å–æ“ä½œåˆå¹¶å¹¶æ’åºï¼Œä¹‹åæŒ‰é¡ºåºæ‰¹é‡è¯»å–ï¼Œè¿™æ ·å°±é¿å…äº†åœ¨æ–‡ä»¶ä¸­å‰åæ¥å›çš„ç§»åŠ¨è¯»å–ä½ç½®ã€‚ ç³»ç»Ÿçš„å·¥ä½œè´Ÿè½½è¿˜åŒ…æ‹¬è®¸å¤šå¤§è§„æ¨¡çš„ã€é¡ºåºçš„ã€æ•°æ®è¿½åŠ æ–¹å¼çš„å†™æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯æ¬¡å†™å…¥çš„æ•°æ®çš„å¤§å°å’Œå¤§è§„æ¨¡è¯»ç±»ä¼¼ã€‚æ•°æ®ä¸€æ—¦è¢«å†™å…¥åï¼Œæ–‡ä»¶å°±å¾ˆå°‘ä¼šè¢«ä¿®æ”¹äº†ã€‚ç³»ç»Ÿæ”¯æŒå°è§„æ¨¡çš„éšæœºä½ç½®å†™å…¥æ“ä½œï¼Œä½†æ˜¯å¯èƒ½æ•ˆç‡ä¸å½°ã€‚ ç³»ç»Ÿå¿…é¡»é«˜æ•ˆçš„ã€è¡Œä¸ºå®šä¹‰æ˜ç¡®çš„ï¼ˆåŸæ–‡ï¼šwell-definedï¼‰å®ç°å¤šå®¢æˆ·ç«¯å¹¶è¡Œè¿½åŠ æ•°æ®åˆ°åŒä¸€ä¸ªæ–‡ä»¶é‡Œçš„è¯­æ„ã€‚æˆ‘ä»¬çš„æ–‡ä»¶é€šå¸¸è¢«ç”¨äºâ€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€é˜Ÿåˆ—ï¼Œæˆ–è€…å…¶å®ƒå¤šè·¯æ–‡ä»¶åˆå¹¶æ“ä½œã€‚é€šå¸¸ä¼šæœ‰æ•°ç™¾ä¸ªç”Ÿäº§è€…ï¼Œæ¯ä¸ªç”Ÿäº§è€…è¿›ç¨‹è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼ŒåŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¿½åŠ æ“ä½œã€‚ä½¿ç”¨æœ€å°çš„åŒæ­¥å¼€é”€æ¥å®ç°çš„åŸå­çš„å¤šè·¯è¿½åŠ æ•°æ®æ“ä½œæ˜¯å¿…ä¸å¯å°‘çš„ã€‚æ–‡ä»¶å¯ä»¥åœ¨ç¨åè¯»å–ï¼Œæˆ–è€…æ˜¯æ¶ˆè´¹è€…åœ¨è¿½åŠ çš„æ“ä½œçš„åŒæ—¶è¯»å–æ–‡ä»¶ã€‚ é«˜æ€§èƒ½çš„ç¨³å®šç½‘ç»œå¸¦å®½è¿œæ¯”ä½å»¶è¿Ÿé‡è¦ã€‚æˆ‘ä»¬çš„ç›®æ ‡ç¨‹åºç»å¤§éƒ¨åˆ†è¦æ±‚èƒ½å¤Ÿé«˜é€Ÿç‡çš„ã€å¤§æ‰¹é‡çš„å¤„ç†æ•°æ®ï¼Œæå°‘æœ‰ç¨‹åºå¯¹å•ä¸€çš„è¯»å†™æ“ä½œæœ‰ä¸¥æ ¼çš„å“åº”æ—¶é—´è¦æ±‚ã€‚ æ¥å£GFS æä¾›äº†ä¸€å¥—ç±»ä¼¼ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿçš„ API æ¥å£å‡½æ•°ï¼Œè™½ç„¶å¹¶ä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§ POSIX ç­‰æ ‡å‡† API çš„å½¢å¼å®ç°çš„ã€‚æ–‡ä»¶ä»¥åˆ†å±‚ç›®å½•çš„å½¢å¼ç»„ç»‡ï¼Œç”¨è·¯å¾„åæ¥æ ‡è¯†ã€‚æˆ‘ä»¬æ”¯æŒå¸¸ç”¨çš„æ“ä½œï¼Œå¦‚åˆ›å»ºæ–°æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶ã€æ‰“å¼€æ–‡ä»¶ã€å…³é—­æ–‡ä»¶ã€è¯»å’Œå†™æ–‡ä»¶ã€‚ å¦å¤–ï¼ŒGFS æä¾›äº†å¿«ç…§å’Œè®°å½•è¿½åŠ æ“ä½œã€‚å¿«ç…§ä»¥å¾ˆä½çš„æˆæœ¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•æ ‘çš„æ‹·è´ã€‚è®°å½•è¿½åŠ æ“ä½œå…è®¸å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œæ•°æ®è¿½åŠ æ“ä½œï¼ŒåŒæ—¶ä¿è¯æ¯ä¸ªå®¢æˆ·ç«¯çš„è¿½åŠ æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚è¿™å¯¹äºå®ç°å¤šè·¯ç»“æœåˆå¹¶ï¼Œä»¥åŠâ€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€é˜Ÿåˆ—éå¸¸æœ‰ç”¨ï¼Œå¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥åœ¨ä¸éœ€è¦é¢å¤–çš„åŒæ­¥é”å®šçš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿½åŠ æ•°æ®ã€‚æˆ‘ä»¬å‘ç°è¿™äº›ç±»å‹çš„æ–‡ä»¶å¯¹äºæ„å»ºå¤§å‹åˆ†å¸ƒåº”ç”¨æ˜¯éå¸¸é‡è¦çš„ã€‚å¿«ç…§å’Œè®°å½•è¿½åŠ æ“ä½œå°†åœ¨ 3.4 å’Œ 3.3 èŠ‚åˆ†åˆ«è®¨è®ºã€‚ æ¶æ„ä¸€ä¸ª GFS é›†ç¾¤åŒ…å«ä¸€ä¸ªå•ç‹¬çš„ Master èŠ‚ç‚¹ï¼ˆè¿™é‡Œçš„ä¸€ä¸ªå•ç‹¬çš„ Master èŠ‚ç‚¹çš„å«ä¹‰æ˜¯ GFS ç³»ç»Ÿä¸­åªå­˜åœ¨ä¸€ä¸ªé€»è¾‘ä¸Šçš„ Master ç»„ä»¶ã€‚åé¢æˆ‘ä»¬è¿˜ä¼šæåˆ° Master èŠ‚ç‚¹å¤åˆ¶ï¼Œå› æ­¤ï¼Œä¸ºäº†ç†è§£æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠ Master èŠ‚ç‚¹è§†ä¸ºä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œä¸€ä¸ªé€»è¾‘çš„ Master èŠ‚ç‚¹åŒ…æ‹¬ä¸¤å°ç‰©ç†ä¸»æœºï¼‰ã€å¤šå° Chunk æœåŠ¡å™¨ï¼Œå¹¶ä¸”åŒæ—¶è¢«å¤šä¸ªå®¢æˆ·ç«¯è®¿é—®ï¼Œå¦‚å›¾ 1æ‰€ç¤ºã€‚æ‰€æœ‰çš„è¿™äº›æœºå™¨é€šå¸¸éƒ½æ˜¯æ™®é€šçš„ Linux æœºå™¨ï¼Œè¿è¡Œç€ç”¨æˆ·çº§åˆ«(user-level)çš„æœåŠ¡è¿›ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„æŠŠ Chunk æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æ”¾åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå‰ææ˜¯æœºå™¨èµ„æºå…è®¸ï¼Œå¹¶ä¸”æˆ‘ä»¬èƒ½å¤Ÿæ¥å—ä¸å¯é çš„åº”ç”¨ç¨‹åºä»£ç å¸¦æ¥çš„ç¨³å®šæ€§é™ä½çš„é£é™©ã€‚GFS å­˜å‚¨çš„æ–‡ä»¶éƒ½è¢«åˆ†å‰²æˆå›ºå®šå¤§å°çš„ Chunkã€‚åœ¨ Chunk åˆ›å»ºçš„æ—¶å€™ï¼ŒMaster æœåŠ¡å™¨ä¼šç»™æ¯ä¸ª Chunk åˆ†é…ä¸€ä¸ªä¸å˜çš„ã€å…¨çƒå”¯ä¸€çš„ 64 ä½çš„ Chunk æ ‡è¯†ã€‚Chunk æœåŠ¡å™¨æŠŠ Chunk ä»¥ Linux æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨æœ¬åœ°ç¡¬ç›˜ä¸Šï¼Œå¹¶ä¸”æ ¹æ®æŒ‡å®šçš„ Chunk æ ‡è¯†å’Œå­—èŠ‚èŒƒå›´æ¥è¯»å†™å—æ•°æ®ã€‚å‡ºäºå¯é æ€§çš„è€ƒè™‘ï¼Œæ¯ä¸ªå—éƒ½ä¼šå¤åˆ¶åˆ°å¤šä¸ªå—æœåŠ¡å™¨ä¸Šã€‚ç¼ºçœæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ 3 ä¸ªå­˜å‚¨å¤åˆ¶èŠ‚ç‚¹ï¼Œä¸è¿‡ç”¨æˆ·å¯ä»¥ä¸ºä¸åŒçš„æ–‡ä»¶å‘½åç©ºé—´è®¾å®šä¸åŒçš„å¤åˆ¶çº§åˆ«ã€‚ Master èŠ‚ç‚¹ç®¡ç†æ‰€æœ‰çš„æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®ã€‚è¿™äº›å…ƒæ•°æ®åŒ…æ‹¬åå­—ç©ºé—´ã€è®¿é—®æ§åˆ¶ä¿¡æ¯ã€æ–‡ä»¶å’Œ Chunk çš„æ˜ å°„ä¿¡æ¯ã€ä»¥åŠå½“å‰ Chunk çš„ä½ç½®ä¿¡æ¯ã€‚Master èŠ‚ç‚¹è¿˜ç®¡ç†ç€ç³»ç»ŸèŒƒå›´å†…çš„æ´»åŠ¨ï¼Œæ¯”å¦‚ï¼ŒChunk ç§Ÿç”¨ç®¡ç†ï¼ˆBDB ä¹Ÿæœ‰å…³äº lease çš„æè¿°ï¼Œä¸çŸ¥é“æ˜¯å¦ç›¸åŒï¼‰ã€å­¤å„¿ Chunkï¼ˆåŸæ–‡ï¼šorphaned chunksï¼‰çš„å›æ”¶ã€ä»¥åŠ Chunk åœ¨ Chunk æœåŠ¡å™¨ä¹‹é—´çš„è¿ç§»ã€‚Master èŠ‚ç‚¹ä½¿ç”¨å¿ƒè·³ä¿¡æ¯å‘¨æœŸåœ°å’Œæ¯ä¸ª ChunkæœåŠ¡å™¨é€šè®¯ï¼Œå‘é€æŒ‡ä»¤åˆ°å„ä¸ª Chunk æœåŠ¡å™¨å¹¶æ¥æ”¶ Chunk æœåŠ¡å™¨çš„çŠ¶æ€ä¿¡æ¯ã€‚ GFS å®¢æˆ·ç«¯ä»£ç ä»¥åº“çš„å½¢å¼è¢«é“¾æ¥åˆ°å®¢æˆ·ç¨‹åºé‡Œã€‚å®¢æˆ·ç«¯ä»£ç å®ç°äº† GFS æ–‡ä»¶ç³»ç»Ÿçš„ API æ¥å£å‡½æ•°ã€åº”ç”¨ç¨‹åºä¸ Master èŠ‚ç‚¹å’Œ Chunk æœåŠ¡å™¨é€šè®¯ã€ä»¥åŠå¯¹æ•°æ®è¿›è¡Œè¯»å†™æ“ä½œã€‚å®¢æˆ·ç«¯å’Œ Master èŠ‚ç‚¹çš„é€šä¿¡åªè·å–å…ƒæ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®æ“ä½œéƒ½æ˜¯ç”±å®¢æˆ·ç«¯ç›´æ¥å’Œ Chunk æœåŠ¡å™¨è¿›è¡Œäº¤äº’çš„ã€‚æˆ‘ä»¬ä¸æä¾› POSIX æ ‡å‡†çš„ API çš„åŠŸèƒ½ï¼Œå› æ­¤ï¼ŒGFS API è°ƒç”¨ä¸éœ€è¦æ·±å…¥åˆ° Linux vnode çº§åˆ«ã€‚ æ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯ Chunk æœåŠ¡å™¨éƒ½ä¸éœ€è¦ç¼“å­˜æ–‡ä»¶æ•°æ®ã€‚å®¢æˆ·ç«¯ç¼“å­˜æ•°æ®å‡ ä¹æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ç¨‹åºè¦ä¹ˆä»¥æµçš„æ–¹å¼è¯»å–ä¸€ä¸ªå·¨å¤§æ–‡ä»¶ï¼Œè¦ä¹ˆå·¥ä½œé›†å¤ªå¤§æ ¹æœ¬æ— æ³•è¢«ç¼“å­˜ã€‚æ— éœ€è€ƒè™‘ç¼“å­˜ç›¸å…³çš„é—®é¢˜ä¹Ÿç®€åŒ–äº†å®¢æˆ·ç«¯å’Œæ•´ä¸ªç³»ç»Ÿçš„è®¾è®¡å’Œå®ç°ï¼ˆæ³¨ï¼šä¸è¿‡ï¼Œå®¢æˆ·ç«¯ä¼šç¼“å­˜å…ƒæ•°æ®ã€‚ï¼‰ã€‚Chunk æœåŠ¡å™¨ä¸éœ€è¦ç¼“å­˜æ–‡ä»¶æ•°æ®çš„åŸå› æ˜¯ï¼ŒChunk ä»¥æœ¬åœ°æ–‡ä»¶çš„æ–¹å¼ä¿å­˜ï¼ŒLinux æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¼šæŠŠç»å¸¸è®¿é—®çš„æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ å•ä¸€ Master èŠ‚ç‚¹å•ä¸€çš„ Master èŠ‚ç‚¹çš„ç­–ç•¥å¤§å¤§ç®€åŒ–äº†æˆ‘ä»¬çš„è®¾è®¡ã€‚å•ä¸€çš„ Master èŠ‚ç‚¹å¯ä»¥é€šè¿‡å…¨å±€çš„ä¿¡æ¯ç²¾ç¡®å®šä½Chunk çš„ä½ç½®ä»¥åŠè¿›è¡Œå¤åˆ¶å†³ç­–ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¿…é¡»å‡å°‘å¯¹ Master èŠ‚ç‚¹çš„è¯»å†™ï¼Œé¿å… Master èŠ‚ç‚¹æˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆã€‚å®¢æˆ·ç«¯å¹¶ä¸é€šè¿‡ Master èŠ‚ç‚¹è¯»å†™æ–‡ä»¶æ•°æ®ã€‚åä¹‹ï¼Œå®¢æˆ·ç«¯å‘ Master èŠ‚ç‚¹è¯¢é—®å®ƒåº”è¯¥è”ç³»çš„ Chunk æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯å°†è¿™äº›å…ƒæ•°æ®ä¿¡æ¯ç¼“å­˜ä¸€æ®µæ—¶é—´ï¼Œåç»­çš„æ“ä½œå°†ç›´æ¥å’Œ Chunk æœåŠ¡å™¨è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œã€‚ æˆ‘ä»¬åˆ©ç”¨å›¾ 1 è§£é‡Šä¸€ä¸‹ä¸€æ¬¡ç®€å•è¯»å–çš„æµç¨‹ã€‚é¦–å…ˆï¼Œå®¢æˆ·ç«¯æŠŠæ–‡ä»¶åå’Œç¨‹åºæŒ‡å®šçš„å­—èŠ‚åç§»ï¼Œæ ¹æ®å›ºå®šçš„ Chunk å¤§å°ï¼Œè½¬æ¢æˆæ–‡ä»¶çš„ Chunk ç´¢å¼•ã€‚ç„¶åï¼Œå®ƒæŠŠæ–‡ä»¶åå’Œ Chunk ç´¢å¼•å‘é€ç»™ Master èŠ‚ç‚¹ã€‚Master èŠ‚ç‚¹å°†ç›¸åº”çš„ Chunk æ ‡è¯†å’Œå‰¯æœ¬çš„ä½ç½®ä¿¡æ¯å‘è¿˜ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ç”¨æ–‡ä»¶åå’Œ Chunk ç´¢å¼•ä½œä¸º key ç¼“å­˜è¿™äº›ä¿¡æ¯ã€‚ ä¹‹åå®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°å…¶ä¸­çš„ä¸€ä¸ªå‰¯æœ¬å¤„ï¼Œä¸€èˆ¬ä¼šé€‰æ‹©æœ€è¿‘çš„ã€‚è¯·æ±‚ä¿¡æ¯åŒ…å«äº† Chunk çš„æ ‡è¯†å’Œå­—èŠ‚èŒƒå›´ã€‚åœ¨å¯¹è¿™ä¸ª Chunk çš„åç»­è¯»å–æ“ä½œä¸­ï¼Œå®¢æˆ·ç«¯ä¸å¿…å†å’Œ Master èŠ‚ç‚¹é€šè®¯äº†ï¼Œé™¤éç¼“å­˜çš„å…ƒæ•°æ®ä¿¡æ¯è¿‡æœŸæˆ–è€…æ–‡ä»¶è¢«é‡æ–°æ‰“å¼€ã€‚å®é™…ä¸Šï¼Œå®¢æˆ·ç«¯é€šå¸¸ä¼šåœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æŸ¥è¯¢å¤šä¸ª Chunk ä¿¡æ¯ï¼ŒMaster èŠ‚ç‚¹çš„å›åº”ä¹Ÿå¯èƒ½åŒ…å«äº†ç´§è·Ÿç€è¿™äº›è¢«è¯·æ±‚çš„ Chunk åé¢çš„ Chunk çš„ä¿¡æ¯ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™äº›é¢å¤–çš„ä¿¡æ¯åœ¨æ²¡æœ‰ä»»ä½•ä»£ä»·çš„æƒ…å†µä¸‹ï¼Œé¿å…äº†å®¢æˆ·ç«¯å’Œ Master èŠ‚ç‚¹æœªæ¥å¯èƒ½ä¼šå‘ç”Ÿçš„å‡ æ¬¡é€šè®¯ã€‚ Chunk å°ºå¯¸Chunk çš„å¤§å°æ˜¯å…³é”®çš„è®¾è®¡å‚æ•°ä¹‹ä¸€ã€‚æˆ‘ä»¬é€‰æ‹©äº† 64MBï¼Œè¿™ä¸ªå°ºå¯¸è¿œè¿œå¤§äºä¸€èˆ¬æ–‡ä»¶ç³»ç»Ÿçš„ Block sizeã€‚æ¯ä¸ª Chunk çš„å‰¯æœ¬éƒ½ä»¥æ™®é€š Linux æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨ Chunk æœåŠ¡å™¨ä¸Šï¼Œåªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰æ‰©å¤§ã€‚æƒ°æ€§ç©ºé—´åˆ†é…ç­–ç•¥é¿å…äº†å› å†…éƒ¨ç¢ç‰‡é€ æˆçš„ç©ºé—´æµªè´¹ï¼Œå†…éƒ¨ç¢ç‰‡æˆ–è®¸æ˜¯å¯¹é€‰æ‹©è¿™ä¹ˆå¤§çš„ Chunk å°ºå¯¸æœ€å…·äº‰è®®ä¸€ç‚¹ã€‚ é€‰æ‹©è¾ƒå¤§çš„ Chunk å°ºå¯¸æœ‰å‡ ä¸ªé‡è¦çš„ä¼˜ç‚¹ã€‚é¦–å…ˆï¼Œå®ƒå‡å°‘äº†å®¢æˆ·ç«¯å’Œ Master èŠ‚ç‚¹é€šè®¯çš„éœ€æ±‚ï¼Œå› ä¸ºåªéœ€è¦ä¸€æ¬¡å’Œ Mater èŠ‚ç‚¹çš„é€šä¿¡å°±å¯ä»¥è·å– Chunk çš„ä½ç½®ä¿¡æ¯ï¼Œä¹‹åå°±å¯ä»¥å¯¹åŒä¸€ä¸ª Chunk è¿›è¡Œå¤šæ¬¡çš„è¯»å†™æ“ä½œã€‚è¿™ç§æ–¹å¼å¯¹é™ä½æˆ‘ä»¬çš„å·¥ä½œè´Ÿè½½æ¥è¯´æ•ˆæœæ˜¾è‘—ï¼Œå› ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé€šå¸¸æ˜¯è¿ç»­è¯»å†™å¤§æ–‡ä»¶ã€‚å³ä½¿æ˜¯å°è§„æ¨¡çš„éšæœºè¯»å–ï¼Œé‡‡ç”¨è¾ƒå¤§çš„ Chunk å°ºå¯¸ä¹Ÿå¸¦æ¥æ˜æ˜¾çš„å¥½å¤„ï¼Œå®¢æˆ·ç«¯å¯ä»¥è½»æ¾çš„ç¼“å­˜ä¸€ä¸ªæ•° TB çš„å·¥ä½œæ•°æ®é›†æ‰€æœ‰çš„ Chunk ä½ç½®ä¿¡æ¯ã€‚å…¶æ¬¡ï¼Œé‡‡ç”¨è¾ƒå¤§çš„ Chunk å°ºå¯¸ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿå¯¹ä¸€ä¸ªå—è¿›è¡Œå¤šæ¬¡æ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ä¸ Chunk æœåŠ¡å™¨ä¿æŒè¾ƒé•¿æ—¶é—´çš„ TCP è¿æ¥æ¥å‡å°‘ç½‘ç»œè´Ÿè½½ã€‚ç¬¬ä¸‰ï¼Œé€‰ç”¨è¾ƒå¤§çš„ Chunk å°ºå¯¸å‡å°‘äº† MasterèŠ‚ç‚¹éœ€è¦ä¿å­˜çš„å…ƒæ•°æ®çš„æ•°é‡ã€‚è¿™å°±å…è®¸æˆ‘ä»¬æŠŠå…ƒæ•°æ®å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­ï¼Œåœ¨ 2.6.1 èŠ‚æˆ‘ä»¬ä¼šè®¨è®ºå…ƒæ•°æ®å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­å¸¦æ¥çš„é¢å¤–çš„å¥½å¤„ã€‚ å¦ä¸€æ–¹é¢ï¼Œå³ä½¿é…åˆæƒ°æ€§ç©ºé—´åˆ†é…ï¼Œé‡‡ç”¨è¾ƒå¤§çš„ Chunk å°ºå¯¸ä¹Ÿæœ‰å…¶ç¼ºé™·ã€‚å°æ–‡ä»¶åŒ…å«è¾ƒå°‘çš„ Chunkï¼Œç”šè‡³åªæœ‰ä¸€ä¸ª Chunkã€‚å½“æœ‰è®¸å¤šçš„å®¢æˆ·ç«¯å¯¹åŒä¸€ä¸ªå°æ–‡ä»¶è¿›è¡Œå¤šæ¬¡çš„è®¿é—®æ—¶ï¼Œå­˜å‚¨è¿™äº› Chunk çš„ Chunk æœåŠ¡å™¨å°±ä¼šå˜æˆçƒ­ç‚¹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”±äºæˆ‘ä»¬çš„ç¨‹åºé€šå¸¸æ˜¯è¿ç»­çš„è¯»å–åŒ…å«å¤šä¸ª Chunk çš„å¤§æ–‡ä»¶ï¼Œçƒ­ç‚¹è¿˜ä¸æ˜¯ä¸»è¦çš„é—®é¢˜ã€‚ ç„¶è€Œï¼Œå½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡æŠŠ GFS ç”¨äºæ‰¹å¤„ç†é˜Ÿåˆ—ç³»ç»Ÿçš„æ—¶å€™ï¼Œçƒ­ç‚¹çš„é—®é¢˜è¿˜æ˜¯äº§ç”Ÿäº†ï¼šä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åœ¨GFS ä¸Šä¿å­˜ä¸º single-chunk æ–‡ä»¶ï¼Œä¹‹åè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åœ¨æ•°ç™¾å°æœºå™¨ä¸ŠåŒæ—¶å¯åŠ¨ã€‚å­˜æ”¾è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„å‡ ä¸ª Chunk æœåŠ¡å™¨è¢«æ•°ç™¾ä¸ªå®¢æˆ·ç«¯çš„å¹¶å‘è¯·æ±‚è®¿é—®å¯¼è‡´ç³»ç»Ÿå±€éƒ¨è¿‡è½½ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨æ›´å¤§çš„å¤åˆ¶å‚æ•°æ¥ä¿å­˜å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»¥åŠé”™å¼€æ‰¹å¤„ç†é˜Ÿåˆ—ç³»ç»Ÿç¨‹åºçš„å¯åŠ¨æ—¶é—´çš„æ–¹æ³•è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¸€ä¸ªå¯èƒ½çš„é•¿æ•ˆè§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨è¿™ç§çš„æƒ…å†µä¸‹ï¼Œå…è®¸å®¢æˆ·ç«¯ä»å…¶å®ƒå®¢æˆ·ç«¯è¯»å–æ•°æ®ã€‚ å…ƒæ•°æ®Master æœåŠ¡å™¨ï¼ˆæ³¨æ„é€»è¾‘çš„ Master èŠ‚ç‚¹å’Œç‰©ç†çš„ Master æœåŠ¡å™¨çš„åŒºåˆ«ã€‚åç»­æˆ‘ä»¬è°ˆçš„æ˜¯æ¯ä¸ª Master æœåŠ¡å™¨çš„è¡Œä¸ºï¼Œå¦‚å­˜å‚¨ã€å†…å­˜ç­‰ç­‰ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¨éƒ¨ä½¿ç”¨ç‰©ç†åç§°ï¼‰å­˜å‚¨ 3 ç§ä¸»è¦ç±»å‹çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ï¼šæ–‡ä»¶å’Œ Chunk çš„å‘½åç©ºé—´ã€æ–‡ä»¶å’Œ Chunk çš„å¯¹åº”å…³ç³»ã€æ¯ä¸ª Chunk å‰¯æœ¬çš„å­˜æ”¾åœ°ç‚¹ã€‚æ‰€æœ‰çš„å…ƒæ•°æ®éƒ½ä¿å­˜åœ¨ Master æœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚å‰ä¸¤ç§ç±»å‹çš„ å…ƒæ•°æ®ï¼ˆå…ƒæ•°æ®ï¼šå‘½åç©ºé—´ã€æ–‡ä»¶å’Œ Chunk çš„å¯¹åº”å…³ç³»ï¼‰åŒæ—¶ä¹Ÿä¼šä»¥è®°å½•å˜æ›´æ—¥å¿—çš„æ–¹å¼è®°å½•åœ¨æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°ç£ç›˜ä¸Šï¼ŒåŒæ—¶æ—¥å¿—ä¼šè¢«å¤åˆ¶åˆ°å…¶å®ƒçš„è¿œç¨‹MasteræœåŠ¡å™¨ä¸Šã€‚é‡‡ç”¨ä¿å­˜å˜æ›´æ—¥å¿—çš„æ–¹å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç®€å•å¯é çš„æ›´æ–° Master æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¸ç”¨æ‹…å¿ƒ Master æœåŠ¡å™¨å´©æºƒå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚Master æœåŠ¡å™¨ä¸ä¼šæŒä¹…ä¿å­˜ Chunk ä½ç½®ä¿¡æ¯ã€‚MasteræœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶ï¼Œæˆ–è€…æœ‰æ–°çš„ Chunk æœåŠ¡å™¨åŠ å…¥æ—¶ï¼Œå‘å„ä¸ª Chunk æœåŠ¡å™¨è½®è¯¢å®ƒä»¬æ‰€å­˜å‚¨çš„ Chunk çš„ä¿¡æ¯ã€‚ å†…å­˜ä¸­çš„æ•°æ®ç»“æ„å› ä¸ºå…ƒæ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥ Master æœåŠ¡å™¨çš„æ“ä½œé€Ÿåº¦éå¸¸å¿«ã€‚å¹¶ä¸”ï¼ŒMaster æœåŠ¡å™¨å¯ä»¥åœ¨åå°ç®€å•è€Œé«˜æ•ˆçš„å‘¨æœŸæ€§æ‰«æè‡ªå·±ä¿å­˜çš„å…¨éƒ¨çŠ¶æ€ä¿¡æ¯ã€‚è¿™ç§å‘¨æœŸæ€§çš„çŠ¶æ€æ‰«æä¹Ÿç”¨äºå®ç° Chunk åƒåœ¾æ”¶é›†ã€åœ¨ ChunkæœåŠ¡å™¨å¤±æ•ˆçš„æ—¶é‡æ–°å¤åˆ¶æ•°æ®ã€é€šè¿‡ Chunk çš„è¿ç§»å®ç°è·¨ Chunk æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ä»¥åŠç£ç›˜ä½¿ç”¨çŠ¶å†µç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚4.3 å’Œ 4.4 ç« èŠ‚å°†æ·±å…¥è®¨è®ºè¿™äº›è¡Œä¸ºã€‚ å°†å…ƒæ•°æ®å…¨éƒ¨ä¿å­˜åœ¨å†…å­˜ä¸­çš„æ–¹æ³•æœ‰æ½œåœ¨é—®é¢˜ï¼šChunk çš„æ•°é‡ä»¥åŠæ•´ä¸ªç³»ç»Ÿçš„æ‰¿è½½èƒ½åŠ›éƒ½å—é™äº MasteræœåŠ¡å™¨æ‰€æ‹¥æœ‰çš„å†…å­˜å¤§å°ã€‚ä½†æ˜¯åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ã€‚Master æœåŠ¡å™¨åªéœ€è¦ä¸åˆ° 64 ä¸ªå­—èŠ‚çš„å…ƒæ•°æ®å°±èƒ½å¤Ÿç®¡ç†ä¸€ä¸ª 64MB çš„ Chunkã€‚ç”±äºå¤§å¤šæ•°æ–‡ä»¶éƒ½åŒ…å«å¤šä¸ª Chunkï¼Œå› æ­¤ç»å¤§å¤šæ•° Chunk éƒ½æ˜¯æ»¡çš„ï¼Œé™¤äº†æ–‡ä»¶çš„æœ€åä¸€ä¸ª Chunk æ˜¯éƒ¨åˆ†å¡«å……çš„ã€‚åŒæ ·çš„ï¼Œæ¯ä¸ªæ–‡ä»¶çš„åœ¨å‘½åç©ºé—´ä¸­çš„æ•°æ®å¤§å°é€šå¸¸åœ¨ 64å­—èŠ‚ä»¥ä¸‹ï¼Œå› ä¸ºä¿å­˜çš„æ–‡ä»¶åæ˜¯ç”¨å‰ç¼€å‹ç¼©ç®—æ³•å‹ç¼©è¿‡çš„ã€‚ å³ä¾¿æ˜¯éœ€è¦æ”¯æŒæ›´å¤§çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸º Master æœåŠ¡å™¨å¢åŠ é¢å¤–å†…å­˜çš„è´¹ç”¨æ˜¯å¾ˆå°‘çš„ï¼Œè€Œé€šè¿‡å¢åŠ æœ‰é™çš„è´¹ç”¨ï¼Œæˆ‘ä»¬å°±èƒ½å¤ŸæŠŠå…ƒæ•°æ®å…¨éƒ¨ä¿å­˜åœ¨å†…å­˜é‡Œï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„ç®€æ´æ€§ã€å¯é æ€§ã€é«˜æ€§èƒ½å’Œçµæ´»æ€§ã€‚ Chunk ä½ç½®ä¿¡æ¯Master æœåŠ¡å™¨å¹¶ä¸ä¿å­˜æŒä¹…åŒ–ä¿å­˜å“ªä¸ª Chunk æœåŠ¡å™¨å­˜æœ‰æŒ‡å®š Chunk çš„å‰¯æœ¬çš„ä¿¡æ¯ã€‚Master æœåŠ¡å™¨åªæ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™è½®è¯¢ Chunk æœåŠ¡å™¨ä»¥è·å–è¿™äº›ä¿¡æ¯ã€‚Master æœåŠ¡å™¨èƒ½å¤Ÿä¿è¯å®ƒæŒæœ‰çš„ä¿¡æ¯å§‹ç»ˆæ˜¯æœ€æ–°çš„ï¼Œå› ä¸ºå®ƒæ§åˆ¶äº†æ‰€æœ‰çš„ Chunk ä½ç½®çš„åˆ†é…ï¼Œè€Œä¸”é€šè¿‡å‘¨æœŸæ€§çš„å¿ƒè·³ä¿¡æ¯ç›‘æ§ Chunk æœåŠ¡å™¨çš„çŠ¶æ€ã€‚ æœ€åˆè®¾è®¡æ—¶ï¼Œæˆ‘ä»¬è¯•å›¾æŠŠ Chunk çš„ä½ç½®ä¿¡æ¯æŒä¹…çš„ä¿å­˜åœ¨ Master æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯åæ¥æˆ‘ä»¬å‘ç°åœ¨å¯åŠ¨çš„æ—¶å€™è½®è¯¢ Chunk æœåŠ¡å™¨ï¼Œä¹‹åå®šæœŸè½®è¯¢æ›´æ–°çš„æ–¹å¼æ›´ç®€å•ã€‚è¿™ç§è®¾è®¡ç®€åŒ–äº†åœ¨æœ‰ Chunk æœåŠ¡å™¨åŠ å…¥é›†ç¾¤ã€ç¦»å¼€é›†ç¾¤ã€æ›´åã€å¤±æ•ˆã€ä»¥åŠé‡å¯çš„æ—¶å€™ï¼ŒMaster æœåŠ¡å™¨å’Œ Chunk æœåŠ¡å™¨æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚åœ¨ä¸€ä¸ªæ‹¥æœ‰æ•°ç™¾å°æœåŠ¡å™¨çš„é›†ç¾¤ä¸­ï¼Œè¿™ç±»äº‹ä»¶ä¼šé¢‘ç¹çš„å‘ç”Ÿã€‚ å¯ä»¥ä»å¦å¤–ä¸€ä¸ªè§’åº¦å»ç†è§£è¿™ä¸ªè®¾è®¡å†³ç­–ï¼šåªæœ‰ Chunk æœåŠ¡å™¨æ‰èƒ½æœ€ç»ˆç¡®å®šä¸€ä¸ª Chunk æ˜¯å¦åœ¨å®ƒçš„ç¡¬ç›˜ä¸Šã€‚æˆ‘ä»¬ä»æ²¡æœ‰è€ƒè™‘è¿‡åœ¨ Master æœåŠ¡å™¨ä¸Šç»´æŠ¤ä¸€ä¸ªè¿™äº›ä¿¡æ¯çš„å…¨å±€è§†å›¾ï¼Œå› ä¸º Chunk æœåŠ¡å™¨çš„é”™è¯¯å¯èƒ½ä¼šå¯¼è‡´ Chunk è‡ªåŠ¨æ¶ˆå¤±(æ¯”å¦‚ï¼Œç¡¬ç›˜æŸåäº†æˆ–è€…æ— æ³•è®¿é—®äº†)ï¼Œäº¦æˆ–è€…æ“ä½œäººå‘˜å¯èƒ½ä¼šé‡å‘½åä¸€ä¸ª Chunk æœåŠ¡å™¨ã€‚ æ“ä½œæ—¥å¿—æ“ä½œæ—¥å¿—åŒ…å«äº†å…³é”®çš„å…ƒæ•°æ®å˜æ›´å†å²è®°å½•ã€‚è¿™å¯¹ GFS éå¸¸é‡è¦ã€‚è¿™ä¸ä»…ä»…æ˜¯å› ä¸ºæ“ä½œæ—¥å¿—æ˜¯å…ƒæ•°æ®å”¯ä¸€çš„æŒä¹…åŒ–å­˜å‚¨è®°å½•ï¼Œå®ƒä¹Ÿä½œä¸ºåˆ¤æ–­åŒæ­¥æ“ä½œé¡ºåºçš„é€»è¾‘æ—¶é—´åŸºçº¿(ä¹Ÿå°±æ˜¯é€šè¿‡é€»è¾‘æ—¥å¿—çš„åºå·ä½œä¸ºæ“ä½œå‘ç”Ÿçš„é€»è¾‘æ—¶é—´ï¼Œç±»ä¼¼äºäº‹åŠ¡ç³»ç»Ÿä¸­çš„ LSN)ã€‚æ–‡ä»¶å’Œ Chunkï¼Œè¿åŒå®ƒä»¬çš„ç‰ˆæœ¬(å‚è€ƒ4.5 èŠ‚)ï¼Œéƒ½ç”±å®ƒä»¬åˆ›å»ºçš„é€»è¾‘æ—¶é—´å”¯ä¸€çš„ã€æ°¸ä¹…çš„æ ‡è¯†ã€‚ æ“ä½œæ—¥å¿—éå¸¸é‡è¦ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿æ—¥å¿—æ–‡ä»¶çš„å®Œæ•´ï¼Œç¡®ä¿åªæœ‰åœ¨å…ƒæ•°æ®çš„å˜åŒ–è¢«æŒä¹…åŒ–åï¼Œæ—¥å¿—æ‰å¯¹å®¢æˆ·ç«¯æ˜¯å¯è§çš„ã€‚å¦åˆ™ï¼Œå³ä½¿ Chunk æœ¬èº«æ²¡æœ‰å‡ºç°ä»»ä½•é—®é¢˜ï¼Œæˆ‘ä»¬ä»æœ‰å¯èƒ½ä¸¢å¤±æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…ä¸¢å¤±å®¢æˆ·ç«¯æœ€è¿‘çš„æ“ä½œã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¼šæŠŠæ—¥å¿—å¤åˆ¶åˆ°å¤šå°è¿œç¨‹æœºå™¨ï¼Œå¹¶ä¸”åªæœ‰æŠŠç›¸åº”çš„æ—¥å¿—è®°å½•å†™å…¥åˆ°æœ¬åœ°ä»¥åŠè¿œç¨‹æœºå™¨çš„ç¡¬ç›˜åï¼Œæ‰ä¼šå“åº”å®¢æˆ·ç«¯çš„æ“ä½œè¯·æ±‚ã€‚Master æœåŠ¡å™¨ä¼šæ”¶é›†å¤šä¸ªæ—¥å¿—è®°å½•åæ‰¹é‡å¤„ç†ï¼Œä»¥å‡å°‘å†™å…¥ç£ç›˜å’Œå¤åˆ¶å¯¹ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„å½±å“ã€‚ Master æœåŠ¡å™¨åœ¨ç¾éš¾æ¢å¤æ—¶ï¼Œé€šè¿‡é‡æ¼”æ“ä½œæ—¥å¿—æŠŠæ–‡ä»¶ç³»ç»Ÿæ¢å¤åˆ°æœ€è¿‘çš„çŠ¶æ€ã€‚ä¸ºäº†ç¼©çŸ­ Master å¯åŠ¨çš„æ—¶é—´ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿æ—¥å¿—è¶³å¤Ÿå°(å³é‡æ¼”ç³»ç»Ÿæ“ä½œçš„æ—¥å¿—é‡å°½é‡çš„å°‘)ã€‚Master æœåŠ¡å™¨åœ¨æ—¥å¿—å¢é•¿åˆ°ä¸€å®šé‡æ—¶å¯¹ç³»ç»ŸçŠ¶æ€åšä¸€æ¬¡ Checkpoint(Checkpoint æ˜¯ä¸€ç§è¡Œä¸ºï¼Œä¸€ç§å¯¹æ•°æ®åº“çŠ¶æ€ä½œä¸€æ¬¡å¿«ç…§çš„è¡Œä¸º)ï¼Œå°†æ‰€æœ‰çš„çŠ¶æ€æ•°æ®å†™å…¥ä¸€ä¸ª Checkpoint æ–‡ä»¶(æ³¨ï¼šå¹¶åˆ é™¤ä¹‹å‰çš„æ—¥å¿—æ–‡ä»¶)ã€‚åœ¨ç¾éš¾æ¢å¤çš„æ—¶å€™ï¼ŒMaster æœåŠ¡å™¨å°±é€šè¿‡ä»ç£ç›˜ä¸Šè¯»å–è¿™ä¸ªCheckpoint æ–‡ä»¶ï¼Œä»¥åŠé‡æ¼” Checkpoint ä¹‹åçš„æœ‰é™ä¸ªæ—¥å¿—æ–‡ä»¶å°±èƒ½å¤Ÿæ¢å¤ç³»ç»Ÿã€‚Checkpoint æ–‡ä»¶ä»¥å‹ç¼© B-æ ‘å½¢åŠ¿çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œå¯ä»¥ç›´æ¥æ˜ å°„åˆ°å†…å­˜ï¼Œåœ¨ç”¨äºå‘½åç©ºé—´æŸ¥è¯¢æ—¶æ— éœ€é¢å¤–çš„è§£æã€‚è¿™å¤§å¤§æé«˜äº†æ¢å¤é€Ÿåº¦ï¼Œå¢å¼ºäº†å¯ç”¨æ€§ã€‚ ç”±äºåˆ›å»ºä¸€ä¸ª Checkpoint æ–‡ä»¶éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥ Master æœåŠ¡å™¨çš„å†…éƒ¨çŠ¶æ€è¢«ç»„ç»‡ä¸ºä¸€ç§æ ¼å¼ï¼Œè¿™ç§æ ¼å¼è¦ç¡®ä¿åœ¨ Checkpoint è¿‡ç¨‹ä¸­ä¸ä¼šé˜»å¡æ­£åœ¨è¿›è¡Œçš„ä¿®æ”¹æ“ä½œã€‚Master æœåŠ¡å™¨ä½¿ç”¨ç‹¬ç«‹çš„çº¿ç¨‹åˆ‡æ¢åˆ°æ–°çš„æ—¥å¿—æ–‡ä»¶å’Œåˆ›å»ºæ–°çš„ Checkpoint æ–‡ä»¶ã€‚æ–°çš„ Checkpoint æ–‡ä»¶åŒ…æ‹¬åˆ‡æ¢å‰æ‰€æœ‰çš„ä¿®æ”¹ã€‚å¯¹äºä¸€ä¸ªåŒ…å«æ•°ç™¾ä¸‡ä¸ªæ–‡ä»¶çš„é›†ç¾¤ï¼Œåˆ›å»ºä¸€ä¸ª Checkpoint æ–‡ä»¶éœ€è¦ 1 åˆ†é’Ÿå·¦å³çš„æ—¶é—´ã€‚åˆ›å»ºå®Œæˆåï¼ŒCheckpoint æ–‡ä»¶ä¼šè¢«å†™å…¥åœ¨æœ¬åœ°å’Œè¿œç¨‹çš„ç¡¬ç›˜é‡Œã€‚ Master æœåŠ¡å™¨æ¢å¤åªéœ€è¦æœ€æ–°çš„ Checkpoint æ–‡ä»¶å’Œåç»­çš„æ—¥å¿—æ–‡ä»¶ã€‚æ—§çš„ Checkpoint æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶å¯ä»¥è¢«åˆ é™¤ï¼Œä½†æ˜¯ä¸ºäº†åº”å¯¹ç¾éš¾æ€§çš„æ•…éšœ(catastrophesï¼Œæ•°æ®å¤‡ä»½ç›¸å…³æ–‡æ¡£ä¸­ç»å¸¸ä¼šé‡åˆ°è¿™ä¸ªè¯ï¼Œè¡¨ç¤ºä¸€ç§è¶…å‡ºé¢„æœŸèŒƒå›´çš„ç¾éš¾æ€§äº‹ä»¶)ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¤šä¿å­˜ä¸€äº›å†å²æ–‡ä»¶ã€‚Checkpoint å¤±è´¥ä¸ä¼šå¯¹æ­£ç¡®æ€§äº§ç”Ÿä»»ä½•å½±å“ï¼Œå› ä¸ºæ¢å¤åŠŸèƒ½çš„ä»£ç å¯ä»¥æ£€æµ‹å¹¶è·³è¿‡æ²¡æœ‰å®Œæˆçš„ Checkpoint æ–‡ä»¶ã€‚ ä¸€è‡´æ€§æ¨¡å‹GFS æ”¯æŒä¸€ä¸ªå®½æ¾çš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹èƒ½å¤Ÿå¾ˆå¥½çš„æ”¯æ’‘æˆ‘ä»¬çš„é«˜åº¦åˆ†å¸ƒçš„åº”ç”¨ï¼ŒåŒæ—¶è¿˜ä¿æŒäº†ç›¸å¯¹ç®€å•ä¸”å®¹æ˜“å®ç°çš„ä¼˜ç‚¹ã€‚æœ¬èŠ‚æˆ‘ä»¬è®¨è®º GFS çš„ä¸€è‡´æ€§çš„ä¿éšœæœºåˆ¶ï¼Œä»¥åŠå¯¹åº”ç”¨ç¨‹åºçš„æ„ä¹‰ã€‚æˆ‘ä»¬ä¹Ÿç€é‡æè¿°äº† GFS å¦‚ä½•ç®¡ç†è¿™äº›ä¸€è‡´æ€§ä¿éšœæœºåˆ¶ï¼Œä½†æ˜¯å®ç°çš„ç»†èŠ‚å°†åœ¨æœ¬è®ºæ–‡çš„å…¶å®ƒéƒ¨åˆ†è®¨è®ºã€‚ GFS ä¸€è‡´æ€§ä¿éšœæœºåˆ¶æ–‡ä»¶å‘½åç©ºé—´çš„ä¿®æ”¹ï¼ˆä¾‹å¦‚ï¼Œæ–‡ä»¶åˆ›å»ºï¼‰æ˜¯åŸå­æ€§çš„ã€‚å®ƒä»¬ä»…ç”± Master èŠ‚ç‚¹çš„æ§åˆ¶ï¼šå‘½åç©ºé—´é”æä¾›äº†åŸå­æ€§å’Œæ­£ç¡®æ€§ï¼ˆ4.1 ç« ï¼‰çš„ä¿éšœï¼›Master èŠ‚ç‚¹çš„æ“ä½œæ—¥å¿—å®šä¹‰äº†è¿™äº›æ“ä½œåœ¨å…¨å±€çš„é¡ºåºï¼ˆ2.6.3 ç« ï¼‰ã€‚æ•°æ®ä¿®æ”¹åæ–‡ä»¶ regionçš„çŠ¶æ€å–å†³äºæ“ä½œçš„ç±»å‹ã€æˆåŠŸä¸å¦ã€ä»¥åŠæ˜¯å¦åŒæ­¥ä¿®æ”¹ã€‚è¡¨ 1 æ€»ç»“äº†å„ç§æ“ä½œçš„ç»“æœã€‚ å¦‚æœæ‰€æœ‰å®¢æˆ·ç«¯ï¼Œæ— è®ºä»å“ªä¸ªå‰¯æœ¬è¯»å–ï¼Œè¯»åˆ°çš„æ•°æ®éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸ºæ–‡ä»¶ region æ˜¯â€œä¸€è‡´çš„â€ï¼›å¦‚æœå¯¹æ–‡ä»¶çš„æ•°æ®ä¿®æ”¹ä¹‹åï¼Œregion æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯èƒ½å¤Ÿçœ‹åˆ°å†™å…¥æ“ä½œå…¨éƒ¨çš„å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ª regionæ˜¯â€œå·²å®šä¹‰çš„â€ã€‚ å½“ä¸€ä¸ªæ•°æ®ä¿®æ”¹æ“ä½œæˆåŠŸæ‰§è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰å—åˆ°åŒæ—¶æ‰§è¡Œçš„å…¶å®ƒå†™å…¥æ“ä½œçš„å¹²æ‰°ï¼Œé‚£ä¹ˆå½±å“çš„ region å°±æ˜¯å·²å®šä¹‰çš„ï¼ˆéšå«äº†ä¸€è‡´æ€§ï¼‰ï¼šæ‰€æœ‰çš„å®¢æˆ·ç«¯éƒ½å¯ä»¥çœ‹åˆ°å†™å…¥çš„å†…å®¹ã€‚å¹¶è¡Œä¿®æ”¹æ“ä½œæˆåŠŸå®Œæˆä¹‹åï¼Œregion å¤„äºä¸€è‡´çš„ã€æœªå®šä¹‰çš„çŠ¶æ€ï¼šæ‰€æœ‰çš„å®¢æˆ·ç«¯çœ‹åˆ°åŒæ ·çš„æ•°æ®ï¼Œä½†æ˜¯æ— æ³•è¯»åˆ°ä»»ä½•ä¸€æ¬¡å†™å…¥æ“ä½œå†™å…¥çš„æ•°æ®ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ–‡ä»¶ region å†…åŒ…å«äº†æ¥è‡ªå¤šä¸ªä¿®æ”¹æ“ä½œçš„ã€æ··æ‚çš„æ•°æ®ç‰‡æ®µã€‚å¤±è´¥çš„ä¿®æ”¹æ“ä½œå¯¼è‡´ä¸€ä¸ª region å¤„äºä¸ä¸€è‡´çŠ¶æ€ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æœªå®šä¹‰çš„ï¼‰ï¼šä¸åŒçš„å®¢æˆ·åœ¨ä¸åŒçš„æ—¶é—´ä¼šçœ‹åˆ°ä¸åŒçš„æ•°æ®ã€‚åé¢æˆ‘ä»¬å°†æè¿°åº”ç”¨å¦‚ä½•åŒºåˆ†å·²å®šä¹‰å’Œæœªå®šä¹‰çš„ regionã€‚åº”ç”¨ç¨‹åºæ²¡æœ‰å¿…è¦å†å»ç»†åˆ†æœªå®šä¹‰ region çš„ä¸åŒç±»å‹ã€‚ æ•°æ®ä¿®æ”¹æ“ä½œåˆ†ä¸ºå†™å…¥æˆ–è€…è®°å½•è¿½åŠ ä¸¤ç§ã€‚å†™å…¥æ“ä½œæŠŠæ•°æ®å†™åœ¨åº”ç”¨ç¨‹åºæŒ‡å®šçš„æ–‡ä»¶åç§»ä½ç½®ä¸Šã€‚å³ä½¿æœ‰å¤šä¸ªä¿®æ”¹æ“ä½œå¹¶è¡Œæ‰§è¡Œæ—¶ï¼Œè®°å½•è¿½åŠ æ“ä½œè‡³å°‘å¯ä»¥æŠŠæ•°æ®åŸå­æ€§çš„è¿½åŠ åˆ°æ–‡ä»¶ä¸­ä¸€æ¬¡ï¼Œä½†æ˜¯åç§»ä½ç½®æ˜¯ç”±GFS é€‰æ‹©çš„ï¼ˆ3.3 ç« ï¼‰(è¿™å¥è¯æœ‰ç‚¹è´¹è§£ï¼Œå…¶å«ä¹‰æ˜¯æ‰€æœ‰çš„è¿½åŠ å†™å…¥éƒ½ä¼šæˆåŠŸï¼Œä½†æ˜¯æœ‰å¯èƒ½è¢«æ‰§è¡Œäº†å¤šæ¬¡ï¼Œè€Œä¸”æ¯æ¬¡è¿½åŠ çš„æ–‡ä»¶åç§»é‡ç”± GFS è‡ªå·±è®¡ç®—ã€‚ç›¸æ¯”è€Œè¨€ï¼Œé€šå¸¸è¯´çš„è¿½åŠ æ“ä½œå†™çš„åç§»ä½ç½®æ˜¯æ–‡ä»¶çš„å°¾éƒ¨)ã€‚GFS è¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªåç§»é‡ï¼Œè¡¨ç¤ºäº†åŒ…å«äº†å†™å…¥è®°å½•çš„ã€å·²å®šä¹‰çš„ region çš„èµ·ç‚¹ã€‚å¦å¤–ï¼ŒGFS å¯èƒ½ä¼šåœ¨æ–‡ä»¶ä¸­é—´æ’å…¥å¡«å……æ•°æ®æˆ–è€…é‡å¤è®°å½•ã€‚è¿™äº›æ•°æ®å æ®çš„æ–‡ä»¶ region è¢«è®¤å®šæ˜¯ä¸ä¸€è‡´çš„ï¼Œè¿™äº›æ•°æ®é€šå¸¸æ¯”ç”¨æˆ·æ•°æ®å°çš„å¤šã€‚ ç»è¿‡äº†ä¸€ç³»åˆ—çš„æˆåŠŸçš„ä¿®æ”¹æ“ä½œä¹‹åï¼ŒGFS ç¡®ä¿è¢«ä¿®æ”¹çš„æ–‡ä»¶ region æ˜¯å·²å®šä¹‰çš„ï¼Œå¹¶ä¸”åŒ…å«æœ€åä¸€æ¬¡ä¿®æ”¹æ“ä½œå†™å…¥çš„æ•°æ®ã€‚GFS é€šè¿‡ä»¥ä¸‹æªæ–½ç¡®ä¿ä¸Šè¿°è¡Œä¸ºï¼šï¼ˆaï¼‰ å¯¹ Chunk çš„æ‰€æœ‰å‰¯æœ¬çš„ä¿®æ”¹æ“ä½œé¡ºåºä¸€è‡´ï¼ˆ3.1ç« ï¼‰ï¼Œï¼ˆbï¼‰ä½¿ç”¨ Chunk çš„ç‰ˆæœ¬å·æ¥æ£€æµ‹å‰¯æœ¬æ˜¯å¦å› ä¸ºå®ƒæ‰€åœ¨çš„ Chunk æœåŠ¡å™¨å®•æœºï¼ˆ4.5 ç« ï¼‰è€Œé”™è¿‡äº†ä¿®æ”¹æ“ä½œè€Œå¯¼è‡´å…¶å¤±æ•ˆã€‚å¤±æ•ˆçš„å‰¯æœ¬ä¸ä¼šå†è¿›è¡Œä»»ä½•ä¿®æ”¹æ“ä½œï¼ŒMaster æœåŠ¡å™¨ä¹Ÿä¸å†è¿”å›è¿™ä¸ª Chunk å‰¯æœ¬çš„ä½ç½®ä¿¡æ¯ç»™å®¢æˆ·ç«¯ã€‚å®ƒä»¬ä¼šè¢«åƒåœ¾æ”¶é›†ç³»ç»Ÿå°½å¿«å›æ”¶ã€‚ ç”±äº Chunk ä½ç½®ä¿¡æ¯ä¼šè¢«å®¢æˆ·ç«¯ç¼“å­˜ï¼Œæ‰€ä»¥åœ¨ä¿¡æ¯åˆ·æ–°å‰ï¼Œå®¢æˆ·ç«¯æœ‰å¯èƒ½ä»ä¸€ä¸ªå¤±æ•ˆçš„å‰¯æœ¬è¯»å–äº†æ•°æ®ã€‚åœ¨ç¼“å­˜çš„è¶…æ—¶æ—¶é—´å’Œæ–‡ä»¶ä¸‹ä¸€æ¬¡è¢«æ‰“å¼€çš„æ—¶é—´ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæ—¶é—´çª—ï¼Œæ–‡ä»¶å†æ¬¡è¢«æ‰“å¼€åä¼šæ¸…é™¤ç¼“å­˜ä¸­ä¸è¯¥æ–‡ä»¶æœ‰å…³çš„æ‰€æœ‰ Chunk ä½ç½®ä¿¡æ¯ã€‚è€Œä¸”ï¼Œç”±äºæˆ‘ä»¬çš„æ–‡ä»¶å¤§å¤šæ•°éƒ½æ˜¯åªè¿›è¡Œè¿½åŠ æ“ä½œçš„ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªå¤±æ•ˆçš„å‰¯æœ¬é€šå¸¸è¿”å›ä¸€ä¸ªæå‰ç»“æŸçš„ Chunk è€Œä¸æ˜¯è¿‡æœŸçš„æ•°æ®ã€‚å½“ä¸€ä¸ª Reader(æœ¬æ–‡ä¸­å°†ç”¨åˆ°ä¸¤ä¸ªä¸“æœ‰åè¯ï¼ŒReader å’Œ Writerï¼Œåˆ†åˆ«è¡¨ç¤ºæ‰§è¡Œ GFS è¯»å–å’Œå†™å…¥æ“ä½œçš„ç¨‹åº)é‡æ–°å°è¯•å¹¶è”ç»œ Master æœåŠ¡å™¨æ—¶ï¼Œå®ƒå°±ä¼šç«‹åˆ»å¾—åˆ°æœ€æ–°çš„ Chunk ä½ç½®ä¿¡æ¯ã€‚ å³ä½¿åœ¨ä¿®æ”¹æ“ä½œæˆåŠŸæ‰§è¡Œå¾ˆé•¿æ—¶é—´ä¹‹åï¼Œç»„ä»¶çš„å¤±æ•ˆä¹Ÿå¯èƒ½æŸåæˆ–è€…åˆ é™¤æ•°æ®ã€‚GFS é€šè¿‡ Master æœåŠ¡å™¨å’Œæ‰€æœ‰ Chunk æœåŠ¡å™¨çš„å®šæœŸâ€œæ¡æ‰‹â€æ¥æ‰¾åˆ°å¤±æ•ˆçš„ Chunk æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½¿ç”¨ Checksum æ¥æ ¡éªŒæ•°æ®æ˜¯å¦æŸåï¼ˆ5.2 ç« ï¼‰ã€‚ä¸€æ—¦å‘ç°é—®é¢˜ï¼Œæ•°æ®è¦å°½å¿«åˆ©ç”¨æœ‰æ•ˆçš„å‰¯æœ¬è¿›è¡Œæ¢å¤ï¼ˆ4.3 ç« ï¼‰ã€‚åªæœ‰å½“ä¸€ä¸ª Chunk çš„æ‰€æœ‰å‰¯æœ¬åœ¨ GFS æ£€æµ‹åˆ°é”™è¯¯å¹¶é‡‡å–åº”å¯¹æªæ–½ä¹‹å‰å…¨éƒ¨ä¸¢å¤±ï¼Œè¿™ä¸ª Chunk æ‰ä¼šä¸å¯é€†è½¬çš„ä¸¢å¤±ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ GFS çš„ååº”æ—¶é—´(æŒ‡ Master èŠ‚ç‚¹æ£€æµ‹åˆ°é”™è¯¯å¹¶é‡‡å–åº”å¯¹æªæ–½)æ˜¯å‡ åˆ†é’Ÿã€‚å³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒChunk ä¹Ÿåªæ˜¯ä¸å¯ç”¨äº†ï¼Œè€Œä¸æ˜¯æŸåäº†ï¼šåº”ç”¨ç¨‹åºä¼šæ”¶åˆ°æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯æŸåçš„æ•°æ®ã€‚ ç¨‹åºçš„å®ç°ä½¿ç”¨ GFS çš„åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨ä¸€äº›ç®€å•æŠ€æœ¯å®ç°è¿™ä¸ªå®½æ¾çš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œè¿™äº›æŠ€æœ¯ä¹Ÿç”¨æ¥å®ç°ä¸€äº›å…¶å®ƒçš„ç›®æ ‡åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼šå°½é‡é‡‡ç”¨è¿½åŠ å†™å…¥è€Œä¸æ˜¯è¦†ç›–ï¼ŒCheckpointï¼Œè‡ªéªŒè¯çš„å†™å…¥æ“ä½œï¼Œè‡ªæ ‡è¯†çš„è®°å½•ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„åº”ç”¨ç¨‹åºå¯¹æ–‡ä»¶çš„å†™å…¥æ“ä½œéƒ½æ˜¯å°½é‡é‡‡ç”¨æ•°æ®è¿½åŠ æ–¹å¼ï¼Œè€Œä¸æ˜¯è¦†ç›–æ–¹å¼ã€‚ä¸€ç§å…¸å‹çš„åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºä»å¤´åˆ°å°¾å†™å…¥æ•°æ®ï¼Œç”Ÿæˆäº†ä¸€ä¸ªæ–‡ä»¶ã€‚å†™å…¥æ‰€æœ‰æ•°æ®ä¹‹åï¼Œåº”ç”¨ç¨‹åºè‡ªåŠ¨å°†æ–‡ä»¶æ”¹åä¸ºä¸€ä¸ªæ°¸ä¹…ä¿å­˜çš„æ–‡ä»¶åï¼Œæˆ–è€…å‘¨æœŸæ€§çš„ä½œ Checkpointï¼Œè®°å½•æˆåŠŸå†™å…¥äº†å¤šå°‘æ•°æ®ã€‚Checkpoint æ–‡ä»¶å¯ä»¥åŒ…å«ç¨‹åºçº§åˆ«çš„æ ¡éªŒå’Œã€‚Readers ä»…æ ¡éªŒå¹¶å¤„ç†ä¸Šä¸ª Checkpoint ä¹‹åäº§ç”Ÿçš„æ–‡ä»¶ regionï¼Œè¿™äº›æ–‡ä»¶ region çš„çŠ¶æ€ä¸€å®šæ˜¯å·²å®šä¹‰çš„ã€‚è¿™ä¸ªæ–¹æ³•æ»¡è¶³äº†æˆ‘ä»¬ä¸€è‡´æ€§å’Œå¹¶å‘å¤„ç†çš„è¦æ±‚ã€‚è¿½åŠ å†™å…¥æ¯”éšæœºä½ç½®å†™å…¥æ›´åŠ æœ‰æ•ˆç‡ï¼Œå¯¹åº”ç”¨ç¨‹åºçš„å¤±è´¥å¤„ç†æ›´å…·æœ‰å¼¹æ€§ã€‚Checkpoint å¯ä»¥è®© Writer ä»¥æ¸è¿›çš„æ–¹å¼é‡æ–°å¼€å§‹ï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢ Readerå¤„ç†å·²ç»è¢«æˆåŠŸå†™å…¥ï¼Œä½†æ˜¯ä»åº”ç”¨ç¨‹åºçš„è§’åº¦æ¥çœ‹è¿˜å¹¶æœªå®Œæˆçš„æ•°æ®ã€‚ æˆ‘ä»¬å†æ¥åˆ†æå¦ä¸€ç§å…¸å‹çš„åº”ç”¨ã€‚è®¸å¤šåº”ç”¨ç¨‹åºå¹¶è¡Œçš„è¿½åŠ æ•°æ®åˆ°åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚è¿›è¡Œç»“æœçš„åˆå¹¶æˆ–è€…æ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…é˜Ÿåˆ—ã€‚è®°å½•è¿½åŠ æ–¹å¼çš„â€œè‡³å°‘ä¸€æ¬¡è¿½åŠ â€çš„ç‰¹æ€§ä¿è¯äº† Writer çš„è¾“å‡ºã€‚Readers ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥å¤„ç†å¶ç„¶æ€§çš„å¡«å……æ•°æ®å’Œé‡å¤å†…å®¹ã€‚Writers åœ¨æ¯æ¡å†™å…¥çš„è®°å½•ä¸­éƒ½åŒ…å«äº†é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚Checksumï¼Œç”¨æ¥éªŒè¯å®ƒçš„æœ‰æ•ˆæ€§ã€‚Reader å¯ä»¥åˆ©ç”¨ Checksum è¯†åˆ«å’ŒæŠ›å¼ƒé¢å¤–çš„å¡«å……æ•°æ®å’Œè®°å½•ç‰‡æ®µã€‚å¦‚æœåº”ç”¨ä¸èƒ½å®¹å¿å¶å°”çš„é‡å¤å†…å®¹(æ¯”å¦‚ï¼Œå¦‚æœè¿™äº›é‡å¤æ•°æ®è§¦å‘äº†éå¹‚ç­‰æ“ä½œ)ï¼Œå¯ä»¥ç”¨è®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦æ¥è¿‡æ»¤å®ƒä»¬ï¼Œè¿™äº›å”¯ä¸€æ ‡è¯†ç¬¦é€šå¸¸ç”¨äºå‘½åç¨‹åºä¸­å¤„ç†çš„å®ä½“å¯¹è±¡ï¼Œä¾‹å¦‚ web æ–‡æ¡£ã€‚è¿™äº›è®°å½• I/O åŠŸèƒ½(These functionalities for record I/Oï¼Œé™¤äº†å‰”é™¤é‡å¤æ•°æ®çš„åŠŸèƒ½)éƒ½åŒ…å«åœ¨æˆ‘ä»¬çš„ç¨‹åºå…±äº«çš„åº“ä¸­ï¼Œå¹¶ä¸”é€‚ç”¨äº Google å†…éƒ¨çš„å…¶å®ƒçš„æ–‡ä»¶æ¥å£å®ç°ã€‚æ‰€ä»¥ï¼Œç›¸åŒåºåˆ—çš„è®°å½•ï¼ŒåŠ ä¸Šä¸€äº›å¶å°”å‡ºç°çš„é‡å¤æ•°æ®ï¼Œéƒ½è¢«åˆ†å‘åˆ° Reader äº†ã€‚ ç³»ç»Ÿäº¤äº’æˆ‘ä»¬åœ¨è®¾è®¡è¿™ä¸ªç³»ç»Ÿæ—¶ï¼Œä¸€ä¸ªé‡è¦çš„åŸåˆ™æ˜¯æœ€å°åŒ–æ‰€æœ‰æ“ä½œå’Œ Master èŠ‚ç‚¹çš„äº¤äº’ã€‚å¸¦ç€è¿™æ ·çš„è®¾è®¡ç†å¿µï¼Œæˆ‘ä»¬ç°åœ¨æè¿°ä¸€ä¸‹å®¢æˆ·æœºã€Master æœåŠ¡å™¨å’Œ Chunk æœåŠ¡å™¨å¦‚ä½•è¿›è¡Œäº¤äº’ï¼Œä»¥å®ç°æ•°æ®ä¿®æ”¹æ“ä½œã€åŸå­çš„è®°å½•è¿½åŠ æ“ä½œä»¥åŠå¿«ç…§åŠŸèƒ½ã€‚ ç§Ÿçº¦ï¼ˆleaseï¼‰å’Œå˜æ›´é¡ºåºå˜æ›´æ˜¯ä¸€ä¸ªä¼šæ”¹å˜ Chunk å†…å®¹æˆ–è€…å…ƒæ•°æ®çš„æ“ä½œï¼Œæ¯”å¦‚å†™å…¥æ“ä½œæˆ–è€…è®°å½•è¿½åŠ æ“ä½œã€‚å˜æ›´æ“ä½œä¼šåœ¨ Chunkçš„æ‰€æœ‰å‰¯æœ¬ä¸Šæ‰§è¡Œã€‚æˆ‘ä»¬ä½¿ç”¨ç§Ÿçº¦ï¼ˆleaseï¼‰æœºåˆ¶æ¥ä¿æŒå¤šä¸ªå‰¯æœ¬é—´å˜æ›´é¡ºåºçš„ä¸€è‡´æ€§ã€‚Master èŠ‚ç‚¹ä¸º Chunkçš„ä¸€ä¸ªå‰¯æœ¬å»ºç«‹ä¸€ä¸ªç§Ÿçº¦ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå‰¯æœ¬å«åšä¸» Chunkã€‚ä¸» Chunk å¯¹ Chunk çš„æ‰€æœ‰æ›´æ”¹æ“ä½œè¿›è¡Œåºåˆ—åŒ–ã€‚æ‰€æœ‰çš„å‰¯æœ¬éƒ½éµä»è¿™ä¸ªåºåˆ—è¿›è¡Œä¿®æ”¹æ“ä½œã€‚å› æ­¤ï¼Œä¿®æ”¹æ“ä½œå…¨å±€çš„é¡ºåºé¦–å…ˆç”± Master èŠ‚ç‚¹é€‰æ‹©çš„ç§Ÿçº¦çš„é¡ºåºå†³å®šï¼Œç„¶åç”±ç§Ÿçº¦ä¸­ä¸» Chunk åˆ†é…çš„åºåˆ—å·å†³å®šã€‚ è®¾è®¡ç§Ÿçº¦æœºåˆ¶çš„ç›®çš„æ˜¯ä¸ºäº†æœ€å°åŒ– Master èŠ‚ç‚¹çš„ç®¡ç†è´Ÿæ‹…ã€‚ç§Ÿçº¦çš„åˆå§‹è¶…æ—¶è®¾ç½®ä¸º 60 ç§’ã€‚ä¸è¿‡ï¼Œåªè¦Chunk è¢«ä¿®æ”¹äº†ï¼Œä¸» Chunk å°±å¯ä»¥ç”³è¯·æ›´é•¿çš„ç§ŸæœŸï¼Œé€šå¸¸ä¼šå¾—åˆ° Master èŠ‚ç‚¹çš„ç¡®è®¤å¹¶æ”¶åˆ°ç§Ÿçº¦å»¶é•¿çš„æ—¶é—´ã€‚è¿™äº›ç§Ÿçº¦å»¶é•¿è¯·æ±‚å’Œæ‰¹å‡†çš„ä¿¡æ¯é€šå¸¸éƒ½æ˜¯é™„åŠ åœ¨ Master èŠ‚ç‚¹å’Œ Chunk æœåŠ¡å™¨ä¹‹é—´çš„å¿ƒè·³æ¶ˆæ¯ä¸­æ¥ä¼ é€’ã€‚æœ‰æ—¶Master èŠ‚ç‚¹ä¼šè¯•å›¾æå‰å–æ¶ˆç§Ÿçº¦ï¼ˆä¾‹å¦‚ï¼ŒMaster èŠ‚ç‚¹æƒ³å–æ¶ˆåœ¨ä¸€ä¸ªå·²ç»è¢«æ”¹åçš„æ–‡ä»¶ä¸Šçš„ä¿®æ”¹æ“ä½œï¼‰ã€‚å³ä½¿MasterèŠ‚ç‚¹å’Œä¸»Chunkå¤±å»è”ç³»ï¼Œå®ƒä»ç„¶å¯ä»¥å®‰å…¨åœ°åœ¨æ—§çš„ç§Ÿçº¦åˆ°æœŸåå’Œå¦å¤–ä¸€ä¸ªChunkå‰¯æœ¬ç­¾è®¢æ–°çš„ç§Ÿçº¦ã€‚ åœ¨å›¾ 2 ä¸­ï¼Œæˆ‘ä»¬ä¾æ®æ­¥éª¤ç¼–å·ï¼Œå±•ç°å†™å…¥æ“ä½œçš„æ§åˆ¶æµç¨‹ã€‚ å®¢æˆ·æœºå‘ Master èŠ‚ç‚¹è¯¢é—®å“ªä¸€ä¸ª Chunk æœåŠ¡å™¨æŒæœ‰å½“å‰çš„ç§Ÿçº¦ï¼Œä»¥åŠå…¶å®ƒå‰¯æœ¬çš„ä½ç½®ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ª Chunk æŒæœ‰ç§Ÿçº¦ï¼ŒMaster èŠ‚ç‚¹å°±é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå‰¯æœ¬å»ºç«‹ä¸€ä¸ªç§Ÿçº¦(è¿™ä¸ªæ­¥éª¤åœ¨å›¾ä¸Šæ²¡æœ‰æ˜¾ç¤º)ã€‚ Master èŠ‚ç‚¹å°†ä¸» Chunk çš„æ ‡è¯†ç¬¦ä»¥åŠå…¶å®ƒå‰¯æœ¬(åˆç§°ä¸º secondary å‰¯æœ¬ã€äºŒçº§å‰¯æœ¬)çš„ä½ç½®è¿”å›ç»™å®¢æˆ· æœºã€‚å®¢æˆ·æœºç¼“å­˜è¿™äº›æ•°æ®ä»¥ä¾¿åç»­çš„æ“ä½œã€‚åªæœ‰åœ¨ä¸» Chunk ä¸å¯ç”¨ï¼Œæˆ–è€…ä¸» Chunk å›å¤ä¿¡æ¯è¡¨æ˜å®ƒå·²ä¸å†æŒ æœ‰ç§Ÿçº¦çš„æ—¶å€™ï¼Œå®¢æˆ·æœºæ‰éœ€è¦é‡æ–°è·Ÿ Master èŠ‚ç‚¹è”ç³»ã€‚ å®¢æˆ·æœºæŠŠæ•°æ®æ¨é€åˆ°æ‰€æœ‰çš„å‰¯æœ¬ä¸Šã€‚å®¢æˆ·æœºå¯ä»¥ä»¥ä»»æ„çš„é¡ºåºæ¨é€æ•°æ®ã€‚Chunk æœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®å¹¶ä¿ å­˜åœ¨å®ƒçš„å†…éƒ¨ LRU ç¼“å­˜ä¸­ï¼Œä¸€ç›´åˆ°æ•°æ®è¢«ä½¿ç”¨æˆ–è€…è¿‡æœŸäº¤æ¢å‡ºå»ã€‚ç”±äºæ•°æ®æµçš„ç½‘ç»œä¼ è¾“è´Ÿè½½éå¸¸é«˜ï¼Œé€šè¿‡ åˆ†ç¦»æ•°æ®æµå’Œæ§åˆ¶æµï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºç½‘ç»œæ‹“æ‰‘æƒ…å†µå¯¹æ•°æ®æµè¿›è¡Œè§„åˆ’ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œè€Œä¸ç”¨å»ç†ä¼šå“ªä¸ª Chunk æœåŠ¡å™¨ä¿å­˜äº†ä¸» Chunkã€‚3.2 ç« èŠ‚ä¼šè¿›ä¸€æ­¥è®¨è®ºè¿™ç‚¹ã€‚ å½“æ‰€æœ‰çš„å‰¯æœ¬éƒ½ç¡®è®¤æ¥æ”¶åˆ°äº†æ•°æ®ï¼Œå®¢æˆ·æœºå‘é€å†™è¯·æ±‚åˆ°ä¸» Chunk æœåŠ¡å™¨ã€‚è¿™ä¸ªè¯·æ±‚æ ‡è¯†äº†æ—©å‰æ¨é€åˆ° æ‰€æœ‰å‰¯æœ¬çš„æ•°æ®ã€‚ä¸» Chunk ä¸ºæ¥æ”¶åˆ°çš„æ‰€æœ‰æ“ä½œåˆ†é…è¿ç»­çš„åºåˆ—å·ï¼Œè¿™äº›æ“ä½œå¯èƒ½æ¥è‡ªä¸åŒçš„å®¢æˆ·æœºï¼Œåºåˆ— å·ä¿è¯äº†æ“ä½œé¡ºåºæ‰§è¡Œã€‚å®ƒä»¥åºåˆ—å·çš„é¡ºåºæŠŠæ“ä½œåº”ç”¨åˆ°å®ƒè‡ªå·±çš„æœ¬åœ°çŠ¶æ€ä¸­(alex æ³¨:ä¹Ÿå°±æ˜¯åœ¨æœ¬åœ°æ‰§è¡Œè¿™äº›æ“ä½œï¼Œè¿™å¥è¯æŒ‰å­—é¢ç¿»è¯‘æœ‰ç‚¹è´¹è§£ï¼Œä¹Ÿè®¸åº”è¯¥ç¿»è¯‘ä¸ºâ€œå®ƒé¡ºåºæ‰§è¡Œè¿™äº›æ“ä½œï¼Œå¹¶æ›´æ–°è‡ªå·±çš„çŠ¶æ€â€)ã€‚ ä¸» Chunk æŠŠå†™è¯·æ±‚ä¼ é€’åˆ°æ‰€æœ‰çš„äºŒçº§å‰¯æœ¬ã€‚æ¯ä¸ªäºŒçº§å‰¯æœ¬ä¾ç…§ä¸» Chunk åˆ†é…çš„åºåˆ—å·ä»¥ç›¸åŒçš„é¡ºåºæ‰§è¡Œ è¿™äº›æ“ä½œã€‚æ‰€æœ‰çš„äºŒçº§å‰¯æœ¬å›å¤ä¸» Chunkï¼Œå®ƒä»¬å·²ç»å®Œæˆäº†æ“ä½œã€‚ ä¸» Chunk æœåŠ¡å™¨20å›å¤å®¢æˆ·æœºã€‚ä»»ä½•å‰¯æœ¬äº§ç”Ÿçš„ä»»ä½•é”™è¯¯éƒ½ä¼šè¿”å›ç»™å®¢æˆ·æœºã€‚åœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œå†™ å…¥æ“ä½œå¯èƒ½åœ¨ä¸» Chunk å’Œä¸€äº›äºŒçº§å‰¯æœ¬æ‰§è¡ŒæˆåŠŸã€‚(å¦‚æœæ“ä½œåœ¨ä¸» Chunk ä¸Šå¤±è´¥äº†ï¼Œæ“ä½œå°±ä¸ä¼šè¢«åˆ†é…åºåˆ— å·ï¼Œä¹Ÿä¸ä¼šè¢«ä¼ é€’ã€‚)å®¢æˆ·ç«¯çš„è¯·æ±‚è¢«ç¡®è®¤ä¸ºå¤±è´¥ï¼Œè¢«ä¿®æ”¹çš„ region å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ã€‚æˆ‘ä»¬çš„å®¢æˆ·æœºä»£ç é€š è¿‡é‡å¤æ‰§è¡Œå¤±è´¥çš„æ“ä½œæ¥å¤„ç†è¿™æ ·çš„é”™è¯¯ã€‚åœ¨ä»å¤´å¼€å§‹é‡å¤æ‰§è¡Œä¹‹å‰ï¼Œå®¢æˆ·æœºä¼šå…ˆä»æ­¥éª¤(3)åˆ°æ­¥éª¤(7) åšå‡ æ¬¡å°è¯•ã€‚ å¦‚æœåº”ç”¨ç¨‹åºä¸€æ¬¡å†™å…¥çš„æ•°æ®é‡å¾ˆå¤§ï¼Œæˆ–è€…æ•°æ®è·¨è¶Šäº†å¤šä¸ª Chunkï¼ŒGFS å®¢æˆ·æœºä»£ç ä¼šæŠŠå®ƒä»¬åˆ†æˆå¤šä¸ª å†™æ“ä½œã€‚è¿™äº›æ“ä½œéƒ½éµå¾ªå‰é¢æè¿°çš„æ§åˆ¶æµç¨‹ï¼Œä½†æ˜¯å¯èƒ½ä¼šè¢«å…¶å®ƒå®¢æˆ·æœºä¸ŠåŒæ—¶è¿›è¡Œçš„æ“ä½œæ‰“æ–­æˆ–è€…è¦†ç›–ã€‚ å› æ­¤ï¼Œå…±äº«çš„æ–‡ä»¶ region çš„å°¾éƒ¨å¯èƒ½åŒ…å«æ¥è‡ªä¸åŒå®¢æˆ·æœºçš„æ•°æ®ç‰‡æ®µï¼Œå°½ç®¡å¦‚æ­¤ï¼Œç”±äºè¿™äº›åˆ†è§£åçš„å†™å…¥æ“ ä½œåœ¨æ‰€æœ‰çš„å‰¯æœ¬ä¸Šéƒ½ä»¥ç›¸åŒçš„é¡ºåºæ‰§è¡Œå®Œæˆï¼ŒChunk çš„æ‰€æœ‰å‰¯æœ¬éƒ½æ˜¯ä¸€è‡´çš„ã€‚è¿™ä½¿æ–‡ä»¶ region å¤„äº 2.7 èŠ‚æè¿° çš„ä¸€è‡´çš„ã€ä½†æ˜¯æœªå®šä¹‰çš„çŠ¶æ€ã€‚ æ•°æ®æµä¸ºäº†æé«˜ç½‘ç»œæ•ˆç‡ï¼Œæˆ‘ä»¬é‡‡å–äº†æŠŠæ•°æ®æµå’Œæ§åˆ¶æµåˆ†å¼€çš„æªæ–½ã€‚åœ¨æ§åˆ¶æµä»å®¢æˆ·æœºåˆ°ä¸» Chunkã€ç„¶åå† åˆ°æ‰€æœ‰äºŒçº§å‰¯æœ¬çš„åŒæ—¶ï¼Œæ•°æ®ä»¥ç®¡é“çš„æ–¹å¼ï¼Œé¡ºåºçš„æ²¿ç€ä¸€ä¸ªç²¾å¿ƒé€‰æ‹©çš„ Chunk æœåŠ¡å™¨é“¾æ¨é€ã€‚æˆ‘ä»¬çš„ç›®æ ‡ æ˜¯å……åˆ†åˆ©ç”¨æ¯å°æœºå™¨çš„å¸¦å®½ï¼Œé¿å…ç½‘ç»œç“¶é¢ˆå’Œé«˜å»¶æ—¶çš„è¿æ¥ï¼Œæœ€å°åŒ–æ¨é€æ‰€æœ‰æ•°æ®çš„å»¶æ—¶ã€‚ ä¸ºäº†å……åˆ†åˆ©ç”¨æ¯å°æœºå™¨çš„å¸¦å®½ï¼Œæ•°æ®æ²¿ç€ä¸€ä¸ª Chunk æœåŠ¡å™¨é“¾é¡ºåºçš„æ¨é€ï¼Œè€Œä¸æ˜¯ä»¥å…¶å®ƒæ‹“æ‰‘å½¢å¼åˆ†æ•£ æ¨é€(ä¾‹å¦‚ï¼Œæ ‘å‹æ‹“æ‰‘ç»“æ„)ã€‚çº¿æ€§æ¨é€æ¨¡å¼ä¸‹ï¼Œæ¯å°æœºå™¨æ‰€æœ‰çš„å‡ºå£å¸¦å®½éƒ½ç”¨äºä»¥æœ€å¿«çš„é€Ÿåº¦ä¼ è¾“æ•°æ®ï¼Œè€Œ ä¸æ˜¯åœ¨å¤šä¸ªæ¥å—è€…ä¹‹é—´åˆ†é…å¸¦å®½ã€‚ ä¸ºäº†å°½å¯èƒ½çš„é¿å…å‡ºç°ç½‘ç»œç“¶é¢ˆå’Œé«˜å»¶è¿Ÿçš„é“¾æ¥(egï¼Œinter-switch æœ€æœ‰å¯èƒ½å‡ºç°ç±»ä¼¼é—®é¢˜)ï¼Œæ¯å°æœºå™¨ éƒ½å°½é‡çš„åœ¨ç½‘ç»œæ‹“æ‰‘ä¸­é€‰æ‹©ä¸€å°è¿˜æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®çš„ã€ç¦»è‡ªå·±æœ€è¿‘çš„æœºå™¨ä½œä¸ºç›®æ ‡æ¨é€æ•°æ®ã€‚å‡è®¾å®¢æˆ·æœºæŠŠ æ•°æ®ä» Chunk æœåŠ¡å™¨ S1 æ¨é€åˆ° S4ã€‚å®ƒæŠŠæ•°æ®æ¨é€åˆ°æœ€è¿‘çš„ Chunk æœåŠ¡å™¨ S1ã€‚S1 æŠŠæ•°æ®æ¨é€åˆ° S2ï¼Œå› ä¸º S2 å’Œ S4 ä¸­æœ€æ¥è¿‘çš„æœºå™¨æ˜¯ S2ã€‚åŒæ ·çš„ï¼ŒS2 æŠŠæ•°æ®ä¼ é€’ç»™ S3 å’Œ S4 ä¹‹é—´æ›´è¿‘çš„æœºå™¨ï¼Œä¾æ¬¡ç±»æ¨æ¨é€ä¸‹å»ã€‚æˆ‘ä»¬ çš„ç½‘ç»œæ‹“æ‰‘éå¸¸ç®€å•ï¼Œé€šè¿‡ IP åœ°å€å°±å¯ä»¥è®¡ç®—å‡ºèŠ‚ç‚¹çš„â€œè·ç¦»â€ã€‚ æœ€åï¼Œæˆ‘ä»¬åˆ©ç”¨åŸºäº TCP è¿æ¥çš„ã€ç®¡é“å¼æ•°æ®æ¨é€æ–¹å¼æ¥æœ€å°åŒ–å»¶è¿Ÿã€‚Chunk æœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®åï¼Œ é©¬ä¸Šå¼€å§‹å‘å‰æ¨é€ã€‚ç®¡é“æ–¹å¼çš„æ•°æ®æ¨é€å¯¹æˆ‘ä»¬å¸®åŠ©å¾ˆå¤§ï¼Œå› ä¸ºæˆ‘ä»¬é‡‡ç”¨å…¨åŒå·¥çš„äº¤æ¢ç½‘ç»œã€‚æ¥æ”¶åˆ°æ•°æ®å(å³ä¸» Chunk æ‰€åœ¨çš„ Chunk æœåŠ¡å™¨)ç«‹åˆ»å‘å‰æ¨é€ä¸ä¼šé™ä½æ¥æ”¶çš„é€Ÿåº¦ã€‚åœ¨æ²¡æœ‰ç½‘ç»œæ‹¥å¡çš„æƒ…å†µä¸‹ï¼Œä¼ é€ B å­—èŠ‚çš„æ•°æ®åˆ° R ä¸ªå‰¯æœ¬çš„ç†æƒ³æ—¶é—´æ˜¯ B/T+RL ï¼ŒT æ˜¯ç½‘ç»œçš„ååé‡ï¼ŒL æ˜¯åœ¨ä¸¤å°æœºå™¨æ•°æ®ä¼ è¾“çš„å»¶è¿Ÿã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç½‘ç»œè¿æ¥é€Ÿåº¦æ˜¯ 100Mbps(T)ï¼ŒL å°†è¿œå°äº 1msã€‚å› æ­¤ï¼Œ1MB çš„æ•°æ®åœ¨ç†æƒ³æƒ…å†µä¸‹ 80ms å·¦å³å°±èƒ½åˆ†å‘å‡ºå»ã€‚ åŸå­çš„è®°å½•è¿½åŠ GFS æä¾›äº†ä¸€ç§åŸå­çš„æ•°æ®è¿½åŠ æ“ä½œâ€“è®°å½•è¿½åŠ ã€‚ä¼ ç»Ÿæ–¹å¼çš„å†™å…¥æ“ä½œï¼Œå®¢æˆ·ç¨‹åºä¼šæŒ‡å®šæ•°æ®å†™å…¥çš„å ç§»é‡ã€‚å¯¹åŒä¸€ä¸ª region çš„å¹¶è¡Œå†™å…¥æ“ä½œä¸æ˜¯ä¸²è¡Œçš„:region å°¾éƒ¨å¯èƒ½ä¼šåŒ…å«å¤šä¸ªä¸åŒå®¢æˆ·æœºå†™å…¥çš„æ•°æ®ç‰‡æ®µã€‚ ä½¿ç”¨è®°å½•è¿½åŠ ï¼Œå®¢æˆ·æœºåªéœ€è¦æŒ‡å®šè¦å†™å…¥çš„æ•°æ®ã€‚GFS ä¿è¯è‡³å°‘æœ‰ä¸€æ¬¡åŸå­çš„å†™å…¥æ“ä½œæˆåŠŸæ‰§è¡Œ(å³å†™å…¥ä¸€ ä¸ªé¡ºåºçš„ byte æµ)ï¼Œå†™å…¥çš„æ•°æ®è¿½åŠ åˆ° GFS æŒ‡å®šçš„åç§»ä½ç½®ä¸Šï¼Œä¹‹å GFS è¿”å›è¿™ä¸ªåç§»é‡ç»™å®¢æˆ·æœºã€‚è¿™ç±»ä¼¼ äºåœ¨ Unix æ“ä½œç³»ç»Ÿç¼–ç¨‹ç¯å¢ƒä¸­ï¼Œå¯¹ä»¥ O_APPEND æ¨¡å¼æ‰“å¼€çš„æ–‡ä»¶ï¼Œå¤šä¸ªå¹¶å‘å†™æ“ä½œåœ¨æ²¡æœ‰ç«æ€æ¡ä»¶æ—¶çš„è¡Œ ä¸ºã€‚ è®°å½•è¿½åŠ åœ¨æˆ‘ä»¬çš„åˆ†å¸ƒåº”ç”¨ä¸­éå¸¸é¢‘ç¹çš„ä½¿ç”¨ï¼Œåœ¨è¿™äº›åˆ†å¸ƒå¼åº”ç”¨ä¸­ï¼Œé€šå¸¸æœ‰å¾ˆå¤šçš„å®¢æˆ·æœºå¹¶è¡Œåœ°å¯¹åŒ ä¸€ä¸ªæ–‡ä»¶è¿½åŠ å†™å…¥æ•°æ®ã€‚å¦‚æœæˆ‘ä»¬é‡‡ç”¨ä¼ ç»Ÿæ–¹å¼çš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œå®¢æˆ·æœºéœ€è¦é¢å¤–çš„å¤æ‚ã€æ˜‚è´µçš„åŒæ­¥æœºåˆ¶ï¼Œ ä¾‹å¦‚ä½¿ç”¨ä¸€ä¸ªåˆ†å¸ƒå¼çš„é”ç®¡ç†å™¨ã€‚åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­ï¼Œè¿™æ ·çš„æ–‡ä»¶é€šå¸¸ç”¨äºå¤šä¸ªç”Ÿäº§è€…/å•ä¸€æ¶ˆè´¹è€…çš„é˜Ÿåˆ—ç³»ç»Ÿï¼Œ æˆ–è€…æ˜¯åˆå¹¶äº†æ¥è‡ªå¤šä¸ªå®¢æˆ·æœºçš„æ•°æ®çš„ç»“æœæ–‡ä»¶ã€‚ è®°å½•è¿½åŠ æ˜¯ä¸€ç§ä¿®æ”¹æ“ä½œï¼Œå®ƒä¹Ÿéµå¾ª 3.1 èŠ‚æè¿°çš„æ§åˆ¶æµç¨‹ï¼Œé™¤äº†åœ¨ä¸» Chunk æœ‰äº›é¢å¤–çš„æ§åˆ¶é€»è¾‘ã€‚å®¢ æˆ·æœºæŠŠæ•°æ®æ¨é€ç»™æ–‡ä»¶æœ€åä¸€ä¸ª Chunk çš„æ‰€æœ‰å‰¯æœ¬ï¼Œä¹‹åå‘é€è¯·æ±‚ç»™ä¸» Chunkã€‚ä¸» Chunk ä¼šæ£€æŸ¥è¿™æ¬¡è®°å½•è¿½ åŠ æ“ä½œæ˜¯å¦ä¼šä½¿ Chunk è¶…è¿‡æœ€å¤§å°ºå¯¸(64MB)ã€‚å¦‚æœè¶…è¿‡äº†æœ€å¤§å°ºå¯¸ï¼Œä¸» Chunk é¦–å…ˆå°†å½“å‰ Chunk å¡«å……åˆ°æœ€ å¤§å°ºå¯¸ï¼Œä¹‹åé€šçŸ¥æ‰€æœ‰äºŒçº§å‰¯æœ¬åšåŒæ ·çš„æ“ä½œï¼Œç„¶åå›å¤å®¢æˆ·æœºè¦æ±‚å…¶å¯¹ä¸‹ä¸€ä¸ª Chunk é‡æ–°è¿›è¡Œè®°å½•è¿½åŠ æ“ ä½œã€‚(è®°å½•è¿½åŠ çš„æ•°æ®å¤§å°ä¸¥æ ¼æ§åˆ¶åœ¨ Chunk æœ€å¤§å°ºå¯¸çš„ 1/4ï¼Œè¿™æ ·å³ä½¿åœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ•°æ®ç¢ç‰‡çš„æ•°é‡ä»ç„¶ åœ¨å¯æ§çš„èŒƒå›´ã€‚)é€šå¸¸æƒ…å†µä¸‹è¿½åŠ çš„è®°å½•ä¸è¶…è¿‡ Chunk çš„æœ€å¤§å°ºå¯¸ï¼Œä¸» Chunk æŠŠæ•°æ®è¿½åŠ åˆ°è‡ªå·±çš„å‰¯æœ¬å†…ï¼Œ ç„¶åé€šçŸ¥äºŒçº§å‰¯æœ¬æŠŠæ•°æ®å†™åœ¨è·Ÿä¸» Chunk ä¸€æ ·çš„ä½ç½®ä¸Šï¼Œæœ€åå›å¤å®¢æˆ·æœºæ“ä½œæˆåŠŸã€‚ å¦‚æœè®°å½•è¿½åŠ æ“ä½œåœ¨ä»»ä½•ä¸€ä¸ªå‰¯æœ¬ä¸Šå¤±è´¥äº†ï¼Œå®¢æˆ·ç«¯å°±éœ€è¦é‡æ–°è¿›è¡Œæ“ä½œã€‚é‡æ–°è¿›è¡Œè®°å½•è¿½åŠ çš„ç»“æœæ˜¯ï¼Œ åŒä¸€ä¸ª Chunk çš„ä¸åŒå‰¯æœ¬å¯èƒ½åŒ…å«ä¸åŒçš„æ•°æ®â€“é‡å¤åŒ…å«ä¸€ä¸ªè®°å½•å…¨éƒ¨æˆ–è€…éƒ¨åˆ†çš„æ•°æ®ã€‚GFS å¹¶ä¸ä¿è¯ Chunk çš„æ‰€æœ‰å‰¯æœ¬åœ¨å­—èŠ‚çº§åˆ«æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚å®ƒåªä¿è¯æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“åŸå­çš„è¢«è‡³å°‘å†™å…¥ä¸€æ¬¡ã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥é€š è¿‡ç®€å•è§‚å¯Ÿæ¨å¯¼å‡ºæ¥:å¦‚æœæ“ä½œæˆåŠŸæ‰§è¡Œï¼Œæ•°æ®ä¸€å®šå·²ç»å†™å…¥åˆ° Chunk çš„æ‰€æœ‰å‰¯æœ¬çš„ç›¸åŒåç§»ä½ç½®ä¸Šã€‚è¿™ä¹‹ åï¼Œæ‰€æœ‰çš„å‰¯æœ¬è‡³å°‘éƒ½åˆ°äº†è®°å½•å°¾éƒ¨çš„é•¿åº¦ï¼Œä»»ä½•åç»­çš„è®°å½•éƒ½ä¼šè¿½åŠ åˆ°æ›´å¤§çš„åç§»åœ°å€ï¼Œæˆ–è€…æ˜¯ä¸åŒçš„ Chunk ä¸Šï¼Œå³ä½¿å…¶å®ƒçš„ Chunk å‰¯æœ¬è¢« Master èŠ‚ç‚¹é€‰ä¸ºäº†ä¸» Chunkã€‚å°±æˆ‘ä»¬çš„ä¸€è‡´æ€§ä¿éšœæ¨¡å‹è€Œè¨€ï¼Œè®°å½•è¿½åŠ  æ“ä½œæˆåŠŸå†™å…¥æ•°æ®çš„ region æ˜¯å·²å®šä¹‰çš„(å› æ­¤ä¹Ÿæ˜¯ä¸€è‡´çš„)ï¼Œåä¹‹åˆ™æ˜¯ä¸ä¸€è‡´çš„(å› æ­¤ä¹Ÿå°±æ˜¯æœªå®šä¹‰çš„)ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ 2.7.2 èŠ‚è®¨è®ºçš„ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¯ä»¥å¤„ç†ä¸ä¸€è‡´çš„åŒºåŸŸã€‚ å¿«ç…§å¿«ç…§æ“ä½œå‡ ä¹å¯ä»¥ç¬é—´å®Œæˆå¯¹ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•æ ‘(â€œæºâ€)åšä¸€ä¸ªæ‹·è´ï¼Œå¹¶ä¸”å‡ ä¹ä¸ä¼šå¯¹æ­£åœ¨è¿›è¡Œçš„å…¶ å®ƒæ“ä½œé€ æˆä»»ä½•å¹²æ‰°ã€‚æˆ‘ä»¬çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨å¿«ç…§è¿…é€Ÿçš„åˆ›å»ºä¸€ä¸ªå·¨å¤§çš„æ•°æ®é›†çš„åˆ†æ”¯æ‹·è´(è€Œä¸”ç»å¸¸æ˜¯é€’å½’ çš„æ‹·è´æ‹·è´)ï¼Œæˆ–è€…æ˜¯åœ¨åšå®éªŒæ€§çš„æ•°æ®æ“ä½œä¹‹å‰ï¼Œä½¿ç”¨å¿«ç…§æ“ä½œå¤‡ä»½å½“å‰çŠ¶æ€ï¼Œè¿™æ ·ä¹‹åå°±å¯ä»¥è½»æ¾çš„æäº¤ æˆ–è€…å›æ»šåˆ°å¤‡ä»½æ—¶çš„çŠ¶æ€ã€‚ å°±åƒ AFS(alex æ³¨:AFSï¼Œå³ Andrew File Systemï¼Œä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ)ï¼Œæˆ‘ä»¬ç”¨æ ‡å‡†çš„ copy-on-write æŠ€æœ¯å®ç°å¿«ç…§ã€‚å½“ Master èŠ‚ç‚¹æ”¶åˆ°ä¸€ä¸ªå¿«ç…§è¯·æ±‚ï¼Œå®ƒé¦–å…ˆå–æ¶ˆä½œå¿«ç…§çš„æ–‡ä»¶çš„æ‰€æœ‰ Chunk çš„ç§Ÿçº¦ã€‚è¿™ä¸ªæªæ–½ ä¿è¯äº†åç»­å¯¹è¿™äº› Chunk çš„å†™æ“ä½œéƒ½å¿…é¡»ä¸ Master äº¤äº’ä»¥æ‰¾åˆ°ç§Ÿçº¦æŒæœ‰è€…ã€‚è¿™å°±ç»™ Master èŠ‚ç‚¹ä¸€ä¸ªç‡å…ˆåˆ›å»º Chunk çš„æ–°æ‹·è´çš„æœºä¼šã€‚ ç§Ÿçº¦å–æ¶ˆæˆ–è€…è¿‡æœŸä¹‹åï¼ŒMaster èŠ‚ç‚¹æŠŠè¿™ä¸ªæ“ä½œä»¥æ—¥å¿—çš„æ–¹å¼è®°å½•åˆ°ç¡¬ç›˜ä¸Šã€‚ç„¶åï¼ŒMaster èŠ‚ç‚¹é€šè¿‡å¤ åˆ¶æºæ–‡ä»¶æˆ–è€…ç›®å½•çš„å…ƒæ•°æ®çš„æ–¹å¼ï¼ŒæŠŠè¿™æ¡æ—¥å¿—è®°å½•çš„å˜åŒ–åæ˜ åˆ°ä¿å­˜åœ¨å†…å­˜çš„çŠ¶æ€ä¸­ã€‚æ–°åˆ›å»ºçš„å¿«ç…§æ–‡ä»¶ å’Œæºæ–‡ä»¶æŒ‡å‘å®Œå…¨ç›¸åŒçš„ Chunk åœ°å€ã€‚ åœ¨å¿«ç…§æ“ä½œä¹‹åï¼Œå½“å®¢æˆ·æœºç¬¬ä¸€æ¬¡æƒ³å†™å…¥æ•°æ®åˆ° Chunk Cï¼Œå®ƒé¦–å…ˆä¼šå‘é€ä¸€ä¸ªè¯·æ±‚åˆ° Master èŠ‚ç‚¹æŸ¥è¯¢å½“ å‰çš„ç§Ÿçº¦æŒæœ‰è€…ã€‚Master èŠ‚ç‚¹æ³¨æ„åˆ° Chunk C çš„å¼•ç”¨è®¡æ•°è¶…è¿‡äº† 1ã€‚Master èŠ‚ç‚¹ä¸ä¼šé©¬ä¸Šå›å¤å®¢æˆ·æœºçš„è¯·æ±‚ï¼Œ è€Œæ˜¯é€‰æ‹©ä¸€ä¸ªæ–°çš„ Chunk å¥æŸ„ Cã€‚ä¹‹åï¼ŒMaster èŠ‚ç‚¹è¦æ±‚æ¯ä¸ªæ‹¥æœ‰ Chunk C å½“å‰å‰¯æœ¬çš„ Chunk æœåŠ¡å™¨åˆ›å»ºä¸€ ä¸ªå«åš Cçš„æ–° Chunkã€‚é€šè¿‡åœ¨æº Chunk æ‰€åœ¨ Chunk æœåŠ¡å™¨ä¸Šåˆ›å»ºæ–°çš„ Chunkï¼Œæˆ‘ä»¬ç¡®ä¿æ•°æ®åœ¨æœ¬åœ°è€Œä¸æ˜¯é€š è¿‡ç½‘ç»œå¤åˆ¶(æˆ‘ä»¬çš„ç¡¬ç›˜æ¯”æˆ‘ä»¬çš„ 100Mb ä»¥å¤ªç½‘å¤§çº¦å¿« 3 å€)ã€‚ä»è¿™ç‚¹æ¥è®²ï¼Œè¯·æ±‚çš„å¤„ç†æ–¹å¼å’Œä»»ä½•å…¶å®ƒ Chunk æ²¡ä»€ä¹ˆä¸åŒ:Master èŠ‚ç‚¹ç¡®ä¿æ–° Chunk C`çš„ä¸€ä¸ªå‰¯æœ¬æ‹¥æœ‰ç§Ÿçº¦ï¼Œä¹‹åå›å¤å®¢æˆ·æœºï¼Œå®¢æˆ·æœºå¾—åˆ°å›å¤åå°±å¯ä»¥ æ­£å¸¸çš„å†™è¿™ä¸ª Chunkï¼Œè€Œä¸å¿…ç†ä¼šå®ƒæ˜¯ä»ä¸€ä¸ªå·²å­˜åœ¨çš„ Chunk å…‹éš†å‡ºæ¥çš„ã€‚ Master èŠ‚ç‚¹çš„æ“ä½œMaster èŠ‚ç‚¹æ‰§è¡Œæ‰€æœ‰çš„åç§°ç©ºé—´æ“ä½œã€‚æ­¤å¤–ï¼Œå®ƒè¿˜ç®¡ç†ç€æ•´ä¸ªç³»ç»Ÿé‡Œæ‰€æœ‰ Chunk çš„å‰¯æœ¬:å®ƒå†³å®š Chunk çš„å­˜å‚¨ä½ç½®ï¼Œåˆ›å»ºæ–° Chunk å’Œå®ƒçš„å‰¯æœ¬ï¼Œåè°ƒå„ç§å„æ ·çš„ç³»ç»Ÿæ´»åŠ¨ä»¥ä¿è¯ Chunk è¢«å®Œå…¨å¤åˆ¶ï¼Œåœ¨æ‰€æœ‰çš„ Chunk æœåŠ¡å™¨ä¹‹é—´çš„è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ã€‚æœ¬èŠ‚æˆ‘ä»¬è®¨è®ºä¸Šè¿°çš„ä¸»é¢˜ã€‚ åç§°ç©ºé—´ç®¡ç†å’Œé”Master èŠ‚ç‚¹çš„å¾ˆå¤šæ“ä½œä¼šèŠ±è´¹å¾ˆé•¿çš„æ—¶é—´:æ¯”å¦‚ï¼Œå¿«ç…§æ“ä½œå¿…é¡»å–æ¶ˆ Chunk æœåŠ¡å™¨ä¸Šå¿«ç…§æ‰€æ¶‰åŠçš„æ‰€æœ‰ çš„ Chunk çš„ç§Ÿçº¦ã€‚æˆ‘ä»¬ä¸å¸Œæœ›åœ¨è¿™äº›æ“ä½œçš„è¿è¡Œæ—¶ï¼Œå»¶ç¼“äº†å…¶å®ƒçš„ Master èŠ‚ç‚¹çš„æ“ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬å…è®¸å¤šä¸ª æ“ä½œåŒæ—¶è¿›è¡Œï¼Œä½¿ç”¨åç§°ç©ºé—´çš„ region ä¸Šçš„é”æ¥ä¿è¯æ‰§è¡Œçš„æ­£ç¡®é¡ºåºã€‚ ä¸åŒäºè®¸å¤šä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼ŒGFS æ²¡æœ‰é’ˆå¯¹æ¯ä¸ªç›®å½•å®ç°èƒ½å¤Ÿåˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ•°æ®ç»“æ„ã€‚GFS ä¹Ÿä¸ æ”¯æŒæ–‡ä»¶æˆ–è€…ç›®å½•çš„é“¾æ¥(å³ Unix æœ¯è¯­ä¸­çš„ç¡¬é“¾æ¥æˆ–è€…ç¬¦å·é“¾æ¥)ã€‚åœ¨é€»è¾‘ä¸Šï¼ŒGFS çš„åç§°ç©ºé—´å°±æ˜¯ä¸€ä¸ªå…¨ è·¯å¾„å’Œå…ƒæ•°æ®æ˜ å°„å…³ç³»çš„æŸ¥æ‰¾è¡¨ã€‚åˆ©ç”¨å‰ç¼€å‹ç¼©ï¼Œè¿™ä¸ªè¡¨å¯ä»¥é«˜æ•ˆçš„å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚åœ¨å­˜å‚¨åç§°ç©ºé—´çš„æ ‘å‹ ç»“æ„ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹(ç»å¯¹è·¯å¾„çš„æ–‡ä»¶åæˆ–ç»å¯¹è·¯å¾„çš„ç›®å½•å)éƒ½æœ‰ä¸€ä¸ªå…³è”çš„è¯»å†™é”ã€‚ æ¯ä¸ª Master èŠ‚ç‚¹çš„æ“ä½œåœ¨å¼€å§‹ä¹‹å‰éƒ½è¦è·å¾—ä¸€ç³»åˆ—çš„é”ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ¶‰åŠ/d1/d2/â€¦ /dn/leafï¼Œé‚£ä¹ˆæ“ä½œé¦–å…ˆè¦è·å¾—ç›®å½•/d1ï¼Œ/d1/d2ï¼Œâ€¦ï¼Œ/d1/d2/â€¦/dn çš„è¯»é”ï¼Œä»¥åŠ/d1/d2/â€¦/dn/leaf çš„è¯»å†™é”ã€‚æ³¨ æ„ï¼Œæ ¹æ®æ“ä½œçš„ä¸åŒï¼Œleaf å¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹åœ¨/home/user è¢«å¿«ç…§åˆ°/save/user çš„æ—¶å€™ï¼Œé”æœºåˆ¶å¦‚ä½•é˜²æ­¢åˆ›å»ºæ–‡ä»¶/home/user/fooã€‚ å¿«ç…§æ“ä½œè·å–/home å’Œ/save çš„è¯»å–é”ï¼Œä»¥åŠ/home/user å’Œ/save/user çš„å†™å…¥é”ã€‚æ–‡ä»¶åˆ›å»ºæ“ä½œè·å¾—/home å’Œ /home/user çš„è¯»å–é”ï¼Œä»¥åŠ/home/user/foo çš„å†™å…¥é”ã€‚è¿™ä¸¤ä¸ªæ“ä½œè¦é¡ºåºæ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬è¯•å›¾è·å–çš„/home/user çš„é”æ˜¯ç›¸äº’å†²çªã€‚æ–‡ä»¶åˆ›å»ºæ“ä½œä¸éœ€è¦è·å–çˆ¶ç›®å½•çš„å†™å…¥é”ï¼Œå› ä¸ºè¿™é‡Œæ²¡æœ‰â€œç›®å½•â€ï¼Œæˆ–è€…ç±»ä¼¼ inode ç­‰ç”¨æ¥ ç¦æ­¢ä¿®æ”¹çš„æ•°æ®ç»“æ„ã€‚æ–‡ä»¶åçš„è¯»å–é”è¶³ä»¥é˜²æ­¢çˆ¶ç›®å½•è¢«åˆ é™¤ã€‚ é‡‡ç”¨è¿™ç§é”æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ”¯æŒå¯¹åŒä¸€ç›®å½•çš„å¹¶è¡Œæ“ä½œã€‚æ¯”å¦‚ï¼Œå¯ä»¥å†åŒä¸€ä¸ªç›®å½•ä¸‹åŒæ—¶åˆ›å»ºå¤šä¸ªæ–‡ä»¶: æ¯ä¸€ä¸ªæ“ä½œéƒ½è·å–ä¸€ä¸ªç›®å½•åçš„ä¸Šçš„è¯»å–é”å’Œæ–‡ä»¶åä¸Šçš„å†™å…¥é”ã€‚ç›®å½•åçš„è¯»å–é”è¶³ä»¥çš„é˜²æ­¢ç›®å½•è¢«åˆ é™¤ã€ æ”¹åä»¥åŠè¢«å¿«ç…§ã€‚æ–‡ä»¶åçš„å†™å…¥é”åºåˆ—åŒ–æ–‡ä»¶åˆ›å»ºæ“ä½œï¼Œç¡®ä¿ä¸ä¼šå¤šæ¬¡åˆ›å»ºåŒåçš„æ–‡ä»¶ã€‚ å› ä¸ºåç§°ç©ºé—´å¯èƒ½æœ‰å¾ˆå¤šèŠ‚ç‚¹ï¼Œè¯»å†™é”é‡‡ç”¨æƒ°æ€§åˆ†é…ç­–ç•¥ï¼Œåœ¨ä¸å†ä½¿ç”¨çš„æ—¶å€™ç«‹åˆ»è¢«åˆ é™¤ã€‚åŒæ ·ï¼Œé”çš„ è·å–ä¹Ÿè¦ä¾æ®ä¸€ä¸ªå…¨å±€ä¸€è‡´çš„é¡ºåºæ¥é¿å…æ­»é”:é¦–å…ˆæŒ‰åç§°ç©ºé—´çš„å±‚æ¬¡æ’åºï¼Œåœ¨åŒä¸€ä¸ªå±‚æ¬¡å†…æŒ‰å­—å…¸é¡ºåºæ’åºã€‚ å‰¯æœ¬çš„ä½ç½®GFS é›†ç¾¤æ˜¯é«˜åº¦åˆ†å¸ƒçš„å¤šå±‚å¸ƒå±€ç»“æ„ï¼Œè€Œä¸æ˜¯å¹³é¢ç»“æ„ã€‚å…¸å‹çš„æ‹“æ‰‘ç»“æ„æ˜¯æœ‰æ•°ç™¾ä¸ª Chunk æœåŠ¡å™¨å®‰è£… åœ¨è®¸å¤šæœºæ¶ä¸Šã€‚Chunk æœåŠ¡å™¨è¢«æ¥è‡ªåŒä¸€æˆ–è€…ä¸åŒæœºæ¶ä¸Šçš„æ•°ç™¾ä¸ªå®¢æˆ·æœºè½®æµè®¿é—®ã€‚ä¸åŒæœºæ¶ä¸Šçš„ä¸¤å°æœºå™¨ é—´çš„é€šè®¯å¯èƒ½è·¨è¶Šä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œäº¤æ¢æœºã€‚å¦å¤–ï¼Œæœºæ¶çš„å‡ºå…¥å¸¦å®½å¯èƒ½æ¯”æœºæ¶å†…æ‰€æœ‰æœºå™¨åŠ å’Œåœ¨ä¸€èµ·çš„å¸¦å®½ è¦å°ã€‚å¤šå±‚åˆ†å¸ƒæ¶æ„å¯¹æ•°æ®çš„çµæ´»æ€§ã€å¯é æ€§ä»¥åŠå¯ç”¨æ€§æ–¹é¢æå‡ºç‰¹æœ‰çš„æŒ‘æˆ˜ã€‚ Chunk å‰¯æœ¬ä½ç½®é€‰æ‹©çš„ç­–ç•¥æœåŠ¡ä¸¤å¤§ç›®æ ‡:æœ€å¤§åŒ–æ•°æ®å¯é æ€§å’Œå¯ç”¨æ€§ï¼Œæœ€å¤§åŒ–ç½‘ç»œå¸¦å®½åˆ©ç”¨ç‡ã€‚ä¸ºäº† å®ç°è¿™ä¸¤ä¸ªç›®çš„ï¼Œä»…ä»…æ˜¯åœ¨å¤šå°æœºå™¨ä¸Šåˆ†åˆ«å­˜å‚¨è¿™äº›å‰¯æœ¬æ˜¯ä¸å¤Ÿçš„ï¼Œè¿™åªèƒ½é¢„é˜²ç¡¬ç›˜æŸåæˆ–è€…æœºå™¨å¤±æ•ˆå¸¦æ¥çš„å½±å“ï¼Œä»¥åŠæœ€å¤§åŒ–æ¯å°æœºå™¨çš„ç½‘ç»œå¸¦å®½åˆ©ç”¨ç‡ã€‚æˆ‘ä»¬å¿…é¡»åœ¨å¤šä¸ªæœºæ¶é—´åˆ†å¸ƒå‚¨å­˜ Chunk çš„å‰¯æœ¬ã€‚è¿™ä¿è¯ Chunk çš„ä¸€äº›å‰¯æœ¬åœ¨æ•´ä¸ªæœºæ¶è¢«ç ´åæˆ–æ‰çº¿(æ¯”å¦‚ï¼Œå…±äº«èµ„æºï¼Œå¦‚ç”µæºæˆ–è€…ç½‘ç»œäº¤æ¢æœºé€ æˆçš„é—®é¢˜)çš„æƒ…å†µä¸‹ä¾ç„¶ å­˜åœ¨ä¸”ä¿æŒå¯ç”¨çŠ¶æ€ã€‚è¿™è¿˜æ„å‘³ç€åœ¨ç½‘ç»œæµé‡æ–¹é¢ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ Chunk çš„è¯»æ“ä½œï¼Œèƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨å¤šä¸ªæœºæ¶çš„æ•´åˆå¸¦å®½ã€‚å¦ä¸€æ–¹é¢ï¼Œå†™æ“ä½œå¿…é¡»å’Œå¤šä¸ªæœºæ¶ä¸Šçš„è®¾å¤‡è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œä½†æ˜¯è¿™ä¸ªä»£ä»·æ˜¯æˆ‘ä»¬æ„¿æ„ä»˜å‡ºçš„ã€‚ åˆ›å»ºï¼Œé‡æ–°å¤åˆ¶ï¼Œé‡æ–°è´Ÿè½½å‡è¡¡Chunk çš„å‰¯æœ¬æœ‰ä¸‰ä¸ªç”¨é€”:Chunk åˆ›å»ºï¼Œé‡æ–°å¤åˆ¶å’Œé‡æ–°è´Ÿè½½å‡è¡¡ã€‚å½“ Master èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª Chunk æ—¶ï¼Œå®ƒä¼šé€‰æ‹©åœ¨å“ªé‡Œæ”¾ç½®åˆå§‹çš„ç©ºçš„å‰¯æœ¬ã€‚Master èŠ‚ç‚¹ä¼šè€ƒè™‘å‡ ä¸ªå› ç´  :(1)æˆ‘ä»¬å¸Œæœ›åœ¨ä½äºå¹³å‡ç¡¬ç›˜ä½¿ç”¨ç‡çš„ Chunk æœåŠ¡å™¨ä¸Šå­˜å‚¨æ–°çš„å‰¯æœ¬ã€‚è¿™æ ·çš„åšæ³•æœ€ç»ˆèƒ½å¤Ÿå¹³è¡¡ChunkæœåŠ¡å™¨ä¹‹é—´çš„ç¡¬ç›˜ä½¿ç”¨ç‡ã€‚ (2)æˆ‘ä»¬å¸Œæœ›é™åˆ¶åœ¨æ¯ä¸ª Chunk æœåŠ¡å™¨ä¸Šâ€œæœ€è¿‘â€çš„ Chunk åˆ›å»ºæ“ä½œçš„æ¬¡æ•°ã€‚è™½ç„¶åˆ›å»ºæ“ä½œæœ¬èº«æ˜¯å»‰ä»·çš„ï¼Œä½†æ˜¯åˆ›å»ºæ“ä½œä¹Ÿæ„å‘³ç€éšä¹‹ä¼šæœ‰å¤§é‡çš„å†™å…¥æ•°æ®çš„æ“ä½œï¼Œå› ä¸º Chunk åœ¨ Writer çœŸæ­£å†™å…¥æ•°æ®çš„æ—¶å€™æ‰ è¢«åˆ›å»ºï¼Œè€Œåœ¨æˆ‘ä»¬çš„â€œè¿½åŠ ä¸€æ¬¡ï¼Œè¯»å–å¤šæ¬¡â€çš„å·¥ä½œæ¨¡å¼ä¸‹ï¼ŒChunk ä¸€æ—¦å†™å…¥æˆåŠŸä¹‹åå°±ä¼šå˜ä¸ºåªè¯»çš„äº†ã€‚ (3)å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¸Œæœ›æŠŠ Chunk çš„å‰¯æœ¬åˆ†å¸ƒåœ¨å¤šä¸ªæœºæ¶ä¹‹é—´ã€‚ å½“ Chunk çš„æœ‰æ•ˆå‰¯æœ¬æ•°é‡å°‘äºç”¨æˆ·æŒ‡å®šçš„å¤åˆ¶å› æ•°çš„æ—¶å€™ï¼ŒMaster èŠ‚ç‚¹ä¼šé‡æ–°å¤åˆ¶å®ƒã€‚è¿™å¯èƒ½æ˜¯ç”±å‡ ä¸ª åŸå› å¼•èµ·çš„:ä¸€ä¸ª Chunk æœåŠ¡å™¨ä¸å¯ç”¨äº†ï¼ŒChunk æœåŠ¡å™¨æŠ¥å‘Šå®ƒæ‰€å­˜å‚¨çš„ä¸€ä¸ªå‰¯æœ¬æŸåäº†ï¼ŒChunk æœåŠ¡å™¨çš„ ä¸€ä¸ªç£ç›˜å› ä¸ºé”™è¯¯ä¸å¯ç”¨äº†ï¼Œæˆ–è€… Chunk å‰¯æœ¬çš„å¤åˆ¶å› æ•°æé«˜äº†ã€‚æ¯ä¸ªéœ€è¦è¢«é‡æ–°å¤åˆ¶çš„ Chunk éƒ½ä¼šæ ¹æ®å‡  ä¸ªå› ç´ è¿›è¡Œæ’åºã€‚ä¸€ä¸ªå› ç´ æ˜¯ Chunk ç°æœ‰å‰¯æœ¬æ•°é‡å’Œå¤åˆ¶å› æ•°ç›¸å·®å¤šå°‘ã€‚ä¾‹å¦‚ï¼Œä¸¢å¤±ä¸¤ä¸ªå‰¯æœ¬çš„ Chunk æ¯”ä¸¢ å¤±ä¸€ä¸ªå‰¯æœ¬çš„ Chunk æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¼˜å…ˆé‡æ–°å¤åˆ¶æ´»è·ƒ(live)æ–‡ä»¶çš„ Chunk è€Œä¸æ˜¯æœ€è¿‘åˆšè¢« åˆ é™¤çš„æ–‡ä»¶çš„ Chunk(æŸ¥çœ‹ 4.4 èŠ‚)ã€‚æœ€åï¼Œä¸ºäº†æœ€å°åŒ–å¤±æ•ˆçš„ Chunk å¯¹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„å½±å“ï¼Œæˆ‘ä»¬æ é«˜ä¼šé˜»å¡å®¢æˆ·æœºç¨‹åºå¤„ç†æµç¨‹çš„ Chunk çš„ä¼˜å…ˆçº§ã€‚ Master èŠ‚ç‚¹é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„ Chunkï¼Œç„¶åå‘½ä»¤æŸä¸ª Chunk æœåŠ¡å™¨ç›´æ¥ä»å¯ç”¨çš„å‰¯æœ¬â€å…‹éš†â€ä¸€ä¸ªå‰¯æœ¬ å‡ºæ¥ã€‚é€‰æ‹©æ–°å‰¯æœ¬çš„ä½ç½®çš„ç­–ç•¥å’Œåˆ›å»ºæ—¶ç±»ä¼¼:å¹³è¡¡ç¡¬ç›˜ä½¿ç”¨ç‡ã€é™åˆ¶åŒä¸€å° Chunk æœåŠ¡å™¨ä¸Šçš„æ­£åœ¨è¿›è¡Œçš„ å…‹éš†æ“ä½œçš„æ•°é‡ã€åœ¨æœºæ¶é—´åˆ†å¸ƒå‰¯æœ¬ã€‚ä¸ºäº†é˜²æ­¢å…‹éš†äº§ç”Ÿçš„ç½‘ç»œæµé‡å¤§å¤§è¶…è¿‡å®¢æˆ·æœºçš„æµé‡ï¼ŒMaster èŠ‚ç‚¹å¯¹ æ•´ä¸ªé›†ç¾¤å’Œæ¯ä¸ª Chunk æœåŠ¡å™¨ä¸Šçš„åŒæ—¶è¿›è¡Œçš„å…‹éš†æ“ä½œçš„æ•°é‡éƒ½è¿›è¡Œäº†é™åˆ¶ã€‚å¦å¤–ï¼ŒChunk æœåŠ¡å™¨é€šè¿‡è°ƒèŠ‚ å®ƒå¯¹æº Chunk æœåŠ¡å™¨è¯»è¯·æ±‚çš„é¢‘ç‡æ¥é™åˆ¶å®ƒç”¨äºå…‹éš†æ“ä½œçš„å¸¦å®½ã€‚ æœ€åï¼ŒMaster æœåŠ¡å™¨å‘¨æœŸæ€§åœ°å¯¹å‰¯æœ¬è¿›è¡Œé‡æ–°è´Ÿè½½å‡è¡¡:å®ƒæ£€æŸ¥å½“å‰çš„å‰¯æœ¬åˆ†å¸ƒæƒ…å†µï¼Œç„¶åç§»åŠ¨å‰¯æœ¬ä»¥ ä¾¿æ›´å¥½çš„åˆ©ç”¨ç¡¬ç›˜ç©ºé—´ã€æ›´æœ‰æ•ˆçš„è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚è€Œä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒMaster æœåŠ¡å™¨é€æ¸çš„å¡«æ»¡ä¸€ä¸ªæ–°çš„ Chunk æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯åœ¨çŸ­æ—¶é—´å†…ç”¨æ–°çš„ Chunk å¡«æ»¡å®ƒï¼Œä»¥è‡³äºè¿‡è½½ã€‚æ–°å‰¯æœ¬çš„å­˜å‚¨ä½ç½®é€‰æ‹©ç­–ç•¥å’Œä¸Šé¢è®¨è®ºçš„ç›¸ åŒã€‚å¦å¤–ï¼ŒMaster èŠ‚ç‚¹å¿…é¡»é€‰æ‹©å“ªä¸ªå‰¯æœ¬è¦è¢«ç§»èµ°ã€‚é€šå¸¸æƒ…å†µï¼ŒMaster èŠ‚ç‚¹ç§»èµ°é‚£äº›å‰©ä½™ç©ºé—´ä½äºå¹³å‡å€¼çš„Chunk æœåŠ¡å™¨ä¸Šçš„å‰¯æœ¬ï¼Œä»è€Œå¹³è¡¡ç³»ç»Ÿæ•´ä½“çš„ç¡¬ç›˜ä½¿ç”¨ç‡ã€‚ åƒåœ¾å›æ”¶GFS åœ¨æ–‡ä»¶åˆ é™¤åä¸ä¼šç«‹åˆ»å›æ”¶å¯ç”¨çš„ç‰©ç†ç©ºé—´ã€‚GFS ç©ºé—´å›æ”¶é‡‡ç”¨æƒ°æ€§çš„ç­–ç•¥ï¼Œåªåœ¨æ–‡ä»¶å’Œ Chunk çº§ çš„å¸¸è§„åƒåœ¾æ”¶é›†æ—¶è¿›è¡Œã€‚æˆ‘ä»¬å‘ç°è¿™ä¸ªæ–¹æ³•ä½¿ç³»ç»Ÿæ›´ç®€å•ã€æ›´å¯é ã€‚ æœºåˆ¶å½“ä¸€ä¸ªæ–‡ä»¶è¢«åº”ç”¨ç¨‹åºåˆ é™¤æ—¶ï¼ŒMaster èŠ‚ç‚¹è±¡å¯¹å¾…å…¶å®ƒä¿®æ”¹æ“ä½œä¸€æ ·ï¼Œç«‹åˆ»æŠŠåˆ é™¤æ“ä½œä»¥æ—¥å¿—çš„æ–¹å¼è®° å½•ä¸‹æ¥ã€‚ä½†æ˜¯ï¼ŒMaster èŠ‚ç‚¹å¹¶ä¸é©¬ä¸Šå›æ”¶èµ„æºï¼Œè€Œæ˜¯æŠŠæ–‡ä»¶åæ”¹ä¸ºä¸€ä¸ªåŒ…å«åˆ é™¤æ—¶é—´æˆ³çš„ã€éšè—çš„åå­—ã€‚å½“ Master èŠ‚ç‚¹å¯¹æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´åšå¸¸è§„æ‰«æçš„æ—¶å€™ï¼Œå®ƒä¼šåˆ é™¤æ‰€æœ‰ä¸‰å¤©å‰çš„éšè—æ–‡ä»¶(è¿™ä¸ªæ—¶é—´é—´éš”æ˜¯å¯ä»¥ è®¾ç½®çš„)ã€‚ç›´åˆ°æ–‡ä»¶è¢«çœŸæ­£åˆ é™¤ï¼Œå®ƒä»¬ä»æ—§å¯ä»¥ç”¨æ–°çš„ç‰¹æ®Šçš„åå­—è¯»å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŠŠéšè—æ–‡ä»¶æ”¹åä¸ºæ­£å¸¸æ˜¾ ç¤ºçš„æ–‡ä»¶åçš„æ–¹å¼â€œååˆ é™¤â€ã€‚å½“éšè—æ–‡ä»¶è¢«ä»åç§°ç©ºé—´ä¸­åˆ é™¤ï¼ŒMaster æœåŠ¡å™¨å†…å­˜ä¸­ä¿å­˜çš„è¿™ä¸ªæ–‡ä»¶çš„ç›¸å…³ å…ƒæ•°æ®æ‰ä¼šè¢«åˆ é™¤ã€‚è¿™ä¹Ÿæœ‰æ•ˆçš„åˆ‡æ–­äº†æ–‡ä»¶å’Œå®ƒåŒ…å«çš„æ‰€æœ‰ Chunk çš„è¿æ¥ã€‚ åœ¨å¯¹ Chunk åå­—ç©ºé—´åšç±»ä¼¼çš„å¸¸è§„æ‰«ææ—¶ï¼ŒMaster èŠ‚ç‚¹æ‰¾åˆ°å­¤å„¿ Chunk(ä¸è¢«ä»»ä½•æ–‡ä»¶åŒ…å«çš„ Chunk) å¹¶åˆ é™¤å®ƒä»¬çš„å…ƒæ•°æ®ã€‚Chunk æœåŠ¡å™¨åœ¨å’Œ Master èŠ‚ç‚¹äº¤äº’çš„å¿ƒè·³ä¿¡æ¯ä¸­ï¼ŒæŠ¥å‘Šå®ƒæ‹¥æœ‰çš„ Chunk å­é›†çš„ä¿¡æ¯ï¼Œ Master èŠ‚ç‚¹å›å¤ Chunk æœåŠ¡å™¨å“ªäº› Chunk åœ¨ Master èŠ‚ç‚¹ä¿å­˜çš„å…ƒæ•°æ®ä¸­å·²ç»ä¸å­˜åœ¨äº†ã€‚Chunk æœåŠ¡å™¨å¯ä»¥ä»» æ„åˆ é™¤è¿™äº› Chunk çš„å‰¯æœ¬ã€‚ è®¨è®ºè™½ç„¶åˆ†å¸ƒå¼åƒåœ¾å›æ”¶åœ¨ç¼–ç¨‹è¯­è¨€é¢†åŸŸæ˜¯ä¸€ä¸ªéœ€è¦å¤æ‚çš„æ–¹æ¡ˆæ‰èƒ½è§£å†³çš„éš¾é¢˜ï¼Œä½†æ˜¯åœ¨ GFS ç³»ç»Ÿä¸­æ˜¯éå¸¸ ç®€å•çš„ã€‚æˆ‘ä»¬å¯ä»¥è½»æ˜“çš„å¾—åˆ° Chunk çš„æ‰€æœ‰å¼•ç”¨:å®ƒä»¬éƒ½åªå­˜å‚¨åœ¨ Master æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶åˆ°å—çš„æ˜ å°„è¡¨ä¸­ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆè½»æ˜“çš„å¾—åˆ°æ‰€æœ‰ Chunk çš„å‰¯æœ¬:å®ƒä»¬éƒ½ä»¥ Linux æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ Chunk æœåŠ¡å™¨çš„æŒ‡å®šç›®å½•ä¸‹ã€‚ æ‰€æœ‰ Master èŠ‚ç‚¹ä¸èƒ½è¯†åˆ«çš„å‰¯æœ¬éƒ½æ˜¯â€œåƒåœ¾â€ã€‚ åƒåœ¾å›æ”¶åœ¨ç©ºé—´å›æ”¶æ–¹é¢ç›¸æ¯”ç›´æ¥åˆ é™¤æœ‰å‡ ä¸ªä¼˜åŠ¿ã€‚é¦–å…ˆï¼Œå¯¹äºç»„ä»¶å¤±æ•ˆæ˜¯å¸¸æ€çš„å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œ åƒåœ¾å›æ”¶æ–¹å¼ç®€å•å¯é ã€‚Chunk å¯èƒ½åœ¨æŸäº› Chunk æœåŠ¡å™¨åˆ›å»ºæˆåŠŸï¼ŒæŸäº› Chunk æœåŠ¡å™¨ä¸Šåˆ›å»ºå¤±è´¥ï¼Œå¤±è´¥çš„ å‰¯æœ¬å¤„äºæ— æ³•è¢« Master èŠ‚ç‚¹è¯†åˆ«çš„çŠ¶æ€ã€‚å‰¯æœ¬åˆ é™¤æ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼ŒMaster èŠ‚ç‚¹å¿…é¡»é‡æ–°å‘é€å¤±è´¥çš„åˆ é™¤æ¶ˆæ¯ï¼Œ åŒ…æ‹¬è‡ªèº«çš„å’Œ Chunk æœåŠ¡å™¨çš„(è‡ªèº«çš„æŒ‡åˆ é™¤ metadata çš„æ¶ˆæ¯)ã€‚åƒåœ¾å›æ”¶æä¾›äº†ä¸€è‡´çš„ã€å¯é çš„æ¸…é™¤æ— ç”¨å‰¯æœ¬çš„æ–¹æ³•ã€‚ç¬¬äºŒï¼Œåƒåœ¾å›æ”¶æŠŠ å­˜å‚¨ç©ºé—´çš„å›æ”¶æ“ä½œåˆå¹¶åˆ° Master èŠ‚ç‚¹è§„å¾‹æ€§çš„åå°æ´»åŠ¨ä¸­ï¼Œæ¯”å¦‚ï¼Œä¾‹è¡Œæ‰«æå’Œä¸ Chunk æœåŠ¡å™¨æ¡æ‰‹ç­‰ã€‚å›  æ­¤ï¼Œæ“ä½œè¢«æ‰¹é‡çš„æ‰§è¡Œï¼Œå¼€é”€ä¼šè¢«åˆ†æ•£ã€‚å¦å¤–ï¼Œåƒåœ¾å›æ”¶åœ¨ Master èŠ‚ç‚¹ç›¸å¯¹ç©ºé—²çš„æ—¶å€™å®Œæˆã€‚è¿™æ · MasterèŠ‚ç‚¹å°±å¯ä»¥ç»™é‚£äº›éœ€è¦å¿«é€Ÿååº”çš„å®¢æˆ·æœºè¯·æ±‚æä¾›æ›´å¿«æ·çš„å“åº”ã€‚ç¬¬ä¸‰ï¼Œå»¶ç¼“å­˜å‚¨ç©ºé—´å›æ”¶ä¸ºæ„å¤–çš„ã€ä¸å¯é€†è½¬çš„åˆ é™¤æ“ä½œæä¾›äº†å®‰å…¨ä¿éšœã€‚ æ ¹æ®æˆ‘ä»¬çš„ä½¿ç”¨ç»éªŒï¼Œå»¶è¿Ÿå›æ”¶ç©ºé—´çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œå»¶è¿Ÿå›æ”¶ä¼šé˜»ç¢ç”¨æˆ·è°ƒä¼˜å­˜å‚¨ç©ºé—´çš„ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“å­˜å‚¨ç©ºé—´æ¯”è¾ƒç´§ç¼ºçš„æ—¶å€™ã€‚å½“åº”ç”¨ç¨‹åºé‡å¤åˆ›å»ºå’Œåˆ é™¤ä¸´æ—¶æ–‡ä»¶æ—¶ï¼Œé‡Šæ”¾çš„å­˜å‚¨ç©ºé—´ä¸èƒ½é©¬ä¸Šé‡ç”¨ã€‚æˆ‘ä»¬ é€šè¿‡æ˜¾å¼çš„å†æ¬¡åˆ é™¤ä¸€ä¸ªå·²ç»è¢«åˆ é™¤çš„æ–‡ä»¶çš„æ–¹å¼åŠ é€Ÿç©ºé—´å›æ”¶çš„é€Ÿåº¦ã€‚æˆ‘ä»¬å…è®¸ç”¨æˆ·ä¸ºå‘½åç©ºé—´çš„ä¸åŒéƒ¨ åˆ†è®¾å®šä¸åŒçš„å¤åˆ¶å’Œå›æ”¶ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šæŸäº›ç›®å½•æ ‘ä¸‹é¢çš„æ–‡ä»¶ä¸åšå¤åˆ¶ï¼Œåˆ é™¤çš„æ–‡ä»¶è¢«å³æ—¶çš„ã€ ä¸å¯æ¢å¤çš„ä»æ–‡ä»¶ç³»ç»Ÿç§»é™¤ã€‚ è¿‡æœŸå¤±æ•ˆçš„å‰¯æœ¬æ£€æµ‹å½“ Chunk æœåŠ¡å™¨å¤±æ•ˆæ—¶ï¼ŒChunk çš„å‰¯æœ¬æœ‰å¯èƒ½å› é”™å¤±äº†ä¸€äº›ä¿®æ”¹æ“ä½œè€Œè¿‡æœŸå¤±æ•ˆã€‚Master èŠ‚ç‚¹ä¿å­˜äº†æ¯ ä¸ª Chunk çš„ç‰ˆæœ¬å·ï¼Œç”¨æ¥åŒºåˆ†å½“å‰çš„å‰¯æœ¬å’Œè¿‡æœŸå‰¯æœ¬ã€‚ æ— è®ºä½•æ—¶ï¼Œåªè¦ Master èŠ‚ç‚¹å’Œ Chunk ç­¾è®¢ä¸€ä¸ªæ–°çš„ç§Ÿçº¦ï¼Œå®ƒå°±å¢åŠ  Chunk çš„ç‰ˆæœ¬å·ï¼Œç„¶åé€šçŸ¥æœ€æ–°çš„ å‰¯æœ¬ã€‚Master èŠ‚ç‚¹å’Œè¿™äº›å‰¯æœ¬éƒ½æŠŠæ–°çš„ç‰ˆæœ¬å·è®°å½•åœ¨å®ƒä»¬æŒä¹…åŒ–å­˜å‚¨çš„çŠ¶æ€ä¿¡æ¯ä¸­ã€‚è¿™ä¸ªåŠ¨ä½œå‘ç”Ÿåœ¨ä»»ä½•å®¢ æˆ·æœºå¾—åˆ°é€šçŸ¥ä»¥å‰ï¼Œå› æ­¤ä¹Ÿæ˜¯å¯¹è¿™ä¸ª Chunk å¼€å§‹å†™ä¹‹å‰ã€‚å¦‚æœæŸä¸ªå‰¯æœ¬æ‰€åœ¨çš„ Chunk æœåŠ¡å™¨æ­£å¥½å¤„äºå¤±æ•ˆçŠ¶ æ€ï¼Œé‚£ä¹ˆå‰¯æœ¬çš„ç‰ˆæœ¬å·å°±ä¸ä¼šè¢«å¢åŠ ã€‚Master èŠ‚ç‚¹åœ¨è¿™ä¸ª Chunk æœåŠ¡å™¨é‡æ–°å¯åŠ¨ï¼Œå¹¶ä¸”å‘ Master èŠ‚ç‚¹æŠ¥å‘Šå®ƒ æ‹¥æœ‰çš„ Chunk çš„é›†åˆä»¥åŠç›¸åº”çš„ç‰ˆæœ¬å·çš„æ—¶å€™ï¼Œå°±ä¼šæ£€æµ‹å‡ºå®ƒåŒ…å«è¿‡æœŸçš„ Chunkã€‚å¦‚æœ Master èŠ‚ç‚¹çœ‹åˆ°ä¸€ä¸ª æ¯”å®ƒè®°å½•çš„ç‰ˆæœ¬å·æ›´é«˜çš„ç‰ˆæœ¬å·ï¼ŒMaster èŠ‚ç‚¹ä¼šè®¤ä¸ºå®ƒå’Œ Chunk æœåŠ¡å™¨ç­¾è®¢ç§Ÿçº¦çš„æ“ä½œå¤±è´¥äº†ï¼Œå› æ­¤ä¼šé€‰æ‹© æ›´é«˜çš„ç‰ˆæœ¬å·ä½œä¸ºå½“å‰çš„ç‰ˆæœ¬å·ã€‚ Master èŠ‚ç‚¹åœ¨ä¾‹è¡Œçš„åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ç§»é™¤æ‰€æœ‰çš„è¿‡æœŸå¤±æ•ˆå‰¯æœ¬ã€‚åœ¨æ­¤ä¹‹å‰ï¼ŒMaster èŠ‚ç‚¹åœ¨å›å¤å®¢æˆ·æœºçš„ Chunk ä¿¡æ¯è¯·æ±‚çš„æ—¶å€™ï¼Œç®€å•çš„è®¤ä¸ºé‚£äº›è¿‡æœŸçš„å—æ ¹æœ¬å°±ä¸å­˜åœ¨ã€‚å¦å¤–ä¸€é‡ä¿éšœæªæ–½æ˜¯ï¼ŒMaster èŠ‚ç‚¹åœ¨é€šçŸ¥ å®¢æˆ·æœºå“ªä¸ª Chunk æœåŠ¡å™¨æŒæœ‰ç§Ÿçº¦ã€æˆ–è€…æŒ‡ç¤º Chunk æœåŠ¡å™¨ä»å“ªä¸ª Chunk æœåŠ¡å™¨è¿›è¡Œå…‹éš†æ—¶ï¼Œæ¶ˆæ¯ä¸­éƒ½é™„å¸¦ äº† Chunk çš„ç‰ˆæœ¬å·ã€‚å®¢æˆ·æœºæˆ–è€… Chunk æœåŠ¡å™¨åœ¨æ‰§è¡Œæ“ä½œæ—¶éƒ½ä¼šéªŒè¯ç‰ˆæœ¬å·ä»¥ç¡®ä¿æ€»æ˜¯è®¿é—®å½“å‰ç‰ˆæœ¬çš„æ•°æ®ã€‚ å®¹é”™å’Œè¯Šæ–­æˆ‘ä»¬åœ¨è®¾è®¡ GFS æ—¶é‡åˆ°çš„æœ€å¤§æŒ‘æˆ˜ä¹‹ä¸€æ˜¯å¦‚ä½•å¤„ç†é¢‘ç¹å‘ç”Ÿçš„ç»„ä»¶å¤±æ•ˆã€‚ç»„ä»¶çš„æ•°é‡å’Œè´¨é‡è®©è¿™äº›é—®é¢˜ å‡ºç°çš„é¢‘ç‡è¿œè¿œè¶…è¿‡ä¸€èˆ¬ç³»ç»Ÿæ„å¤–å‘ç”Ÿçš„é¢‘ç‡:æˆ‘ä»¬ä¸èƒ½å®Œå…¨ä¾èµ–æœºå™¨çš„ç¨³å®šæ€§ï¼Œä¹Ÿä¸èƒ½å®Œå…¨ç›¸ä¿¡ç¡¬ç›˜çš„å¯ é æ€§ã€‚ç»„ä»¶çš„å¤±æ•ˆå¯èƒ½é€ æˆç³»ç»Ÿä¸å¯ç”¨ï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿˜å¯èƒ½äº§ç”Ÿä¸å®Œæ•´çš„æ•°æ®ã€‚æˆ‘ä»¬è®¨è®ºæˆ‘ä»¬å¦‚ä½•é¢å¯¹è¿™ äº›æŒ‘æˆ˜ï¼Œä»¥åŠå½“ç»„ä»¶å¤±æ•ˆä¸å¯é¿å…çš„å‘ç”Ÿæ—¶ï¼Œç”¨ GFS è‡ªå¸¦å·¥å…·è¯Šæ–­ç³»ç»Ÿæ•…éšœã€‚ é«˜å¯ç”¨æ€§åœ¨ GFS é›†ç¾¤çš„æ•°ç™¾ä¸ªæœåŠ¡å™¨ä¹‹ä¸­ï¼Œåœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´å¿…å®šä¼šæœ‰äº›æœåŠ¡å™¨æ˜¯ä¸å¯ç”¨çš„ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸¤æ¡ç®€å•ä½†æ˜¯æœ‰æ•ˆçš„ç­–ç•¥ä¿è¯æ•´ä¸ªç³»ç»Ÿçš„é«˜å¯ç”¨æ€§:å¿«é€Ÿæ¢å¤å’Œå¤åˆ¶ã€‚ å¿«é€Ÿæ¢å¤ä¸ç®¡ Master æœåŠ¡å™¨å’Œ Chunk æœåŠ¡å™¨æ˜¯å¦‚ä½•å…³é—­çš„ï¼Œå®ƒä»¬éƒ½è¢«è®¾è®¡ä¸ºå¯ä»¥åœ¨æ•°ç§’é’Ÿå†…æ¢å¤å®ƒä»¬çš„çŠ¶æ€å¹¶é‡ æ–°å¯åŠ¨ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸åŒºåˆ†æ­£å¸¸å…³é—­å’Œå¼‚å¸¸å…³é—­;é€šå¸¸ï¼Œæˆ‘ä»¬é€šè¿‡ç›´æ¥ kill æ‰è¿›ç¨‹æ¥å…³é—­æœåŠ¡å™¨ã€‚å®¢æˆ· æœºå’Œå…¶å®ƒçš„æœåŠ¡å™¨ä¼šæ„Ÿè§‰åˆ°ç³»ç»Ÿæœ‰ç‚¹é¢ ç°¸(a minor hiccup)ï¼Œæ­£åœ¨å‘å‡ºçš„è¯·æ±‚ä¼šè¶…æ—¶ï¼Œéœ€è¦é‡æ–°è¿æ¥åˆ°é‡å¯åçš„æœåŠ¡å™¨ï¼Œç„¶å é‡è¯•è¿™ä¸ªè¯·æ±‚ã€‚6.6.2 ç« èŠ‚è®°å½•äº†å®æµ‹çš„å¯åŠ¨æ—¶é—´ã€‚ Chunk å¤åˆ¶æ­£å¦‚ä¹‹å‰è®¨è®ºçš„ï¼Œæ¯ä¸ª Chunk éƒ½è¢«å¤åˆ¶åˆ°ä¸åŒæœºæ¶ä¸Šçš„ä¸åŒçš„ Chunk æœåŠ¡å™¨ä¸Šã€‚ç”¨æˆ·å¯ä»¥ä¸ºæ–‡ä»¶å‘½åç©º é—´çš„ä¸åŒéƒ¨åˆ†è®¾å®šä¸åŒçš„å¤åˆ¶çº§åˆ«ã€‚ç¼ºçœæ˜¯ 3ã€‚å½“æœ‰ Chunk æœåŠ¡å™¨ç¦»çº¿äº†ï¼Œæˆ–è€…é€šè¿‡ Chksum æ ¡éªŒ(å‚è€ƒ 5.2 èŠ‚)å‘ç°äº†å·²ç»æŸåçš„æ•°æ®ï¼ŒMaster èŠ‚ç‚¹é€šè¿‡å…‹éš†å·²æœ‰çš„å‰¯æœ¬ä¿è¯æ¯ä¸ª Chunk éƒ½è¢«å®Œæ•´å¤åˆ¶(å³æ¯ä¸ª Chunk éƒ½æœ‰å¤åˆ¶å› å­åˆ¶å®šçš„ä¸ªæ•°ä¸ªå‰¯æœ¬ï¼Œç¼ºçœæ˜¯ 3)ã€‚è™½ç„¶ Chunk å¤åˆ¶ç­–ç•¥å¯¹æˆ‘ä»¬éå¸¸æœ‰æ•ˆï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿåœ¨å¯»æ‰¾å…¶å®ƒå½¢å¼çš„è·¨æœåŠ¡å™¨çš„å†—ä½™è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨å¥‡å¶æ ¡éªŒã€æˆ– è€… Erasure codes(Erasure codes ç”¨æ¥è§£å†³é“¾æ¥å±‚ä¸­ä¸ç›¸å…³çš„é”™è¯¯ï¼Œä»¥åŠç½‘ç»œæ‹¥å¡å’Œ buffer é™åˆ¶é€ æˆçš„ä¸¢åŒ…é”™è¯¯)æ¥è§£å†³æˆ‘ä»¬æ—¥ç›Šå¢é•¿çš„åªè¯»å­˜å‚¨éœ€æ±‚ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿä¸»è¦çš„å·¥ä½œè´Ÿè½½æ˜¯è¿½åŠ æ–¹å¼çš„å†™å…¥å’Œè¯»å– æ“ä½œï¼Œå¾ˆå°‘æœ‰éšæœºçš„å†™å…¥æ“ä½œï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºåœ¨æˆ‘ä»¬è¿™ä¸ªé«˜åº¦è§£è€¦åˆçš„ç³»ç»Ÿæ¶æ„ä¸‹å®ç°è¿™äº›å¤æ‚çš„å†—ä½™æ–¹ æ¡ˆå¾ˆæœ‰æŒ‘æˆ˜æ€§ï¼Œä½†å¹¶éä¸å¯å®ç°ã€‚ Master æœåŠ¡å™¨çš„å¤åˆ¶ä¸ºäº†ä¿è¯ Master æœåŠ¡å™¨çš„å¯é æ€§ï¼ŒMaster æœåŠ¡å™¨çš„çŠ¶æ€ä¹Ÿè¦å¤åˆ¶ã€‚Master æœåŠ¡å™¨æ‰€æœ‰çš„æ“ä½œæ—¥å¿—å’Œ checkpoint æ–‡ä»¶éƒ½è¢«å¤åˆ¶åˆ°å¤šå°æœºå™¨ä¸Šã€‚å¯¹ Master æœåŠ¡å™¨çŠ¶æ€çš„ä¿®æ”¹æ“ä½œèƒ½å¤Ÿæäº¤æˆåŠŸçš„å‰ææ˜¯ï¼Œæ“ä½œæ—¥å¿— å†™å…¥åˆ° Master æœåŠ¡å™¨çš„å¤‡èŠ‚ç‚¹å’Œæœ¬æœºçš„ç£ç›˜ã€‚ç®€å•è¯´æ¥ï¼Œä¸€ä¸ª Master æœåŠ¡è¿›ç¨‹è´Ÿè´£æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œï¼ŒåŒ…æ‹¬å å°çš„æœåŠ¡ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶ç­‰æ”¹å˜ç³»ç»Ÿå†…éƒ¨çŠ¶æ€æ´»åŠ¨ã€‚å½“å®ƒå¤±æ•ˆçš„æ—¶ï¼Œå‡ ä¹å¯ä»¥ç«‹åˆ»é‡æ–°å¯åŠ¨ã€‚å¦‚æœ Master è¿› ç¨‹æ‰€åœ¨çš„æœºå™¨æˆ–è€…ç£ç›˜å¤±æ•ˆäº†ï¼Œå¤„äº GFS ç³»ç»Ÿå¤–éƒ¨çš„ç›‘æ§è¿›ç¨‹ä¼šåœ¨å…¶å®ƒçš„å­˜æœ‰å®Œæ•´æ“ä½œæ—¥å¿—çš„æœºå™¨ä¸Šå¯åŠ¨ä¸€ ä¸ªæ–°çš„ Master è¿›ç¨‹ã€‚å®¢æˆ·ç«¯ä½¿ç”¨è§„èŒƒçš„åå­—è®¿é—® Master(æ¯”å¦‚ gfs-test)èŠ‚ç‚¹ï¼Œè¿™ä¸ªåå­—ç±»ä¼¼ DNS åˆ«åï¼Œå›  æ­¤ä¹Ÿå°±å¯ä»¥åœ¨ Master è¿›ç¨‹è½¬åˆ°åˆ«çš„æœºå™¨ä¸Šæ‰§è¡Œæ—¶ï¼Œé€šè¿‡æ›´æ”¹åˆ«åçš„å®é™…æŒ‡å‘è®¿é—®æ–°çš„ Master èŠ‚ç‚¹ã€‚ æ­¤å¤–ï¼ŒGFS ä¸­è¿˜æœ‰äº›â€œå½±å­â€Master æœåŠ¡å™¨ï¼Œè¿™äº›â€œå½±å­â€æœåŠ¡å™¨åœ¨â€œä¸»â€Master æœåŠ¡å™¨å®•æœºçš„æ—¶å€™æ ä¾›æ–‡ä»¶ç³»ç»Ÿçš„åªè¯»è®¿é—®ã€‚å®ƒä»¬æ˜¯å½±å­ï¼Œè€Œä¸æ˜¯é•œåƒï¼Œæ‰€ä»¥å®ƒä»¬çš„æ•°æ®å¯èƒ½æ¯”â€œä¸»â€Master æœåŠ¡å™¨æ›´æ–°è¦æ…¢ï¼Œ é€šå¸¸æ˜¯ä¸åˆ° 1 ç§’ã€‚å¯¹äºé‚£äº›ä¸ç»å¸¸æ”¹å˜çš„æ–‡ä»¶ã€æˆ–è€…é‚£äº›å…è®¸è·å–çš„æ•°æ®æœ‰å°‘é‡è¿‡æœŸçš„åº”ç”¨ç¨‹åºï¼Œâ€œå½±å­â€Master æœåŠ¡å™¨èƒ½å¤Ÿæé«˜è¯»å–çš„æ•ˆç‡ã€‚äº‹å®ä¸Šï¼Œå› ä¸ºæ–‡ä»¶å†…å®¹æ˜¯ä» Chunk æœåŠ¡å™¨ä¸Šè¯»å–çš„ï¼Œå› æ­¤ï¼Œåº”ç”¨ç¨‹åºä¸ ä¼šå‘ç°è¿‡æœŸçš„æ–‡ä»¶å†…å®¹ã€‚åœ¨è¿™ä¸ªçŸ­æš‚çš„æ—¶é—´çª—å†…ï¼Œè¿‡æœŸçš„å¯èƒ½æ˜¯æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ç›®å½•çš„å†…å®¹æˆ–è€…è®¿é—®æ§åˆ¶ä¿¡æ¯ã€‚ â€œå½±å­â€Master æœåŠ¡å™¨ä¸ºäº†ä¿æŒè‡ªèº«çŠ¶æ€æ˜¯æœ€æ–°çš„ï¼Œå®ƒä¼šè¯»å–ä¸€ä»½å½“å‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œçš„æ—¥å¿—å‰¯æœ¬ï¼Œå¹¶ä¸”ä¾ç…§å’Œä¸» Master æœåŠ¡å™¨å®Œå…¨ç›¸åŒçš„é¡ºåºæ¥æ›´æ”¹å†…éƒ¨çš„æ•°æ®ç»“æ„ã€‚å’Œä¸» Master æœåŠ¡å™¨ä¸€æ ·ï¼Œâ€œå½±å­â€Master æœåŠ¡å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ä¹Ÿä¼šä» Chunk æœåŠ¡å™¨è½®è¯¢æ•°æ®(ä¹‹åå®šæœŸæ‹‰æ•°æ®)ï¼Œæ•°æ®ä¸­åŒ…æ‹¬äº† Chunk å‰¯æœ¬çš„ä½ç½®ä¿¡ æ¯;â€œå½±å­â€Master æœåŠ¡å™¨ä¹Ÿä¼šå®šæœŸå’Œ Chunk æœåŠ¡å™¨â€œæ¡æ‰‹â€æ¥ç¡®å®šå®ƒä»¬çš„çŠ¶æ€ã€‚åœ¨ä¸» Master æœåŠ¡å™¨å› åˆ›å»º å’Œåˆ é™¤å‰¯æœ¬å¯¼è‡´å‰¯æœ¬ä½ç½®ä¿¡æ¯æ›´æ–°æ—¶ï¼Œâ€œå½±å­â€Master æœåŠ¡å™¨æ‰å’Œä¸» Master æœåŠ¡å™¨é€šä¿¡æ¥æ›´æ–°è‡ªèº«çŠ¶æ€ã€‚ æ•°æ®å®Œæ•´æ€§æ¯ä¸ª Chunk æœåŠ¡å™¨éƒ½ä½¿ç”¨ Checksum æ¥æ£€æŸ¥ä¿å­˜çš„æ•°æ®æ˜¯å¦æŸåã€‚è€ƒè™‘åˆ°ä¸€ä¸ª GFS é›†ç¾¤é€šå¸¸éƒ½æœ‰å¥½å‡ ç™¾ å°æœºå™¨ã€å‡ åƒå—ç¡¬ç›˜ï¼Œç£ç›˜æŸåå¯¼è‡´æ•°æ®åœ¨è¯»å†™è¿‡ç¨‹ä¸­æŸåæˆ–è€…ä¸¢å¤±æ˜¯éå¸¸å¸¸è§çš„(ç¬¬ 7 èŠ‚è®²äº†ä¸€ä¸ªåŸå› )ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ«çš„ Chunk å‰¯æœ¬æ¥è§£å†³æ•°æ®æŸåé—®é¢˜ï¼Œä½†æ˜¯è·¨è¶Š Chunk æœåŠ¡å™¨æ¯”è¾ƒå‰¯æœ¬æ¥æ£€æŸ¥æ•°æ®æ˜¯å¦æŸåå¾ˆ ä¸å®é™…ã€‚å¦å¤–ï¼ŒGFS å…è®¸æœ‰æ­§ä¹‰çš„å‰¯æœ¬å­˜åœ¨:GFS ä¿®æ”¹æ“ä½œçš„è¯­ä¹‰ï¼Œç‰¹åˆ«æ˜¯æ—©å…ˆè®¨è®ºè¿‡çš„åŸå­çºªå½•è¿½åŠ çš„æ“ ä½œï¼Œå¹¶ä¸ä¿è¯å‰¯æœ¬å®Œå…¨ç›¸åŒ(alex æ³¨:å‰¯æœ¬ä¸æ˜¯ byte-wise å®Œå…¨ä¸€è‡´çš„)ã€‚å› æ­¤ï¼Œæ¯ä¸ª Chunk æœåŠ¡å™¨å¿…é¡»ç‹¬ç«‹ç»´ æŠ¤ Checksum æ¥æ ¡éªŒè‡ªå·±çš„å‰¯æœ¬çš„å®Œæ•´æ€§ã€‚ æˆ‘ä»¬æŠŠæ¯ä¸ª Chunk éƒ½åˆ†æˆ 64KB å¤§å°çš„å—ã€‚æ¯ä¸ªå—éƒ½å¯¹åº”ä¸€ä¸ª 32 ä½çš„ Checksumã€‚å’Œå…¶å®ƒå…ƒæ•°æ®ä¸€æ ·ï¼Œ Checksum ä¸å…¶å®ƒçš„ç”¨æˆ·æ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œå¹¶ä¸”ä¿å­˜åœ¨å†…å­˜å’Œç¡¬ç›˜ä¸Šï¼ŒåŒæ—¶ä¹Ÿè®°å½•æ“ä½œæ—¥å¿—ã€‚å¯¹äºè¯»æ“ä½œæ¥è¯´ï¼Œåœ¨æŠŠæ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯æˆ–è€…å…¶å®ƒçš„ Chunk æœåŠ¡å™¨ä¹‹å‰ï¼ŒChunk æœåŠ¡å™¨ä¼šæ ¡éªŒè¯»å–æ“ä½œ æ¶‰åŠçš„èŒƒå›´å†…çš„å—çš„ Checksumã€‚å› æ­¤ Chunk æœåŠ¡å™¨ä¸ä¼šæŠŠé”™è¯¯æ•°æ®ä¼ é€’åˆ°å…¶å®ƒçš„æœºå™¨ä¸Šã€‚å¦‚æœå‘ç”ŸæŸä¸ªå—çš„ Checksum ä¸æ­£ç¡®ï¼ŒChunk æœåŠ¡å™¨è¿”å›ç»™è¯·æ±‚è€…ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”é€šçŸ¥ Master æœåŠ¡å™¨è¿™ä¸ªé”™è¯¯ã€‚ä½œä¸ºå›åº”ï¼Œ è¯·æ±‚è€…åº”å½“ä»å…¶å®ƒå‰¯æœ¬è¯»å–æ•°æ®ï¼ŒMaster æœåŠ¡å™¨ä¹Ÿä¼šä»å…¶å®ƒå‰¯æœ¬å…‹éš†æ•°æ®è¿›è¡Œæ¢å¤ã€‚å½“ä¸€ä¸ªæ–°çš„å‰¯æœ¬å°±ç»ªåï¼Œ Master æœåŠ¡å™¨é€šçŸ¥å‰¯æœ¬é”™è¯¯çš„ Chunk æœåŠ¡å™¨åˆ æ‰é”™è¯¯çš„å‰¯æœ¬ã€‚ Checksum å¯¹è¯»æ“ä½œçš„æ€§èƒ½å½±å“å¾ˆå°ï¼Œå¯ä»¥åŸºäºå‡ ä¸ªåŸå› æ¥åˆ†æä¸€ä¸‹ã€‚å› ä¸ºå¤§éƒ¨åˆ†çš„è¯»æ“ä½œéƒ½è‡³å°‘è¦è¯»å– å‡ ä¸ªå—ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦è¯»å–ä¸€å°éƒ¨åˆ†é¢å¤–çš„ç›¸å…³æ•°æ®è¿›è¡Œæ ¡éªŒã€‚GFS å®¢æˆ·ç«¯ä»£ç é€šè¿‡æ¯æ¬¡æŠŠè¯»å–æ“ä½œéƒ½å¯¹é½ åœ¨ Checksum block çš„è¾¹ç•Œä¸Šï¼Œè¿›ä¸€æ­¥å‡å°‘äº†è¿™äº›é¢å¤–çš„è¯»å–æ“ä½œçš„è´Ÿé¢å½±å“ã€‚å¦å¤–ï¼Œåœ¨ Chunk æœåŠ¡å™¨ä¸Šï¼Œ Checksum çš„æŸ¥æ‰¾å’Œæ¯”è¾ƒä¸éœ€è¦ I/O æ“ä½œï¼ŒChecksum çš„è®¡ç®—å¯ä»¥å’Œ I/O æ“ä½œåŒæ—¶è¿›è¡Œã€‚ Checksum çš„è®¡ç®—é’ˆå¯¹åœ¨ Chunk å°¾éƒ¨çš„è¿½åŠ å†™å…¥æ“ä½œåšäº†é«˜åº¦ä¼˜åŒ–(ä¸ä¹‹å¯¹åº”çš„æ˜¯è¦†ç›–ç°æœ‰æ•°æ®çš„å†™å…¥æ“ ä½œ)ï¼Œå› ä¸ºè¿™ç±»æ“ä½œåœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­å äº†å¾ˆå¤§æ¯”ä¾‹ã€‚æˆ‘ä»¬åªå¢é‡æ›´æ–°æœ€åä¸€ä¸ªä¸å®Œæ•´çš„å—çš„ Checksumï¼Œå¹¶ä¸” ç”¨æ‰€æœ‰çš„è¿½åŠ æ¥çš„æ–° Checksum å—æ¥è®¡ç®—æ–°çš„ Checksumã€‚å³ä½¿æ˜¯æœ€åä¸€ä¸ªä¸å®Œæ•´çš„ Checksum å—å·²ç»æŸåäº†ï¼Œä¸”æˆ‘ä»¬ä¸èƒ½å¤Ÿé©¬ä¸Šæ£€æŸ¥å‡ºæ¥ï¼Œç”±äºæ–°çš„ Checksum å’Œå·²æœ‰æ•°æ®ä¸å»åˆï¼Œåœ¨ä¸‹æ¬¡å¯¹è¿™ä¸ªå—è¿›è¡Œè¯»å–æ“ä½œçš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥å‡ºæ•°æ®å·²ç»æŸåäº†ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¦‚æœå†™æ“ä½œè¦†ç›–å·²ç»å­˜åœ¨çš„ä¸€ä¸ªèŒƒå›´å†…çš„ Chunkï¼Œæˆ‘ä»¬å¿…é¡»è¯»å–å’Œæ ¡éªŒè¢«è¦†ç›–çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå—ï¼Œç„¶åå†æ‰§è¡Œå†™æ“ä½œ;æ“ä½œå®Œæˆä¹‹åå†é‡æ–°è®¡ç®—å’Œå†™å…¥æ–°çš„ Checksumã€‚å¦‚æœæˆ‘ä»¬ä¸æ ¡éªŒç¬¬ä¸€ä¸ªå’Œæœ€ åä¸€ä¸ªè¢«å†™çš„å—ï¼Œé‚£ä¹ˆæ–°çš„ Checksum å¯èƒ½ä¼šéšè—æ²¡æœ‰è¢«è¦†ç›–åŒºåŸŸå†…çš„æ•°æ®é”™è¯¯ã€‚ åœ¨ Chunk æœåŠ¡å™¨ç©ºé—²çš„æ—¶å€™ï¼Œå®ƒä¼šæ‰«æå’Œæ ¡éªŒæ¯ä¸ªä¸æ´»åŠ¨çš„ Chunk çš„å†…å®¹ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿå‘ç°å¾ˆå°‘è¢« è¯»å–çš„ Chunk æ˜¯å¦å®Œæ•´ã€‚ä¸€æ—¦å‘ç°æœ‰ Chunk çš„æ•°æ®æŸåï¼ŒMaster å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ã€æ­£ç¡®çš„å‰¯æœ¬ï¼Œç„¶åæŠŠæŸ åçš„å‰¯æœ¬åˆ é™¤æ‰ã€‚è¿™ä¸ªæœºåˆ¶ä¹Ÿé¿å…äº†éæ´»åŠ¨çš„ã€å·²æŸåçš„ Chunk æ¬ºéª— Master èŠ‚ç‚¹ï¼Œä½¿ Master èŠ‚ç‚¹è®¤ä¸ºå®ƒä»¬å·² ç»æœ‰äº†è¶³å¤Ÿå¤šçš„å‰¯æœ¬äº†ã€‚ è¯Šæ–­å·¥å…·è¯¦å°½çš„ã€æ·±å…¥ç»†èŠ‚çš„è¯Šæ–­æ—¥å¿—ï¼Œåœ¨é—®é¢˜éš”ç¦»ã€è°ƒè¯•ã€ä»¥åŠæ€§èƒ½åˆ†æç­‰æ–¹é¢ç»™æˆ‘ä»¬å¸¦æ¥æ— æ³•ä¼°é‡çš„å¸®åŠ©ï¼Œ åŒæ—¶ä¹Ÿåªéœ€è¦å¾ˆå°çš„å¼€é”€ã€‚æ²¡æœ‰æ—¥å¿—çš„å¸®åŠ©ï¼Œæˆ‘ä»¬å¾ˆéš¾ç†è§£çŸ­æš‚çš„ã€ä¸é‡å¤çš„æœºå™¨ä¹‹é—´çš„æ¶ˆæ¯äº¤äº’ã€‚GFS çš„ æœåŠ¡å™¨ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—ï¼Œè®°å½•äº†å¤§é‡å…³é”®çš„äº‹ä»¶(æ¯”å¦‚ï¼ŒChunk æœåŠ¡å™¨å¯åŠ¨å’Œå…³é—­)ä»¥åŠæ‰€æœ‰çš„ RPC çš„è¯· æ±‚å’Œå›å¤ã€‚è¿™äº›è¯Šæ–­æ—¥å¿—å¯ä»¥éšæ„åˆ é™¤ï¼Œå¯¹ç³»ç»Ÿçš„æ­£ç¡®è¿è¡Œä¸é€ æˆä»»ä½•å½±å“ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åœ¨å­˜å‚¨ç©ºé—´å…è®¸çš„ æƒ…å†µä¸‹ä¼šå°½é‡çš„ä¿å­˜è¿™äº›æ—¥å¿—ã€‚ RPC æ—¥å¿—åŒ…å«äº†ç½‘ç»œä¸Šå‘ç”Ÿçš„æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„è¯¦ç»†è®°å½•ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬è¯»å†™çš„æ–‡ä»¶æ•°æ®ã€‚é€šè¿‡åŒ¹é…è¯·æ±‚ ä¸å›åº”ï¼Œä»¥åŠæ”¶é›†ä¸åŒæœºå™¨ä¸Šçš„ RPC æ—¥å¿—è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ¼”æ‰€æœ‰çš„æ¶ˆæ¯äº¤äº’æ¥è¯Šæ–­é—®é¢˜ã€‚æ—¥å¿—è¿˜ç”¨æ¥è·Ÿè¸ª è´Ÿè½½æµ‹è¯•å’Œæ€§èƒ½åˆ†æã€‚ æ—¥å¿—å¯¹æ€§èƒ½çš„å½±å“å¾ˆå°(è¿œå°äºå®ƒå¸¦æ¥çš„å¥½å¤„)ï¼Œå› ä¸ºè¿™äº›æ—¥å¿—çš„å†™å…¥æ–¹å¼æ˜¯é¡ºåºçš„ã€å¼‚æ­¥çš„ã€‚æœ€è¿‘å‘ç”Ÿ çš„äº‹ä»¶æ—¥å¿—ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯ç”¨äºæŒç»­ä¸æ–­çš„åœ¨çº¿ç›‘æ§ã€‚ åº¦é‡æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€äº›å°è§„æ¨¡åŸºå‡†æµ‹è¯•æ¥å±•ç° GFS ç³»ç»Ÿæ¶æ„å’Œå®ç°ä¸Šçš„ä¸€äº›å›ºæœ‰ç“¶é¢ˆï¼Œè¿˜æœ‰äº›æ¥è‡ªGoogle å†…éƒ¨ä½¿ç”¨çš„çœŸå®çš„ GFS é›†ç¾¤çš„åŸºå‡†æ•°æ®ã€‚ å°è§„æ¨¡åŸºå‡†æµ‹è¯•æˆ‘ä»¬åœ¨ä¸€ä¸ªåŒ…å« 1 å° Master æœåŠ¡å™¨ï¼Œ2 å° Master æœåŠ¡å™¨å¤åˆ¶èŠ‚ç‚¹ï¼Œ16 å° Chunk æœåŠ¡å™¨å’Œ 16 ä¸ªå®¢æˆ·æœºç»„ æˆçš„ GFS é›†ç¾¤ä¸Šæµ‹é‡æ€§èƒ½ã€‚æ³¨æ„ï¼Œé‡‡ç”¨è¿™æ ·çš„é›†ç¾¤é…ç½®æ–¹æ¡ˆåªæ˜¯ä¸ºäº†æ˜“äºæµ‹è¯•ã€‚å…¸å‹çš„ GFS é›†ç¾¤æœ‰æ•°ç™¾ä¸ª Chunk æœåŠ¡å™¨å’Œæ•°ç™¾ä¸ªå®¢æˆ·æœºã€‚ æ‰€æœ‰æœºå™¨çš„é…ç½®éƒ½ä¸€æ ·:ä¸¤ä¸ª PIII 1.4GHz å¤„ç†å™¨ï¼Œ2GB å†…å­˜ï¼Œä¸¤ä¸ª 80G/5400rpm çš„ç¡¬ç›˜ï¼Œä»¥åŠ 100Mbps å…¨åŒå·¥ä»¥å¤ªç½‘è¿æ¥åˆ°ä¸€ä¸ª HP2524 äº¤æ¢æœºã€‚GFS é›†ç¾¤ä¸­æ‰€æœ‰çš„ 19 å°æœåŠ¡å™¨éƒ½è¿æ¥åœ¨ä¸€ä¸ªäº¤æ¢æœºï¼Œæ‰€æœ‰ 16 å°å®¢æˆ·æœºè¿æ¥åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºä¸Šã€‚ä¸¤ä¸ªäº¤æ¢æœºä¹‹é—´ä½¿ç”¨ 1Gbps çš„çº¿è·¯è¿æ¥ã€‚ è¯»å–N ä¸ªå®¢æˆ·æœºä» GFS æ–‡ä»¶ç³»ç»ŸåŒæ­¥è¯»å–æ•°æ®ã€‚æ¯ä¸ªå®¢æˆ·æœºä» 320GB çš„æ–‡ä»¶é›†åˆä¸­éšæœºè¯»å– 4MB region çš„ å†…å®¹ã€‚è¯»å–æ“ä½œé‡å¤æ‰§è¡Œ 256 æ¬¡ï¼Œå› æ­¤ï¼Œæ¯ä¸ªå®¢æˆ·æœºæœ€ç»ˆéƒ½è¯»å– 1GB çš„æ•°æ®ã€‚æ‰€æœ‰çš„ Chunk æœåŠ¡å™¨åŠ èµ·æ¥æ€» å…±åªæœ‰ 32GB çš„å†…å­˜ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é¢„æœŸåªæœ‰æœ€å¤š 10%çš„è¯»å–è¯·æ±‚å‘½ä¸­ Linux çš„æ–‡ä»¶ç³»ç»Ÿç¼“å†²ã€‚æˆ‘ä»¬çš„æµ‹è¯•ç»“ æœåº”è¯¥å’Œä¸€ä¸ªåœ¨æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿç¼“å­˜çš„æƒ…å†µä¸‹è¯»å–æµ‹è¯•çš„ç»“æœæ¥è¿‘ã€‚ä¸Šè¾¹çš„æ›²çº¿æ˜¾ç¤ºäº†æˆ‘ä»¬ç½‘ç»œæ‹“æ‰‘ä¸‹çš„åˆè®¡ç†è®ºååé‡ä¸Šé™ã€‚ä¸‹è¾¹çš„æ›²çº¿æ˜¾ç¤ºäº†è§‚æµ‹åˆ°çš„ååé‡ã€‚è¿™ä¸ªæ›²çº¿æœ‰ç€ 95%çš„å¯é æ€§ï¼Œå› ä¸ºæœ‰æ—¶å€™æµ‹é‡ä¼šä¸å¤Ÿç²¾ç¡®ã€‚ å›¾ 3(a)æ˜¾ç¤ºäº† N ä¸ªå®¢æˆ·æœºæ•´ä½“çš„è¯»å–é€Ÿåº¦ä»¥åŠè¿™ä¸ªé€Ÿåº¦çš„ç†è®ºæé™ã€‚å½“è¿æ¥ä¸¤ä¸ªäº¤æ¢æœºçš„ 1Gbps çš„é“¾è·¯é¥±å’Œæ—¶ï¼Œæ•´ä½“è¯»å–é€Ÿåº¦è¾¾åˆ°ç†è®ºçš„æé™å€¼æ˜¯ 125MB/Sï¼Œæˆ–è€…è¯´æ¯ä¸ªå®¢æˆ·æœºé…ç½®çš„ 100Mbps ç½‘å¡è¾¾åˆ°é¥±å’Œæ—¶ï¼Œ æ¯ä¸ªå®¢æˆ·æœºè¯»å–é€Ÿåº¦çš„ç†è®ºæé™å€¼æ˜¯ 12.5MB/sã€‚å®æµ‹ç»“æœæ˜¯ï¼Œå½“ä¸€ä¸ªå®¢æˆ·æœºè¯»å–çš„æ—¶å€™ï¼Œè¯»å–çš„é€Ÿåº¦æ˜¯ 10MB/sï¼Œ ä¹Ÿå°±æ˜¯è¯´è¾¾åˆ°å®¢æˆ·æœºç†è®ºè¯»å–é€Ÿåº¦æé™å€¼çš„ 80%ã€‚å¯¹äº 16 ä¸ªå®¢æˆ·æœºï¼Œæ•´ä½“çš„è¯»å–é€Ÿåº¦è¾¾åˆ°äº† 94MB/sï¼Œå¤§çº¦ æ˜¯ç†è®ºæ•´ä½“è¯»å–é€Ÿåº¦æé™å€¼çš„ 75%ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªå®¢æˆ·æœºçš„è¯»å–é€Ÿåº¦æ˜¯ 6MB/sã€‚è¯»å–æ•ˆç‡ä» 80%é™ä½åˆ°äº† 75%ï¼Œ ä¸»è¦çš„åŸå› æ˜¯å½“è¯»å–çš„å®¢æˆ·æœºå¢åŠ æ—¶ï¼Œå¤šä¸ªå®¢æˆ·æœºåŒæ—¶è¯»å–ä¸€ä¸ª Chunk æœåŠ¡å™¨çš„å‡ ç‡ä¹Ÿå¢åŠ äº†ï¼Œå¯¼è‡´æ•´ä½“çš„ è¯»å–æ•ˆç‡ä¸‹é™ã€‚ å†™å…¥N ä¸ªå®¢æˆ·æœºåŒæ—¶å‘ N ä¸ªä¸åŒçš„æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ã€‚æ¯ä¸ªå®¢æˆ·æœºä»¥æ¯æ¬¡ 1MB çš„é€Ÿåº¦è¿ç»­å†™å…¥ 1GB çš„æ•°æ®ã€‚ å›¾ 3(b)æ˜¾ç¤ºäº†æ•´ä½“çš„å†™å…¥é€Ÿåº¦å’Œå®ƒä»¬ç†è®ºä¸Šçš„æé™å€¼ã€‚ç†è®ºä¸Šçš„æé™å€¼æ˜¯ 67MB/sï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æŠŠæ¯ä¸€ byte å†™å…¥åˆ° 16 ä¸ª Chunk æœåŠ¡å™¨ä¸­çš„ 3 ä¸ªä¸Šï¼Œè€Œæ¯ä¸ª Chunk æœåŠ¡å™¨çš„è¾“å…¥è¿æ¥é€Ÿåº¦æ˜¯ 12.5MB/sã€‚ ä¸€ä¸ªå®¢æˆ·æœºçš„å†™å…¥é€Ÿåº¦æ˜¯ 6.3MBï¼Œå¤§æ¦‚æ˜¯ç†è®ºæé™å€¼çš„ä¸€åŠã€‚å¯¼è‡´è¿™ä¸ªç»“æœçš„ä¸»è¦åŸå› æ˜¯æˆ‘ä»¬çš„ç½‘ç»œå è®®æ ˆã€‚å®ƒä¸æˆ‘ä»¬æ¨é€æ•°æ®åˆ° Chunk æœåŠ¡å™¨æ—¶é‡‡ç”¨çš„ç®¡é“æ¨¡å¼ä¸ç›¸é€‚åº”ã€‚ä»ä¸€ä¸ªå‰¯æœ¬åˆ°å¦ä¸€ä¸ªå‰¯æœ¬çš„æ•°æ®ä¼ è¾“å»¶è¿Ÿé™ä½äº†æ•´ä¸ªçš„å†™å…¥é€Ÿåº¦ã€‚ 16 ä¸ªå®¢æˆ·æœºæ•´ä½“çš„å†™å…¥é€Ÿåº¦è¾¾åˆ°äº† 35MB/s(å³æ¯ä¸ªå®¢æˆ·æœº 2.2MB/s)ï¼Œå¤§çº¦åªæ˜¯ç†è®ºæé™å€¼çš„ä¸€åŠã€‚å’Œå¤šä¸ªå®¢æˆ·æœºè¯»å–çš„æƒ…å½¢å¾ˆç±»å‹ï¼Œéšç€å®¢æˆ·æœºæ•°é‡çš„å¢åŠ ï¼Œå¤šä¸ªå®¢æˆ·æœºåŒæ—¶å†™å…¥åŒä¸€ä¸ª Chunk æœåŠ¡å™¨çš„å‡ ç‡ä¹Ÿ å¢åŠ äº†ã€‚è€Œä¸”ï¼Œ16 ä¸ªå®¢æˆ·æœºå¹¶è¡Œå†™å…¥å¯èƒ½å¼•èµ·çš„å†²çªæ¯” 16 ä¸ªå®¢æˆ·æœºå¹¶è¡Œè¯»å–è¦å¤§å¾—å¤šï¼Œå› ä¸ºæ¯ä¸ªå†™å…¥éƒ½ä¼š æ¶‰åŠä¸‰ä¸ªä¸åŒçš„å‰¯æœ¬ã€‚ å†™å…¥çš„é€Ÿåº¦æ¯”æˆ‘ä»¬æƒ³è±¡çš„è¦æ…¢ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™æ²¡æœ‰æˆä¸ºæˆ‘ä»¬çš„ä¸»è¦é—®é¢˜ï¼Œå› ä¸ºå³ä½¿åœ¨å•ä¸ªå®¢æˆ·æœºä¸Š èƒ½å¤Ÿæ„Ÿå—åˆ°å»¶æ—¶ï¼Œå®ƒä¹Ÿä¸ä¼šåœ¨æœ‰å¤§é‡å®¢æˆ·æœºçš„æ—¶å€™å¯¹æ•´ä½“çš„å†™å…¥å¸¦å®½é€ æˆæ˜¾è‘—çš„å½±å“ã€‚ è®°å½•è¿½åŠ å›¾ 3(c)æ˜¾ç¤ºäº†è®°å½•è¿½åŠ æ“ä½œçš„æ€§èƒ½ã€‚N ä¸ªå®¢æˆ·æœºåŒæ—¶è¿½åŠ æ•°æ®åˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚è®°å½•è¿½åŠ æ“ä½œçš„æ€§èƒ½å—é™ äºä¿å­˜æ–‡ä»¶æœ€åä¸€ä¸ª Chunk çš„ Chunk æœåŠ¡å™¨çš„å¸¦å®½ï¼Œè€Œä¸å®¢æˆ·æœºçš„æ•°é‡æ— å…³ã€‚è®°å½•è¿½åŠ çš„é€Ÿåº¦ç”±ä¸€ä¸ªå®¢æˆ·æœº çš„ 6.0MB/s å¼€å§‹ï¼Œä¸‹é™åˆ° 16 ä¸ªå®¢æˆ·æœºçš„ 4.8MB/s ä¸ºæ­¢ï¼Œé€Ÿåº¦çš„ä¸‹é™ä¸»è¦æ˜¯ç”±äºä¸åŒå®¢æˆ·ç«¯çš„ç½‘ç»œæ‹¥å¡ä»¥åŠç½‘ ç»œä¼ è¾“é€Ÿåº¦çš„ä¸åŒè€Œå¯¼è‡´çš„ã€‚ æˆ‘ä»¬çš„ç¨‹åºå€¾å‘äºåŒæ—¶å¤„ç†å¤šä¸ªè¿™æ ·çš„æ–‡ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œå³ N ä¸ªå®¢æˆ·æœºåŒæ—¶è¿½åŠ æ•°æ®åˆ° M ä¸ªå…±äº«æ–‡ä»¶ä¸­ï¼Œ è¿™é‡Œ N å’Œ M éƒ½æ˜¯æ•°åæˆ–è€…æ•°ç™¾ä»¥ä¸Šã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘ä»¬çš„å®é™…åº”ç”¨ä¸­ï¼ŒChunk æœåŠ¡å™¨çš„ç½‘ç»œæ‹¥å¡å¹¶æ²¡æœ‰æˆä¸ºä¸€ä¸ª ä¸¥é‡é—®é¢˜ï¼Œå¦‚æœ Chunk æœåŠ¡å™¨çš„æŸä¸ªæ–‡ä»¶æ­£åœ¨å†™å…¥ï¼Œå®¢æˆ·æœºä¼šå»å†™å¦å¤–ä¸€ä¸ªæ–‡ä»¶ã€‚ å®é™…åº”ç”¨ä¸­çš„é›†ç¾¤æˆ‘ä»¬ç°åœ¨æ¥ä»”ç»†è¯„ä¼°ä¸€ä¸‹ Google å†…éƒ¨æ­£åœ¨ä½¿ç”¨çš„ä¸¤ä¸ªé›†ç¾¤ï¼Œå®ƒä»¬å…·æœ‰ä¸€å®šçš„ä»£è¡¨æ€§ã€‚é›†ç¾¤ A é€šå¸¸è¢«ä¸Šç™¾ ä¸ªå·¥ç¨‹å¸ˆç”¨äºç ”ç©¶å’Œå¼€å‘ã€‚å…¸å‹çš„ä»»åŠ¡æ˜¯è¢«äººå·¥åˆå§‹åŒ–åè¿ç»­è¿è¡Œæ•°ä¸ªå°æ—¶ã€‚å®ƒé€šå¸¸è¯»å–æ•° MB åˆ°æ•° TB çš„ æ•°æ®ï¼Œä¹‹åè¿›è¡Œè½¬åŒ–æˆ–è€…åˆ†æï¼Œæœ€åæŠŠç»“æœå†™å›åˆ°é›†ç¾¤ä¸­ã€‚é›†ç¾¤ B ä¸»è¦ç”¨äºå¤„ç†å½“å‰çš„ç”Ÿäº§æ•°æ®ã€‚é›†ç¾¤ B çš„ ä»»åŠ¡æŒç»­çš„æ—¶é—´æ›´é•¿ï¼Œåœ¨å¾ˆå°‘äººå·¥å¹²é¢„çš„æƒ…å†µä¸‹ï¼ŒæŒç»­çš„ç”Ÿæˆå’Œå¤„ç†æ•° TB çš„æ•°æ®é›†ã€‚åœ¨è¿™ä¸¤ä¸ªæ¡ˆä¾‹ä¸­ï¼Œä¸€ ä¸ªå•ç‹¬çš„â€œä»»åŠ¡â€éƒ½æ˜¯æŒ‡è¿è¡Œåœ¨å¤šä¸ªæœºå™¨ä¸Šçš„å¤šä¸ªè¿›ç¨‹ï¼Œå®ƒä»¬åŒæ—¶è¯»å–å’Œå†™å…¥å¤šä¸ªæ–‡ä»¶ã€‚ å­˜å‚¨å¦‚ä¸Šè¡¨å‰äº”è¡Œæ‰€æè¿°çš„ï¼Œä¸¤ä¸ªé›†ç¾¤éƒ½ç”±ä¸Šç™¾å° Chunk æœåŠ¡å™¨ç»„æˆï¼Œæ”¯æŒæ•° TB çš„ç¡¬ç›˜ç©ºé—´;ä¸¤ä¸ªé›†ç¾¤è™½ ç„¶éƒ½å­˜å‚¨äº†å¤§é‡çš„æ•°æ®ï¼Œä½†æ˜¯è¿˜æœ‰å‰©ä½™çš„ç©ºé—´ã€‚â€œå·²ç”¨ç©ºé—´â€åŒ…å«äº†æ‰€æœ‰çš„ Chunk å‰¯æœ¬ã€‚å®é™…ä¸Šæ‰€æœ‰çš„æ–‡ä»¶éƒ½ å¤åˆ¶äº†ä¸‰ä»½ã€‚å› æ­¤ï¼Œé›†ç¾¤å®é™…ä¸Šå„å­˜å‚¨äº† 18TB å’Œ 52TB çš„æ–‡ä»¶æ•°æ®ã€‚ ä¸¤ä¸ªé›†ç¾¤å­˜å‚¨çš„æ–‡ä»¶æ•°é‡éƒ½å·®ä¸å¤šï¼Œä½†æ˜¯é›†ç¾¤ B ä¸Šæœ‰å¤§é‡çš„æ­»æ–‡ä»¶ã€‚æ‰€è°“â€œæ­»æ–‡ä»¶â€æ˜¯æŒ‡æ–‡ä»¶è¢«åˆ é™¤äº† æˆ–è€…æ˜¯è¢«æ–°ç‰ˆæœ¬çš„æ–‡ä»¶æ›¿æ¢äº†ï¼Œä½†æ˜¯å­˜å‚¨ç©ºé—´è¿˜æ²¡æœ‰æ¥å¾—åŠè¢«å›æ”¶ã€‚ç”±äºé›†ç¾¤ B å­˜å‚¨çš„æ–‡ä»¶è¾ƒå¤§ï¼Œå› æ­¤å®ƒçš„ Chunk æ•°é‡ä¹Ÿæ¯”è¾ƒå¤šã€‚ å…ƒæ•°æ®Chunk æœåŠ¡å™¨æ€»å…±ä¿å­˜äº†åå‡  GB çš„å…ƒæ•°æ®ï¼Œå¤§å¤šæ•°æ˜¯æ¥è‡ªç”¨æˆ·æ•°æ®çš„ã€64KB å¤§å°çš„å—çš„ Checksumã€‚ ä¿å­˜åœ¨ Chunk æœåŠ¡å™¨ä¸Šå…¶å®ƒçš„å…ƒæ•°æ®æ˜¯ Chunk çš„ç‰ˆæœ¬å·ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨ 4.5 èŠ‚æè¿°è¿‡ã€‚ åœ¨ Master æœåŠ¡å™¨ä¸Šä¿å­˜çš„å…ƒæ•°æ®å°±å°çš„å¤šäº†ï¼Œå¤§çº¦åªæœ‰æ•°å MBï¼Œæˆ–è€…è¯´å¹³å‡æ¯ä¸ªæ–‡ä»¶ 100 å­—èŠ‚çš„å…ƒæ•° æ®ã€‚è¿™å’Œæˆ‘ä»¬è®¾æƒ³çš„æ˜¯ä¸€æ ·çš„ï¼ŒMaster æœåŠ¡å™¨çš„å†…å­˜å¤§å°åœ¨å®é™…åº”ç”¨ä¸­å¹¶ä¸ä¼šæˆä¸º GFS ç³»ç»Ÿå®¹é‡çš„ç“¶é¢ˆã€‚å¤§ å¤šæ•°æ–‡ä»¶çš„å…ƒæ•°æ®éƒ½æ˜¯ä»¥å‰ç¼€å‹ç¼©æ¨¡å¼å­˜æ”¾çš„æ–‡ä»¶åã€‚Master æœåŠ¡å™¨ä¸Šå­˜æ”¾çš„å…¶å®ƒå…ƒæ•°æ®åŒ…æ‹¬äº†æ–‡ä»¶çš„æ‰€æœ‰ è€…å’Œæƒé™ã€æ–‡ä»¶åˆ° Chunk çš„æ˜ å°„å…³ç³»ï¼Œä»¥åŠæ¯ä¸€ä¸ª Chunk çš„å½“å‰ç‰ˆæœ¬å·ã€‚æ­¤å¤–ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ª Chunkï¼Œæˆ‘ä»¬éƒ½ ä¿å­˜äº†å½“å‰çš„å‰¯æœ¬ä½ç½®ä»¥åŠå¯¹å®ƒçš„å¼•ç”¨è®¡æ•°ï¼Œè¿™ä¸ªå¼•ç”¨è®¡æ•°ç”¨äºå®ç°å†™æ—¶æ‹·è´(å³ COWï¼Œcopy-on-write)ã€‚ å¯¹äºæ¯ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡å™¨ï¼Œæ— è®ºæ˜¯ Chunk æœåŠ¡å™¨è¿˜æ˜¯ Master æœåŠ¡å™¨ï¼Œéƒ½åªä¿å­˜äº† 50MB åˆ° 100MB çš„å…ƒ æ•°æ®ã€‚å› æ­¤ï¼Œæ¢å¤æœåŠ¡å™¨æ˜¯éå¸¸å¿«é€Ÿçš„:åœ¨æœåŠ¡å™¨å“åº”å®¢æˆ·è¯·æ±‚ä¹‹å‰ï¼Œåªéœ€è¦èŠ±å‡ ç§’é’Ÿæ—¶é—´ä»ç£ç›˜ä¸Šè¯»å–è¿™ äº›æ•°æ®å°±å¯ä»¥äº†ã€‚ä¸è¿‡ï¼ŒMaster æœåŠ¡å™¨ä¼šæŒç»­é¢ ç°¸ä¸€æ®µæ—¶é—´â€“é€šå¸¸æ˜¯ 30 åˆ° 60 ç§’â€“ç›´åˆ°å®ƒå®Œæˆè½®è¯¢æ‰€æœ‰çš„ ChunkæœåŠ¡å™¨ï¼Œå¹¶è·å–åˆ°æ‰€æœ‰ Chunk çš„ä½ç½®ä¿¡æ¯ã€‚ è¯»å†™é€Ÿç‡è¡¨ä¸‰æ˜¾ç¤ºäº†ä¸åŒæ—¶æ®µçš„è¯»å†™é€Ÿç‡ã€‚åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œè¿™ä¸¤ä¸ªé›†ç¾¤éƒ½è¿è¡Œäº†ä¸€å‘¨å·¦å³çš„æ—¶é—´ã€‚(è¿™ä¸¤ä¸ªé›†ç¾¤æœ€ è¿‘éƒ½å› ä¸ºå‡çº§æ–°ç‰ˆæœ¬çš„ GFS é‡æ–°å¯åŠ¨è¿‡äº†)ã€‚ é›†ç¾¤é‡æ–°å¯åŠ¨åï¼Œå¹³å‡å†™å…¥é€Ÿç‡å°äº 30MB/sã€‚å½“æˆ‘ä»¬æå–æ€§èƒ½æ•°æ®çš„æ—¶å€™ï¼Œé›†ç¾¤ B æ­£è¿›è¡Œå¤§é‡çš„å†™å…¥æ“ ä½œï¼Œå†™å…¥é€Ÿåº¦è¾¾åˆ°äº† 100MB/sï¼Œå¹¶ä¸”å› ä¸ºæ¯ä¸ª Chunk éƒ½æœ‰ä¸‰ä¸ªå‰¯æœ¬çš„åŸå› ï¼Œç½‘ç»œè´Ÿè½½è¾¾åˆ°äº† 300MB/sã€‚ è¯»å–é€Ÿç‡è¦æ¯”å†™å…¥é€Ÿç‡é«˜çš„å¤šã€‚æ­£å¦‚æˆ‘ä»¬è®¾æƒ³çš„é‚£æ ·ï¼Œæ€»çš„å·¥ä½œè´Ÿè½½ä¸­ï¼Œè¯»å–çš„æ¯”ä¾‹è¿œè¿œé«˜äºå†™å…¥çš„æ¯” ä¾‹ã€‚ä¸¤ä¸ªé›†ç¾¤éƒ½è¿›è¡Œç€ç¹é‡çš„è¯»å–æ“ä½œã€‚ç‰¹åˆ«æ˜¯ï¼Œé›†ç¾¤ A åœ¨ä¸€å‘¨æ—¶é—´å†…éƒ½ç»´æŒäº† 580MB/s çš„è¯»å–é€Ÿåº¦ã€‚é›†ç¾¤ A çš„ç½‘ç»œé…ç½®å¯ä»¥æ”¯æŒ 750MB/s çš„é€Ÿåº¦ï¼Œæ˜¾ç„¶ï¼Œå®ƒæœ‰æ•ˆçš„åˆ©ç”¨äº†èµ„æºã€‚é›†ç¾¤ B æ”¯æŒçš„å³°å€¼è¯»å–é€Ÿåº¦æ˜¯ 1300MB/sï¼Œ ä½†æ˜¯å®ƒçš„åº”ç”¨åªç”¨åˆ°äº† 380MB/sã€‚ Master æœåŠ¡å™¨çš„è´Ÿè½½è¡¨ 3 çš„æ•°æ®æ˜¾ç¤ºäº†å‘é€åˆ° Master æœåŠ¡å™¨çš„æ“ä½œè¯·æ±‚å¤§æ¦‚æ˜¯æ¯ç§’é’Ÿ 200 åˆ° 500 ä¸ªã€‚Master æœåŠ¡å™¨å¯ä»¥è½»æ¾ çš„åº”ä»˜è¿™ä¸ªè¯·æ±‚é€Ÿåº¦ï¼Œæ‰€ä»¥ Master æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ä¸æ˜¯ç³»ç»Ÿçš„ç“¶é¢ˆã€‚ åœ¨æ—©æœŸç‰ˆæœ¬çš„ GFS ä¸­ï¼ŒMaster æœåŠ¡å™¨å¶å°”ä¼šæˆä¸ºç“¶é¢ˆã€‚å®ƒå¤§å¤šæ•°æ—¶é—´é‡Œéƒ½åœ¨é¡ºåºæ‰«ææŸä¸ªå¾ˆå¤§çš„ç›®å½• (åŒ…å«æ•°ä¸‡ä¸ªæ–‡ä»¶)å»æŸ¥æ‰¾æŸä¸ªç‰¹å®šçš„æ–‡ä»¶ã€‚å› æ­¤æˆ‘ä»¬ä¿®æ”¹äº† Master æœåŠ¡å™¨çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å¯¹åå­—ç©ºé—´è¿› è¡ŒäºŒåˆ†æŸ¥æ‰¾æ¥æé«˜æ•ˆç‡ã€‚ç°åœ¨ Master æœåŠ¡å™¨å¯ä»¥è½»æ¾çš„æ¯ç§’é’Ÿè¿›è¡Œæ•°åƒæ¬¡æ–‡ä»¶è®¿é—®ã€‚å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œæˆ‘ä»¬ å¯ä»¥é€šè¿‡åœ¨åç§°ç©ºé—´æ•°æ®ç»“æ„ä¹‹å‰è®¾ç½®åç§°æŸ¥è¯¢ç¼“å†²çš„æ–¹å¼è¿›ä¸€æ­¥æé«˜é€Ÿåº¦ã€‚ æ¢å¤æ—¶é—´å½“æŸä¸ª Chunk æœåŠ¡å™¨å¤±æ•ˆäº†ï¼Œä¸€äº› Chunk å‰¯æœ¬çš„æ•°é‡å¯èƒ½ä¼šä½äºå¤åˆ¶å› å­æŒ‡å®šçš„æ•°é‡ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡å…‹ éš†å‰¯æœ¬ä½¿ Chunk å‰¯æœ¬æ•°é‡è¾¾åˆ°å¤åˆ¶å› å­æŒ‡å®šçš„æ•°é‡ã€‚æ¢å¤æ‰€æœ‰ Chunk å‰¯æœ¬æ‰€èŠ±è´¹çš„æ—¶é—´å–å†³äºèµ„æºçš„æ•°é‡ã€‚ åœ¨æˆ‘ä»¬çš„è¯•éªŒä¸­ï¼Œæˆ‘ä»¬æŠŠé›†ç¾¤ B ä¸Šçš„ä¸€ä¸ª Chunk æœåŠ¡å™¨ Kill æ‰ã€‚è¿™ä¸ª Chunk æœåŠ¡å™¨ä¸Šå¤§çº¦æœ‰ 15000 ä¸ª Chunkï¼Œ å…±è®¡ 600GB çš„æ•°æ®ã€‚ä¸ºäº†å‡å°å…‹éš†æ“ä½œå¯¹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„å½±å“ï¼Œä»¥åŠä¸º GFS è°ƒåº¦å†³ç­–æä¾›ä¿®æ­£ç©ºé—´ï¼Œ æˆ‘ä»¬ç¼ºçœçš„æŠŠé›†ç¾¤ä¸­å¹¶å‘å…‹éš†æ“ä½œçš„æ•°é‡è®¾ç½®ä¸º 91 ä¸ª(Chunk æœåŠ¡å™¨çš„æ•°é‡çš„ 40%)ï¼Œæ¯ä¸ªå…‹éš†æ“ä½œæœ€å¤šå… è®¸ä½¿ç”¨çš„å¸¦å®½æ˜¯ 6.25MB/s(50mbps)ã€‚æ‰€æœ‰çš„ Chunk åœ¨ 23.2 åˆ†é’Ÿå†…æ¢å¤äº†ï¼Œå¤åˆ¶çš„é€Ÿåº¦é«˜è¾¾ 440MB/sã€‚ åœ¨å¦å¤–ä¸€ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ Kill æ‰äº†ä¸¤ä¸ª Chunk æœåŠ¡å™¨ï¼Œæ¯ä¸ª Chunk æœåŠ¡å™¨å¤§çº¦æœ‰ 16000 ä¸ª Chunkï¼Œå…± è®¡ 660GB çš„æ•°æ®ã€‚è¿™ä¸¤ä¸ªæ•…éšœå¯¼è‡´äº† 266 ä¸ª Chunk åªæœ‰å•ä¸ªå‰¯æœ¬ã€‚è¿™ 266 ä¸ª Chunk è¢« GFS ä¼˜å…ˆè°ƒåº¦è¿›è¡Œå¤ åˆ¶ï¼Œåœ¨ 2 åˆ†é’Ÿå†…æ¢å¤åˆ°è‡³å°‘æœ‰ä¸¤ä¸ªå‰¯æœ¬;ç°åœ¨é›†ç¾¤è¢«å¸¦å…¥åˆ°å¦å¤–ä¸€ä¸ªçŠ¶æ€ï¼Œåœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œç³»ç»Ÿå¯ä»¥å®¹å¿å¦ å¤–ä¸€ä¸ª Chunk æœåŠ¡å™¨å¤±æ•ˆè€Œä¸ä¸¢å¤±æ•°æ®ã€‚ å·¥ä½œè´Ÿè·åˆ†æ(Workload Breakdown)æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¯¹ä¸¤ä¸ª GFS é›†ç¾¤å·¥ä½œè´Ÿè½½æƒ…å†µçš„è¯¦ç»†åˆ†æï¼Œè¿™ä¸¤ä¸ªé›†ç¾¤å’Œ 6.2 èŠ‚ä¸­çš„ç±»ä¼¼ï¼Œä½†æ˜¯ä¸å®Œå…¨ç›¸åŒã€‚é›†ç¾¤ X ç”¨äºç ”ç©¶å’Œå¼€å‘ï¼Œé›†ç¾¤ Y ç”¨äºç”Ÿäº§æ•°æ®å¤„ç†ã€‚ æ–¹æ³•è®ºå’Œæ³¨æ„äº‹é¡¹æœ¬ç« èŠ‚åˆ—å‡ºçš„è¿™äº›ç»“æœæ•°æ®åªåŒ…æ‹¬å®¢æˆ·æœºå‘èµ·çš„åŸå§‹è¯·æ±‚ï¼Œå› æ­¤ï¼Œè¿™äº›ç»“æœèƒ½å¤Ÿåæ˜ æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯¹ GFS æ–‡ä»¶ç³»ç»Ÿäº§ç”Ÿçš„å…¨éƒ¨å·¥ä½œè´Ÿè½½ã€‚å®ƒä»¬ä¸åŒ…å«é‚£äº›ä¸ºäº†å®ç°å®¢æˆ·ç«¯è¯·æ±‚è€Œåœ¨æœåŠ¡å™¨é—´äº¤äº’çš„è¯·æ±‚ï¼Œä¹Ÿä¸åŒ… å« GFS å†…éƒ¨çš„åå°æ´»åŠ¨ç›¸å…³çš„è¯·æ±‚ï¼Œæ¯”å¦‚å‰å‘è½¬å‘çš„å†™æ“ä½œï¼Œæˆ–è€…é‡æ–°è´Ÿè½½å‡è¡¡ç­‰æ“ä½œã€‚ æˆ‘ä»¬ä» GFS æœåŠ¡å™¨è®°å½•çš„çœŸå®çš„ RPC è¯·æ±‚æ—¥å¿—ä¸­æ¨å¯¼é‡å»ºå‡ºå…³äº IO æ“ä½œçš„ç»Ÿè®¡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒGFS å®¢ æˆ·ç¨‹åºå¯èƒ½ä¼šæŠŠä¸€ä¸ªè¯»æ“ä½œåˆ†æˆå‡ ä¸ª RPC è¯·æ±‚æ¥æé«˜å¹¶è¡Œåº¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº› RPC è¯·æ±‚æ¨å¯¼å‡ºåŸå§‹çš„è¯» æ“ä½œã€‚å› ä¸ºæˆ‘ä»¬çš„è®¿é—®æ¨¡å¼æ˜¯é«˜åº¦ç¨‹å¼åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºä»»ä½•ä¸ç¬¦åˆçš„æ•°æ®éƒ½æ˜¯è¯¯å·®ã€‚åº”ç”¨ç¨‹åºå¦‚æœèƒ½å¤Ÿè®° å½•æ›´è¯¦å°½çš„æ—¥å¿—ï¼Œå°±æœ‰å¯èƒ½æä¾›æ›´å‡†ç¡®çš„è¯Šæ–­æ•°æ®;ä½†æ˜¯ä¸ºäº†è¿™ä¸ªç›®çš„å»é‡æ–°ç¼–è¯‘å’Œé‡æ–°å¯åŠ¨æ•°åƒä¸ªæ­£åœ¨è¿ è¡Œçš„å®¢æˆ·æœºæ˜¯ä¸ç°å®çš„ï¼Œè€Œä¸”ä»é‚£ä¹ˆå¤šå®¢æˆ·æœºä¸Šæ”¶é›†ç»“æœä¹Ÿæ˜¯ä¸ªç¹é‡çš„å·¥ä½œã€‚ åº”è¯¥é¿å…ä»æˆ‘ä»¬çš„å·¥ä½œè´Ÿè·æ•°æ®ä¸­è¿‡åº¦çš„å½’çº³å‡ºæ™®éçš„ç»“è®º(å³ä¸è¦æŠŠæœ¬èŠ‚çš„æ•°æ®ä½œä¸ºåŸºç¡€çš„æŒ‡å¯¼æ€§æ•°æ®)ã€‚å› ä¸º Google å®Œå…¨æ§åˆ¶ç€ GFS å’Œä½¿ç”¨ GFS çš„åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥ï¼Œåº”ç”¨ç¨‹åºéƒ½é’ˆå¯¹ GFS åšäº†ä¼˜åŒ–ï¼ŒåŒæ—¶ï¼ŒGFS ä¹Ÿæ˜¯ä¸ºäº†è¿™äº›åº”ç”¨ç¨‹åºè€Œè®¾è®¡çš„ã€‚è¿™æ ·çš„ç›¸ äº’ä½œç”¨ä¹Ÿå¯èƒ½å­˜åœ¨äºä¸€èˆ¬ç¨‹åºå’Œæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­è¿™æ ·çš„ä½œç”¨å½±å“å¯èƒ½æ›´æ˜¾è‘—ã€‚ Chunk æœåŠ¡å™¨å·¥ä½œè´Ÿè·è¡¨ 4 æ˜¾ç¤ºäº†æ“ä½œæŒ‰æ¶‰åŠçš„æ•°æ®é‡å¤§å°çš„åˆ†å¸ƒæƒ…å†µã€‚è¯»å–æ“ä½œæŒ‰æ“ä½œæ¶‰åŠçš„æ•°æ®é‡å¤§å°å‘ˆç°äº†åŒå³°åˆ†å¸ƒã€‚ å°çš„è¯»å–æ“ä½œ(å°äº 64KB)ä¸€èˆ¬æ˜¯ç”±æŸ¥æ‰¾æ“ä½œçš„å®¢æˆ·ç«¯å‘èµ·çš„ï¼Œç›®çš„åœ¨äºä»å·¨å¤§çš„æ–‡ä»¶ä¸­æŸ¥æ‰¾å°å—çš„æ•°æ®ã€‚ å¤§çš„è¯»å–æ“ä½œ(å¤§äº 512KB)ä¸€èˆ¬æ˜¯ä»å¤´åˆ°å°¾é¡ºåºçš„è¯»å–æ•´ä¸ªæ–‡ä»¶ã€‚ åœ¨é›†ç¾¤ Y ä¸Šï¼Œæœ‰ç›¸å½“æ•°é‡çš„è¯»æ“ä½œæ²¡æœ‰è¿”å›ä»»ä½•çš„æ•°æ®ã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œç»å¸¸ ä½¿ç”¨æ–‡ä»¶ä½œä¸ºç”Ÿäº§è€…-æ¶ˆè´¹è€…é˜Ÿåˆ—ã€‚ç”Ÿäº§è€…å¹¶è¡Œçš„å‘æ–‡ä»¶ä¸­è¿½åŠ æ•°æ®ï¼ŒåŒæ—¶ï¼Œæ¶ˆè´¹è€…ä»æ–‡ä»¶çš„å°¾éƒ¨è¯»å–æ•°æ®ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…è¯»å–çš„é€Ÿåº¦è¶…è¿‡äº†ç”Ÿäº§è€…å†™å…¥çš„é€Ÿåº¦ï¼Œè¿™å°±ä¼šå¯¼è‡´æ²¡æœ‰è¯»åˆ°ä»»ä½•æ•°æ®çš„æƒ…å†µã€‚é›†ç¾¤ X é€š å¸¸ç”¨äºçŸ­æš‚çš„æ•°æ®åˆ†æä»»åŠ¡ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´è¿è¡Œçš„åˆ†å¸ƒå¼åº”ç”¨ï¼Œå› æ­¤ï¼Œé›†ç¾¤ X å¾ˆå°‘å‡ºç°è¿™ç§æƒ…å†µã€‚ å†™æ“ä½œæŒ‰æ•°æ®é‡å¤§å°ä¹ŸåŒæ ·å‘ˆç°ä¸ºåŒå³°åˆ†å¸ƒã€‚å¤§çš„å†™æ“ä½œ(è¶…è¿‡ 256KB)é€šå¸¸æ˜¯ç”±äº Writer ä½¿ç”¨äº†ç¼“å­˜ æœºåˆ¶å¯¼è‡´çš„ã€‚Writer ç¼“å­˜è¾ƒå°çš„æ•°æ®ï¼Œé€šè¿‡é¢‘ç¹çš„ Checkpoint æˆ–è€…åŒæ­¥æ“ä½œï¼Œæˆ–è€…åªæ˜¯ç®€å•çš„ç»Ÿè®¡å°çš„å†™å…¥ (å°äº 64KB)çš„æ•°æ®é‡(alex æ³¨:å³æ±‡é›†å¤šæ¬¡å°çš„å†™å…¥æ“ä½œï¼Œå½“æ•°æ®é‡è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼ï¼Œä¸€æ¬¡å†™å…¥)ï¼Œä¹‹åæ‰¹é‡ å†™å…¥ã€‚ å†æ¥è§‚å¯Ÿä¸€ä¸‹è®°å½•è¿½åŠ æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é›†ç¾¤ Y ä¸­å¤§çš„è®°å½•è¿½åŠ æ“ä½œæ‰€å æ¯”ä¾‹æ¯”é›†ç¾¤ X å¤šçš„å¤šï¼Œè¿™æ˜¯ å› ä¸ºé›†ç¾¤ Y ç”¨äºæˆ‘ä»¬çš„ç”Ÿäº§ç³»ç»Ÿï¼Œé’ˆå¯¹ GFS åšäº†æ›´å…¨é¢çš„è°ƒä¼˜ã€‚è¡¨ 5 æ˜¾ç¤ºäº†æŒ‰æ“ä½œæ¶‰åŠçš„æ•°æ®é‡çš„å¤§å°ç»Ÿè®¡å‡ºæ¥çš„æ€»æ•°æ®ä¼ è¾“é‡ã€‚åœ¨æ‰€æœ‰çš„æ“ä½œä¸­ï¼Œå¤§çš„æ“ä½œ(è¶…è¿‡ 256KB)å æ®äº†ä¸»è¦çš„ä¼ è¾“é‡ã€‚å°çš„è¯»å–(å°äº 64KB)è™½ç„¶ä¼ è¾“çš„æ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯åœ¨è¯»å–çš„æ•°æ®é‡ä¸­ä» å äº†ç›¸å½“çš„æ¯”ä¾‹ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ–‡ä»¶ä¸­éšæœº Seek çš„å·¥ä½œè´Ÿè·è€Œå¯¼è‡´çš„ã€‚ è®°å½•è¿½åŠ  vs. å†™æ“ä½œè®°å½•è¿½åŠ æ“ä½œåœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç³»ç»Ÿä¸­å¤§é‡ä½¿ç”¨ã€‚å¯¹äºé›†ç¾¤ Xï¼Œè®°å½•è¿½åŠ æ“ä½œå’Œæ™®é€šå†™æ“ä½œçš„æ¯”ä¾‹æŒ‰ç…§å­—èŠ‚ æ¯”æ˜¯ 108:1ï¼ŒæŒ‰ç…§æ“ä½œæ¬¡æ•°æ¯”æ˜¯ 8:1ã€‚å¯¹äºä½œä¸ºæˆ‘ä»¬çš„ç”Ÿäº§ç³»ç»Ÿçš„é›†ç¾¤ Y æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªæ¯”ä¾‹åˆ†åˆ«æ˜¯ 3.7:1 å’Œ 2.5:1ã€‚ æ›´è¿›ä¸€æ­¥ï¼Œè¿™ä¸€ç»„æ•°æ®è¯´æ˜åœ¨æˆ‘ä»¬çš„ä¸¤ä¸ªé›†ç¾¤ä¸Šï¼Œè®°å½•è¿½åŠ æ“ä½œæ‰€å æ¯”ä¾‹éƒ½è¦æ¯”å†™æ“ä½œè¦å¤§ã€‚å¯¹äºé›†ç¾¤ Xï¼Œ åœ¨æ•´ä¸ªæµ‹é‡è¿‡ç¨‹ä¸­ï¼Œè®°å½•è¿½åŠ æ“ä½œæ‰€å æ¯”ç‡éƒ½æ¯”è¾ƒä½ï¼Œå› æ­¤ç»“æœä¼šå—åˆ°ä¸€ä¸¤ä¸ªä½¿ç”¨æŸäº›ç‰¹å®šå¤§å°çš„ buffer çš„ åº”ç”¨ç¨‹åºçš„å½±å“ã€‚ å¦‚åŒæˆ‘ä»¬æ‰€é¢„æœŸçš„ï¼Œæˆ‘ä»¬çš„æ•°æ®ä¿®æ”¹æ“ä½œä¸»è¦æ˜¯è®°å½•è¿½åŠ æ“ä½œè€Œä¸æ˜¯è¦†ç›–æ–¹å¼çš„å†™æ“ä½œã€‚æˆ‘ä»¬æµ‹é‡äº†ç¬¬ ä¸€ä¸ªå‰¯æœ¬çš„æ•°æ®è¦†ç›–å†™çš„æƒ…å†µã€‚è¿™è¿‘ä¼¼äºä¸€ä¸ªå®¢æˆ·æœºæ•…æ„è¦†ç›–åˆšåˆšå†™å…¥çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å¢åŠ æ–°çš„æ•°æ®ã€‚å¯¹äº é›†ç¾¤ Xï¼Œè¦†ç›–å†™æ“ä½œåœ¨å†™æ“ä½œæ‰€å æ®å­—èŠ‚ä¸Šçš„æ¯”ä¾‹å°äº 0.0001%ï¼Œåœ¨æ‰€å æ®æ“ä½œæ•°é‡ä¸Šçš„æ¯”ä¾‹å°äº 0.0003%ã€‚ å¯¹äºé›†ç¾¤ Yï¼Œè¿™ä¸¤ä¸ªæ¯”ç‡éƒ½æ˜¯ 0.05%ã€‚è™½ç„¶è¿™åªæ˜¯æŸä¸€ç‰‡æ–­çš„æƒ…å†µï¼Œä½†æ˜¯ä»ç„¶é«˜äºæˆ‘ä»¬çš„é¢„æœŸã€‚è¿™æ˜¯ç”±äºè¿™ äº›è¦†ç›–å†™çš„æ“ä½œï¼Œå¤§éƒ¨åˆ†æ˜¯ç”±äºå®¢æˆ·ç«¯åœ¨å‘ç”Ÿé”™è¯¯æˆ–è€…è¶…æ—¶ä»¥åé‡è¯•çš„æƒ…å†µã€‚è¿™åœ¨æœ¬è´¨ä¸Šåº”è¯¥ä¸ç®—ä½œå·¥ä½œè´Ÿ è·çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯é‡è¯•æœºåˆ¶äº§ç”Ÿçš„ç»“æœã€‚ Master çš„å·¥ä½œè´Ÿè·è¡¨ 6 æ˜¾ç¤ºäº† Master æœåŠ¡å™¨ä¸Šçš„è¯·æ±‚æŒ‰ç±»å‹åŒºåˆ†çš„æ˜ç»†è¡¨ã€‚å¤§éƒ¨åˆ†çš„è¯·æ±‚éƒ½æ˜¯è¯»å–æ“ä½œæŸ¥è¯¢ Chunk ä½ç½®ä¿¡ æ¯(FindLocation)ã€ä»¥åŠä¿®æ”¹æ“ä½œæŸ¥è¯¢ lease æŒæœ‰è€…çš„ä¿¡æ¯(FindLease-Locker)ã€‚ é›†ç¾¤ X å’Œ Y åœ¨åˆ é™¤è¯·æ±‚çš„æ•°é‡ä¸Šæœ‰ç€æ˜æ˜¾çš„ä¸åŒï¼Œå› ä¸ºé›†ç¾¤ Y å­˜å‚¨äº†ç”Ÿäº§æ•°æ®ï¼Œä¸€èˆ¬ä¼šé‡æ–°ç”Ÿæˆæ•°æ® ä»¥åŠç”¨æ–°ç‰ˆæœ¬çš„æ•°æ®æ›¿æ¢æ—§æœ‰çš„æ•°æ®ã€‚æ•°é‡ä¸Šçš„å·®å¼‚ä¹Ÿè¢«éšè—åœ¨äº† Open è¯·æ±‚ä¸­ï¼Œå› ä¸ºæ—§ç‰ˆæœ¬çš„æ–‡ä»¶å¯èƒ½åœ¨ä»¥ é‡æ–°å†™å…¥çš„æ¨¡å¼æ‰“å¼€æ—¶ï¼Œéšå¼çš„è¢«åˆ é™¤äº†(ç±»ä¼¼ UNIX çš„ open å‡½æ•°ä¸­çš„â€œwâ€æ¨¡å¼)ã€‚ FindMatchingFiles æ˜¯ä¸€ä¸ªæ¨¡å¼åŒ¹é…è¯·æ±‚ï¼Œæ”¯æŒâ€œlsâ€ä»¥åŠå…¶å®ƒç±»ä¼¼çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€‚ä¸åŒäº Master æœåŠ¡ å™¨çš„å…¶å®ƒè¯·æ±‚ï¼Œå®ƒå¯èƒ½ä¼šæ£€ç´¢ namespace çš„å¤§éƒ¨åˆ†å†…å®¹ï¼Œå› æ­¤æ˜¯éå¸¸æ˜‚è´µçš„æ“ä½œã€‚é›†ç¾¤ Y çš„è¿™ç±»è¯·æ±‚è¦å¤šä¸€ äº›ï¼Œå› ä¸ºè‡ªåŠ¨åŒ–æ•°æ®å¤„ç†çš„ä»»åŠ¡è¿›ç¨‹éœ€è¦æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿçš„å„ä¸ªéƒ¨åˆ†ï¼Œä»¥ä¾¿ä»å…¨å±€ä¸Šäº†è§£åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚ä¸ ä¹‹ä¸åŒçš„æ˜¯ï¼Œé›†ç¾¤ X çš„åº”ç”¨ç¨‹åºæ›´åŠ å€¾å‘äºç”±å•ç‹¬çš„ç”¨æˆ·æ§åˆ¶ï¼Œé€šå¸¸é¢„å…ˆçŸ¥é“è‡ªå·±æ‰€éœ€è¦ä½¿ç”¨çš„å…¨éƒ¨æ–‡ä»¶çš„ åç§°ã€‚ ç»éªŒåœ¨å»ºé€ å’Œéƒ¨ç½² GFS çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å†äº†å„ç§å„æ ·çš„é—®é¢˜ï¼Œæœ‰äº›æ˜¯æ“ä½œä¸Šçš„ï¼Œæœ‰äº›æ˜¯æŠ€æœ¯ä¸Šçš„ã€‚èµ·åˆï¼ŒGFS è¢«è®¾æƒ³ä¸ºæˆ‘ä»¬çš„ç”Ÿäº§ç³»ç»Ÿçš„åç«¯æ–‡ä»¶ç³»ç»Ÿã€‚éšç€æ—¶é—´æ¨ç§»ï¼Œåœ¨ GFS çš„ä½¿ç”¨ä¸­é€æ­¥çš„å¢åŠ äº†å¯¹ ç ”ç©¶å’Œå¼€å‘ä»»åŠ¡çš„æ”¯æŒã€‚æˆ‘ä»¬å¼€å§‹å¢åŠ ä¸€äº›å°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æƒé™å’Œé…é¢ï¼Œåˆ°äº†ç°åœ¨ï¼ŒGFS å·²ç»åˆæ­¥æ”¯æŒäº†è¿™ äº›åŠŸèƒ½ã€‚è™½ç„¶æˆ‘ä»¬ç”Ÿäº§ç³»ç»Ÿæ˜¯ä¸¥æ ¼å—æ§çš„ï¼Œä½†æ˜¯ç”¨æˆ·å±‚å´ä¸æ€»æ˜¯è¿™æ ·çš„ã€‚éœ€è¦æ›´å¤šçš„åŸºç¡€æ¶æ„æ¥é˜²æ­¢ç”¨æˆ·é—´ çš„ç›¸äº’å¹²æ‰°ã€‚ æˆ‘ä»¬æœ€å¤§çš„é—®é¢˜æ˜¯ç£ç›˜ä»¥åŠå’Œ Linux ç›¸å…³çš„é—®é¢˜ã€‚å¾ˆå¤šç£ç›˜éƒ½å£°ç§°å®ƒä»¬æ”¯æŒæŸä¸ªèŒƒå›´å†…çš„ Linux IDE ç¡¬ç›˜ é©±åŠ¨ç¨‹åºï¼Œä½†æ˜¯å®é™…åº”ç”¨ä¸­åæ˜ å‡ºæ¥çš„æƒ…å†µå´ä¸æ˜¯è¿™æ ·ï¼Œå®ƒä»¬åªæ”¯æŒæœ€æ–°çš„é©±åŠ¨ã€‚å› ä¸ºåè®®ç‰ˆæœ¬å¾ˆæ¥è¿‘ï¼Œæ‰€ ä»¥å¤§éƒ¨åˆ†ç£ç›˜éƒ½å¯ä»¥ç”¨ï¼Œä½†æ˜¯å¶å°”ä¹Ÿä¼šæœ‰ç”±äºåè®®ä¸åŒ¹é…ï¼Œå¯¼è‡´é©±åŠ¨å’Œå†…æ ¸å¯¹äºé©±åŠ¨å™¨çš„çŠ¶æ€åˆ¤æ–­å¤±è¯¯ã€‚è¿™ä¼šå¯¼è‡´æ•°æ®å› ä¸ºå†…æ ¸ä¸­çš„é—®é¢˜æ„å¤–çš„è¢«ç ´åäº†ã€‚è¿™ä¸ªé—®é¢˜ä¿ƒä½¿æˆ‘ä»¬ä½¿ç”¨ Checksum æ¥æ ¡éªŒæ•°æ®ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿä¿®æ”¹å†…æ ¸æ¥å¤„ç†è¿™äº›å› ä¸ºåè®®ä¸åŒ¹é…å¸¦æ¥çš„é—®é¢˜ã€‚ è¾ƒæ—©çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ Linux 2.2 å†…æ ¸æ—¶é‡åˆ°äº†äº›é—®é¢˜ï¼Œä¸»è¦æ˜¯ fsync()çš„æ•ˆç‡é—®é¢˜ã€‚å®ƒçš„æ•ˆç‡ä¸æ–‡ä»¶çš„å¤§å°è€Œä¸æ˜¯æ–‡ä»¶ä¿®æ”¹éƒ¨åˆ†çš„å¤§å°æœ‰å…³ã€‚è¿™åœ¨æˆ‘ä»¬çš„æ“ä½œæ—¥å¿—æ–‡ä»¶è¿‡å¤§æ—¶ç»™å‡ºäº†éš¾é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨æˆ‘ä»¬å°šæœªå® ç° Checkpoint çš„æ—¶å€™ã€‚æˆ‘ä»¬è´¹äº†å¾ˆå¤§çš„åŠ›æ°”ç”¨åŒæ­¥å†™æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯ç§»æ¤åˆ°äº† Linux2.4 å†…æ ¸ ä¸Šã€‚ å¦ä¸€ä¸ªå’Œ Linux ç›¸å…³çš„é—®é¢˜æ˜¯å•ä¸ªè¯»å†™é”çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŸä¸€ä¸ªåœ°å€ç©ºé—´çš„ä»»æ„ä¸€ä¸ªçº¿ç¨‹éƒ½å¿…é¡» åœ¨ä»ç£ç›˜ page in(è¯»é”)çš„æ—¶å€™å…ˆ hold ä½ï¼Œæˆ–è€…åœ¨ mmap()è°ƒç”¨(å†™é”)çš„æ—¶å€™æ”¹å†™åœ°å€ç©ºé—´ã€‚æˆ‘ä»¬å‘ç°å³ ä½¿æˆ‘ä»¬çš„ç³»ç»Ÿè´Ÿè½½å¾ˆè½»çš„æƒ…å†µä¸‹ä¹Ÿä¼šæœ‰å¶å°”çš„è¶…æ—¶ï¼Œæˆ‘ä»¬èŠ±è´¹äº†å¾ˆå¤šçš„ç²¾åŠ›å»æŸ¥æ‰¾èµ„æºçš„ç“¶é¢ˆæˆ–è€…ç¡¬ä»¶çš„é—® é¢˜ã€‚æœ€åæˆ‘ä»¬ç»ˆäºå‘ç°è¿™ä¸ªå•ä¸ªé”åœ¨ç£ç›˜çº¿ç¨‹äº¤æ¢ä»¥å‰æ˜ å°„çš„æ•°æ®åˆ°ç£ç›˜çš„æ—¶å€™ï¼Œé”ä½äº†å½“å‰çš„ç½‘ç»œçº¿ç¨‹ï¼Œ é˜»æ­¢å®ƒæŠŠæ–°æ•°æ®æ˜ å°„åˆ°å†…å­˜ã€‚ç”±äºæˆ‘ä»¬çš„æ€§èƒ½ä¸»è¦å—é™äºç½‘ç»œæ¥å£ï¼Œè€Œä¸æ˜¯å†…å­˜ copy çš„å¸¦å®½ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ç”¨ pread()æ›¿ä»£ mmap()ï¼Œç”¨äº†ä¸€ä¸ªé¢å¤–çš„ copy åŠ¨ä½œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å°½ç®¡å¶å°”è¿˜æ˜¯æœ‰å…¶å®ƒçš„é—®é¢˜ï¼ŒLinux çš„å¼€æ”¾æºä»£ç è¿˜æ˜¯ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿæ¢ç©¶å’Œç†è§£ç³»ç»Ÿçš„è¡Œä¸ºã€‚åœ¨é€‚å½“çš„ æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæ”¹è¿›å†…æ ¸å¹¶ä¸”å’Œå…¬å¼€æºç ç»„ç»‡å…±äº«è¿™äº›æ”¹åŠ¨ã€‚ ç›¸å…³å·¥ä½œå’Œå…¶å®ƒçš„å¤§å‹åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ AFS[5]ç±»ä¼¼ï¼ŒGFS æä¾›äº†ä¸€ä¸ªä¸ä½ç½®æ— å…³çš„åå­—ç©ºé—´ï¼Œè¿™ä½¿å¾—æ•°æ® å¯ä»¥ä¸ºäº†è´Ÿè½½å‡è¡¡æˆ–è€…ç¾éš¾å†—ä½™ç­‰ç›®çš„åœ¨ä¸åŒä½ç½®é€æ˜çš„è¿ç§»ã€‚ä¸åŒäº AFS çš„æ˜¯ï¼ŒGFS æŠŠæ–‡ä»¶åˆ†å¸ƒå­˜å‚¨åˆ°ä¸ åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿™ç§æ–¹å¼æ›´ç±»ä¼¼ Xfs[1]å’Œ Swift[3]ï¼Œè¿™æ˜¯ä¸ºäº†æé«˜æ•´ä½“æ€§èƒ½ä»¥åŠç¾éš¾å†—ä½™çš„èƒ½åŠ›ã€‚ ç”±äºç£ç›˜ç›¸å¯¹æ¥è¯´æ¯”è¾ƒä¾¿å®œï¼Œå¹¶ä¸”å¤åˆ¶çš„æ–¹å¼æ¯” RAID[9]æ–¹æ³•ç®€å•çš„å¤šï¼ŒGFS ç›®å‰åªä½¿ç”¨å¤åˆ¶çš„æ–¹å¼æ¥ è¿›è¡Œå†—ä½™ï¼Œå› æ­¤è¦æ¯” xFS æˆ–è€… Swift å ç”¨æ›´å¤šçš„è£¸å­˜å‚¨ç©ºé—´(alex æ³¨:Raw storageï¼Œè£¸ç›˜çš„ç©ºé—´)ã€‚ ä¸ AFSã€xFSã€Frangipani[12]ä»¥åŠ Intermezzo[6]ç­‰æ–‡ä»¶ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼ŒGFS å¹¶æ²¡æœ‰åœ¨æ–‡ä»¶ç³»ç»Ÿå±‚é¢æä¾› ä»»ä½• Cache æœºåˆ¶ã€‚æˆ‘ä»¬ä¸»è¦çš„å·¥ä½œåœ¨å•ä¸ªåº”ç”¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™å‡ ä¹ä¸ä¼šé‡å¤è¯»å–æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬çš„å·¥ä½œæ–¹å¼ è¦ä¹ˆæ˜¯æµå¼çš„è¯»å–ä¸€ä¸ªå¤§å‹çš„æ•°æ®é›†ï¼Œè¦ä¹ˆæ˜¯åœ¨å¤§å‹çš„æ•°æ®é›†ä¸­éšæœº Seek åˆ°æŸä¸ªä½ç½®ï¼Œä¹‹åæ¯æ¬¡è¯»å–å°‘é‡çš„ æ•°æ®ã€‚ æŸäº›åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ Frangipaniã€xFSã€Minnesotaâ€™s GFS[11]ã€GPFS[10]ï¼Œå»æ‰äº†ä¸­å¿ƒæœåŠ¡å™¨ï¼Œåª ä¾èµ–äºåˆ†å¸ƒå¼ç®—æ³•æ¥ä¿è¯ä¸€è‡´æ€§å’Œå¯ç®¡ç†æ€§ã€‚æˆ‘ä»¬é€‰æ‹©äº†ä¸­å¿ƒæœåŠ¡å™¨çš„æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–è®¾è®¡ï¼Œå¢åŠ å¯ é æ€§ï¼Œèƒ½å¤Ÿçµæ´»æ‰©å±•ã€‚ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç”±äºå¤„äºä¸­å¿ƒä½ç½®çš„ Master æœåŠ¡å™¨ä¿å­˜æœ‰å‡ ä¹æ‰€æœ‰çš„ Chunk ç›¸å…³ ä¿¡æ¯ï¼Œå¹¶ä¸”æ§åˆ¶ç€ Chunk çš„æ‰€æœ‰å˜æ›´ï¼Œå› æ­¤ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº†åŸæœ¬éå¸¸å¤æ‚çš„ Chunk åˆ†é…å’Œå¤åˆ¶ç­–ç•¥çš„å®ç° æ–¹æ³•ã€‚æˆ‘ä»¬é€šè¿‡å‡å°‘ Master æœåŠ¡å™¨ä¿å­˜çš„çŠ¶æ€ä¿¡æ¯çš„æ•°é‡ï¼Œä»¥åŠå°† Master æœåŠ¡å™¨çš„çŠ¶æ€å¤åˆ¶åˆ°å…¶å®ƒèŠ‚ç‚¹æ¥ä¿è¯ç³»ç»Ÿçš„ç¾éš¾å†—ä½™èƒ½åŠ›ã€‚æ‰©å±•èƒ½åŠ›å’Œé«˜å¯ç”¨æ€§(å¯¹äºè¯»å–)ç›®å‰æ˜¯é€šè¿‡æˆ‘ä»¬çš„å½±å­ Master æœåŠ¡å™¨æœºåˆ¶æ¥ä¿è¯ çš„ã€‚å¯¹ Master æœåŠ¡å™¨çŠ¶æ€æ›´æ”¹æ˜¯é€šè¿‡é¢„å†™æ—¥å¿—çš„æ–¹å¼å®ç°æŒä¹…åŒ–ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´ä¸ºä½¿ç”¨ç±»ä¼¼ Harp[7]ä¸­çš„ primary-copy æ–¹æ¡ˆï¼Œä»è€Œæä¾›æ¯”æˆ‘ä»¬ç°åœ¨çš„æ–¹æ¡ˆæ›´ä¸¥æ ¼çš„ä¸€è‡´æ€§ä¿è¯ã€‚ æˆ‘ä»¬è§£å†³äº†ä¸€ä¸ªéš¾é¢˜ï¼Œè¿™ä¸ªéš¾é¢˜ç±»ä¼¼ Lustre[8]åœ¨å¦‚ä½•åœ¨æœ‰å¤§é‡å®¢æˆ·ç«¯æ—¶ä¿éšœç³»ç»Ÿæ•´ä½“æ€§èƒ½é‡åˆ°çš„é—®é¢˜ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬é€šè¿‡åªå…³æ³¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„éœ€æ±‚ï¼Œè€Œä¸æ˜¯æä¾›ä¸€ä¸ªå…¼å®¹ POSIX çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»è€Œè¾¾åˆ°äº†ç®€åŒ–é—® é¢˜çš„ç›®çš„ã€‚æ­¤å¤–ï¼ŒGFS è®¾è®¡é¢„æœŸæ˜¯ä½¿ç”¨å¤§é‡çš„ä¸å¯é èŠ‚ç‚¹ç»„å»ºé›†ç¾¤ï¼Œå› æ­¤ï¼Œç¾éš¾å†—ä½™æ–¹æ¡ˆæ˜¯æˆ‘ä»¬è®¾è®¡çš„æ ¸å¿ƒã€‚ GFS å¾ˆç±»ä¼¼ NASD æ¶æ„[4]ã€‚NASD æ¶æ„æ˜¯åŸºäºç½‘ç»œç£ç›˜çš„ï¼Œè€Œ GFS ä½¿ç”¨çš„æ˜¯æ™®é€šè®¡ç®—æœºä½œä¸º Chunk æœ åŠ¡å™¨ï¼Œå°±åƒ NASD åŸå½¢ä¸­æ–¹æ¡ˆä¸€æ ·ã€‚æ‰€ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬çš„ Chunk æœåŠ¡å™¨é‡‡ç”¨æƒ°æ€§åˆ†é…å›ºå®šå¤§å°çš„ Chunk çš„æ–¹ å¼ï¼Œè€Œä¸æ˜¯åˆ†é…å˜é•¿çš„å¯¹è±¡å­˜å‚¨ç©ºé—´ã€‚æ­¤å¤–ï¼ŒGFS å®ç°äº†è¯¸å¦‚é‡æ–°è´Ÿè½½å‡è¡¡ã€å¤åˆ¶ã€æ¢å¤æœºåˆ¶ç­‰ç­‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦çš„ç‰¹æ€§ã€‚ ä¸åŒäºä¸ Minnesotaâ€™s GFS å’Œ NASDï¼Œæˆ‘ä»¬å¹¶ä¸æ”¹å˜å­˜å‚¨è®¾å¤‡çš„ Modelã€‚æˆ‘ä»¬åªå…³æ³¨ç”¨æ™®é€šçš„è®¾å¤‡æ¥è§£å†³éå¸¸å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ—¥å¸¸çš„æ•°æ®å¤„ç†ã€‚ æˆ‘ä»¬é€šè¿‡åŸå­çš„è®°å½•è¿½åŠ æ“ä½œå®ç°äº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…é˜Ÿåˆ—ï¼Œè¿™ä¸ªé—®é¢˜ç±»ä¼¼ River[2]ä¸­çš„åˆ†å¸ƒå¼é˜Ÿåˆ—ã€‚Riverä½¿ç”¨çš„æ˜¯è·¨ä¸»æœºçš„ã€åŸºäºå†…å­˜çš„åˆ†å¸ƒå¼é˜Ÿåˆ—ï¼Œä¸ºäº†å®ç°è¿™ä¸ªé˜Ÿåˆ—ï¼Œå¿…é¡»ä»”ç»†æ§åˆ¶æ•°æ®æµ;è€Œ GFS é‡‡ç”¨å¯ä»¥è¢« ç”Ÿäº§è€…å¹¶å‘è¿½åŠ è®°å½•çš„æŒä¹…åŒ–çš„æ–‡ä»¶çš„æ–¹å¼å®ç°ã€‚River æ¨¡å¼æ”¯æŒ m-åˆ°-n çš„åˆ†å¸ƒå¼é˜Ÿåˆ—ï¼Œä½†æ˜¯ç¼ºå°‘ç”±æŒä¹…åŒ– å­˜å‚¨æä¾›çš„å®¹é”™æœºåˆ¶ï¼ŒGFS åªæ”¯æŒ m-åˆ°-1 çš„é˜Ÿåˆ—ã€‚å¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥åŒæ—¶è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å®ƒä»¬è¾“å…¥æµçš„åŒº é—´å¿…é¡»æ˜¯å¯¹é½çš„ã€‚ ç»“æŸè¯­Google æ–‡ä»¶ç³»ç»Ÿå±•ç¤ºäº†ä¸€ä¸ªä½¿ç”¨æ™®é€šç¡¬ä»¶æ”¯æŒå¤§è§„æ¨¡æ•°æ®å¤„ç†çš„ç³»ç»Ÿçš„ç‰¹è´¨ã€‚è™½ç„¶ä¸€äº›è®¾è®¡è¦ç‚¹éƒ½æ˜¯é’ˆ å¯¹æˆ‘ä»¬çš„ç‰¹æ®Šçš„éœ€è¦å®šåˆ¶çš„ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šç‰¹æ€§é€‚ç”¨äºç±»ä¼¼è§„æ¨¡çš„å’Œæˆæœ¬çš„æ•°æ®å¤„ç†ä»»åŠ¡ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æ ¹æ®æˆ‘ä»¬å½“å‰çš„å’Œå¯é¢„æœŸçš„å°†æ¥çš„åº”ç”¨è§„æ¨¡å’ŒæŠ€æœ¯ç¯å¢ƒæ¥è¯„ä¼°ä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„ç‰¹æ€§ã€‚æˆ‘ä»¬ çš„è¯„ä¼°ç»“æœå°†æˆ‘ä»¬å¼•å¯¼åˆ°ä¸€ä¸ªä½¿ç”¨å®Œå…¨ä¸åŒäºä¼ ç»Ÿçš„è®¾è®¡æ€è·¯ä¸Šã€‚æ ¹æ®æˆ‘ä»¬çš„è®¾è®¡æ€è·¯ï¼Œæˆ‘ä»¬è®¤ä¸ºç»„ä»¶å¤±æ•ˆ æ˜¯å¸¸æ€è€Œä¸æ˜¯å¼‚å¸¸ï¼Œé’ˆå¯¹é‡‡ç”¨è¿½åŠ æ–¹å¼(æœ‰å¯èƒ½æ˜¯å¹¶å‘è¿½åŠ )å†™å…¥ã€ç„¶åå†è¯»å–(é€šå¸¸åºåˆ—åŒ–è¯»å–)çš„å¤§æ–‡ ä»¶è¿›è¡Œä¼˜åŒ–ï¼Œä»¥åŠæ‰©å±•æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿæ¥å£ã€æ”¾æ¾æ¥å£é™åˆ¶æ¥æ”¹è¿›æ•´ä¸ªç³»ç»Ÿã€‚ æˆ‘ä»¬ç³»ç»Ÿé€šè¿‡æŒç»­ç›‘æ§ï¼Œå¤åˆ¶å…³é”®æ•°æ®ï¼Œå¿«é€Ÿå’Œè‡ªåŠ¨æ¢å¤æä¾›ç¾éš¾å†—ä½™ã€‚Chunk å¤åˆ¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¯¹ Chunk æœåŠ¡å™¨çš„å¤±æ•ˆè¿›è¡Œå®¹é”™ã€‚é«˜é¢‘ç‡çš„ç»„ä»¶å¤±æ•ˆè¦æ±‚ç³»ç»Ÿå…·å¤‡åœ¨çº¿ä¿®å¤æœºåˆ¶ï¼Œèƒ½å¤Ÿå‘¨æœŸæ€§çš„ã€é€æ˜çš„ä¿®å¤ æŸåçš„æ•°æ®ï¼Œä¹Ÿèƒ½å¤Ÿç¬¬ä¸€æ—¶é—´é‡æ–°å»ºç«‹ä¸¢å¤±çš„å‰¯æœ¬ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨ Checksum åœ¨ç£ç›˜æˆ–è€… IDE å­ç³»ç»Ÿçº§åˆ« æ£€æµ‹æ•°æ®æŸåï¼Œåœ¨è¿™æ ·ç£ç›˜æ•°é‡æƒŠäººçš„å¤§ç³»ç»Ÿä¸­ï¼ŒæŸåç‡æ˜¯ç›¸å½“é«˜çš„ã€‚ æˆ‘ä»¬çš„è®¾è®¡ä¿è¯äº†åœ¨æœ‰å¤§é‡çš„å¹¶å‘è¯»å†™æ“ä½œæ—¶èƒ½å¤Ÿæä¾›å¾ˆé«˜çš„åˆè®¡ååé‡ã€‚æˆ‘ä»¬é€šè¿‡åˆ†ç¦»æ§åˆ¶æµå’Œæ•°æ® æµæ¥å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæ§åˆ¶æµåœ¨ Master æœåŠ¡å™¨å¤„ç†ï¼Œè€Œæ•°æ®æµåœ¨ Chunk æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¤„ç†ã€‚å½“ä¸€èˆ¬çš„æ“ä½œæ¶‰ åŠåˆ° Master æœåŠ¡å™¨æ—¶ï¼Œç”±äº GFS é€‰æ‹©çš„ Chunk å°ºå¯¸è¾ƒå¤§(alex æ³¨:ä»è€Œå‡å°äº†å…ƒæ•°æ®çš„å¤§å°)ï¼Œä»¥åŠé€šè¿‡ Chunk Lease å°†æ§åˆ¶æƒé™ç§»äº¤ç»™ä¸»å‰¯æœ¬ï¼Œè¿™äº›æªæ–½å°† Master æœåŠ¡å™¨çš„è´Ÿæ‹…é™åˆ°æœ€ä½ã€‚è¿™ä½¿å¾—ä¸€ä¸ªç®€å•ã€ä¸­å¿ƒçš„ Masterä¸ä¼šæˆä¸ºæˆä¸ºç“¶é¢ˆã€‚æˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬å¯¹ç½‘ç»œåè®®æ ˆçš„ä¼˜åŒ–å¯ä»¥æå‡å½“å‰å¯¹äºæ¯å®¢æˆ·ç«¯çš„å†™å…¥ååé‡é™åˆ¶ã€‚ GFS æˆåŠŸçš„å®ç°äº†æˆ‘ä»¬å¯¹å­˜å‚¨çš„éœ€æ±‚ï¼Œåœ¨ Google å†…éƒ¨ï¼Œæ— è®ºæ˜¯ä½œä¸ºç ”ç©¶å’Œå¼€å‘çš„å­˜å‚¨å¹³å°ï¼Œè¿˜æ˜¯ä½œä¸º ç”Ÿäº§ç³»ç»Ÿçš„æ•°æ®å¤„ç†å¹³å°ï¼Œéƒ½å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚å®ƒæ˜¯æˆ‘ä»¬æŒç»­åˆ›æ–°å’Œå¤„ç†æ•´ä¸ª WEB èŒƒå›´å†…çš„éš¾é¢˜çš„ä¸€ä¸ªé‡è¦å·¥å…·ã€‚","raw":null,"content":null,"categories":[{"name":"paper","slug":"paper","permalink":"https://stanxia.github.io/categories/paper/"}],"tags":[{"name":"paper","slug":"paper","permalink":"https://stanxia.github.io/tags/paper/"}]},{"title":"Hiveäº‹åŠ¡-ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£","slug":"Hiveäº‹åŠ¡-ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£","date":"2017-12-13T16:34:17.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/13/Hiveäº‹åŠ¡-ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£/","link":"","permalink":"https://stanxia.github.io/2017/12/13/Hiveäº‹åŠ¡-ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£/","excerpt":"ACIDç®€ä»‹\nACIDä»£è¡¨æ•°æ®åº“äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§:\n\nåŸå­æ€§ï¼ˆAtomicityï¼‰:ä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯å†åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚\nä¸€è‡´æ€§ï¼ˆConsistencyï¼‰:äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚è¿™æ˜¯è¯´æ•°æ®åº“äº‹åŠ¡ä¸èƒ½ç ´åå…³ç³»æ•°æ®çš„å®Œæ•´æ€§ä»¥åŠä¸šåŠ¡é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§ã€‚\néš”ç¦»æ€§ï¼ˆIsolationï¼‰:å¤šä¸ªäº‹åŠ¡å¹¶å‘è®¿é—®ï¼Œäº‹åŠ¡ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸å½±å“å…¶å®ƒäº‹åŠ¡è¿è¡Œæ•ˆæœã€‚è¿™æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“ä½œç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªå®Œæ•´çš„æ•°æ®ç©ºé—´ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹åçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚äº‹åŠ¡ä¹‹é—´çš„ç›¸åº”å½±å“ï¼Œåˆ†åˆ«ä¸ºï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€ä¸¢å¤±æ›´æ–°ã€‚\næŒä¹…æ€§ï¼ˆDurabilityï¼‰:æ„å‘³ç€åœ¨äº‹åŠ¡å®Œæˆä»¥åï¼Œè¯¥äº‹åŠ¡é”å¯¹æ•°æ®åº“æ‰€ä½œçš„æ›´æ”¹ä¾¿æŒä¹…çš„ä¿å­˜åœ¨æ•°æ®åº“ä¹‹ä¸­ï¼Œå¹¶ä¸ä¼šè¢«å›æ»šã€‚\n\nåœ¨Hive0.13ä¸­æ·»åŠ äº‹åŠ¡ä¹‹åï¼Œåœ¨åˆ†åŒºçº§åˆ«ä¸Šæä¾›äº†åŸå­æ€§ã€ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ã€‚å¯ä»¥é€šè¿‡æ‰“å¼€å¯ç”¨çš„é”å®šæœºåˆ¶(ZooKeeperæˆ–å†…å­˜)æ¥æä¾›éš”ç¦»ã€‚ç°åœ¨å¯ä»¥åœ¨è¡Œçº§åˆ«ä¸Šæä¾›å®Œæ•´çš„ACIDè¯­ä¹‰ï¼Œè¿™æ ·ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æ·»åŠ è¡Œï¼Œè€Œå¦ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ç›¸åŒçš„åˆ†åŒºä¸Šè¯»å–ï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚","text":"ACIDç®€ä»‹ ACIDä»£è¡¨æ•°æ®åº“äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§: åŸå­æ€§ï¼ˆAtomicityï¼‰:ä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯å†åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰:äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚è¿™æ˜¯è¯´æ•°æ®åº“äº‹åŠ¡ä¸èƒ½ç ´åå…³ç³»æ•°æ®çš„å®Œæ•´æ€§ä»¥åŠä¸šåŠ¡é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§ã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰:å¤šä¸ªäº‹åŠ¡å¹¶å‘è®¿é—®ï¼Œäº‹åŠ¡ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸å½±å“å…¶å®ƒäº‹åŠ¡è¿è¡Œæ•ˆæœã€‚è¿™æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“ä½œç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªå®Œæ•´çš„æ•°æ®ç©ºé—´ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹åçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚äº‹åŠ¡ä¹‹é—´çš„ç›¸åº”å½±å“ï¼Œåˆ†åˆ«ä¸ºï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€ä¸¢å¤±æ›´æ–°ã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰:æ„å‘³ç€åœ¨äº‹åŠ¡å®Œæˆä»¥åï¼Œè¯¥äº‹åŠ¡é”å¯¹æ•°æ®åº“æ‰€ä½œçš„æ›´æ”¹ä¾¿æŒä¹…çš„ä¿å­˜åœ¨æ•°æ®åº“ä¹‹ä¸­ï¼Œå¹¶ä¸ä¼šè¢«å›æ»šã€‚ åœ¨Hive0.13ä¸­æ·»åŠ äº‹åŠ¡ä¹‹åï¼Œåœ¨åˆ†åŒºçº§åˆ«ä¸Šæä¾›äº†åŸå­æ€§ã€ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ã€‚å¯ä»¥é€šè¿‡æ‰“å¼€å¯ç”¨çš„é”å®šæœºåˆ¶(ZooKeeperæˆ–å†…å­˜)æ¥æä¾›éš”ç¦»ã€‚ç°åœ¨å¯ä»¥åœ¨è¡Œçº§åˆ«ä¸Šæä¾›å®Œæ•´çš„ACIDè¯­ä¹‰ï¼Œè¿™æ ·ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æ·»åŠ è¡Œï¼Œè€Œå¦ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ç›¸åŒçš„åˆ†åŒºä¸Šè¯»å–ï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚ä½¿ç”¨ACIDè¯­ä¹‰çš„äº‹åŠ¡è¢«æ·»åŠ åˆ°Hiveä¸­ï¼Œä»¥è§£å†³ä»¥ä¸‹ç”¨ä¾‹: æµæ•°æ®çš„æ¥å…¥ã€‚è®¸å¤šç”¨æˆ·éƒ½ä½¿ç”¨ Apache Flume, Apache Storm, or Apache Kafka å°†æµå¼æ•°æ®å¯¼å…¥Hadoopé›†ç¾¤ã€‚ è¿™äº›å·¥å…·éƒ½æ˜¯æ¯ç§’ç™¾ä¸‡è¡Œçº§çš„æ•°æ®å†™å…¥ï¼Œè€ŒHiveåªèƒ½æ¯åäº”åˆ†é’Ÿåˆ°ä¸€ä¸ªå°æ—¶æ·»åŠ ä¸€æ¬¡åˆ†åŒºã€‚å¿«é€Ÿçš„å¢åŠ åˆ†åŒºä¼šå¯¹è¡¨ä¸­çš„åˆ†åŒºæ•°é‡å½¢æˆå‹åŠ›ã€‚å½“ç„¶å¯ä»¥äº‹å…ˆåˆ›å»ºå¥½åˆ†åŒºå†å°†æ•°æ®å¯¼å…¥ï¼Œä½†è¿™æ ·ä¼šå¼•èµ·è„è¯»ï¼Œè€Œä¸”ç›®å½•ä¸‹ç”Ÿæˆçš„å°æ–‡ä»¶ä¼šå¯¹namenodeé€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚è€Œæ–°ç‰¹æ€§å¯ä»¥å¾ˆå¥½çš„è§£å†³ä¸Šè¿°é—®é¢˜ ç»´åº¦è¡¨çš„ç¼“æ…¢å˜åŒ–ï¼šåœ¨å…¸å‹çš„æ˜Ÿå‹æ¶æ„æ•°æ®ä»“åº“ä¸­ï¼Œç»´åº¦è¡¨éšæ—¶é—´æ…¢æ…¢å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œé›¶å”®å•†å°†ä¼šæ‰“å¼€æ–°çš„å•†åº—ï¼Œè¿™äº›å•†åº—éœ€è¦è¢«æ·»åŠ åˆ°å•†åº—çš„è¡¨ä¸­ï¼Œæˆ–è€…ç°æœ‰çš„å•†åº—å¯èƒ½ä¼šæ”¹å˜å®ƒçš„å¹³æ–¹è‹±å°ºæˆ–å…¶ä»–ä¸€äº›è¢«è·Ÿè¸ªçš„ç‰¹æ€§ã€‚è¿™äº›æ›´æ”¹ä¼šå¯¼è‡´æ’å…¥å•ä¸ªè®°å½•æˆ–æ›´æ–°è®°å½•(å–å†³äºæ‰€é€‰æ‹©çš„ç­–ç•¥)ã€‚Hiveä»0.14å¼€å§‹æ”¯æŒã€‚ æ•°æ®æ›´æ–°ã€‚ä»Hive 0.14å¼€å§‹ï¼Œå¯ä»¥ INSERT, UPDATE, å’Œ DELETEã€‚ ä½¿ç”¨SQL MERGEè¯­å¥è¿›è¡Œæ‰¹é‡æ›´æ–°ã€‚ äº‹åŠ¡é™åˆ¶ BEGIN, COMMIT, and ROLLBACKè¿˜ä¸æ”¯æŒã€‚æ‰€æœ‰æ“ä½œéƒ½æ˜¯è‡ªåŠ¨æäº¤çš„ã€‚è¯¥è®¡åˆ’å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æä¾›æ”¯æŒã€‚ ç°ç›®å‰åªæ”¯æŒORCæ–‡ä»¶æ ¼å¼ã€‚å·²ç»æ„å»ºäº†è¿™æ ·çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ä»»ä½•å­˜å‚¨æ ¼å¼æ¥ä½¿ç”¨äº‹åŠ¡ï¼Œä»¥ç¡®å®šæ›´æ–°æˆ–åˆ é™¤å¦‚ä½•åº”ç”¨äºåŸºæœ¬è®°å½•(åŸºæœ¬ä¸Šï¼Œå…·æœ‰æ˜¾å¼æˆ–éšå¼è¡Œid)ï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œé›†æˆå·¥ä½œè¿˜åªæ˜¯ç”¨äºORCã€‚ äº‹åŠ¡é»˜è®¤ä¸ºå…³é—­çš„ã€‚ è¡¨å¿…é¡»è¦åˆ†æ¡¶æ‰èƒ½æ”¯æŒäº‹åŠ¡ã€‚å› ä¸ºå¤–éƒ¨è¡¨ä¸å—åˆ†æ¡¶çš„æ§åˆ¶ï¼Œå› è€Œå¤–éƒ¨è¡¨å¹¶ä¸æ”¯æŒäº‹åŠ¡ã€‚ ä»ä¸€ä¸ª non_ACID è¡¨è¯»å†™ ACID è¡¨ æ˜¯ä¸å…è®¸çš„ã€‚äº‹åŠ¡ç®¡ç†å™¨å¿…é¡»è®¾ç½®ä¸ºï¼šorg.apache.hadoop.hive.ql.lockmgr.DbTxnManager ã€‚ ç›®å‰åªæ”¯æŒå¿«ç…§çº§åˆ«çš„éš”ç¦»ã€‚ ç°æœ‰çš„ZooKeeperå’Œå†…å­˜ä¸­çš„é”ç®¡ç†å™¨ä¸äº‹åŠ¡ä¸å…¼å®¹ã€‚ ACIDè¡¨ä¸æ”¯æŒä½¿ç”¨ALTER TABLEçš„æ¨¡å¼æ›´æ”¹ã€‚ ä½¿ç”¨ ORACLE ä½œä¸ºå…ƒæ•°æ®åº“ï¼Œâ€datanucleus.connectionPoolingType=BONECPâ€ å¯èƒ½ä¼šå‡ºç°ï¼šâ€No such lock..â€ å’Œ â€œNo such transactionâ€¦â€ç­‰é”™è¯¯ã€‚è¯·è®¾ç½®ä¸ºï¼šâ€datanucleus.connectionPoolingType=DBCPâ€ ã€‚ äº‹åŠ¡è¡¨ä¸æ”¯æŒ ï¼šLOAD DATAâ€¦ è¯­æ³•ã€‚ æµ APIs Hive æä¾›æ•°æ® æµå¼æ’å…¥å’Œæµå¼æ›´æ–°çš„ APIs: Hive HCatalog Streaming API HCatalog Streaming Mutation API (Hive 2.0.0 åŠä»¥ä¸Šå¯ç”¨) è¯­æ³•ä¿®æ”¹ ä»Hive 0.14. å¼€å§‹ï¼ŒINSERTâ€¦VALUES, UPDATE, and DELETE å·²ç»æ·»åŠ è¿› SQL è¯­æ³•ã€‚å‡ ä¸ªæ–°å‘½ä»¤å·²ç»æ·»åŠ è¿› Hive çš„ DDL æ”¯æŒ ACID å’Œ äº‹åŠ¡, å¹¶ä¿®æ”¹ä¸€äº›å·²ç»å­˜åœ¨çš„ DDL ã€‚ æ–°å‘½ä»¤ï¼š SHOW TRANSACTIONS SHOW COMPACTIONS ABORT TRANSACTIONS ä¿®æ”¹çš„å‘½ä»¤ï¼š SHOW LOCKS :æä¾›ä¸äº‹åŠ¡ç›¸å…³çš„æ–°é”çš„ä¿¡æ¯ã€‚å¦‚æœæ­£åœ¨ä½¿ç”¨ ZooKeeper æˆ–è€…å†…å­˜é”ç®¡ç†ï¼Œå‘½ä»¤çš„è¾“å‡ºå°†æœ‰ä¸åŒã€‚ ALTER TABLE :æ·»åŠ æ–°åŠŸèƒ½ï¼Œè¯·æ±‚è¡¨æˆ–åˆ†åŒºçš„å‹ç¼©ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œç”¨æˆ·ä¸éœ€è¦è¯·æ±‚å‹ç¼©ï¼Œå› ä¸ºç³»ç»Ÿå°†æ£€æµ‹åˆ°å¯¹å®ƒä»¬çš„éœ€æ±‚å¹¶å¯åŠ¨å‹ç¼©ã€‚ ç„¶è€Œï¼Œå¦‚æœå¯¹ä¸€ä¸ªè¡¨å…³é—­äº†å‹ç¼©ï¼Œæˆ–è€…ç”¨æˆ·å¸Œæœ›åœ¨ç³»ç»Ÿä¸é€‰æ‹©çš„æ—¶å€™å‹ç¼©è¡¨, ALTER TABLE å¯ç”¨äºå¯åŠ¨å‹ç¼©ã€‚ä¸ºäº†è§‚å¯Ÿå‹ç¼©çš„è¿›åº¦ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ SHOW COMPACTIONS ã€‚ åŸºç¡€è®¾è®¡ HDFS ä¸æ”¯æŒå¯¹æ–‡ä»¶è¿›è¡Œå°±åœ°ä¿®æ”¹ã€‚ä¹Ÿä¸æä¾›è¯»çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”å½“æœ‰æ•°æ®è¿½åŠ åˆ°æ–‡ä»¶ï¼ŒHDFS ä¸å¯¹è¯»æ•°æ®çš„ç”¨æˆ·æä¾›ä¸€è‡´æ€§çš„ã€‚ä¸ºäº†åœ¨ HDFS ä¸Šæä¾›è¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬éµå¾ªäº†å…¶ä»–æ•°æ®ä»“åº“å·¥å…·ä¸­ä½¿ç”¨çš„æ ‡å‡†æ–¹æ³•ã€‚ è¡¨æˆ–åˆ†åŒºçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ç»„ base æ–‡ä»¶ä¸­ã€‚ æ–°çš„è®°å½•ã€æ›´æ–°å’Œåˆ é™¤å­˜å‚¨åœ¨ delta æ–‡ä»¶ä¸­ã€‚æ¯ä¸ªæ”¹å˜è¡¨æˆ–åˆ†åŒºçš„äº‹åŠ¡äº§ç”Ÿä¸€ç»„æ–°çš„ delta æ–‡ä»¶ ã€‚è¯»çš„æ—¶å€™ï¼Œåˆå¹¶ base å’Œ delta æ–‡ä»¶, åº”ç”¨æ‰€æœ‰çš„æ›´æ–°å’Œåˆ é™¤ã€‚ Base å’Œ Delta ç›®å½•ä¸€ä¸ªåˆ†åŒºæˆ–ä¸€ä¸ªéåˆ†åŒºè¡¨çš„æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚æœ‰æ›´æ–°çš„æ—¶å€™ï¼Œä»»ä½• ACID çš„åˆ†åŒºï¼ˆæˆ–éåˆ†åŒºè¡¨ï¼‰éƒ½æœ‰ä¸€ä¸ª base æ–‡ä»¶ç›®å½•ï¼Œå’Œä¸€ä¸ª delta æ–‡ä»¶ç›®å½•ã€‚ 1234567hive&gt; dfs -ls -R /user/hive/warehouse/t;drwxr-xr-x - ekoifman staff 0 2016-06-09 17:03 /user/hive/warehouse/t/base_0000022-rw-r--r-- 1 ekoifman staff 602 2016-06-09 17:03 /user/hive/warehouse/t/base_0000022/bucket_00000drwxr-xr-x - ekoifman staff 0 2016-06-09 17:06 /user/hive/warehouse/t/delta_0000023_0000023_0000-rw-r--r-- 1 ekoifman staff 611 2016-06-09 17:06 /user/hive/warehouse/t/delta_0000023_0000023_0000/bucket_00000drwxr-xr-x - ekoifman staff 0 2016-06-09 17:07 /user/hive/warehouse/t/delta_0000024_0000024_0000-rw-r--r-- 1 ekoifman staff 610 2016-06-09 17:07 /user/hive/warehouse/t/delta_0000024_0000024_0000/bucket_00000 åˆå¹¶åˆå¹¶æ˜¯ä¸€ç»„è¿è¡Œåœ¨ Metastoreä¸­æ”¯æŒ ACID ç³»ç»Ÿçš„åå°ç¨‹åºã€‚åŒ…å« Initiator, Worker, Cleaner, AcidHouseKeeperServiceis å’Œä¸€äº›å…¶ä»–çš„ã€‚ Delta æ–‡ä»¶åˆå¹¶éšç€ä¿®æ”¹çš„æ“ä½œï¼Œè¶Šæ¥è¶Šå¤šçš„deltaæ–‡ä»¶è¢«åˆ›å»ºï¼Œéœ€è¦åˆå¹¶ä»¥ä¿æŒè¶³å¤Ÿçš„æ€§èƒ½ã€‚æœ‰ä¸¤ç§ç±»å‹çš„åˆå¹¶ï¼Œminorå’Œmajorã€‚ Minor åˆå¹¶ ï¼šåœ¨æ¯ä¸€ä¸ª bucket ï¼Œå°†ä¸€ç»„å·²ç»å­˜åœ¨çš„ delta æ–‡ä»¶åˆå¹¶é‡å†™åˆ°ä¸€ä¸ªå•ç‹¬çš„ delta æ–‡ä»¶ä¸­ã€‚ Major åˆå¹¶ ï¼šåœ¨æ¯ä¸€ä¸ª bucket ï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ª delta æ–‡ä»¶å’Œ bucket çš„ base æ–‡ä»¶åˆå¹¶é‡å†™åˆ°ä¸€ä¸ªæ–°çš„ base æ–‡ä»¶ä¸­. Major åˆå¹¶æ•ˆç‡é«˜ä½†èŠ±é”€å¤§ã€‚ æ‰€æœ‰çš„åˆå¹¶éƒ½åœ¨åå°å®Œæˆï¼Œå¹¶ä¸”ä¸å¦¨ç¢å¯¹æ•°æ®å½“å‰çš„è¯»å’Œå†™ã€‚ åˆå¹¶å®Œæ‰€æœ‰çš„æ—§æ–‡ä»¶ä¹‹åï¼Œå°±åˆ é™¤æ‰è¿™äº›æ—§æ–‡ä»¶ã€‚ Initiator åˆå§‹åŒ–å™¨è¿™ä¸ªæ¨¡å—è´Ÿè´£å‘ç°å“ªäº›è¡¨æˆ–åˆ†åŒºåº”è¯¥è¢«åˆå¹¶ã€‚ é€šè¿‡è®¾ç½®ï¼šhive.compactor.initiator.on å¼€å¯ã€‚æ¯ä¸ªåˆå¹¶ä»»åŠ¡å¤„ç†ä¸€ä¸ªåˆ†åŒº (æˆ–ä¸€ä¸ªéåˆ†åŒºè¡¨). å¦‚æœè¿ç»­åˆå¹¶å¤±è´¥æ¬¡æ•°è¶…è¿‡ hive.compactor.initiator.failed.compacts.threshold è®¾å®šçš„å€¼ï¼Œè¯¥åˆ†åŒºçš„è‡ªåŠ¨åˆå¹¶è°ƒåº¦å°†ä¼šè¢«åœæ­¢ã€‚ Worker å·¥ä½œæ‰§è¡Œå™¨æ¯ä¸ª worker å¤„ç†ä¸€ä¸ªå•ç‹¬çš„åˆå¹¶ä»»åŠ¡. åˆå¹¶æ˜¯ MapReduce jobï¼Œåå­—æ˜¯: -compactor-... æ¯ä¸€ä¸ªworker æäº¤ job åˆ°é›†ç¾¤ä¸Š (é€šè¿‡å®šä¹‰çš„ hive.compactor.job.queue) å¹¶ç­‰ç€ä»»åŠ¡å®Œæˆã€‚hive.compactor.worker.threads å†³å®šäº†æ¯ä¸ª Metastore ä¸­ Workers çš„æ•°é‡ã€‚Hive ä»“åº“ä¸­çš„ Workers çš„æ€»æ•°å†³å®šäº†å½“å‰åˆå¹¶ä»»åŠ¡çš„æœ€å¤§å€¼ã€‚ Cleaner æ¸…é™¤å™¨è¯¥ç¨‹åºçš„èŒè´£ï¼šåˆ é™¤åˆå¹¶åä¸å†éœ€è¦çš„ delta æ–‡ä»¶. AcidHouseKeeperService ACIDç®¡å®¶æœåŠ¡å¯»æ‰¾åœ¨ hive.txn.timeout æ—¶é—´å†…æ²¡æœ‰å¿ƒè·³çš„äº‹åŠ¡ï¼Œå¹¶å°†å…¶ç»ˆæ­¢ã€‚è¯¥ç³»ç»Ÿå‡å®šå‘èµ·äº‹åŠ¡çš„å®¢æˆ·æœºåœæ­¢äº†å¿ƒè·³ï¼Œè€Œé”å®šçš„èµ„æºåº”è¯¥è¢«é‡Šæ”¾ã€‚ SHOW COMPACTIONS æŸ¥çœ‹åˆå¹¶è¿™ä¸ªå‘½ä»¤æ˜¾ç¤ºç›®å‰æ­£åœ¨è¿è¡Œçš„åˆå¹¶ä¿¡æ¯ï¼Œå’Œæœ€è¿‘çš„åˆå¹¶å†å² (é…ç½®çš„æ—¶é—´èŒƒå›´å†…)ã€‚ ä» HIV-12353 å¼€å§‹æ”¯æŒå†å²æ˜¾ç¤ºã€‚ äº‹åŠ¡ï¼é” ç®¡ç†å™¨æ·»åŠ äº†ä¸€ä¸ªåä¸ºâ€œäº‹åŠ¡ç®¡ç†å™¨â€çš„æ–°é€»è¾‘å®ä½“ï¼Œå®ƒåŒ…å«äº†ä»¥å‰çš„â€œæ•°æ®åº“/è¡¨/åˆ†åŒºé”ç®¡ç†å™¨â€æ¦‚å¿µã€‚(hive.lock.manager with default of org.apache.hadoop.hive.ql.lockmgr.zookeeper.ZooKeeperHiveLockManager). äº‹åŠ¡ç®¡ç†å™¨ç°åœ¨è¿˜è´Ÿè´£ç®¡ç†äº‹åŠ¡é”ã€‚é»˜è®¤çš„ DummyTxnManager æ¨¡æ‹Ÿäº†è€ç‰ˆæœ¬ Hive çš„è¡Œä¸º: æ²¡æœ‰äº‹åŠ¡å’Œä½¿ç”¨ hive.lock.manager å±æ€§ç”¨æ¥ä¸ºè¡¨ï¼Œåˆ†åŒºï¼Œæ•°æ®åº“åˆ›å»ºé”ç®¡ç†å™¨ã€‚åœ¨ Hive metastore ä¸­æ–°æ·»åŠ çš„ DbTxnManager ç®¡ç†æ‰€æœ‰çš„é”/äº‹åŠ¡å’Œ DbLockManager (åœ¨æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ï¼Œäº‹åŠ¡å’Œé”æ˜¯æŒä¹…çš„). è¿™æ„å‘³ç€åœ¨å¯ç”¨äº‹åŠ¡æ—¶ï¼Œä»¥å‰é”å®šZooKeeperçš„è¡Œä¸ºä¸å†å­˜åœ¨ã€‚ ä» lock æŒæœ‰è€…å’Œäº‹åŠ¡ initiators åˆ° metastore çš„å¿ƒè·³è¿æ¥ï¼Œå¦‚æœå¿ƒè·³è¶…æ—¶ï¼Œåˆ™è¿™ä¸ªé”æˆ–äº‹åŠ¡å°†è¢«èˆå¼ƒã€‚ ä»hive 1.30èµ·ï¼ŒDbLockManger æŒç»­è·å–é”çš„å‘¨æœŸå¯ä»¥é€šè¿‡ hive.lock.numretires å’Œ hive.lock.sleep.between.retries. ä¸¤ä¸ªå±æ€§è®¾ç½®ã€‚å¦‚æœDbLockManger è·å–é”å¤±è´¥ï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¹‹åä¼šè¿›è¡Œé‡è¯•ã€‚ä¸ºäº†æ”¯æŒçŸ­æŸ¥è¯¢åŒæ—¶ä¸å¯¹metastoreé€ æˆè´Ÿæ‹…ï¼ŒDbLockManger åœ¨æ¯æ¬¡é‡è¯•ååŠ å€ç­‰å¾…æ—¶é•¿ã€‚ æ³¨æ„ï¼šDbTxnManager å¯ä»¥è·å–æ‰€æœ‰çš„è¡¨çš„é”ï¼Œå³ä¾¿é‚£äº›æ²¡æœ‰è®¾ç½®transactional=trueå±æ€§çš„è¡¨ã€‚é»˜è®¤å¯¹ä¸€ä¸ªéäº‹åŠ¡è¡¨çš„æ’å…¥æ“ä¼šè·å–ä¸€ä¸ªæ’ä»–é”ä»è€Œé˜»æ­¢å…¶ä»–çš„æ’å…¥å’Œè¯»å–ã€‚æŠ€æœ¯ä¸Šæ­£ç¡®çš„ï¼Œä½†æ˜¯è¿™èƒŒç¦»äº†hiveä¹‹å‰çš„å·¥ä½œæ–¹å¼ã€‚ä¸ºäº†å‘åå…¼å®¹ï¼Œå¯ä»¥è®¾ç½®hive.txn.strict.locking.mode å±æ€§æ¥ä½¿é”ç®¡ç†å™¨åœ¨å¯¹éäº‹åŠ¡è¡¨çš„æ’å…¥æ“ä½œæ—¶ï¼Œè·å–å…±äº«é”ã€‚ä¿ç•™ä¹‹å‰çš„è¯­ä¹‰ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯èƒ½é˜²æ­¢è¡¨åœ¨è¯»å–æ˜¯è¢«åˆ é™¤ã€‚è€Œå¯¹äºäº‹åŠ¡è¡¨ï¼Œæ’å…¥æ€»æ˜¯è·å–çš„å…±äº«é”ã€‚æ˜¯å› ä¸ºè¿™äº›è¡¨å®ç°äº†MVCCçš„æ¶æ„ï¼Œåœ¨å­˜å‚¨çš„åº•å±‚å®ç°äº†å¾ˆå¼ºçš„è¯»ä¸€è‡´æ€§ï¼ˆå¿«ç…§éš”ç¦»çš„æ–¹å¼ï¼‰ï¼Œç”šè‡³èƒ½åº”å¯¹å¹¶å‘çš„ä¿®æ”¹æ“ä½œã€‚ å…±äº«é”ã€Sé”ã€‘:åˆç§°è¯»é”ï¼Œè‹¥äº‹åŠ¡Tå¯¹æ•°æ®å¯¹è±¡AåŠ ä¸ŠSé”ï¼Œåˆ™äº‹åŠ¡Tå¯ä»¥è¯»Aä½†ä¸èƒ½ä¿®æ”¹Aï¼Œå…¶ä»–äº‹åŠ¡åªèƒ½å†å¯¹AåŠ Sé”ï¼Œè€Œä¸èƒ½åŠ Xé”ï¼Œç›´åˆ°Té‡Šæ”¾Aä¸Šçš„Sé”ã€‚è¿™ä¿è¯äº†å…¶ä»–äº‹åŠ¡å¯ä»¥è¯»Aï¼Œä½†åœ¨Té‡Šæ”¾Aä¸Šçš„Sé”ä¹‹å‰ä¸èƒ½å¯¹Aåšä»»ä½•ä¿®æ”¹ã€‚ æ’ä»–é”ã€Xé”ã€‘:åˆç§°å†™é”ã€‚è‹¥äº‹åŠ¡Tå¯¹æ•°æ®å¯¹è±¡AåŠ ä¸ŠXé”ï¼Œäº‹åŠ¡Tå¯ä»¥è¯»Aä¹Ÿå¯ä»¥ä¿®æ”¹Aï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹AåŠ ä»»ä½•é”ï¼Œç›´åˆ°Té‡Šæ”¾Aä¸Šçš„é”ã€‚è¿™ä¿è¯äº†å…¶ä»–äº‹åŠ¡åœ¨Té‡Šæ”¾Aä¸Šçš„é”ä¹‹å‰ä¸èƒ½å†è¯»å–å’Œä¿®æ”¹Aã€‚ï¼‰ é…ç½®ä¿¡æ¯ ä¸ºäº†å¼€å¯hiveçš„äº‹åŠ¡æ”¯æŒï¼Œä»¥ä¸‹æ˜¯éœ€è¦å¼€å¯çš„æœ€å°‘çš„hiveé…ç½®ï¼š å®¢æˆ·ç«¯ï¼š 1234hive.support.concurrency â€“ truehive.enforce.bucketing â€“ true (Not required as of Hive 2.0)hive.exec.dynamic.partition.mode â€“ nonstricthive.txn.manager â€“ org.apache.hadoop.hive.ql.lockmgr.DbTxnManager æœåŠ¡ç«¯ï¼š (Metastore) 12hive.compactor.initiator.on â€“ true (See table below for more details)hive.compactor.worker.threads â€“ a positive number on at least one instance of the Thrift metastore service è¯¦ç»†é…ç½®ä¿¡æ¯è¯·çœ‹ï¼šhiveäº‹åŠ¡é…ç½®ä¿¡æ¯ è¡¨å±æ€§ å¦‚æœè¡¨è¦ä½¿ç”¨ ACID ï¼Œåˆ™å¿…é¡»æŒ‡å®šï¼š &quot;transactional=true&quot; ã€‚å¦‚æœè¯¥è¡¨è¢«è®¾ç½®ä¸º ACID è¡¨ï¼Œåˆ™ä¸èƒ½è½¬æ¢ä¸ºé ACID è¡¨ï¼Œè®¾ç½® &quot;transactional&quot;=&quot;false&quot; ä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚åœ¨ hive-site.xml ä¸­å¿…é¡»è®¾ç½®ï¼šhive.txn.manager = org.apache.hadoop.hive.ql.lockmgr.DbTxnManager å¦‚æœéœ€å¸Œæœ›ç³»ç»Ÿè‡ªåŠ¨è¿›è¡Œåˆå¹¶ï¼Œåˆ™å¯ä»¥è®¾ç½®ï¼š &quot;NO_AUTO_COMPACTION&quot; ,ä¹Ÿå¯ä»¥é€šè¿‡Alter Table/Partition Compact è¯­æ³•æ¥è®¾ç½®ã€‚ Example: Set compaction options in TBLPROPERTIES at table level1234567891011CREATE TABLE table_name ( id int, name string)CLUSTERED BY (id) INTO 2 BUCKETS STORED AS ORCTBLPROPERTIES (\"transactional\"=\"true\", \"compactor.mapreduce.map.memory.mb\"=\"2048\", -- specify compaction map job properties \"compactorthreshold.hive.compactor.delta.num.threshold\"=\"4\", -- trigger minor compaction if there are more than 4 delta directories \"compactorthreshold.hive.compactor.delta.pct.threshold\"=\"0.5\" -- trigger major compaction if the ratio of size of delta files to -- size of base files is greater than 50%); Example: Set compaction options in TBLPROPERTIES at request level1234ALTER TABLE table_name COMPACT 'minor' WITH OVERWRITE TBLPROPERTIES (\"compactor.mapreduce.map.memory.mb\"=\"3072\"); -- specify compaction map job propertiesALTER TABLE table_name COMPACT 'major' WITH OVERWRITE TBLPROPERTIES (\"tblprops.orc.compress.size\"=\"8192\"); -- change any other Hive table properties","raw":null,"content":null,"categories":[{"name":"hive","slug":"hive","permalink":"https://stanxia.github.io/categories/hive/"}],"tags":[{"name":"hive","slug":"hive","permalink":"https://stanxia.github.io/tags/hive/"}]},{"title":"GitHubä½¿ç”¨æŒ‡å—","slug":"GitHubä½¿ç”¨æŒ‡å—","date":"2017-12-13T10:38:05.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/13/GitHubä½¿ç”¨æŒ‡å—/","link":"","permalink":"https://stanxia.github.io/2017/12/13/GitHubä½¿ç”¨æŒ‡å—/","excerpt":"å‰è¨€\nå­¦ä¹  GitHub çš„ä½¿ç”¨è§„åˆ™ï¼Œè®°å½•é‡åˆ°çš„é—®é¢˜ã€‚watch , star , fork çš„å«ä¹‰åˆšä½¿ç”¨ GitHub çš„æ—¶å€™ï¼Œçœ‹åˆ°æ¯ä¸€ä¸ªé¡¹ç›®é¡µé¢å³ä¸Šè§’éƒ½æœ‰å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å­—æ ·ï¼š","text":"å‰è¨€ å­¦ä¹  GitHub çš„ä½¿ç”¨è§„åˆ™ï¼Œè®°å½•é‡åˆ°çš„é—®é¢˜ã€‚watch , star , fork çš„å«ä¹‰åˆšä½¿ç”¨ GitHub çš„æ—¶å€™ï¼Œçœ‹åˆ°æ¯ä¸€ä¸ªé¡¹ç›®é¡µé¢å³ä¸Šè§’éƒ½æœ‰å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å­—æ ·ï¼šç‚¹å‡» watch æŒ‰é’® ä¼šå‡ºç°å¦‚ä¸‹æ‰€ç¤ºï¼š watch watch çš„åŠŸèƒ½æ˜¯è§‚å¯Ÿè·Ÿè¸ªè¿™ä¸ªé¡¹ç›®ï¼Œå¦‚æœé¡¹ç›®æœ‰ä»»ä½•æ›´æ–°ï¼Œå¦‚æœé€‰æ‹©äº† watching è¯¥é¡¹ç›®ï¼Œéƒ½ä¼šåœ¨é‚®ç®±ä¸­æ¥æ”¶åˆ°ç›¸å…³çš„æ›´æ–°ä¿¡æ¯ã€‚ not watching è¡¨ç¤ºä¸å…³æ³¨è¿™ä¸ªé¡¹ç›®çš„æ›´æ–°æƒ…å†µï¼Œä½†ä½ è¢«æåŠçš„æ—¶å€™ä¹Ÿä¼šå‘é‚®ä»¶é€šçŸ¥ã€‚ ignoring è¡¨ç¤ºä¸æ¥æ”¶ä»»ä½•é€šçŸ¥ã€‚ å¦‚æœä½ æƒ³æŒç»­è·Ÿè¿›è¯¥é¡¹ç›®çš„ä»»ä½•æ›´æ–°æƒ…å†µï¼Œåˆ™å¯ä»¥é€‰æ‹© watching ã€‚ starstar ç±»ä¼¼äºç¤¾äº¤è½¯ä»¶ä¸­çš„å…³æ³¨ã€‚å¦‚æœé€‰æ‹©äº† star ï¼Œ åˆ™å¯ä»¥åœ¨è‡ªå·±çš„ star é¡µé¢æŸ¥çœ‹åˆ°æ›¾ç» star è¿‡çš„é¡¹ç›®ã€‚ç‚¹å‡»å³ä¸Šè§’è‡ªå·±çš„å¤´åƒï¼Œé€‰æ‹© your stars ï¼šç„¶åå°±ä¼šçœ‹åˆ°æ›¾ç»æ‰€æœ‰ star è¿‡çš„é¡¹ç›®ï¼šå¦‚æœä½ åªæƒ³å…³æ³¨è¿™ä¸ªé¡¹ç›®ï¼Œä½†ä¸éœ€è¦æ¥æ”¶ä»»ä½•æ›´æ–°é€šçŸ¥ï¼Œä¹Ÿä¸éœ€è¦å¯¹è¯¥é¡¹ç›®è¿›è¡Œæ“ä½œï¼Œåˆ™å¯ä»¥é€‰æ‹© star ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥å¿«æ·æŸ¥çœ‹è¯¥é¡¹ç›®ã€‚ forkfork çš„ç›®çš„æ˜¯å°†è¯¥é¡¹ç›®å…‹éš†åˆ°è‡ªå·±çš„ GitHub ä¸­ï¼Œè‡ªå·±å¯ä»¥å¯¹è¯¥é¡¹ç›®è¿›è¡Œç¼–è¾‘ä¿®æ”¹ï¼Œåœ¨ fork çš„æ—¶å€™ä¼šåœ¨è¯¥é¡¹ç›®ä¸­æ–°æ·»ä¸€ä¸ªåˆ†æ”¯ï¼Œå¯ä»¥é€‰æ‹© pull-requests å¯¹è¯¥é¡¹ç›®è¿›è¡Œä¿®æ”¹åå¹¶æäº¤ã€‚ å¦‚æœä½ æƒ³å‚ä¸ç»´æŠ¤è¿™ä¸ªé¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ fork åŠŸèƒ½ï¼Œå¹¶æäº¤è‡ªå·±çš„ä»£ç ï¼ˆå½“ç„¶ç”¨è‡ªå·±çš„åˆ†æ”¯æäº¤é¡¹ç›®çš„æ—¶å€™ï¼Œéœ€è¦é¡¹ç›®å…¶ä»–åˆ†æ”¯çš„äººå‘˜å®¡æ ¸ï¼‰ã€‚åˆšå¼€å§‹ä¸çŸ¥é“ fork çš„åŠŸèƒ½ï¼Œå¯¼è‡´æˆ‘å°†å¾ˆå¤šé¡¹ç›®éƒ½ fork ä¸‹æ¥ï¼Œå…¶å®å¾ˆæ²¡æœ‰å¿…è¦ã€‚æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚é€‰æ‹©å°±å¥½ã€‚ æŸ¥çœ‹éƒ½æœ‰å“ªäº›äººè¿›è¡Œäº†æ“ä½œå¦‚æœæƒ³è¦çŸ¥é“éƒ½æœ‰å“ªäº›äººè¿›è¡Œäº†è¿™äº›æ“ä½œå‘¢ï¼Ÿæ¯”å¦‚æˆ‘æƒ³çŸ¥é“éƒ½æœ‰è°å¯¹è¿™ä¸ªé¡¹ç›®è¿›è¡Œäº† star æ“ä½œï¼Œå¯ä»¥çœ‹è§æ¯ä¸ªåŠŸèƒ½æ—è¾¹éƒ½æœ‰ä¸€ä¸ªæ•°å­—ï¼Œè¯¥æ•°å­—è¡¨ç¤ºå¯¹è¿™ä¸ªé¡¹ç›®è¿›è¡Œè¯¥æ“ä½œçš„äººæ•°ï¼Œç‚¹å‡»è¯¥æ•°å­—ï¼Œå°±å¯ä»¥çŸ¥é“å…·ä½“æ˜¯å“ªäº›äººè¿›è¡Œäº†æ“ä½œï¼š","raw":null,"content":null,"categories":[{"name":"GitHub","slug":"GitHub","permalink":"https://stanxia.github.io/categories/GitHub/"}],"tags":[{"name":"GitHub","slug":"GitHub","permalink":"https://stanxia.github.io/tags/GitHub/"}]},{"title":"sparkå–æ ·å‡½æ•°åˆ†æ","slug":"Spark sample å–æ ·å‡½æ•°","date":"2017-12-12T17:30:25.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/12/12/Spark sample å–æ ·å‡½æ•°/","link":"","permalink":"https://stanxia.github.io/2017/12/12/Spark sample å–æ ·å‡½æ•°/","excerpt":"\nèƒŒæ™¯\nSparkå–æ ·æ“ä½œï¼Œæ— æ³•è·å–éšæœºæ ·æœ¬çš„è§£å†³æ–¹æ¡ˆã€‚Datasetä¸­sampleå‡½æ•°æºç å¦‚ä¸‹ï¼š\n123456789101112131415161718192021222324252627282930313233343536373839404142434445/**  * Returns a new [[Dataset]] by sampling a fraction of rows, using a user-supplied seed.  *  * é€šè¿‡ä½¿ç”¨ç”¨æˆ·æä¾›çš„ç§å­ï¼Œé€šè¿‡æŠ½æ ·çš„æ–¹å¼è¿”å›ä¸€ä¸ªæ–°çš„[[Dataset]]ã€‚  *  * @param withReplacement Sample with replacement or not.  *                        å¦‚æœwithReplacement=trueçš„è¯è¡¨ç¤ºæœ‰æ”¾å›çš„æŠ½æ ·ï¼Œé‡‡ç”¨æ³Šæ¾æŠ½æ ·ç®—æ³•å®ç°.  *                        å¦‚æœwithReplacement=falseçš„è¯è¡¨ç¤ºæ— æ”¾å›çš„æŠ½æ ·ï¼Œé‡‡ç”¨ä¼¯åŠªåˆ©æŠ½æ ·ç®—æ³•å®ç°.  * @param fraction        Fraction of rows to generate.  *                        æ¯ä¸€è¡Œæ•°æ®è¢«å–æ ·çš„æ¦‚ç‡.æœä»äºŒé¡¹åˆ†å¸ƒ.å½“withReplacement=trueçš„æ—¶å€™fraction&gt;=0,å½“withReplacement=falseçš„æ—¶å€™ 0 &lt; fraction &lt; 1.  * @param seed            Seed for sampling.  *                        å–æ ·ç§å­ï¼ˆä¸éšæœºæ•°ç”Ÿæˆæœ‰å…³ï¼‰  * @note This is NOT guaranteed to provide exactly the fraction of the count  *       of the given [[Dataset]].  *       ä¸èƒ½ä¿è¯å‡†ç¡®çš„æŒ‰ç…§ç»™å®šçš„åˆ†æ•°å–æ ·ã€‚ï¼ˆä¸€èˆ¬ç»“æœä¼šåœ¨æ¦‚ç‡å€¼*æ€»æ•°å·¦å³ï¼‰  * @group typedrel  * @since 1.6.0  */def sample(withReplacement: Boolean, fraction: Double, seed: Long): Dataset[T] = &#123;  require(fraction &gt;= 0,    s\"Fraction must be nonnegative, but got $&#123;fraction&#125;\")  withTypedPlan &#123;    Sample(0.0, fraction, withReplacement, seed, logicalPlan)()  &#125;&#125;/**  * Returns a new [[Dataset]] by sampling a fraction of rows, using a random seed.  *  * é€šè¿‡ç¨‹åºéšæœºçš„ç§å­ï¼ŒæŠ½æ ·è¿”å›æ–°çš„DataSet  *  * @param withReplacement Sample with replacement or not.  *                        å–æ ·ç»“æœæ˜¯å¦æ”¾å›  * @param fraction        Fraction of rows to generate.  *                        æ¯è¡Œæ•°æ®è¢«å–æ ·çš„æ¦‚ç‡  * @note This is NOT guaranteed to provide exactly the fraction of the total count  *       of the given [[Dataset]].  *       ä¸èƒ½ä¿è¯å‡†ç¡®çš„æŒ‰ç…§ç»™å®šçš„åˆ†æ•°å–æ ·ã€‚ï¼ˆä¸€èˆ¬ç»“æœä¼šåœ¨æ¦‚ç‡å€¼*æ€»æ•°å·¦å³ï¼‰  * @group typedrel  * @since 1.6.0  */def sample(withReplacement: Boolean, fraction: Double): Dataset[T] = &#123;  sample(withReplacement, fraction, Utils.random.nextLong)&#125;","text":"èƒŒæ™¯ Sparkå–æ ·æ“ä½œï¼Œæ— æ³•è·å–éšæœºæ ·æœ¬çš„è§£å†³æ–¹æ¡ˆã€‚Datasetä¸­sampleå‡½æ•°æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * Returns a new [[Dataset]] by sampling a fraction of rows, using a user-supplied seed. * * é€šè¿‡ä½¿ç”¨ç”¨æˆ·æä¾›çš„ç§å­ï¼Œé€šè¿‡æŠ½æ ·çš„æ–¹å¼è¿”å›ä¸€ä¸ªæ–°çš„[[Dataset]]ã€‚ * * @param withReplacement Sample with replacement or not. * å¦‚æœwithReplacement=trueçš„è¯è¡¨ç¤ºæœ‰æ”¾å›çš„æŠ½æ ·ï¼Œé‡‡ç”¨æ³Šæ¾æŠ½æ ·ç®—æ³•å®ç°. * å¦‚æœwithReplacement=falseçš„è¯è¡¨ç¤ºæ— æ”¾å›çš„æŠ½æ ·ï¼Œé‡‡ç”¨ä¼¯åŠªåˆ©æŠ½æ ·ç®—æ³•å®ç°. * @param fraction Fraction of rows to generate. * æ¯ä¸€è¡Œæ•°æ®è¢«å–æ ·çš„æ¦‚ç‡.æœä»äºŒé¡¹åˆ†å¸ƒ.å½“withReplacement=trueçš„æ—¶å€™fraction&gt;=0,å½“withReplacement=falseçš„æ—¶å€™ 0 &lt; fraction &lt; 1. * @param seed Seed for sampling. * å–æ ·ç§å­ï¼ˆä¸éšæœºæ•°ç”Ÿæˆæœ‰å…³ï¼‰ * @note This is NOT guaranteed to provide exactly the fraction of the count * of the given [[Dataset]]. * ä¸èƒ½ä¿è¯å‡†ç¡®çš„æŒ‰ç…§ç»™å®šçš„åˆ†æ•°å–æ ·ã€‚ï¼ˆä¸€èˆ¬ç»“æœä¼šåœ¨æ¦‚ç‡å€¼*æ€»æ•°å·¦å³ï¼‰ * @group typedrel * @since 1.6.0 */def sample(withReplacement: Boolean, fraction: Double, seed: Long): Dataset[T] = &#123; require(fraction &gt;= 0, s\"Fraction must be nonnegative, but got $&#123;fraction&#125;\") withTypedPlan &#123; Sample(0.0, fraction, withReplacement, seed, logicalPlan)() &#125;&#125;/** * Returns a new [[Dataset]] by sampling a fraction of rows, using a random seed. * * é€šè¿‡ç¨‹åºéšæœºçš„ç§å­ï¼ŒæŠ½æ ·è¿”å›æ–°çš„DataSet * * @param withReplacement Sample with replacement or not. * å–æ ·ç»“æœæ˜¯å¦æ”¾å› * @param fraction Fraction of rows to generate. * æ¯è¡Œæ•°æ®è¢«å–æ ·çš„æ¦‚ç‡ * @note This is NOT guaranteed to provide exactly the fraction of the total count * of the given [[Dataset]]. * ä¸èƒ½ä¿è¯å‡†ç¡®çš„æŒ‰ç…§ç»™å®šçš„åˆ†æ•°å–æ ·ã€‚ï¼ˆä¸€èˆ¬ç»“æœä¼šåœ¨æ¦‚ç‡å€¼*æ€»æ•°å·¦å³ï¼‰ * @group typedrel * @since 1.6.0 */def sample(withReplacement: Boolean, fraction: Double): Dataset[T] = &#123; sample(withReplacement, fraction, Utils.random.nextLong)&#125; é—®é¢˜ ç»“æœæ•°æ®çš„è¡Œæ•°ä¸€èˆ¬åœ¨ï¼ˆfraction*æ€»æ•°ï¼‰å·¦å³ã€‚æ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œå¦‚æœéœ€è¦å¾—åˆ°å›ºå®šè¡Œæ•°çš„éšæœºæ•°æ®çš„è¯ä¸å»ºè®®é‡‡ç”¨è¯¥æ–¹æ³•ã€‚åŠæ³•è·å–éšæœºå–æ ·çš„æ›¿ä»£æ–¹æ³•ï¼š 123456df.createOrReplaceTempView(\"test_sample\"); // ç”Ÿæˆä¸´æ—¶è¡¨df.sqlContext() // æ·»åŠ éšæœºæ•°åˆ—ï¼Œå¹¶æ ¹æ®å…¶è¿›è¡Œæ’åº .sql(\"select * ,rand() as random from test_sample order by random\") .limit(2) // æ ¹æ®å‚æ•°çš„fractionè®¡ç®—éœ€è¦è·å–çš„å–æ ·ç»“æœ .drop(\"random\") // åˆ é™¤æ‰æ·»åŠ çš„éšæœºåˆ— .show();","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"}]},{"title":"HiveæŠ¥é”™é›†","slug":"HiveæŠ¥é”™é›†","date":"2017-12-11T13:58:58.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/11/HiveæŠ¥é”™é›†/","link":"","permalink":"https://stanxia.github.io/2017/12/11/HiveæŠ¥é”™é›†/","excerpt":"å‰è¨€\né’ˆå¯¹ä¸€ä¸ªè€æ¯›ç—…ï¼šæœ‰äº›é”™è¯¯å±¡çŠ¯å±¡æ”¹ï¼Œå±¡æ”¹å±¡çŠ¯ï¼Œæ²¡æœ‰å¼•èµ·æ ¹æœ¬ä¸Šçš„æ³¨æ„ï¼Œæˆ–è€…æ²¡æœ‰ä»æºå¤´ç†è§£é”™è¯¯å‘ç”Ÿçš„åº•å±‚åŸç†ï¼Œå¯¼è‡´åšå¾ˆå¤šæ— ç”¨åŠŸã€‚\næ€»ç»“å†å²ï¼Œå¹¶ä»ä¸­å¸å–æ•™è®­ï¼Œå‡å°‘æ— ç”¨åŠŸé€ æˆçš„æ—¶é—´æµªè´¹ã€‚ç‰¹æ­¤å°†ä»ç›®å‰é‡åˆ°çš„ hive é—®é¢˜å…¨éƒ¨è®°å½•åœ¨è¿™é‡Œï¼Œææ¸…æ¥šé—®é¢˜ï¼Œè‡ªä¿¡å‘å‰ã€‚","text":"å‰è¨€ é’ˆå¯¹ä¸€ä¸ªè€æ¯›ç—…ï¼šæœ‰äº›é”™è¯¯å±¡çŠ¯å±¡æ”¹ï¼Œå±¡æ”¹å±¡çŠ¯ï¼Œæ²¡æœ‰å¼•èµ·æ ¹æœ¬ä¸Šçš„æ³¨æ„ï¼Œæˆ–è€…æ²¡æœ‰ä»æºå¤´ç†è§£é”™è¯¯å‘ç”Ÿçš„åº•å±‚åŸç†ï¼Œå¯¼è‡´åšå¾ˆå¤šæ— ç”¨åŠŸã€‚ æ€»ç»“å†å²ï¼Œå¹¶ä»ä¸­å¸å–æ•™è®­ï¼Œå‡å°‘æ— ç”¨åŠŸé€ æˆçš„æ—¶é—´æµªè´¹ã€‚ç‰¹æ­¤å°†ä»ç›®å‰é‡åˆ°çš„ hive é—®é¢˜å…¨éƒ¨è®°å½•åœ¨è¿™é‡Œï¼Œææ¸…æ¥šé—®é¢˜ï¼Œè‡ªä¿¡å‘å‰ã€‚æŠ¥é”™é›† é—®é¢˜1ï¼šError rolling backè¯¦æƒ…ï¼šError rolling back: Can&#39;t call rollback when autocommit=true è§£å†³æ–¹æ¡ˆï¼švim conf/hive-site.xml ä¸è¦åŠ è¿™ä¸ªé…ç½®ï¼ï¼ï¼ï¼ 1234&lt;property&gt;&lt;name&gt;hive.in.test&lt;/name&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;","raw":null,"content":null,"categories":[{"name":"hive","slug":"hive","permalink":"https://stanxia.github.io/categories/hive/"}],"tags":[{"name":"hive","slug":"hive","permalink":"https://stanxia.github.io/tags/hive/"}]},{"title":"Hiveé”ä»‹ç»-ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£","slug":"Hiveé”ä»‹ç»-ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£","date":"2017-12-11T09:58:58.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/11/Hiveé”ä»‹ç»-ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£/","link":"","permalink":"https://stanxia.github.io/2017/12/11/Hiveé”ä»‹ç»-ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£/","excerpt":"åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶å‘æ€§æ”¯æŒæ˜¯å¿…é¡»çš„ï¼Œè€Œä¸”å®ƒä»¬çš„ç”¨ä¾‹ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚è‡³å°‘ï¼Œæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½æ”¯æŒå¹¶å‘çš„è¯»å’Œå†™ã€‚æ·»åŠ ä¸€ä¸ªæœºåˆ¶æ¥å‘ç°å·²è·å¾—çš„å½“å‰é”æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚æ²¡æœ‰ç«‹å³æ·»åŠ APIæ¥æ˜¾å¼è·å–ä»»ä½•é”çš„éœ€æ±‚ï¼Œå› æ­¤æ‰€æœ‰é”éƒ½æ˜¯éšå¼è·å¾—çš„ã€‚ä»¥ä¸‹é”å®šæ¨¡å¼å°†åœ¨hiveä¸­å®šä¹‰(æ³¨æ„ï¼Œä¸éœ€è¦æ„å›¾é”)ã€‚\n12å…±äº«(S)ç‹¬å (X)\né¡¾åæ€ä¹‰ï¼Œå¯ä»¥åŒæ—¶è·å¾—å¤šä¸ªå…±äº«é”ï¼Œè€ŒXé”å¯ä»¥é˜»æ­¢æ‰€æœ‰å…¶ä»–é”ã€‚å…¼å®¹æ€§çŸ©é˜µå¦‚ä¸‹:å¯¹äºæŸäº›æ“ä½œï¼Œé”åœ¨æœ¬è´¨ä¸Šæ˜¯åˆ†å±‚çš„â€”â€”ä¾‹å¦‚ï¼Œå¯¹äºæŸäº›åˆ†åŒºæ“ä½œï¼Œè¡¨ä¹Ÿè¢«é”å®š(ä»¥ç¡®ä¿åœ¨åˆ›å»ºæ–°åˆ†åŒºæ—¶ä¸èƒ½åˆ é™¤è¡¨)ã€‚","text":"åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶å‘æ€§æ”¯æŒæ˜¯å¿…é¡»çš„ï¼Œè€Œä¸”å®ƒä»¬çš„ç”¨ä¾‹ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚è‡³å°‘ï¼Œæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½æ”¯æŒå¹¶å‘çš„è¯»å’Œå†™ã€‚æ·»åŠ ä¸€ä¸ªæœºåˆ¶æ¥å‘ç°å·²è·å¾—çš„å½“å‰é”æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚æ²¡æœ‰ç«‹å³æ·»åŠ APIæ¥æ˜¾å¼è·å–ä»»ä½•é”çš„éœ€æ±‚ï¼Œå› æ­¤æ‰€æœ‰é”éƒ½æ˜¯éšå¼è·å¾—çš„ã€‚ä»¥ä¸‹é”å®šæ¨¡å¼å°†åœ¨hiveä¸­å®šä¹‰(æ³¨æ„ï¼Œä¸éœ€è¦æ„å›¾é”)ã€‚ 12å…±äº«(S)ç‹¬å (X) é¡¾åæ€ä¹‰ï¼Œå¯ä»¥åŒæ—¶è·å¾—å¤šä¸ªå…±äº«é”ï¼Œè€ŒXé”å¯ä»¥é˜»æ­¢æ‰€æœ‰å…¶ä»–é”ã€‚å…¼å®¹æ€§çŸ©é˜µå¦‚ä¸‹:å¯¹äºæŸäº›æ“ä½œï¼Œé”åœ¨æœ¬è´¨ä¸Šæ˜¯åˆ†å±‚çš„â€”â€”ä¾‹å¦‚ï¼Œå¯¹äºæŸäº›åˆ†åŒºæ“ä½œï¼Œè¡¨ä¹Ÿè¢«é”å®š(ä»¥ç¡®ä¿åœ¨åˆ›å»ºæ–°åˆ†åŒºæ—¶ä¸èƒ½åˆ é™¤è¡¨)ã€‚é”å®šæ¨¡å¼ä¸‹è·å–çš„åˆç†æ€§å¦‚ä¸‹: å¯¹äºéåˆ†åŒºè¡¨ï¼Œé”æ¨¡å¼éå¸¸ç›´è§‚ã€‚è¯»å–è¡¨æ—¶ï¼Œè·å–ä¸€ä¸ªSé”ï¼Œè€Œæ‰€æœ‰å…¶ä»–æ“ä½œ(æ’å…¥è¡¨ã€alter tableç­‰å…¶ä»–æ“ä½œ)è·å¾—ä¸€ä¸ªXé”ã€‚ å¯¹äºåˆ†åŒºè¡¨ï¼Œå…¶æ€æƒ³å¦‚ä¸‹: åœ¨æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œè·å–è¡¨å’Œç›¸å…³åˆ†åŒºçš„ â€˜Sâ€™ é”ã€‚å¯¹äºæ‰€æœ‰å…¶ä»–æ“ä½œï¼Œåœ¨åˆ†åŒºä¸Šæ‰§è¡Œâ€œXâ€é”ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ›´æ”¹åªé€‚ç”¨äºè¾ƒæ–°çš„åˆ†åŒºï¼Œåˆ™åœ¨è¡¨ä¸Šè·å¾—â€œSâ€é”ï¼Œè€Œå¦‚æœæ›´æ”¹é€‚ç”¨äºæ‰€æœ‰åˆ†åŒºï¼Œåˆ™åœ¨è¡¨ä¸Šè·å¾—â€œXâ€é”ã€‚å› æ­¤ï¼Œæ—§åˆ†åŒºå¯ä»¥è¢«è¯»å–å’Œå†™å…¥ï¼Œè€Œæ–°çš„åˆ†åŒºåˆ™è¢«è½¬æ¢ä¸ºRCFileã€‚æ¯å½“ä¸€ä¸ªåˆ†åŒºè¢«é”å®šåœ¨ä»»ä½•æ¨¡å¼æ—¶ï¼Œå®ƒçš„æ‰€æœ‰çˆ¶çº§éƒ½è¢«é”åœ¨â€œSâ€æ¨¡å¼ä¸­ã€‚ åŸºäºæ­¤ï¼Œä¸ºæ“ä½œè·å¾—çš„é”å¦‚ä¸‹: ä¸ºäº†é¿å…æ­»é”ï¼Œè¿™é‡Œæå‡ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„æ–¹æ¡ˆã€‚æ‰€æœ‰è¦é”å®šçš„å¯¹è±¡éƒ½æ˜¯æŒ‰å­—æ¯é¡ºåºæ’åºçš„ï¼Œç„¶åè·å–æ‰€éœ€çš„æ¨¡å¼é”ã€‚è¯·æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¸çŸ¥é“å¯¹è±¡åˆ—è¡¨â€”â€”ä¾‹å¦‚ï¼Œåœ¨åŠ¨æ€åˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œæ­£åœ¨ä¿®æ”¹çš„åˆ†åŒºåˆ—è¡¨åœ¨ç¼–è¯‘æ—¶æ˜¯æœªçŸ¥çš„â€”â€”å› æ­¤ï¼Œåˆ—è¡¨çš„ç”Ÿæˆæ˜¯ä¿å®ˆçš„ã€‚ç”±äºåˆ†åŒºçš„æ•°é‡å¯èƒ½ä¸çŸ¥é“ï¼Œæ‰€ä»¥åº”è¯¥å°†ä¸€ä¸ªä¸“ç”¨é”(ä½†ç›®å‰ä¸æ˜¯ç”±äºhive -3509 bug)æ”¾åœ¨è¡¨ä¸Šï¼Œæˆ–è€…æ˜¯å·²çŸ¥çš„å‰ç¼€ã€‚ å°†æ·»åŠ ä¸¤ä¸ªæ–°çš„å¯é…ç½®å‚æ•°æ¥å†³å®šé”çš„é‡è¯•æ¬¡æ•°å’Œæ¯æ¬¡é‡è¯•ä¹‹é—´çš„ç­‰å¾…æ—¶é—´ã€‚å¦‚æœé‡è¯•çš„æ¬¡æ•°çœŸçš„å¾ˆé«˜ï¼Œå®ƒä¼šå¯¼è‡´ä¸€ä¸ªæ´»é”ã€‚çœ‹çœ‹ZooKeeperï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ZooKeeper apiå®ç°è¯»å†™é”ã€‚è¯·æ³¨æ„ï¼Œé”è¯·æ±‚å°†è¢«æ‹’ç»ï¼Œè€Œä¸æ˜¯ç­‰å¾…ã€‚ç°æœ‰çš„é”å°†è¢«é‡Šæ”¾ï¼Œæ‰€æœ‰çš„é”å°†åœ¨é‡è¯•é—´éš”åé‡è¯•ã€‚ ä¸Šé¢åˆ—å‡ºçš„ä¸ä¼šæŒ‰ç…§æŒ‡å®šçš„æ–¹å¼å·¥ä½œï¼Œå› ä¸ºé”çš„ç­‰çº§æ€§ã€‚ è¡¨Tçš„â€œSâ€é”æŒ‡å®šå¦‚ä¸‹: è°ƒç”¨create()åˆ›å»ºå…·æœ‰è·¯å¾„åçš„èŠ‚ç‚¹â€œ/ warehouse/T/ readâ€”â€ã€‚è¿™æ˜¯åè®®åé¢ä½¿ç”¨çš„é”èŠ‚ç‚¹ã€‚ç¡®ä¿è®¾ç½®é¡ºåºå’Œä¸´æ—¶æ ‡å¿—ã€‚ åœ¨é”å®šèŠ‚ç‚¹ä¸Šè°ƒç”¨getChildren()ï¼Œè€Œæ— éœ€è®¾ç½®è§‚å¯Ÿæ ‡å¿—ã€‚ å¦‚æœæœ‰ä¸€ä¸ªä»¥â€œwrite -â€å¼€å¤´çš„è·¯å¾„åçš„å­©å­ï¼Œä»¥åŠä¸€ä¸ªè¾ƒä½çš„åºåˆ—æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°±ä¸èƒ½è¢«è·å–ã€‚åˆ é™¤ç¬¬ä¸€æ­¥ä¸­åˆ›å»ºçš„èŠ‚ç‚¹å¹¶è¿”å›ã€‚ å¦åˆ™ï¼Œé”å°±è¢«æˆäºˆäº†ã€‚ è¡¨Tçš„â€œXâ€é”å®šå¦‚ä¸‹: è°ƒç”¨create()åˆ›å»ºå…·æœ‰è·¯å¾„åçš„èŠ‚ç‚¹â€œ/ warehouse/T/ writeâ€”â€ã€‚è¿™æ˜¯åè®®åé¢ä½¿ç”¨çš„é”èŠ‚ç‚¹ã€‚ç¡®ä¿è®¾ç½®é¡ºåºå’Œä¸´æ—¶æ ‡å¿—ã€‚ åœ¨é”å®šèŠ‚ç‚¹ä¸Šè°ƒç”¨getChildren()ï¼Œè€Œæ— éœ€è®¾ç½®è§‚å¯Ÿæ ‡å¿—ã€‚ å¦‚æœæœ‰ä¸€ä¸ªä»¥â€œè¯»-â€æˆ–â€œå†™-â€å¼€å¤´çš„è·¯å¾„åçš„å­©å­ï¼Œå¹¶ä»¥è¾ƒä½çš„åºåˆ—å·å¼€å§‹ï¼Œå°±ä¸èƒ½è·å¾—é”ã€‚åˆ é™¤ç¬¬ä¸€æ­¥ä¸­åˆ›å»ºçš„èŠ‚ç‚¹å¹¶è¿”å›ã€‚ å¦åˆ™ï¼Œé”å°±è¢«æˆäºˆäº†ã€‚ é»˜è®¤çš„Hiveè¡Œä¸ºä¸ä¼šæ›´æ”¹ï¼Œå¹¶å‘ä¹Ÿä¸å—æ”¯æŒã€‚æ‚¨å¯ä»¥é€šè¿‡å°†ä»¥ä¸‹å˜é‡è®¾ç½®ä¸ºfalseæ¥å…³é—­å¹¶å‘æ€§: hive.support.concurrency. æ‚¨å¯ä»¥é€šè¿‡å‘å‡ºä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è¡¨ä¸­çš„é”: 1234SHOW LOCKS &lt;TABLE_NAME&gt;;SHOW LOCKS &lt;TABLE_NAME&gt; EXTENDED;SHOW LOCKS &lt;TABLE_NAME&gt; PARTITION (&lt;PARTITION_DESC&gt;);SHOW LOCKS &lt;TABLE_NAME&gt; PARTITION (&lt;PARTITION_DESC&gt;) EXTENDED; ç‚¹æˆ‘äº†è§£Hiveé”å®šçš„é…ç½®å±æ€§","raw":null,"content":null,"categories":[{"name":"hive","slug":"hive","permalink":"https://stanxia.github.io/categories/hive/"}],"tags":[{"name":"hive","slug":"hive","permalink":"https://stanxia.github.io/tags/hive/"}]},{"title":"Hexo + AppVeyor æŒç»­é›†æˆ","slug":"Hexo ä¼˜åŒ–-ä½¿ç”¨ AppVeyor è¿›è¡Œéƒ¨ç½²","date":"2017-12-07T11:30:06.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/07/Hexo ä¼˜åŒ–-ä½¿ç”¨ AppVeyor è¿›è¡Œéƒ¨ç½²/","link":"","permalink":"https://stanxia.github.io/2017/12/07/Hexo ä¼˜åŒ–-ä½¿ç”¨ AppVeyor è¿›è¡Œéƒ¨ç½²/","excerpt":"å‰è¨€\nä»Šå¤©æŸ¥çœ‹ Spark æºç çš„æ—¶å€™ï¼Œæ— æ„å‘ç°äº† AppVeyor ï¼Œæ‰çŸ¥é“ æŒç»­é›†æˆï¼ˆContinuous Integrationï¼Œç®€ç§°CIï¼‰,ç®€å•ç†è§£ä¸ºå¯ä»¥è‡ªåŠ¨åŒ–æ„å»ºé¡¹ç›®çš„å·¥å…·ã€‚åœ¨ Spark ä¸­ï¼ŒSparkR çš„é¡¹ç›®ä½¿ç”¨äº† AppVeyor æŒç»­é›†æˆå·¥å…·ã€‚\nçœ‹åˆ°ç½‘ç»œä¸Šä¸€äº›å¤§ä½¬ç”¨ AppVeyor è”åˆ Hexoï¼Œä½œä¸ºåšå®¢ä»£ç çš„éƒ¨ç½²å·¥å…·ï¼Œä¸€æ–¹é¢å¯ä»¥ä½¿éƒ¨ç½²ä»£ç æ›´åŠ ç®€å•ï¼ˆå…¨è‡ªåŠ¨åŒ–ï¼Œè™½ç„¶ä¹‹å‰ä¹Ÿåªæœ‰ hexo -clean ,hexo -g ,hexo -d ä¸‰æ­¥ï¼Œä½†ç°åœ¨å®Œå…¨åœ¨åå°è‡ªåŠ¨éƒ¨ç½²ï¼‰ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥è§£å†³åšå®¢æºç å¤šç”µè„‘ä¹¦å†™çš„å±€é™æ€§ï¼ˆä¹‹å‰åªèƒ½åœ¨ä¸€å°ç”µè„‘ä¸Šè¿›è¡Œåšå®¢çš„åˆ›ä½œï¼Œé¢ä¸´ç€é¡¹ç›®å¤‡ä»½çš„é—®é¢˜ï¼‰ï¼Œç°åœ¨å°†é¡¹ç›®å®Œå…¨æ‰˜ç®¡åœ¨ GitHubä¸Šï¼Œæ— éœ€æ‹…å¿ƒç”µè„‘æ¢äº†ï¼Œæˆ–æ˜¯ç£ç›˜æŸåé€ æˆçš„æ•°æ®ä¸¢å¤±ï¼Œä¹Ÿæ— éœ€ä½¿ç”¨äº‘å¤‡ä»½å·¥å…·è´¹æ—¶è´¹åŠ›çš„ç»´æŠ¤é¡¹ç›®ã€‚æ ¸å¿ƒæ­¥éª¤\næ–°å»ºä»£ç ä»“åº“é¦–å…ˆæˆ‘ä»¬å…ˆç¡®å®šï¼Œå°†é¡¹ç›®æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯åœ¨å­˜æ”¾åšå®¢é™æ€ä»£ç çš„ä»“åº“ï¼ˆå¦‚ï¼šxxx.github.ioï¼‰ä¸­æ–°æ·»åŠ åˆ†æ”¯;å¦ä¸€ç§åˆ™æ˜¯æ–°å»ºä¸€ä¸ªä»“åº“ç”¨äºå­˜æ”¾é¡¹ç›®ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„ç¬¬äºŒç§æ–¹å¼ï¼Œæ–°å»ºäº†ä¸€ä¸ªä»“åº“ï¼šhexo-github-source ã€‚","text":"å‰è¨€ ä»Šå¤©æŸ¥çœ‹ Spark æºç çš„æ—¶å€™ï¼Œæ— æ„å‘ç°äº† AppVeyor ï¼Œæ‰çŸ¥é“ æŒç»­é›†æˆï¼ˆContinuous Integrationï¼Œç®€ç§°CIï¼‰,ç®€å•ç†è§£ä¸ºå¯ä»¥è‡ªåŠ¨åŒ–æ„å»ºé¡¹ç›®çš„å·¥å…·ã€‚åœ¨ Spark ä¸­ï¼ŒSparkR çš„é¡¹ç›®ä½¿ç”¨äº† AppVeyor æŒç»­é›†æˆå·¥å…·ã€‚ çœ‹åˆ°ç½‘ç»œä¸Šä¸€äº›å¤§ä½¬ç”¨ AppVeyor è”åˆ Hexoï¼Œä½œä¸ºåšå®¢ä»£ç çš„éƒ¨ç½²å·¥å…·ï¼Œä¸€æ–¹é¢å¯ä»¥ä½¿éƒ¨ç½²ä»£ç æ›´åŠ ç®€å•ï¼ˆå…¨è‡ªåŠ¨åŒ–ï¼Œè™½ç„¶ä¹‹å‰ä¹Ÿåªæœ‰ hexo -clean ,hexo -g ,hexo -d ä¸‰æ­¥ï¼Œä½†ç°åœ¨å®Œå…¨åœ¨åå°è‡ªåŠ¨éƒ¨ç½²ï¼‰ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥è§£å†³åšå®¢æºç å¤šç”µè„‘ä¹¦å†™çš„å±€é™æ€§ï¼ˆä¹‹å‰åªèƒ½åœ¨ä¸€å°ç”µè„‘ä¸Šè¿›è¡Œåšå®¢çš„åˆ›ä½œï¼Œé¢ä¸´ç€é¡¹ç›®å¤‡ä»½çš„é—®é¢˜ï¼‰ï¼Œç°åœ¨å°†é¡¹ç›®å®Œå…¨æ‰˜ç®¡åœ¨ GitHubä¸Šï¼Œæ— éœ€æ‹…å¿ƒç”µè„‘æ¢äº†ï¼Œæˆ–æ˜¯ç£ç›˜æŸåé€ æˆçš„æ•°æ®ä¸¢å¤±ï¼Œä¹Ÿæ— éœ€ä½¿ç”¨äº‘å¤‡ä»½å·¥å…·è´¹æ—¶è´¹åŠ›çš„ç»´æŠ¤é¡¹ç›®ã€‚æ ¸å¿ƒæ­¥éª¤ æ–°å»ºä»£ç ä»“åº“é¦–å…ˆæˆ‘ä»¬å…ˆç¡®å®šï¼Œå°†é¡¹ç›®æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯åœ¨å­˜æ”¾åšå®¢é™æ€ä»£ç çš„ä»“åº“ï¼ˆå¦‚ï¼šxxx.github.ioï¼‰ä¸­æ–°æ·»åŠ åˆ†æ”¯;å¦ä¸€ç§åˆ™æ˜¯æ–°å»ºä¸€ä¸ªä»“åº“ç”¨äºå­˜æ”¾é¡¹ç›®ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„ç¬¬äºŒç§æ–¹å¼ï¼Œæ–°å»ºäº†ä¸€ä¸ªä»“åº“ï¼šhexo-github-source ã€‚ é…ç½® AppVeyorç‚¹æˆ‘è¿›å…¥AppVeyorå®˜ç½‘æ·»åŠ ä½ çš„GitHubé¡¹ç›®ï¼Œè¿™é‡Œè¦æ³¨æ„æ·»åŠ çš„æ˜¯ä½ çš„Source Repoï¼ˆhexo-github-sourceï¼‰ï¼Œè€Œä¸æ˜¯Content Repoï¼ˆxxx.github.io.gitï¼‰ã€‚ é…ç½® appveyor.ymlå›åˆ° GitHub é¡µé¢ï¼Œåœ¨æ–°å»ºçš„ hexo-github-source ä»“åº“çš„æ ¹ç›®å½•ä¸‹é¢æ–°å»º appveyor.yml æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132clone_depth: 5 environment: nodejs_version: &quot;6&quot; access_token: secure: [è¿™é‡Œéœ€è¦æ”¹ä¸ºè‡ªå·±çš„å¯†åŒ™ï¼Œè·å–æ–¹æ³•è§ä¸‹] install: - ps: Install-Product node $env:nodejs_version - node --version - npm --version - npm install - npm install hexo-cli -g build_script: - hexo generate artifacts: - path: public on_success: - git config --global credential.helper store - ps: Add-Content &quot;$env:USERPROFILE\\.git-credentials&quot; &quot;https://$($env:access_token):x-oauth-basic@github.com`n&quot; - git config --global user.email &quot;%GIT_USER_EMAIL%&quot; - git config --global user.name &quot;%GIT_USER_NAME%&quot; - git clone --depth 5 -q --branch=%TARGET_BRANCH% %STATIC_SITE_REPO% %TEMP%\\static-site - cd %TEMP%\\static-site - del * /f /q - for /d %%p IN (*) do rmdir &quot;%%p&quot; /s /q - SETLOCAL EnableDelayedExpansion &amp; robocopy &quot;%APPVEYOR_BUILD_FOLDER%\\public&quot; &quot;%TEMP%\\static-site&quot; /e &amp; IF !ERRORLEVEL! EQU 1 (exit 0) ELSE (IF !ERRORLEVEL! EQU 3 (exit 0) ELSE (exit 1)) - git add -A - if &quot;%APPVEYOR_REPO_BRANCH%&quot;==&quot;master&quot; if not defined APPVEYOR_PULL_REQUEST_NUMBER (git diff --quiet --exit-code --cached || git commit -m &quot;Update Static Site&quot; &amp;&amp; git push origin %TARGET_BRANCH% &amp;&amp; appveyor AddMessage &quot;Static Site Updated&quot;) ä»¥ä¸Šé…ç½®ï¼Œåªæœ‰ access_token ä¸ä¸€æ ·ï¼ˆå…¶ä½™çš„éƒ½å¯ä»¥ç›´æ¥ç”¨ï¼‰ï¼Œè¿™ä¸ªéœ€è¦å» GitHub ç”Ÿæˆï¼Œæˆ³æˆ‘äº†è§£æ€ä¹ˆè·å–ã€‚åœ¨ GitHub æ‹¿åˆ° access_token ä¹‹åï¼Œè¿˜éœ€è¦åˆ° AppVeyor åŠ å¯†é¡µé¢ è¿›è¡ŒåŠ å¯†ï¼Œæœ€ç»ˆå¾—åˆ°ç±»ä¼¼è¿™æ ·ä¸€ä¸²ä¸œè¥¿MvjDPMTBE+hD5iZPRY2mIUuTl8quMhcEfhYe1rOti5g2GaTPQSDU/Mliff7NainM ï¼Œå°†è¯¥å¯†åŒ™ å†™å…¥ appveyor.yml ä¸­ã€‚ é…ç½® Appveyor ç¯å¢ƒå˜é‡å›åˆ° åˆšæ‰çš„ Appveyor é¡µé¢ï¼Œè¿›å…¥ settings é¡µé¢ï¼Œé€‰æ‹© Environment ï¼Œç‚¹å‡» Add variable æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œé…ç½®å¦‚ä¸‹å››ä¸ªå˜é‡ï¼š GIT_USER_EMAIL ï¼šGitHubé‚®ç®± GIT_USER_NAME ï¼šGitHubç”¨æˆ·å STATIC_SITE_REPO ï¼šContent Repoåœ°å€ï¼ˆhttps://github.com/xxx/xxx.github.io.gitï¼‰ TARGET_BRANCH ï¼šä¿ç•™é»˜è®¤çš„ masterå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šæµ‹è¯•ä¸é—®é¢˜ ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œç»ˆäºè¶Šè¿‡æ— æ•°çš„å‘ä¹‹åï¼Œå®Œç¾çš„è¿è¡ŒæˆåŠŸã€‚å‘ä¸€ï¼špush åˆ°ä»“åº“æ—¶æç¤ºç©ºæ–‡ä»¶å¤¹æç¤º themes/next ä¸ºç©ºæ–‡ä»¶å¤¹ï¼Œæäº¤å¤±è´¥ï¼ˆ GitHub æ— æ³•æäº¤ç©ºæ–‡ä»¶å¤¹ï¼‰ï¼Œå¯é—®é¢˜æ˜¯æ˜æ˜ä¸æ˜¯ç©ºæ–‡ä»¶å•Šï¼Œä¸ºä»€ä¹ˆä¼šåˆ¤å®šä¸ºç©ºçš„ï¼ŸåŸæ¥æˆ‘è¿™æ˜¯ next ä¸»é¢˜ç›´æ¥ git clone ä¸‹æ¥çš„ï¼Œå› è€Œåœ¨ next æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹é¢æœ‰ä¸€ä¸ª .git çš„éšè—æ–‡ä»¶ï¼Œå°±æ˜¯è¿™å¯¼è‡´çš„æ— æ³•æäº¤ã€‚æ—¢ç„¶æ‰¾åˆ°äº†åŸå› ï¼Œé‚£å°±å¥½æ•´äº†ï¼Œç›´æ¥åˆ æ‰ï¼Œå®Œç¾è§£å†³é—®é¢˜ã€‚å‘äºŒï¼š AppVeyor æç¤º Bugå°†é¡¹ç›® push åˆ°æ–°å»ºçš„ä»“åº“ä¸­ï¼ŒæŸ¥çœ‹ AppVeyor çš„è¿è¡Œæ—¥å¿—ï¼Œçœ‹æ˜¯å¦æç¤º Bug ï¼Œæˆ‘åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­å¾ˆä¸å¹¸ï¼Œå°±å‡ºç°è¿‡é—®é¢˜ï¼ŒåŸå› æ˜¯ hexo çš„ä¸€ä¸ªæ’ä»¶ç›®å½•è¿‡é•¿ï¼Œå¯¼è‡´ç¨‹åºå¤±è´¥ï¼Œè§£å†³æ–¹æ³•æ˜¯ä¸ç”¨æŠŠ hexo æ–‡ä»¶å¤¹å¤‡ä»½åˆ°ä»“åº“ä¸­ï¼Œå› è€Œå®Œç¾çš„è§£å†³ï¼ˆé¿å¼€ï¼‰é—®é¢˜ã€‚å¤‡ä»½åˆ°ä»“åº“çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼šï¼ˆå¤šä½™çš„éƒ½å¯å»æ‰ï¼Œä»…ä¿ç•™æ ¸å¿ƒï¼‰","raw":null,"content":null,"categories":[{"name":"hexo","slug":"hexo","permalink":"https://stanxia.github.io/categories/hexo/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://stanxia.github.io/tags/hexo/"},{"name":"appveyor","slug":"appveyor","permalink":"https://stanxia.github.io/tags/appveyor/"}]},{"title":"Hiveäº‹åŠ¡ç®¡ç†","slug":"Hiveäº‹åŠ¡ç®¡ç†","date":"2017-12-01T11:30:06.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/12/01/Hiveäº‹åŠ¡ç®¡ç†/","link":"","permalink":"https://stanxia.github.io/2017/12/01/Hiveäº‹åŠ¡ç®¡ç†/","excerpt":"ç®€ä»‹\nHiveä½œä¸ºHadoopå®¶æ—å†å²æœ€æ‚ ä¹…çš„ç»„ä»¶ä¹‹ä¸€ï¼Œä¸€ç›´ä»¥å…¶ä¼˜ç§€çš„å…¼å®¹æ€§æ”¯æŒå’Œç¨³å®šæ€§è€Œè‘—ç§°ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå°†ä¸šåŠ¡æ•°æ®ä»ä¼ ç»Ÿæ•°æ®åº“è¿ç§»è‡³Hadoopå¹³å°ï¼Œå¹¶é€šè¿‡Hiveæ¥è¿›è¡Œæ•°æ®åˆ†æã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨è¿ç§»çš„è¿‡ç¨‹ä¸­éš¾å…ä¼šç¢°åˆ°å¦‚ä½•å°†ä¼ ç»Ÿæ•°æ®åº“çš„åŠŸèƒ½ä¹Ÿè¿ç§»åˆ°Hadoopçš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´äº‹åŠ¡ã€‚äº‹åŠ¡ä½œä¸ºä¼ ç»Ÿæ•°æ®åº“å¾ˆé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œåœ¨Hiveä¸­æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸHiveçš„å®ç°æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„åœ°æ–¹å‘¢ï¼Ÿæˆ‘ä»¬å°†ä¼ ç»Ÿæ•°æ®åº“çš„åº”ç”¨è¿ç§»åˆ°Hiveå¦‚æœæœ‰äº‹åŠ¡ç›¸å…³çš„åœºæ™¯æˆ‘ä»¬è¯¥å¦‚ä½•å»è½¬æ¢å¹¶è¦æ³¨æ„ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ\næœ¬æ–‡ä¼šé€šè¿‡å¾ˆå¤šçœŸå®æµ‹è¯•æ¡ˆä¾‹æ¥æ¯”è¾ƒHiveä¸ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡çš„åŒºåˆ«ï¼Œå¹¶åœ¨æ–‡æœ«ç»™å‡ºä¸€äº›åœ¨Hiveå¹³å°ä¸Šä½¿ç”¨äº‹åŠ¡ç›¸å…³çš„åŠŸèƒ½æ—¶çš„æŒ‡å¯¼å’Œå»ºè®®ã€‚ACIDä¸å®ç°åŸç†ä¸ºäº†æ–¹ä¾¿è§£é‡Šå’Œè¯´æ˜åé¢çš„ä¸€äº›é—®é¢˜ï¼Œè¿™é‡Œé‡æä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡ç›¸å…³çš„æ¦‚å¿µï¼Œä»¥ä¸‹å†…å®¹æ¥æºäºç½‘ç»œã€‚","text":"ç®€ä»‹ Hiveä½œä¸ºHadoopå®¶æ—å†å²æœ€æ‚ ä¹…çš„ç»„ä»¶ä¹‹ä¸€ï¼Œä¸€ç›´ä»¥å…¶ä¼˜ç§€çš„å…¼å®¹æ€§æ”¯æŒå’Œç¨³å®šæ€§è€Œè‘—ç§°ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå°†ä¸šåŠ¡æ•°æ®ä»ä¼ ç»Ÿæ•°æ®åº“è¿ç§»è‡³Hadoopå¹³å°ï¼Œå¹¶é€šè¿‡Hiveæ¥è¿›è¡Œæ•°æ®åˆ†æã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨è¿ç§»çš„è¿‡ç¨‹ä¸­éš¾å…ä¼šç¢°åˆ°å¦‚ä½•å°†ä¼ ç»Ÿæ•°æ®åº“çš„åŠŸèƒ½ä¹Ÿè¿ç§»åˆ°Hadoopçš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´äº‹åŠ¡ã€‚äº‹åŠ¡ä½œä¸ºä¼ ç»Ÿæ•°æ®åº“å¾ˆé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œåœ¨Hiveä¸­æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸHiveçš„å®ç°æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„åœ°æ–¹å‘¢ï¼Ÿæˆ‘ä»¬å°†ä¼ ç»Ÿæ•°æ®åº“çš„åº”ç”¨è¿ç§»åˆ°Hiveå¦‚æœæœ‰äº‹åŠ¡ç›¸å…³çš„åœºæ™¯æˆ‘ä»¬è¯¥å¦‚ä½•å»è½¬æ¢å¹¶è¦æ³¨æ„ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ æœ¬æ–‡ä¼šé€šè¿‡å¾ˆå¤šçœŸå®æµ‹è¯•æ¡ˆä¾‹æ¥æ¯”è¾ƒHiveä¸ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡çš„åŒºåˆ«ï¼Œå¹¶åœ¨æ–‡æœ«ç»™å‡ºä¸€äº›åœ¨Hiveå¹³å°ä¸Šä½¿ç”¨äº‹åŠ¡ç›¸å…³çš„åŠŸèƒ½æ—¶çš„æŒ‡å¯¼å’Œå»ºè®®ã€‚ACIDä¸å®ç°åŸç†ä¸ºäº†æ–¹ä¾¿è§£é‡Šå’Œè¯´æ˜åé¢çš„ä¸€äº›é—®é¢˜ï¼Œè¿™é‡Œé‡æä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡ç›¸å…³çš„æ¦‚å¿µï¼Œä»¥ä¸‹å†…å®¹æ¥æºäºç½‘ç»œã€‚ ACIDè¯´æ˜ä½•ä¸ºäº‹åŠ¡ï¼Ÿå°±æ˜¯ä¸€ç»„å•å…ƒåŒ–æ“ä½œï¼Œè¿™äº›æ“ä½œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚ äº‹åŠ¡ï¼ˆtransactionï¼‰æ‰€åº”è¯¥å…·æœ‰çš„å››ä¸ªè¦ç´ ï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰ã€‚è¿™å››ä¸ªåŸºæœ¬è¦ç´ é€šå¸¸ç§°ä¸ºACIDç‰¹æ€§ã€‚ åŸå­æ€§ï¼ˆAtomicityï¼‰:ä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯å†åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰:äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚è¿™æ˜¯è¯´æ•°æ®åº“äº‹åŠ¡ä¸èƒ½ç ´åå…³ç³»æ•°æ®çš„å®Œæ•´æ€§ä»¥åŠä¸šåŠ¡é€»è¾‘ä¸Šçš„ä¸€è‡´æ€§ã€‚ éš”ç¦»æ€§ï¼ˆIsolationï¼‰:å¤šä¸ªäº‹åŠ¡å¹¶å‘è®¿é—®ï¼Œäº‹åŠ¡ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸å½±å“å…¶å®ƒäº‹åŠ¡è¿è¡Œæ•ˆæœã€‚è¿™æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“ä½œç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªå®Œæ•´çš„æ•°æ®ç©ºé—´ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹åçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚äº‹åŠ¡ä¹‹é—´çš„ç›¸åº”å½±å“ï¼Œåˆ†åˆ«ä¸ºï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€ä¸¢å¤±æ›´æ–°ã€‚ æŒä¹…æ€§ï¼ˆDurabilityï¼‰:æ„å‘³ç€åœ¨äº‹åŠ¡å®Œæˆä»¥åï¼Œè¯¥äº‹åŠ¡é”å¯¹æ•°æ®åº“æ‰€ä½œçš„æ›´æ”¹ä¾¿æŒä¹…çš„ä¿å­˜åœ¨æ•°æ®åº“ä¹‹ä¸­ï¼Œå¹¶ä¸ä¼šè¢«å›æ»šã€‚ ACIDçš„å®ç°åŸç†äº‹åŠ¡å¯ä»¥ä¿è¯ACIDåŸåˆ™çš„æ“ä½œï¼Œé‚£ä¹ˆäº‹åŠ¡æ˜¯å¦‚ä½•ä¿è¯è¿™äº›åŸåˆ™çš„ï¼Ÿè§£å†³ACIDé—®é¢˜çš„ä¸¤å¤§æŠ€æœ¯ç‚¹æ˜¯ï¼š é¢„å†™æ—¥å¿—ï¼ˆWrite-ahead loggingï¼‰ä¿è¯åŸå­æ€§å’ŒæŒä¹…æ€§ é”ï¼ˆlockingï¼‰ä¿è¯éš”ç¦»æ€§ è¿™é‡Œå¹¶æ²¡æœ‰æåˆ°ä¸€è‡´æ€§ï¼Œæ˜¯å› ä¸ºä¸€è‡´æ€§æ˜¯åº”ç”¨ç›¸å…³çš„è¯é¢˜ï¼Œå®ƒçš„å®šä¹‰ä¸€ä¸ªç”±ä¸šåŠ¡ç³»ç»Ÿæ¥å®šä¹‰ï¼Œä»€ä¹ˆæ ·çš„çŠ¶æ€æ‰æ˜¯ä¸€è‡´ï¼Ÿè€Œå®ç°ä¸€è‡´æ€§çš„ä»£ç é€šå¸¸åœ¨ä¸šåŠ¡é€»è¾‘çš„ä»£ç ä¸­å¾—ä»¥ä½“ç°ã€‚ æ³¨ï¼šé”æ˜¯æŒ‡åœ¨å¹¶å‘ç¯å¢ƒä¸­é€šè¿‡è¯»å†™é”æ¥ä¿è¯æ“ä½œçš„äº’æ–¥æ€§ã€‚æ ¹æ®éš”ç¦»ç¨‹åº¦ä¸åŒï¼Œé”çš„è¿ç”¨ä¹Ÿä¸åŒã€‚æµ‹è¯•ç¯å¢ƒ æ“ä½œç³»ç»Ÿ CentOS 6.5 JDK jdk1.7.0_67 CDH 5.9 Hadoop 2.6.0 Hive 1.1.0 Hiveçš„ACIDæµ‹è¯• Hiveä¸­çš„é”ï¼ˆä¸å¼€å¯äº‹åŠ¡ï¼‰Hiveä¸­å®šä¹‰äº†ä¸¤ç§é”çš„æ¨¡å¼ï¼šå…±äº«é”ï¼ˆSï¼‰å’Œæ’å®ƒé”ï¼ˆXï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œå¤šä¸ªå…±äº«é”(S)å¯ä»¥åŒæ—¶è·å–ï¼Œä½†æ˜¯æ’å®ƒé”(X)ä¼šé˜»å¡å…¶å®ƒæ‰€æœ‰é”ã€‚åœ¨æœ¬æ¬¡æµ‹è¯•ä¸­ï¼ŒCDH5.9çš„Concurrencyå‚æ•°æ˜¯é»˜è®¤å¼€å¯çš„ï¼ˆhive.support.concurrency=trueï¼‰ï¼Œä»¥ä¸‹åˆ†åˆ«å¯¹å¼€å¯Concurrencyå’Œå…³é—­è¿›è¡Œç›¸å…³æµ‹è¯•ã€‚ é¦–å…ˆåœ¨æµ‹è¯•ä¹‹å‰ï¼Œåˆ›å»ºä¸€ä¸ªæ™®é€šçš„hiveè¡¨ï¼š 1create table test_notransaction(user_id Int,name String); å‘test_transactionè¡¨ä¸­æ’å…¥æµ‹è¯•æ•°æ®ï¼š 1insert into test_notransaction values(1,'peach1'),(2,'peach2'),(3, 'peach3'),(4, 'peach4'); æŸ¥çœ‹æ’å…¥çš„æ•°æ®ï¼š å¼€å¯Concurrency1ã€å¯¹catalog_salesè¡¨è¿›è¡Œå¹¶å‘selectæ“ä½œ æ‰§è¡Œçš„sqlè¯­å¥ï¼šselect count(*) from catalog_sales; æ‰§è¡Œå•æ¡sqlæŸ¥è¯¢æ—¶ï¼Œè·å–ä¸€ä¸ªå…±äº«é”ï¼ˆSï¼‰ï¼Œsqlè¯­å¥æ­£å¸¸æ‰§è¡Œ åŒæ—¶æ‰§è¡Œä¸¤æ¡sqlæŸ¥è¯¢æ˜¯ï¼Œè·å–ä¸¤ä¸ªå…±äº«é”ï¼Œå¹¶ä¸”sqlè¯­å¥å‡æ­£å¸¸æ‰§è¡Œ åˆ†æï¼šç”±æ­¤å¯¹æ¯”å¯å¾—å‡ºhiveåœ¨æ‰§è¡ŒsqlæŸ¥è¯¢æ—¶è·å–Shareé”ï¼Œåœ¨å¹¶å‘çš„æƒ…å†µä¸‹å¯è·å–å¤šä¸ªå…±äº«é”ã€‚ 2ã€å¯¹testè¡¨è¿›è¡Œå¹¶å‘Insertæ“ä½œ åˆ›å»ºè¡¨ï¼š 1create table test(name string, id int); æ‰§è¡Œsqlè¯­å¥ï¼š 12insert into test values('test11aaa1',1252); insert into test values('test1',52); æ‰§è¡Œå•æ¡insertè¯­å¥æ—¶ï¼Œè·å–ä¸€ä¸ªXé”ï¼Œsqlè¯­å¥æ­£å¸¸æ‰§è¡Œ åŒæ—¶æ‰§è¡Œä¸¤æ¡insertè¯­å¥æ—¶ï¼Œåªèƒ½è·å–ä¸€ä¸ªtestè¡¨Xé”ï¼Œç¬¬ä¸€æ¡insertè¯­å¥æ­£å¸¸æ‰§è¡Œï¼Œç¬¬äºŒæ¡insertè¯­å¥å¤„äºç­‰å¾…çŠ¶æ€ï¼Œåœ¨ç¬¬ä¸€æ¡insertè¯­å¥é‡Šæ”¾testè¡¨çš„Xé”ï¼Œç¬¬äºŒæ¡sqlè¯­å¥æ­£å¸¸æ‰§è¡Œ. åˆ†æï¼šç”±æ­¤å¯¹æ¯”å¯å¾—å‡ºhiveåœ¨æ‰§è¡Œinsertæ“ä½œæ—¶ï¼Œåªèƒ½è·å–ä¸€ä¸ªXé”ä¸”é”ä¸èƒ½å…±äº«ï¼Œåªèƒ½åœ¨sqlæ‰§è¡Œå®Œæˆé‡Šæ”¾é”åï¼Œåç»­sqlæ–¹å¯ç»§ç»­æ‰§è¡Œã€‚ 3ã€å¯¹testè¡¨æ‰§è¡Œselectçš„åŒæ—¶æ‰§è¡Œinsertæ“ä½œ æ‰§è¡Œsqlè¯­å¥ï¼š 12select count(*) from test; insert into test values(&quot;test123&quot;,123); æ­¥éª¤ï¼š 1) æ‰§è¡Œselectè¯­å¥ï¼Œåœ¨selectæœªè¿è¡Œå®Œæ—¶ï¼Œåœ¨æ–°çš„çª—å£åŒæ—¶æ‰§è¡Œinsertè¯­å¥è§‚å¯Ÿä¸¤æ¡sqlæ‰§è¡Œæƒ…å†µï¼Œselectè¯­å¥æ­£å¸¸æ‰§è¡Œï¼Œinsertè¯­å¥å¤„äºç­‰å¾…çŠ¶æ€ã€‚ 2) æ­¤æ—¶æŸ¥çœ‹testè¡¨é”çŠ¶æ€ åœ¨æ­¥éª¤1çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè·å–åˆ°testè¡¨çš„é”ä¸ºå…±äº«é”ï¼ˆSï¼‰ 3) åœ¨selectè¯­å¥æ‰§è¡Œå®Œæˆåï¼Œè§‚å¯Ÿinsertè¯­å¥å¼€å§‹æ­£å¸¸æ‰§è¡Œï¼Œæ­¤æ—¶è·å–testè¡¨é”ä¸ºæ’å®ƒé”ï¼ˆXï¼‰ã€‚æ³¨æ„ï¼šåœ¨selectè¯­å¥æ‰§è¡Œå®Œæˆåï¼Œå¤§æ¦‚è¿‡40så·¦å³insertè¯­å¥æ‰æ­£å¸¸æ‰§è¡Œï¼Œè¿™æ˜¯ç”±hive.lock.sleep.between.retrieså‚æ•°æ§åˆ¶ï¼Œé»˜è®¤60 åˆ†æï¼š ç”±ä¸Šè¿°æ“ä½œå¯å¾—å‡ºï¼Œhiveä¸­ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªæ’å®ƒé”(X)ä¸”é”ä¸èƒ½å…±äº«ï¼Œåœ¨è·å–æ’å®ƒé”æ—¶ï¼Œè¡¨ä¸Šä¸èƒ½æœ‰å…¶å®ƒé”åŒ…æ‹¬å…±äº«é”(S)ï¼Œåªæœ‰åœ¨è¡¨ä¸Šæ‰€æœ‰çš„é”éƒ½é‡Šæ”¾åï¼Œinsertæ“ä½œæ‰èƒ½ç»§ç»­ï¼Œå¦åˆ™å¤„äºç­‰å¾…çŠ¶æ€ã€‚ å¯¹æ³¨æ„éƒ¨åˆ†è¿›è¡Œå‚æ•°è°ƒæ•´ï¼Œå°†hive.lock.sleep.between.retriesè®¾ç½®ä¸º10sï¼Œå†æ¬¡è¿›è¡Œæµ‹è¯•å‘ç°ï¼Œåœ¨selectè¯­å¥æ‰§è¡Œå®Œæˆåï¼Œå¤§æ¦‚è¿‡6så·¦å³insertè¯­å¥å¼€å§‹æ‰§è¡Œ,é€šè¿‡ä¸¤æ¬¡æµ‹è¯•å‘ç°ï¼Œç­‰å¾…æ—¶é—´å‡åœ¨10sä»¥å†…ï¼Œç”±æ­¤å¯ä»¥å¾—å‡ºæ­¤å‚æ•°å½±å“sqlæ“ä½œè·å–é”çš„é—´éš”ï¼ˆåœ¨æœªè·å–åˆ°é”çš„æƒ…å†µä¸‹ï¼‰ï¼Œå¦‚æœæ­¤æ—¶æœªåˆ°è·å–é”è§¦å‘å‘¨æœŸï¼Œæ‰§è¡Œå…¶å®ƒsqlåˆ™ï¼Œè¯¥sqlä¼šä¼˜äºç­‰å¾…çš„sqlæ‰§è¡Œã€‚ 4ã€å¯¹testè¡¨æ‰§è¡Œinsertçš„åŒæ—¶æ‰§è¡Œselectæ“ä½œ æ‰§è¡Œsqlè¯­å¥ï¼š 12insert into test values(&quot;test123&quot;,123); select count(*) from test; æ“ä½œæ­¥éª¤ï¼š 1) åœ¨å‘½ä»¤çª—å£æ‰§è¡Œinsertè¯­å¥ï¼Œåœ¨insertæ“ä½œæœªæ‰§è¡Œå®Œæˆæ—¶ï¼Œåœ¨æ–°çš„å‘½ä»¤çª—å£æ‰§è¡Œselectè¯­å¥ï¼Œè§‚å¯Ÿä¸¤ä¸ªçª—å£çš„sqlæ‰§è¡Œæƒ…å†µï¼Œinsertè¯­å¥æ­£å¸¸æ‰§è¡Œï¼Œselectè¯­å¥å¤„äºç­‰å¾…çŠ¶æ€ã€‚ 2) æ­¤æ—¶æŸ¥çœ‹testè¡¨é”çŠ¶æ€ï¼Œåªæœ‰insertæ“ä½œè·å–çš„æ’å®ƒé”ï¼ˆXï¼‰ 3) åœ¨insertè¯­å¥æ‰§è¡Œå®Œæˆåï¼Œè§‚å¯Ÿselectè¯­å¥å¼€å§‹æ­£å¸¸æ‰§è¡Œï¼Œæ­¤æ—¶æŸ¥çœ‹testè¡¨é”çŠ¶æ€ä¸ºå…±äº«é”ï¼ˆSï¼‰ï¼Œä¹‹å‰çš„insertæ“ä½œè·å–çš„æ’å®ƒé”ï¼ˆXï¼‰å·²è¢«é‡Šæ”¾ åˆ†æï¼šåœ¨testè¡¨é”çŠ¶æ€ä¸ºæ’å®ƒé”(X)æ—¶ï¼Œæ‰€æœ‰çš„æ“ä½œå‡è¢«é˜»å¡å¤„äºç­‰å¾…çŠ¶æ€ï¼Œåªæœ‰åœ¨æ’å®ƒé”(X)é‡Šæ”¾å…¶å®ƒæ“ä½œå¯ç»§ç»­è¿›è¡Œã€‚ 5ã€æµ‹è¯•updateå’Œdeleteä¿®æ”¹testè¡¨æ•°æ® sqlè¯­å¥ï¼š 12update test set name=&apos;aaaa&apos; where id=1252; delete test set name=&apos;bbbb&apos; where id=123; 1) è¡¨ä¸­æ•°æ®ï¼Œæ›´æ–°å‰ 2) åœ¨beelineçª—å£æ‰§è¡Œupdateæ“ä½œ æ‰§è¡Œupdateæ“ä½œæŠ¥é”™ï¼Œå¼‚å¸¸æç¤ºâ€œAttempt to do update or delete using transaction manager that does not support these operationsâ€ï¼Œåœ¨éäº‹åŠ¡æ¨¡å¼ä¸‹ä¸æ”¯æŒupdate å’Œ deleteã€‚ å…³é—­Concurrency1ã€æ‰§è¡Œinsertæ“ä½œçš„åŒæ—¶æ‰§è¡Œselectæ“ä½œ sqlè¯­å¥ï¼š 12insert into test_notransaction values(1,&apos;peach1&apos;),(2,&apos;peach2&apos;),(3, &apos;peach3&apos;),(4, &apos;peach4&apos;); select count(*) from test_notransaction; æ“ä½œsqlå‰ï¼ŒæŸ¥çœ‹è¡¨æ•°æ® æŸ¥çœ‹test_notransactionè¡¨è·å–æƒ…å†µï¼Œshow locks; hiveåœ¨æœªå¼€å¯concurrency çš„æƒ…å†µä¸‹,show locksä¸èƒ½æ­£å¸¸è·å–è¡¨çš„é”ï¼ŒåŒæ—¶å¯¹åŒä¸€å¼ è¡¨æ‰§è¡Œinsertå’Œselectæ“ä½œæ—¶å¹¶å‘æ‰§è¡Œï¼Œè·å–æ•°æ®å–å†³äºsqlæ‰§è¡Œé€Ÿåº¦ï¼Œå› æ­¤åœ¨select çš„æ—¶å€™æœªè·å–åˆ°æ’å…¥æ•°æ®ã€‚ 2ã€æ‰§è¡Œselectæ“ä½œçš„åŒæ—¶æ‰§è¡Œinsertæ“ä½œ sqlè¯­å¥ï¼š 12select count(*) from test_notransaction; insert into test_notransaction values(1,&apos;peach1&apos;),(2,&apos;peach2&apos;),(3, &apos;peach3&apos;),(4, &apos;peach4&apos;); åœ¨æ‰§è¡Œselectçš„åŒæ—¶æ‰§è¡Œinsertæ“ä½œï¼Œæ“ä½œå¯ä»¥åŒæ—¶å¹¶è¡Œæ“ä½œï¼Œæœªäº§ç”Ÿé˜»å¡ç­‰å¾…çš„è¿‡ç¨‹ã€‚ 3ã€åŒæ—¶æ‰§è¡Œå¤šæ¡insertæ“ä½œ sqlè¯­å¥ï¼š 12insert into test_notransaction values(1,&apos;peach1&apos;),(2,&apos;peach2&apos;),(3, &apos;peach3&apos;),(4, &apos;peach4&apos;); insert into test_notransaction values(1,&apos;peach1&apos;),(2,&apos;peach2&apos;),(3, &apos;peach3&apos;),(4, &apos;peach4&apos;); åŒæ—¶æ‰§è¡Œinsertæ“ä½œæ—¶ï¼Œå¯åŒæ—¶æ‰§è¡Œæœªäº§ç”Ÿé˜»å¡ç­‰å¾…çš„è¿‡ç¨‹ã€‚ 4ã€æ‰§è¡Œupdateæ“ä½œï¼Œå°†è¡¨ä¸­user_idä¸º2çš„ç”¨æˆ·åä¿®æ”¹ä¸ºpeach22 sqlè¯­å¥ï¼š 1update test_notransaction set name=&apos;peach22&apos; where user_id=2; æ‰§è¡Œupdateæ“ä½œï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š åœ¨æœªé…ç½®hiveçš„Transactionå’ŒACIDæ—¶ï¼Œä¸æ”¯æŒupdateæ“ä½œã€‚ 5ã€æ‰§è¡Œdeleteæ“ä½œï¼Œå°†è¡¨ä¸­user_idä¸º1ä¿¡æ¯åˆ é™¤ sqlè¯­å¥ï¼š 1delete from test_notransaction where user_id=1; æ‰§è¡Œdeleteæ“ä½œï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š hiveæœªé…ç½®Transactionå’ŒACIDï¼Œä¸æ”¯æŒdeleteæ“ä½œã€‚ 6ã€æŸ¥çœ‹è¡¨è·å–é”ç±»å‹ 1show locks; æ— æ³•æ­£å¸¸æ‰§è¡Œï¼› Hiveçš„äº‹åŠ¡Hiveçš„äº‹åŠ¡é…ç½®Hiveä»0.13å¼€å§‹åŠ å…¥äº†äº‹åŠ¡æ”¯æŒï¼Œåœ¨è¡Œçº§åˆ«æä¾›å®Œæ•´çš„ACIDç‰¹æ€§ï¼ŒHiveåœ¨0.14æ—¶åŠ å…¥äº†å¯¹INSERTâ€¦VALUES,UPDATE,and DELETEçš„æ”¯æŒã€‚å¯¹äºåœ¨Hiveä¸­ä½¿ç”¨ACIDå’ŒTransactionsï¼Œä¸»è¦æœ‰ä»¥ä¸‹é™åˆ¶ï¼š ä¸æ”¯æŒBEGIN,COMMITå’ŒROLLBACK åªæ”¯æŒORCæ–‡ä»¶æ ¼å¼ è¡¨å¿…é¡»åˆ†æ¡¶ ä¸å…è®¸ä»ä¸€ä¸ªéACIDè¿æ¥å†™å…¥/è¯»å–ACIDè¡¨ ä¸ºäº†ä½¿Hiveæ”¯æŒäº‹åŠ¡æ“ä½œï¼Œéœ€å°†ä»¥ä¸‹å‚æ•°åŠ å…¥åˆ°hive-site.xmlæ–‡ä»¶ä¸­ã€‚ 123456789101112131415161718192021222324&lt;property&gt;&lt;name&gt;hive.support.concurrency&lt;/name&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;hive.enforce.bucketing&lt;/name&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;hive.exec.dynamic.partition.mode&lt;/name&gt;&lt;value&gt;nonstrict&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;hive.txn.manager&lt;/name&gt;&lt;value&gt;org.apache.hadoop.hive.ql.lockmgr.DbTxnManager&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;hive.compactor.initiator.on&lt;/name&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;property&gt;&lt;name&gt;hive.compactor.worker.threads &lt;/name&gt;&lt;value&gt;1&lt;/value&gt;&lt;/property&gt; å¯ä»¥åœ¨Cloudera Managerè¿›è¡Œä»¥ä¸‹é…ç½®ï¼š ä¸ºäº†è®©beelineæ”¯æŒè¿˜éœ€è¦é…ç½®ï¼š Hiveäº‹åŠ¡æµ‹è¯•ç¯å¢ƒå‡†å¤‡1ã€åˆ›å»ºä¸€ä¸ªæ”¯æŒACIDçš„è¡¨ å»ºè¡¨è¯­å¥ï¼š 123create table test_trancaction (user_id Int,name String) clustered by (user_id) into 3 buckets stored as orc TBLPROPERTIES ('transactional'='true'); å°†è¡¨åä¿®æ”¹ä¸ºtest_transaction 1alter table test_trancaction rename to test_transaction; 2ã€å‡†å¤‡æµ‹è¯•æ•°æ®ï¼Œå‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ® 1insert into test_transaction values(1,'peach'),(2,'peach2'),(3,'peach3'),(4,'peach4'),(5,'peach5'); ç”¨ä¾‹æµ‹è¯•1ã€æ‰§è¡Œupdateæ“ä½œï¼Œå°†user_idçš„nameä¿®æ”¹ä¸ºpeach_update sqlè¯­å¥ï¼š 1update test_transaction set name='peach_update' where user_id=1; æ‰§è¡Œä¿®æ”¹æ“ä½œï¼ŒæŸ¥çœ‹è¡¨è·å–é”ç±»å‹ æ•°æ®ä¿®æ”¹æˆåŠŸï¼Œä¸”ä¸å½±å“å…¶å®ƒæ•°æ®ã€‚ 2ã€åŒæ—¶ä¿®æ”¹åŒä¸€æ¡æ•°æ®ï¼Œå°†user_idä¸º1çš„ç”¨æˆ·åå­—ä¿®æ”¹ä¸ºpeachï¼Œå¦ä¸€æ¡sqlå°†åå­—ä¿®æ”¹ä¸ºpeach_ sqlè¯­å¥ï¼š 12update test_transaction set name='peach' where user_id=1;update test_transaction set name='peach_' where user_id=1; sqlæ‰§è¡Œé¡ºåºä¸ºpeachï¼Œå…¶æ¬¡ä¸ºpeach_ æ­¤æ—¶æŸ¥çœ‹è¡¨è·å–åˆ°çš„é” é€šè¿‡è·å–åˆ°é”åˆ†æï¼Œåœ¨åŒæ—¶ä¿®æ”¹åŒä¸€æ¡æ•°æ®æ—¶ï¼Œä¼˜å…ˆæ‰§è¡Œçš„sqlè·å–åˆ°äº†SHARED_WRITEï¼Œè€Œåæ‰§è¡Œçš„sqlè·å–é”çš„çŠ¶æ€ä¸ºWAITINGçŠ¶æ€ï¼Œè¡¨ç¤ºè¿˜æœªè·å–åˆ°SHARED_WRITEé”ï¼Œç­‰å¾…ç¬¬ä¸€æ¡sqlæ‰§è¡Œç»“æŸåæ–¹å¯è·å–åˆ°é”å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚ é€šè¿‡ä¸Šä¸æ‰§è¡Œæ“ä½œåˆ†æï¼Œæ•°æ®user_idä¸º1çš„ç”¨æˆ·åå­—åº”è¢«ä¿®æ”¹ä¸ºpeach_ 3ã€åŒæ—¶ä¿®æ”¹ä¸åŒæ•°æ®ï¼Œä¿®æ”¹idä¸º2çš„nameä¸ºpeachtestï¼Œä¿®æ”¹idä¸º3çš„nameä¸ºpeach_test sqlè¯­å¥ï¼š 12update test_transaction set name='peachtest' where user_id=2; update test_transaction set name='peach_test' where user_id=3; sqlæ‰§è¡Œé¡ºåºä¸ºpeachtestï¼Œå…¶æ¬¡ä¸ºpeach_test æ­¤æ—¶æŸ¥çœ‹è¡¨è·å–åˆ°çš„é” é€šè¿‡sqlæ“ä½œè·å–é”åˆ†æï¼Œåœ¨åŒæ—¶ä¿®æ”¹ä¸åŒæ•°æ®æ—¶ï¼Œä¼˜å…ˆæ‰§è¡Œçš„sqlè·å–åˆ°äº†SHARED_WRITEï¼Œè€Œåæ‰§è¡Œçš„sqlè·å–é”çš„çŠ¶æ€ä¸ºWAITINGçŠ¶æ€ï¼Œè¡¨ç¤ºè¿˜æœªè·å–åˆ°SHARED_WRITEé”ï¼Œç­‰å¾…ç¬¬ä¸€æ¡sqlæ‰§è¡Œç»“æŸåæ–¹å¯è·å–åˆ°é”å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚ 4ã€æ‰§è¡Œselectæ“ä½œçš„åŒæ—¶æ‰§è¡Œinsertæ“ä½œ sqlè¯­å¥ï¼š 12select count(*) from test_transaction; insert into test_transaction values(3,'peach3'); æ­¥éª¤ï¼š å…ˆæ‰§è¡Œselectæ“ä½œï¼Œå†æ‰§è¡Œinsertæ“ä½œï¼Œæ‰§è¡Œå®ŒæˆåæŸ¥çœ‹è¡¨è·å–åˆ°çš„é” ç”±äºselectå’Œinsertæ“ä½œå‡è·å–çš„æ˜¯SHARED_READé”ï¼Œè¯»é”ä¸ºå¹¶è¡Œï¼Œæ‰€ä»¥selectæŸ¥è¯¢å’ŒinsertåŒæ—¶æ‰§è¡Œï¼Œäº’ä¸å½±å“ã€‚ 5ã€updateåŒä¸€æ¡æ•°æ®çš„åŒæ—¶selectè¯¥æ¡æ•°æ® sqlè¯­å¥ï¼š 12update test_transaction set name='peach_update' where user_id=1; select * from test_transaction where user_id=1; æ­¥éª¤ï¼š å…ˆæ‰§è¡Œupdateæ“ä½œï¼Œå†æ‰§è¡Œselectæ“ä½œï¼Œè·å–æ­¤æ—¶è¡¨è·å–åˆ°çš„é” é€šè¿‡è·å–é”çš„æƒ…å†µåˆ†æï¼Œ åœ¨updateæ“ä½œæ—¶ï¼Œè·å–åˆ°SHARED_WRITEé”ï¼Œæ‰§è¡Œselectæ“ä½œæ—¶è·å–åˆ°SHARED_READé”ï¼Œåœ¨è¿›è¡Œä¿®æ”¹æ•°æ®æ—¶æœªé˜»å¡selectæŸ¥è¯¢æ“ä½œï¼Œupdateæœªæ‰§è¡Œå®Œæˆæ—¶ï¼ŒselectæŸ¥è¯¢åˆ°çš„æ•°æ®ä¸ºæœªä¿®æ”¹çš„æ•°æ®ã€‚ 6ã€æ‰§è¡Œdeleteæ“ä½œï¼Œå°†user_idä¸º3çš„æ•°æ®åˆ é™¤ sqlè¯­å¥ï¼š 1delete from test_transaction where user_id=3; æ­¥éª¤ï¼š æ‰§è¡Œdeleteæ“ä½œï¼Œè·å–æ­¤æ—¶è¡¨è·å–åˆ°çš„é” åˆ é™¤æ“ä½œè·å–åˆ°çš„æ˜¯SHARED_WRITEé” æ‰§è¡ŒæˆåŠŸåæ•°æ® 7ã€åŒæ—¶deleteåŒä¸€æ¡æ•°æ® sqlè¯­å¥ï¼š 12delete from test_transaction where user_id=3;delete from test_transaction where user_id=3; æ­¥éª¤ï¼š æŒ‰é¡ºåºæ‰§è¡Œä¸¤æ¡deleteæ“ä½œï¼ŒæŸ¥çœ‹æ­¤æ—¶è¡¨è·å–åˆ°çš„é”ï¼š é€šè¿‡æŸ¥çœ‹deleteæ“ä½œè·å–åˆ°çš„é”ï¼Œä¼˜å…ˆæ‰§è¡Œçš„æ“ä½œè·å–åˆ°SHARED_WRITEé”ï¼Œåæ‰§è¡Œçš„deleteæ“ä½œæœªè·å–åˆ°SHARED_WRITEé”ï¼Œå¤„äºWAITINGçŠ¶æ€ã€‚ æ‰§è¡Œåˆ é™¤åç»“æœ 8ã€åŒæ—¶deleteä¸¤æ¡ä¸åŒçš„æ•°æ® sqlè¯­å¥ï¼š 12delete from test_transaction where user_id=1; delete from test_transaction where user_id=5; æ­¥éª¤ï¼š æŒ‰é¡ºåºæ‰§è¡Œä¸¤æ¡deleteæ“ä½œï¼ŒæŸ¥çœ‹æ­¤æ—¶è¡¨è·å–åˆ°çš„é”ï¼š é€šè¿‡æŸ¥çœ‹deleteæ“ä½œè·å–åˆ°çš„é”ï¼Œä¼˜å…ˆæ‰§è¡Œçš„æ“ä½œè·å–åˆ°SHARED_WRITEé”ï¼Œåæ‰§è¡Œçš„deleteæ“ä½œæœªè·å–åˆ°SHARED_WRITEé”ï¼Œå¤„äºWAITINGçŠ¶æ€ã€‚ æ‰§è¡Œåˆ é™¤åç»“æœ 9ã€æ‰§è¡Œdeleteçš„åŒæ—¶å¯¹åˆ é™¤çš„æ•°æ®è¿›è¡Œupdateæ“ä½œ sqlè¯­å¥ï¼š 12delete from test_transaction where user_id=3; update test_transaction set name='test' where user_id=3; æ­¥éª¤ï¼š æŒ‰é¡ºåºæ‰§è¡Œä¸¤æ¡sqlï¼ŒæŸ¥çœ‹æ­¤æ—¶è·å–åˆ°è¡¨çš„é”ï¼š é€šè¿‡æŸ¥çœ‹deleteå’Œupdateæ“ä½œè·å–åˆ°çš„é”ï¼Œä¼˜å…ˆæ‰§è¡Œçš„æ“ä½œè·å–åˆ°SHARED_WRITEé”ï¼Œåæ‰§è¡Œçš„æ“ä½œæœªè·å–åˆ°SHARED_WRITEé”ï¼Œå¤„äºWAITINGçŠ¶æ€ã€‚ æ‰§è¡Œdeleteå’Œupdateåç»“æœ æ³¨æ„ï¼šæ­¤å¤„åœ¨deleteä¼˜å…ˆäºupdateæ‰§è¡Œï¼Œä½†æ‰§è¡Œç»“æœä¸ºupdateçš„ç»“æœï¼Œæ‰§è¡Œå¼‚å¸¸ã€‚ 10ã€æ‰§è¡Œdeleteçš„åŒæ—¶å¯¹ä¸åŒçš„æ•°æ®è¿›è¡Œupdateæ“ä½œ sqlè¯­å¥ï¼š 12delete from test_transaction where user_id=2; update test_transaction set name='test' where user_id=4; æ­¥éª¤ï¼š æŒ‰é¡ºåºæ‰§è¡Œä¸Šé¢ä¸¤æ¡sqlï¼ŒæŸ¥çœ‹è¡¨é”è·å–æƒ…å†µ é€šè¿‡æŸ¥çœ‹deleteå’Œupdateæ“ä½œè·å–åˆ°çš„é”ï¼Œä¼˜å…ˆæ‰§è¡Œçš„æ“ä½œè·å–åˆ°SHARED_WRITEé”ï¼Œåæ‰§è¡Œçš„æ“ä½œæœªè·å–åˆ°SHARED_WRITEé”ï¼Œå¤„äºWAITINGçŠ¶æ€ã€‚ æ‰§è¡Œdeleteå’Œupdateåç»“æœ,æ‰§è¡Œç»“æœæ­£å¸¸ 11ã€æ‰§è¡Œdeleteçš„åŒæ—¶æ‰§è¡Œselectæ“ä½œ sqlè¯­å¥ï¼š 12delete from test_transaction where user_id=4; select count(*) from test_transaction; æ­¥éª¤ï¼š æŒ‰é¡ºåºæ‰§è¡Œä¸Šé¢ä¸¤æ¡sqlï¼ŒæŸ¥çœ‹è¡¨é”è·å–æƒ…å†µ åœ¨æ“ä½œdeleteçš„åŒæ—¶æ‰§è¡Œselectæ“ä½œï¼Œä¸¤ä¸ªæ“ä½œå‡åŒæ—¶è·å–åˆ°SHARED_REDå’ŒSHARED_WRITEé”ï¼Œæ“ä½œå¹¶è¡Œè¿›è¡Œæœªå‡ºç°é˜»å¡ã€‚æ€»ç»“å¯¹æ¯”Hiveäº‹åŠ¡ä½¿ç”¨å»ºè®® ä¼ ç»Ÿæ•°æ®åº“ä¸­æœ‰ä¸‰ç§æ¨¡å‹éšå¼äº‹åŠ¡ã€æ˜¾ç¤ºäº‹åŠ¡å’Œè‡ªåŠ¨äº‹åŠ¡ã€‚åœ¨ç›®å‰Hiveå¯¹äº‹åŠ¡ä»…æ”¯æŒè‡ªåŠ¨äº‹åŠ¡ï¼Œå› æ­¤Hiveæ— æ³•é€šè¿‡æ˜¾ç¤ºäº‹åŠ¡çš„æ–¹å¼å¯¹ä¸€ä¸ªæ“ä½œåºåˆ—è¿›è¡Œäº‹åŠ¡æ§åˆ¶ã€‚ ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡åœ¨é‡åˆ°å¼‚å¸¸æƒ…å†µå¯è‡ªåŠ¨è¿›è¡Œå›æ»šï¼Œç›®å‰Hiveæ— æ³•æ”¯æŒROLLBACKã€‚ ä¼ ç»Ÿæ•°æ®åº“ä¸­æ”¯æŒäº‹åŠ¡å¹¶å‘ï¼Œè€ŒHiveå¯¹äº‹åŠ¡æ— æ³•åšåˆ°å®Œå…¨å¹¶å‘æ§åˆ¶,å¤šä¸ªæ“ä½œå‡éœ€è¦è·å–WRITEçš„æ—¶å€™åˆ™è¿™äº›æ“ä½œä¸ºä¸²è¡Œæ¨¡å¼æ‰§è¡Œï¼ˆåœ¨æµ‹è¯•ç”¨ä¾‹ä¸­â€deleteåŒä¸€æ¡æ•°æ®çš„åŒæ—¶updateè¯¥æ•°æ®â€ï¼Œæ“ä½œæ˜¯ä¸²è¡Œçš„ä¸”æ“ä½œå®Œæˆåæ•°æ®æœªè¢«åˆ é™¤ä¸”æ•°æ®è¢«ä¿®æ”¹ï¼‰æœªä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ Hiveçš„äº‹åŠ¡åŠŸèƒ½å°šå±äºå®éªŒå®¤åŠŸèƒ½ï¼Œå¹¶ä¸å»ºè®®ç”¨æˆ·ç›´æ¥ä¸Šç”Ÿäº§ç³»ç»Ÿï¼Œå› ä¸ºç›®å‰å®ƒè¿˜æœ‰è¯¸å¤šçš„é™åˆ¶ï¼Œå¦‚åªæ”¯æŒORCæ–‡ä»¶æ ¼å¼ï¼Œå»ºè¡¨å¿…é¡»åˆ†æ¡¶ç­‰ï¼Œä½¿ç”¨èµ·æ¥æ²¡æœ‰é‚£ä¹ˆæ–¹ä¾¿ï¼Œå¦å¤–è¯¥åŠŸèƒ½çš„ç¨³å®šæ€§è¿˜æœ‰å¾…è¿›ä¸€æ­¥éªŒè¯ã€‚ CDHé»˜è®¤å¼€å¯äº†Hiveçš„ConcurrencyåŠŸèƒ½ï¼Œä¸»è¦æ˜¯å¯¹å¹¶å‘è¯»å†™çš„çš„æ—¶å€™é€šè¿‡é”è¿›è¡Œäº†æ§åˆ¶ã€‚æ‰€ä»¥ä¸ºäº†é˜²æ­¢ç”¨æˆ·åœ¨ä½¿ç”¨Hiveçš„æ—¶å€™ï¼ŒæŠ¥é”™æç¤ºè¯¥è¡¨å·²ç»è¢«lockï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ä¸å‹å¥½ï¼Œå»ºè®®åœ¨ä¸šåŠ¡ä¾§æ§åˆ¶ä¸€ä¸‹å†™å…¥å’Œè¯»å–ï¼Œæ¯”å¦‚å†™å…¥åŒä¸€ä¸ªtableæˆ–è€…partitionçš„æ—¶å€™ä¿è¯æ˜¯å•ä»»åŠ¡å†™å…¥ï¼Œå…¶ä»–å†™å…¥éœ€æ§åˆ¶å†™å®Œç¬¬ä¸€ä¸ªä»»åŠ¡äº†ï¼Œåé¢æ‰ç»§ç»­å†™ï¼Œå¹¶ä¸”æ§åˆ¶åœ¨å†™çš„æ—¶å€™ä¸è®©ç”¨æˆ·è¿›è¡ŒæŸ¥è¯¢ã€‚å¦å¤–éœ€è¦æ§åˆ¶åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¸è¦å…è®¸æœ‰å†™å…¥æ“ä½œã€‚ å¦‚æœå¯¹äºæ•°æ®ä¸€è‡´æ€§ä¸åœ¨ä¹ï¼Œå¯ä»¥å®Œå…¨å…³é—­Hiveçš„ConcurrencyåŠŸèƒ½å…³é—­ï¼Œå³è®¾ç½®hive.support.concurrencyä¸ºfalseï¼Œè¿™æ ·Hiveçš„å¹¶å‘è¯»å†™å°†æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚","raw":null,"content":null,"categories":[{"name":"hive","slug":"hive","permalink":"https://stanxia.github.io/categories/hive/"}],"tags":[{"name":"hive","slug":"hive","permalink":"https://stanxia.github.io/tags/hive/"},{"name":"acid","slug":"acid","permalink":"https://stanxia.github.io/tags/acid/"}]},{"title":"SparkSQL-Catalystä¼˜åŒ–ç†è§£","slug":"SparkSQL-Catalystä¼˜åŒ–ç†è§£","date":"2017-11-30T11:32:26.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/11/30/SparkSQL-Catalystä¼˜åŒ–ç†è§£/","link":"","permalink":"https://stanxia.github.io/2017/11/30/SparkSQL-Catalystä¼˜åŒ–ç†è§£/","excerpt":"å‰è¨€\næœ¬æ–‡ä¸»è¦ä»‹ç»SparkSQLçš„ä¼˜åŒ–å™¨ç³»ç»ŸCatalystï¼Œå…¶è®¾è®¡æ€è·¯åŸºæœ¬éƒ½æ¥è‡ªäºä¼ ç»Ÿå‹æ•°æ®åº“ï¼Œè€Œä¸”å’Œå¤§å¤šæ•°å½“å‰çš„å¤§æ•°æ®SQLå¤„ç†å¼•æ“è®¾è®¡åŸºæœ¬ç›¸åŒï¼ˆImpalaã€Prestoã€Hiveï¼ˆCalciteï¼‰ç­‰ï¼‰ã€‚\nSQLä¼˜åŒ–å™¨æ ¸å¿ƒæ‰§è¡Œç­–ç•¥ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªå¤§çš„æ–¹å‘ï¼š\n\nåŸºäºè§„åˆ™ä¼˜åŒ–ï¼ˆRBOï¼‰ï¼šæ˜¯ä¸€ç§ç»éªŒå¼ã€å¯å‘å¼åœ°ä¼˜åŒ–æ€è·¯ï¼Œæ›´å¤šåœ°ä¾é å‰è¾ˆæ€»ç»“å‡ºæ¥çš„ä¼˜åŒ–è§„åˆ™ï¼Œç®€å•æ˜“è¡Œä¸”èƒ½å¤Ÿè¦†ç›–åˆ°å¤§éƒ¨åˆ†ä¼˜åŒ–é€»è¾‘ï¼Œä½†æ˜¯å¯¹äºæ ¸å¿ƒä¼˜åŒ–ç®—å­Joinå´æ˜¾å¾—æœ‰ç‚¹åŠ›ä¸ä»å¿ƒã€‚\nåŸºäºä»£ä»·ä¼˜åŒ– (CBO)ï¼šæ ¹æ®ä»£ä»·ä¼°ç®—ç¡®å®šä¸€ç§ä»£ä»·æœ€å°çš„æ–¹æ¡ˆã€‚\n\nä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸¤ä¸ªè¡¨æ‰§è¡ŒJoinåˆ°åº•åº”è¯¥ä½¿ç”¨BroadcastHashJoinè¿˜æ˜¯SortMergeJoinï¼Ÿå½“å‰SparkSQLçš„æ–¹å¼æ˜¯é€šè¿‡æ‰‹å·¥è®¾å®šå‚æ•°æ¥ç¡®å®šï¼Œå¦‚æœä¸€ä¸ªè¡¨çš„æ•°æ®é‡å°äºè¿™ä¸ªå€¼å°±ä½¿ç”¨BroadcastHashJoinï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆæ˜¾å¾—å¾ˆä¸ä¼˜é›…ï¼Œå¾ˆä¸çµæ´»ã€‚åŸºäºä»£ä»·ä¼˜åŒ–å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜ï¼Œå®ƒä¼šé’ˆå¯¹æ¯ä¸ªJoinè¯„ä¼°å½“å‰ä¸¤å¼ è¡¨ä½¿ç”¨æ¯ç§Joinç­–ç•¥çš„ä»£ä»·ï¼Œæ ¹æ®ä»£ä»·ä¼°ç®—ç¡®å®šä¸€ç§ä»£ä»·æœ€å°çš„æ–¹æ¡ˆã€‚","text":"å‰è¨€ æœ¬æ–‡ä¸»è¦ä»‹ç»SparkSQLçš„ä¼˜åŒ–å™¨ç³»ç»ŸCatalystï¼Œå…¶è®¾è®¡æ€è·¯åŸºæœ¬éƒ½æ¥è‡ªäºä¼ ç»Ÿå‹æ•°æ®åº“ï¼Œè€Œä¸”å’Œå¤§å¤šæ•°å½“å‰çš„å¤§æ•°æ®SQLå¤„ç†å¼•æ“è®¾è®¡åŸºæœ¬ç›¸åŒï¼ˆImpalaã€Prestoã€Hiveï¼ˆCalciteï¼‰ç­‰ï¼‰ã€‚ SQLä¼˜åŒ–å™¨æ ¸å¿ƒæ‰§è¡Œç­–ç•¥ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªå¤§çš„æ–¹å‘ï¼š åŸºäºè§„åˆ™ä¼˜åŒ–ï¼ˆRBOï¼‰ï¼šæ˜¯ä¸€ç§ç»éªŒå¼ã€å¯å‘å¼åœ°ä¼˜åŒ–æ€è·¯ï¼Œæ›´å¤šåœ°ä¾é å‰è¾ˆæ€»ç»“å‡ºæ¥çš„ä¼˜åŒ–è§„åˆ™ï¼Œç®€å•æ˜“è¡Œä¸”èƒ½å¤Ÿè¦†ç›–åˆ°å¤§éƒ¨åˆ†ä¼˜åŒ–é€»è¾‘ï¼Œä½†æ˜¯å¯¹äºæ ¸å¿ƒä¼˜åŒ–ç®—å­Joinå´æ˜¾å¾—æœ‰ç‚¹åŠ›ä¸ä»å¿ƒã€‚ åŸºäºä»£ä»·ä¼˜åŒ– (CBO)ï¼šæ ¹æ®ä»£ä»·ä¼°ç®—ç¡®å®šä¸€ç§ä»£ä»·æœ€å°çš„æ–¹æ¡ˆã€‚ ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸¤ä¸ªè¡¨æ‰§è¡ŒJoinåˆ°åº•åº”è¯¥ä½¿ç”¨BroadcastHashJoinè¿˜æ˜¯SortMergeJoinï¼Ÿå½“å‰SparkSQLçš„æ–¹å¼æ˜¯é€šè¿‡æ‰‹å·¥è®¾å®šå‚æ•°æ¥ç¡®å®šï¼Œå¦‚æœä¸€ä¸ªè¡¨çš„æ•°æ®é‡å°äºè¿™ä¸ªå€¼å°±ä½¿ç”¨BroadcastHashJoinï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆæ˜¾å¾—å¾ˆä¸ä¼˜é›…ï¼Œå¾ˆä¸çµæ´»ã€‚åŸºäºä»£ä»·ä¼˜åŒ–å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç±»é—®é¢˜ï¼Œå®ƒä¼šé’ˆå¯¹æ¯ä¸ªJoinè¯„ä¼°å½“å‰ä¸¤å¼ è¡¨ä½¿ç”¨æ¯ç§Joinç­–ç•¥çš„ä»£ä»·ï¼Œæ ¹æ®ä»£ä»·ä¼°ç®—ç¡®å®šä¸€ç§ä»£ä»·æœ€å°çš„æ–¹æ¡ˆã€‚ Tree&amp;Ruleåœ¨ä»‹ç»SQLä¼˜åŒ–å™¨å·¥ä½œåŸç†ä¹‹å‰ï¼Œæœ‰å¿…è¦é¦–å…ˆä»‹ç»ä¸¤ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ï¼šTreeå’ŒRuleã€‚SQLè¯­æ³•æ ‘å°±æ˜¯SQLè¯­å¥é€šè¿‡ç¼–è¯‘å™¨ä¹‹åä¼šè¢«è§£ææˆä¸€æ£µæ ‘çŠ¶ç»“æ„ã€‚è¿™æ£µæ ‘ä¼šåŒ…å«å¾ˆå¤šèŠ‚ç‚¹å¯¹è±¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ‹¥æœ‰ç‰¹å®šçš„æ•°æ®ç±»å‹ï¼ŒåŒæ—¶ä¼šæœ‰0ä¸ªæˆ–å¤šä¸ªå­©å­èŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹å¯¹è±¡åœ¨ä»£ç ä¸­å®šä¹‰ä¸ºTreeNodeå¯¹è±¡ï¼‰ï¼Œä¸‹å›¾æ˜¯ä¸ªç®€å•çš„ç¤ºä¾‹ï¼šå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç®­å¤´å·¦è¾¹è¡¨è¾¾å¼æœ‰3ç§æ•°æ®ç±»å‹ï¼ˆLiteralè¡¨ç¤ºå¸¸é‡ã€Attributeè¡¨ç¤ºå˜é‡ã€Addè¡¨ç¤ºåŠ¨ä½œï¼‰ï¼Œè¡¨ç¤ºx+(1+2)ã€‚æ˜ å°„åˆ°å³è¾¹æ ‘çŠ¶ç»“æ„åï¼Œæ¯ä¸€ç§æ•°æ®ç±»å‹å°±ä¼šå˜æˆä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦å¤–ï¼ŒTreeè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡ä¸€å®šçš„è§„åˆ™è¿›è¡Œç­‰ä»·å˜æ¢ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸Šå›¾å®šä¹‰äº†ä¸€ä¸ªç­‰ä»·å˜æ¢è§„åˆ™(Rule)ï¼šä¸¤ä¸ªIntegerç±»å‹çš„å¸¸é‡ç›¸åŠ å¯ä»¥ç­‰ä»·è½¬æ¢ä¸ºä¸€ä¸ªIntegerå¸¸é‡ï¼Œè¿™ä¸ªè§„åˆ™å…¶å®å¾ˆç®€å•ï¼Œå¯¹äºä¸Šæ–‡ä¸­æåˆ°çš„è¡¨è¾¾å¼x+(1+2)æ¥è¯´å°±å¯ä»¥è½¬å˜ä¸ºx+3ã€‚å¯¹äºç¨‹åºæ¥è®²ï¼Œå¦‚ä½•æ‰¾åˆ°ä¸¤ä¸ªIntegerå¸¸é‡å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç®€å•çš„äºŒå‰æ ‘éå†ç®—æ³•ï¼Œæ¯éå†åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ¨¡å¼åŒ¹é…å½“å‰èŠ‚ç‚¹ä¸ºAddã€å·¦å³å­èŠ‚ç‚¹æ˜¯Integerå¸¸é‡çš„ç»“æ„ï¼Œå®šä½åˆ°ä¹‹åå°†æ­¤ä¸‰ä¸ªèŠ‚ç‚¹æ›¿æ¢ä¸ºä¸€ä¸ªLiteralç±»å‹çš„èŠ‚ç‚¹ã€‚ ä¸Šé¢ç”¨ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹æ¥è¯´æ˜ç­‰ä»·å˜æ¢è§„åˆ™ä»¥åŠå¦‚ä½•å°†è§„åˆ™åº”ç”¨äºè¯­æ³•æ ‘ã€‚åœ¨ä»»ä½•ä¸€ä¸ªSQLä¼˜åŒ–å™¨ä¸­ï¼Œé€šå¸¸ä¼šå®šä¹‰å¤§é‡çš„Ruleï¼ˆåé¢ä¼šè®²åˆ°ï¼‰ï¼ŒSQLä¼˜åŒ–å™¨ä¼šéå†è¯­æ³•æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼Œé’ˆå¯¹éå†åˆ°çš„èŠ‚ç‚¹æ¨¡å¼åŒ¹é…æ‰€æœ‰ç»™å®šè§„åˆ™ï¼ˆRuleï¼‰ï¼Œå¦‚æœæœ‰åŒ¹é…æˆåŠŸçš„ï¼Œå°±è¿›è¡Œç›¸åº”è½¬æ¢ï¼Œå¦‚æœæ‰€æœ‰è§„åˆ™éƒ½åŒ¹é…å¤±è´¥ï¼Œå°±ç»§ç»­éå†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚Catalystå·¥ä½œæµç¨‹ä»»ä½•ä¸€ä¸ªä¼˜åŒ–å™¨å·¥ä½œåŸç†éƒ½å¤§åŒå°å¼‚ï¼šSQLè¯­å¥é¦–å…ˆé€šè¿‡Parseræ¨¡å—è¢«è§£æä¸ºè¯­æ³•æ ‘ï¼Œæ­¤æ£µæ ‘ç§°ä¸ºUnresolved Logical Planï¼›Unresolved Logical Plané€šè¿‡Analyzeræ¨¡å—å€ŸåŠ©äºæ•°æ®å…ƒæ•°æ®è§£æä¸ºLogical Planï¼›æ­¤æ—¶å†é€šè¿‡å„ç§åŸºäºè§„åˆ™çš„ä¼˜åŒ–ç­–ç•¥è¿›è¡Œæ·±å…¥ä¼˜åŒ–ï¼Œå¾—åˆ°Optimized Logical Planï¼›ä¼˜åŒ–åçš„é€»è¾‘æ‰§è¡Œè®¡åˆ’ä¾ç„¶æ˜¯é€»è¾‘çš„ï¼Œå¹¶ä¸èƒ½è¢«Sparkç³»ç»Ÿç†è§£ï¼Œæ­¤æ—¶éœ€è¦å°†æ­¤é€»è¾‘æ‰§è¡Œè®¡åˆ’è½¬æ¢ä¸ºPhysical Planï¼›ä¸ºäº†æ›´å¥½çš„å¯¹æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œç†è§£ï¼Œä¸‹æ–‡é€šè¿‡ä¸€ä¸ªç®€å•ç¤ºä¾‹è¿›è¡Œè§£é‡Šã€‚ ParserParserç®€å•æ¥è¯´æ˜¯å°†SQLå­—ç¬¦ä¸²åˆ‡åˆ†æˆä¸€ä¸ªä¸€ä¸ªTokenï¼Œå†æ ¹æ®ä¸€å®šè¯­ä¹‰è§„åˆ™è§£æä¸ºä¸€æ£µè¯­æ³•æ ‘ã€‚Parseræ¨¡å—ç›®å‰åŸºæœ¬éƒ½ä½¿ç”¨ç¬¬ä¸‰æ–¹ç±»åº“ANTLRè¿›è¡Œå®ç°ï¼Œæ¯”å¦‚Hiveã€ Prestoã€SparkSQLç­‰ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªç¤ºä¾‹æ€§çš„SQLè¯­å¥ï¼ˆæœ‰ä¸¤å¼ è¡¨ï¼Œå…¶ä¸­peopleè¡¨ä¸»è¦å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œscoreè¡¨å­˜å‚¨ç”¨æˆ·çš„å„ç§æˆç»©ï¼‰ï¼Œé€šè¿‡Parserè§£æåçš„ASTè¯­æ³•æ ‘å¦‚å›¾æ‰€ç¤ºï¼š Analyzeré€šè¿‡è§£æåçš„é€»è¾‘æ‰§è¡Œè®¡åˆ’åŸºæœ¬æœ‰äº†éª¨æ¶ï¼Œä½†æ˜¯ç³»ç»Ÿå¹¶ä¸çŸ¥é“scoreã€sumè¿™äº›éƒ½æ˜¯äº›ä»€ä¹ˆé¬¼ï¼Œæ­¤æ—¶éœ€è¦åŸºæœ¬çš„å…ƒæ•°æ®ä¿¡æ¯æ¥è¡¨è¾¾è¿™äº›è¯ç´ ï¼Œæœ€é‡è¦çš„å…ƒæ•°æ®ä¿¡æ¯ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šè¡¨çš„Schemeå’ŒåŸºæœ¬å‡½æ•°ä¿¡æ¯ï¼Œè¡¨çš„schemeä¸»è¦åŒ…æ‹¬è¡¨çš„åŸºæœ¬å®šä¹‰ï¼ˆåˆ—åã€æ•°æ®ç±»å‹ï¼‰ã€è¡¨çš„æ•°æ®æ ¼å¼ï¼ˆJsonã€Textï¼‰ã€è¡¨çš„ç‰©ç†ä½ç½®ç­‰ï¼ŒåŸºæœ¬å‡½æ•°ä¿¡æ¯ä¸»è¦æŒ‡ç±»ä¿¡æ¯ã€‚ Analyzerä¼šå†æ¬¡éå†æ•´ä¸ªè¯­æ³•æ ‘ï¼Œå¯¹æ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œæ•°æ®ç±»å‹ç»‘å®šä»¥åŠå‡½æ•°ç»‘å®šï¼Œæ¯”å¦‚peopleè¯ç´ ä¼šæ ¹æ®å…ƒæ•°æ®è¡¨ä¿¡æ¯è§£æä¸ºåŒ…å«ageã€idä»¥åŠnameä¸‰åˆ—çš„è¡¨ï¼Œpeople.ageä¼šè¢«è§£æä¸ºæ•°æ®ç±»å‹ä¸ºintçš„å˜é‡ï¼Œsumä¼šè¢«è§£æä¸ºç‰¹å®šçš„èšåˆå‡½æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š SparkSQLä¸­Analyzerå®šä¹‰äº†å„ç§è§£æè§„åˆ™ï¼Œå¯ä»¥æŸ¥çœ‹Analyzerç±»ï¼Œå…¶ä¸­å®šä¹‰äº†åŸºæœ¬çš„è§£æè§„åˆ™ï¼Œå¦‚ä¸‹ï¼š Optimizerä¼˜åŒ–å™¨æ˜¯æ•´ä¸ªCatalystçš„æ ¸å¿ƒï¼Œä¸Šæ–‡æåˆ°ä¼˜åŒ–å™¨åˆ†ä¸ºåŸºäºè§„åˆ™ä¼˜åŒ–å’ŒåŸºäºä»£ä»·ä¼˜åŒ–ä¸¤ç§ï¼Œå½“å‰SparkSQL 2.1ä¾ç„¶æ²¡æœ‰å¾ˆå¥½çš„æ”¯æŒåŸºäºä»£ä»·ä¼˜åŒ–ï¼Œæ­¤å¤„åªä»‹ç»åŸºäºè§„åˆ™çš„ä¼˜åŒ–ç­–ç•¥ï¼ŒåŸºäºè§„åˆ™çš„ä¼˜åŒ–ç­–ç•¥å®é™…ä¸Šå°±æ˜¯å¯¹è¯­æ³•æ ‘è¿›è¡Œä¸€æ¬¡éå†ï¼Œæ¨¡å¼åŒ¹é…èƒ½å¤Ÿæ»¡è¶³ç‰¹å®šè§„åˆ™çš„èŠ‚ç‚¹ï¼Œå†è¿›è¡Œç›¸åº”çš„ç­‰ä»·è½¬æ¢ã€‚å› æ­¤ï¼ŒåŸºäºè§„åˆ™ä¼˜åŒ–è¯´åˆ°åº•å°±æ˜¯ä¸€æ£µæ ‘ç­‰ä»·åœ°è½¬æ¢ä¸ºå¦ä¸€æ£µæ ‘ã€‚SQLä¸­ç»å…¸çš„ä¼˜åŒ–è§„åˆ™æœ‰å¾ˆå¤šï¼Œä¸‹æ–‡ç»“åˆç¤ºä¾‹ä»‹ç»ä¸‰ç§æ¯”è¾ƒå¸¸è§çš„è§„åˆ™ï¼š è°“è¯ä¸‹æ¨ï¼ˆPredicate Pushdownï¼‰ å¸¸é‡ç´¯åŠ ï¼ˆConstant Foldingï¼‰ åˆ—å€¼è£å‰ªï¼ˆColumn Pruningï¼‰ ä¸Šå›¾å·¦è¾¹æ˜¯ç»è¿‡Analyzerè§£æåçš„è¯­æ³•æ ‘ï¼Œè¯­æ³•æ ‘ä¸­ä¸¤ä¸ªè¡¨å…ˆåšjoinï¼Œä¹‹åå†ä½¿ç”¨age&gt;10å¯¹ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚å¤§å®¶çŸ¥é“joinç®—å­é€šå¸¸æ˜¯ä¸€ä¸ªéå¸¸è€—æ—¶çš„ç®—å­ï¼Œè€—æ—¶å¤šå°‘ä¸€èˆ¬å–å†³äºå‚ä¸joinçš„ä¸¤ä¸ªè¡¨çš„å¤§å°ï¼Œå¦‚æœèƒ½å¤Ÿå‡å°‘å‚ä¸joinä¸¤è¡¨çš„å¤§å°ï¼Œå°±å¯ä»¥å¤§å¤§é™ä½joinç®—å­æ‰€éœ€æ—¶é—´ã€‚è°“è¯ä¸‹æ¨å°±æ˜¯è¿™æ ·ä¸€ç§åŠŸèƒ½ï¼Œå®ƒä¼šå°†è¿‡æ»¤æ“ä½œä¸‹æ¨åˆ°joinä¹‹å‰è¿›è¡Œï¼Œä¸Šå›¾ä¸­è¿‡æ»¤æ¡ä»¶age&gt;0ä»¥åŠid!=nullä¸¤ä¸ªæ¡ä»¶å°±åˆ†åˆ«ä¸‹æ¨åˆ°äº†joinä¹‹å‰ã€‚è¿™æ ·ï¼Œç³»ç»Ÿåœ¨æ‰«ææ•°æ®çš„æ—¶å€™å°±å¯¹æ•°æ®è¿›è¡Œäº†è¿‡æ»¤ï¼Œå‚ä¸joinçš„æ•°æ®é‡å°†ä¼šå¾—åˆ°æ˜¾è‘—çš„å‡å°‘ï¼Œjoinè€—æ—¶å¿…ç„¶ä¹Ÿä¼šé™ä½ã€‚ å¸¸é‡ç´¯åŠ å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸Šæ–‡ä¸­æåˆ°çš„è§„åˆ™ x+(1+2) -&gt; x+3ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªå¾ˆå°çš„æ”¹åŠ¨ï¼Œä½†æ˜¯æ„ä¹‰å·¨å¤§ã€‚ç¤ºä¾‹å¦‚æœæ²¡æœ‰è¿›è¡Œä¼˜åŒ–çš„è¯ï¼Œæ¯ä¸€æ¡ç»“æœéƒ½éœ€è¦æ‰§è¡Œä¸€æ¬¡100+80çš„æ“ä½œï¼Œç„¶åå†ä¸å˜é‡math_scoreä»¥åŠenglish_scoreç›¸åŠ ï¼Œè€Œä¼˜åŒ–åå°±ä¸éœ€è¦å†æ‰§è¡Œ100+80æ“ä½œã€‚ åˆ—å€¼è£å‰ªæ˜¯å¦ä¸€ä¸ªç»å…¸çš„è§„åˆ™ï¼Œç¤ºä¾‹ä¸­å¯¹äºpeopleè¡¨æ¥è¯´ï¼Œå¹¶ä¸éœ€è¦æ‰«æå®ƒçš„æ‰€æœ‰åˆ—å€¼ï¼Œè€Œåªéœ€è¦åˆ—å€¼idï¼Œæ‰€ä»¥åœ¨æ‰«æpeopleä¹‹åéœ€è¦å°†å…¶ä»–åˆ—è¿›è¡Œè£å‰ªï¼Œåªç•™ä¸‹åˆ—idã€‚è¿™ä¸ªä¼˜åŒ–ä¸€æ–¹é¢å¤§å¹…åº¦å‡å°‘äº†ç½‘ç»œã€å†…å­˜æ•°æ®é‡æ¶ˆè€—ï¼Œå¦ä¸€æ–¹é¢å¯¹äºåˆ—å­˜æ•°æ®åº“ï¼ˆParquetï¼‰æ¥è¯´å¤§å¤§æé«˜äº†æ‰«ææ•ˆç‡ã€‚ é™¤æ­¤ä¹‹å¤–ï¼ŒCatalystè¿˜å®šä¹‰äº†å¾ˆå¤šå…¶ä»–ä¼˜åŒ–è§„åˆ™ï¼Œå¯ä»¥æŸ¥çœ‹Optimizerç±»ï¼Œä¸‹å›¾ç®€å•çš„æˆªå–ä¸€éƒ¨åˆ†è§„åˆ™ï¼š è‡³æ­¤ï¼Œé€»è¾‘æ‰§è¡Œè®¡åˆ’å·²ç»å¾—åˆ°äº†æ¯”è¾ƒå®Œå–„çš„ä¼˜åŒ–ï¼Œç„¶è€Œï¼Œé€»è¾‘æ‰§è¡Œè®¡åˆ’ä¾ç„¶æ²¡åŠæ³•çœŸæ­£æ‰§è¡Œï¼Œä»–ä»¬åªæ˜¯é€»è¾‘ä¸Šå¯è¡Œï¼Œå®é™…ä¸ŠSparkå¹¶ä¸çŸ¥é“å¦‚ä½•å»æ‰§è¡Œè¿™ä¸ªä¸œè¥¿ã€‚æ¯”å¦‚Joinåªæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œä»£è¡¨ä¸¤ä¸ªè¡¨æ ¹æ®ç›¸åŒçš„idè¿›è¡Œåˆå¹¶ï¼Œç„¶è€Œå…·ä½“æ€ä¹ˆå®ç°è¿™ä¸ªåˆå¹¶ï¼Œé€»è¾‘æ‰§è¡Œè®¡åˆ’å¹¶æ²¡æœ‰è¯´æ˜ã€‚ æ­¤æ—¶å°±éœ€è¦å°†é€»è¾‘æ‰§è¡Œè®¡åˆ’è½¬æ¢ä¸ºç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼Œå°†é€»è¾‘ä¸Šå¯è¡Œçš„æ‰§è¡Œè®¡åˆ’å˜ä¸ºSparkå¯ä»¥çœŸæ­£æ‰§è¡Œçš„è®¡åˆ’ã€‚æ¯”å¦‚Joinç®—å­ï¼ŒSparkæ ¹æ®ä¸åŒåœºæ™¯ä¸ºè¯¥ç®—å­åˆ¶å®šäº†ä¸åŒçš„ç®—æ³•ç­–ç•¥ï¼Œæœ‰BroadcastHashJoinã€ShuffleHashJoinä»¥åŠSortMergeJoinç­‰ï¼ˆå¯ä»¥å°†Joinç†è§£ä¸ºä¸€ä¸ªæ¥å£ï¼ŒBroadcastHashJoinæ˜¯å…¶ä¸­ä¸€ä¸ªå…·ä½“å®ç°ï¼‰ï¼Œç‰©ç†æ‰§è¡Œè®¡åˆ’å®é™…ä¸Šå°±æ˜¯åœ¨è¿™äº›å…·ä½“å®ç°ä¸­æŒ‘é€‰ä¸€ä¸ªè€—æ—¶æœ€å°çš„ç®—æ³•å®ç°ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°åŸºäºä»£ä»·ä¼˜åŒ–ç­–ç•¥ã€‚æŸ¥çœ‹SparkSQLæ‰§è¡Œè®¡åˆ’è‡³æ­¤ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å®Œæ•´çš„ä»‹ç»äº†Catalystçš„æ•´ä¸ªå·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬Parseré˜¶æ®µã€Analyzeré˜¶æ®µã€Optimizeé˜¶æ®µä»¥åŠPhysical Planningé˜¶æ®µã€‚æœ‰åŒå­¦å¯èƒ½ä¼šæ¯”è¾ƒæ„Ÿå…´è¶£Sparkç¯å¢ƒä¸‹å¦‚ä½•æŸ¥çœ‹ä¸€æ¡å…·ä½“çš„SQLçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œåœ¨æ­¤ä»‹ç»ä¸¤ç§æ–¹æ³•ï¼š æŸ¥çœ‹é€»è¾‘æ‰§è¡Œè®¡åˆ’ä½¿ç”¨queryExecutionæ–¹æ³•æŸ¥çœ‹é€»è¾‘æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š æŸ¥çœ‹ç‰©ç†æ‰§è¡Œè®¡åˆ’ä½¿ç”¨explainæ–¹æ³•æŸ¥çœ‹ç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼š Spark WebUIè¿›è¡ŒæŸ¥çœ‹","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"},{"name":"sparkSQL","slug":"sparkSQL","permalink":"https://stanxia.github.io/tags/sparkSQL/"},{"name":"catalyst","slug":"catalyst","permalink":"https://stanxia.github.io/tags/catalyst/"}]},{"title":"sparkå®¹é”™æœºåˆ¶","slug":"sparkå®¹é”™æœºåˆ¶","date":"2017-11-29T17:16:32.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/11/29/sparkå®¹é”™æœºåˆ¶/","link":"","permalink":"https://stanxia.github.io/2017/11/29/sparkå®¹é”™æœºåˆ¶/","excerpt":"å¼•è¨€\nä¸€èˆ¬æ¥è¯´ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†çš„å®¹é”™æ€§æœ‰ä¸¤ç§æ–¹å¼ï¼š æ•°æ®æ£€æŸ¥ç‚¹ å’Œ è®°å½•æ•°æ®çš„æ›´æ–° ã€‚é¢å‘å¤§è§„æ¨¡æ•°æ®åˆ†æï¼Œæ•°æ®æ£€æŸ¥ç‚¹æ“ä½œæˆæœ¬å¾ˆé«˜ï¼Œéœ€è¦é€šè¿‡æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œè¿æ¥åœ¨æœºå™¨ä¹‹é—´å¤åˆ¶åºå¤§çš„æ•°æ®é›†ï¼Œè€Œç½‘ç»œå¸¦å®½å¾€å¾€æ¯”å†…å­˜å¸¦å®½ä½å¾—å¤šï¼ŒåŒæ—¶è¿˜éœ€è¦æ¶ˆè€—æ›´å¤šçš„å­˜å‚¨èµ„æºã€‚å› æ­¤ï¼ŒSparké€‰æ‹©è®°å½•æ›´æ–°çš„æ–¹å¼ã€‚\nä½†æ˜¯ï¼Œå¦‚æœæ›´æ–°ç²’åº¦å¤ªç»†å¤ªå¤šï¼Œé‚£ä¹ˆè®°å½•æ›´æ–°æˆæœ¬ä¹Ÿä¸ä½ã€‚å› æ­¤ï¼ŒRDDåªæ”¯æŒç²—ç²’åº¦è½¬æ¢ï¼Œå³åªè®°å½•å•ä¸ªå—ä¸Šæ‰§è¡Œçš„å•ä¸ªæ“ä½œï¼Œç„¶åå°†åˆ›å»ºRDDçš„ä¸€ç³»åˆ—å˜æ¢åºåˆ—ï¼ˆæ¯ä¸ªRDDéƒ½åŒ…å«äº†ä»–æ˜¯å¦‚ä½•ç”±å…¶ä»–RDDå˜æ¢è¿‡æ¥çš„ä»¥åŠå¦‚ä½•é‡å»ºæŸä¸€å—æ•°æ®çš„ä¿¡æ¯ã€‚å› æ­¤RDDçš„å®¹é”™æœºåˆ¶åˆç§°â€œè¡€ç»Ÿ(Lineage)â€å®¹é”™ï¼‰è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿æ¢å¤ä¸¢å¤±çš„åˆ†åŒºã€‚ \nLineageæœ¬è´¨ä¸Šå¾ˆç±»ä¼¼äºæ•°æ®åº“ä¸­çš„é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰ï¼Œåªä¸è¿‡è¿™ä¸ªé‡åšæ—¥å¿—ç²’åº¦å¾ˆå¤§ï¼Œæ˜¯å¯¹å…¨å±€æ•°æ®åšåŒæ ·çš„é‡åšè¿›è€Œæ¢å¤æ•°æ®ã€‚Lineageæœºåˆ¶\nLineageç®€ä»‹ç›¸æ¯”å…¶ä»–ç³»ç»Ÿçš„ç»†é¢—ç²’åº¦çš„å†…å­˜æ•°æ®æ›´æ–°çº§åˆ«çš„å¤‡ä»½æˆ–è€…LOGæœºåˆ¶ï¼ŒRDDçš„Lineageè®°å½•çš„æ˜¯ç²—é¢—ç²’åº¦çš„ç‰¹å®šæ•°æ®Transformationæ“ä½œï¼ˆå¦‚filterã€mapã€joinç­‰ï¼‰è¡Œä¸ºã€‚å½“è¿™ä¸ªRDDçš„éƒ¨åˆ†åˆ†åŒºæ•°æ®ä¸¢å¤±æ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡Lineageè·å–è¶³å¤Ÿçš„ä¿¡æ¯æ¥é‡æ–°è¿ç®—å’Œæ¢å¤ä¸¢å¤±çš„æ•°æ®åˆ†åŒºã€‚å› ä¸ºè¿™ç§ç²—é¢—ç²’çš„æ•°æ®æ¨¡å‹ï¼Œé™åˆ¶äº†Sparkçš„è¿ç”¨åœºåˆï¼Œæ‰€ä»¥Sparkå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰é«˜æ€§èƒ½è¦æ±‚çš„åœºæ™¯ï¼Œä½†åŒæ—¶ç›¸æ¯”ç»†é¢—ç²’åº¦çš„æ•°æ®æ¨¡å‹ï¼Œä¹Ÿå¸¦æ¥äº†æ€§èƒ½çš„æå‡ã€‚","text":"å¼•è¨€ ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†çš„å®¹é”™æ€§æœ‰ä¸¤ç§æ–¹å¼ï¼š æ•°æ®æ£€æŸ¥ç‚¹ å’Œ è®°å½•æ•°æ®çš„æ›´æ–° ã€‚é¢å‘å¤§è§„æ¨¡æ•°æ®åˆ†æï¼Œæ•°æ®æ£€æŸ¥ç‚¹æ“ä½œæˆæœ¬å¾ˆé«˜ï¼Œéœ€è¦é€šè¿‡æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œè¿æ¥åœ¨æœºå™¨ä¹‹é—´å¤åˆ¶åºå¤§çš„æ•°æ®é›†ï¼Œè€Œç½‘ç»œå¸¦å®½å¾€å¾€æ¯”å†…å­˜å¸¦å®½ä½å¾—å¤šï¼ŒåŒæ—¶è¿˜éœ€è¦æ¶ˆè€—æ›´å¤šçš„å­˜å‚¨èµ„æºã€‚å› æ­¤ï¼ŒSparké€‰æ‹©è®°å½•æ›´æ–°çš„æ–¹å¼ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ›´æ–°ç²’åº¦å¤ªç»†å¤ªå¤šï¼Œé‚£ä¹ˆè®°å½•æ›´æ–°æˆæœ¬ä¹Ÿä¸ä½ã€‚å› æ­¤ï¼ŒRDDåªæ”¯æŒç²—ç²’åº¦è½¬æ¢ï¼Œå³åªè®°å½•å•ä¸ªå—ä¸Šæ‰§è¡Œçš„å•ä¸ªæ“ä½œï¼Œç„¶åå°†åˆ›å»ºRDDçš„ä¸€ç³»åˆ—å˜æ¢åºåˆ—ï¼ˆæ¯ä¸ªRDDéƒ½åŒ…å«äº†ä»–æ˜¯å¦‚ä½•ç”±å…¶ä»–RDDå˜æ¢è¿‡æ¥çš„ä»¥åŠå¦‚ä½•é‡å»ºæŸä¸€å—æ•°æ®çš„ä¿¡æ¯ã€‚å› æ­¤RDDçš„å®¹é”™æœºåˆ¶åˆç§°â€œè¡€ç»Ÿ(Lineage)â€å®¹é”™ï¼‰è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿æ¢å¤ä¸¢å¤±çš„åˆ†åŒºã€‚ Lineageæœ¬è´¨ä¸Šå¾ˆç±»ä¼¼äºæ•°æ®åº“ä¸­çš„é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰ï¼Œåªä¸è¿‡è¿™ä¸ªé‡åšæ—¥å¿—ç²’åº¦å¾ˆå¤§ï¼Œæ˜¯å¯¹å…¨å±€æ•°æ®åšåŒæ ·çš„é‡åšè¿›è€Œæ¢å¤æ•°æ®ã€‚Lineageæœºåˆ¶ Lineageç®€ä»‹ç›¸æ¯”å…¶ä»–ç³»ç»Ÿçš„ç»†é¢—ç²’åº¦çš„å†…å­˜æ•°æ®æ›´æ–°çº§åˆ«çš„å¤‡ä»½æˆ–è€…LOGæœºåˆ¶ï¼ŒRDDçš„Lineageè®°å½•çš„æ˜¯ç²—é¢—ç²’åº¦çš„ç‰¹å®šæ•°æ®Transformationæ“ä½œï¼ˆå¦‚filterã€mapã€joinç­‰ï¼‰è¡Œä¸ºã€‚å½“è¿™ä¸ªRDDçš„éƒ¨åˆ†åˆ†åŒºæ•°æ®ä¸¢å¤±æ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡Lineageè·å–è¶³å¤Ÿçš„ä¿¡æ¯æ¥é‡æ–°è¿ç®—å’Œæ¢å¤ä¸¢å¤±çš„æ•°æ®åˆ†åŒºã€‚å› ä¸ºè¿™ç§ç²—é¢—ç²’çš„æ•°æ®æ¨¡å‹ï¼Œé™åˆ¶äº†Sparkçš„è¿ç”¨åœºåˆï¼Œæ‰€ä»¥Sparkå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰é«˜æ€§èƒ½è¦æ±‚çš„åœºæ™¯ï¼Œä½†åŒæ—¶ç›¸æ¯”ç»†é¢—ç²’åº¦çš„æ•°æ®æ¨¡å‹ï¼Œä¹Ÿå¸¦æ¥äº†æ€§èƒ½çš„æå‡ã€‚ ä¸¤ç§ä¾èµ–å…³ç³»RDDåœ¨Lineageä¾èµ–æ–¹é¢åˆ†ä¸ºä¸¤ç§ï¼šçª„ä¾èµ–(Narrow Dependencies)ä¸å®½ä¾èµ–(Wide Dependencies,æºç ä¸­ç§°ä¸ºShuffle Dependencies)ï¼Œç”¨æ¥è§£å†³æ•°æ®å®¹é”™çš„é«˜æ•ˆæ€§ã€‚ çª„ä¾èµ–ï¼šæ˜¯æŒ‡çˆ¶RDDçš„æ¯ä¸€ä¸ªåˆ†åŒºæœ€å¤šè¢«ä¸€ä¸ªå­RDDçš„åˆ†åŒºæ‰€ç”¨ï¼Œè¡¨ç°ä¸ºä¸€ä¸ªçˆ¶RDDçš„åˆ†åŒºå¯¹åº”äºä¸€ä¸ªå­RDDçš„åˆ†åŒºï¼Œæˆ–å¤šä¸ªçˆ¶RDDçš„åˆ†åŒºå¯¹åº”äºä¸€ä¸ªå­RDDçš„åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçˆ¶RDDçš„ä¸€ä¸ªåˆ†åŒºä¸å¯èƒ½å¯¹åº”ä¸€ä¸ªå­RDDçš„å¤šä¸ªåˆ†åŒºã€‚ 1ä¸ªçˆ¶RDDåˆ†åŒºå¯¹åº”1ä¸ªå­RDDåˆ†åŒºï¼Œè¿™å…¶ä¸­åˆåˆ†ä¸¤ç§æƒ…å†µï¼š1ä¸ªå­RDDåˆ†åŒºå¯¹åº”1ä¸ªçˆ¶RDDåˆ†åŒºï¼ˆå¦‚mapã€filterç­‰ç®—å­ï¼‰ï¼Œ1ä¸ªå­RDDåˆ†åŒºå¯¹åº”Nä¸ªçˆ¶RDDåˆ†åŒºï¼ˆå¦‚co-paritionedï¼ˆååŒåˆ’åˆ†ï¼‰è¿‡çš„Joinï¼‰ã€‚ å®½ä¾èµ–ï¼šæ˜¯æŒ‡å­RDDçš„åˆ†åŒºä¾èµ–äºçˆ¶RDDçš„å¤šä¸ªåˆ†åŒºæˆ–æ‰€æœ‰åˆ†åŒºï¼Œå³å­˜åœ¨ä¸€ä¸ªçˆ¶RDDçš„ä¸€ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªå­RDDçš„å¤šä¸ªåˆ†åŒºã€‚ 1ä¸ªçˆ¶RDDåˆ†åŒºå¯¹åº”å¤šä¸ªå­RDDåˆ†åŒºï¼Œè¿™å…¶ä¸­åˆåˆ†ä¸¤ç§æƒ…å†µï¼š1ä¸ªçˆ¶RDDå¯¹åº”æ‰€æœ‰å­RDDåˆ†åŒºï¼ˆæœªç»ååŒåˆ’åˆ†çš„Joinï¼‰æˆ–è€…1ä¸ªçˆ¶RDDå¯¹åº”éå…¨éƒ¨çš„å¤šä¸ªRDDåˆ†åŒºï¼ˆå¦‚groupByKeyï¼‰ã€‚ æœ¬è´¨ç†è§£æ ¹æ®çˆ¶RDDåˆ†åŒºæ˜¯å¯¹åº”1ä¸ªè¿˜æ˜¯å¤šä¸ªå­RDDåˆ†åŒºæ¥åŒºåˆ†çª„ä¾èµ–ï¼ˆçˆ¶åˆ†åŒºå¯¹åº”ä¸€ä¸ªå­åˆ†åŒºï¼Œå¤šä¸ªçˆ¶åˆ†åŒºå¯¹åº”ä¸€ä¸ªå­åˆ†åŒºï¼‰å’Œå®½ä¾èµ–ï¼ˆçˆ¶åˆ†åŒºå¯¹åº”å¤šä¸ªå­åˆ†åŒºï¼‰ã€‚å¦‚æœå¯¹åº”å¤šä¸ªï¼Œåˆ™å½“å®¹é”™é‡ç®—åˆ†åŒºæ—¶ï¼Œå› ä¸ºçˆ¶åˆ†åŒºæ•°æ®åªæœ‰ä¸€éƒ¨åˆ†æ˜¯éœ€è¦é‡ç®—å­åˆ†åŒºçš„ï¼Œå…¶ä½™æ•°æ®é‡ç®—å°±é€ æˆäº†å†—ä½™è®¡ç®—ã€‚ å¯¹äºå®½ä¾èµ–ï¼ŒStageè®¡ç®—çš„è¾“å…¥å’Œè¾“å‡ºåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå¯¹äºè¾“å…¥èŠ‚ç‚¹å®Œå¥½ï¼Œè€Œè¾“å‡ºèŠ‚ç‚¹æ­»æœºçš„æƒ…å†µï¼Œé€šè¿‡é‡æ–°è®¡ç®—æ¢å¤æ•°æ®è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å®¹é”™æ˜¯æœ‰æ•ˆçš„ï¼Œå¦åˆ™æ— æ•ˆï¼Œå› ä¸ºæ— æ³•é‡è¯•ï¼Œéœ€è¦å‘ä¸Šè¿½æº¯å…¶ç¥–å…ˆçœ‹æ˜¯å¦å¯ä»¥é‡è¯•ï¼ˆè¿™å°±æ˜¯lineageï¼Œè¡€ç»Ÿçš„æ„æ€ï¼‰ï¼Œçª„ä¾èµ–å¯¹äºæ•°æ®çš„é‡ç®—å¼€é”€è¦è¿œå°äºå®½ä¾èµ–çš„æ•°æ®é‡ç®—å¼€é”€ã€‚ çª„ä¾èµ–å’Œå®½ä¾èµ–çš„æ¦‚å¿µä¸»è¦ç”¨åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼šä¸€ä¸ªæ˜¯å®¹é”™ä¸­ç›¸å½“äºRedoæ—¥å¿—çš„åŠŸèƒ½ï¼›å¦ä¸€ä¸ªæ˜¯åœ¨è°ƒåº¦ä¸­æ„å»ºDAGä½œä¸ºä¸åŒStageçš„åˆ’åˆ†ç‚¹ã€‚ ä¾èµ–å…³ç³»çš„ç‰¹æ€§ç¬¬ä¸€ï¼Œçª„ä¾èµ–å¯ä»¥åœ¨æŸä¸ªè®¡ç®—èŠ‚ç‚¹ä¸Šç›´æ¥é€šè¿‡è®¡ç®—çˆ¶RDDçš„æŸå—æ•°æ®è®¡ç®—å¾—åˆ°å­RDDå¯¹åº”çš„æŸå—æ•°æ®ï¼›å®½ä¾èµ–åˆ™è¦ç­‰åˆ°çˆ¶RDDæ‰€æœ‰æ•°æ®éƒ½è®¡ç®—å®Œæˆä¹‹åï¼Œå¹¶ä¸”çˆ¶RDDçš„è®¡ç®—ç»“æœè¿›è¡Œhashå¹¶ä¼ åˆ°å¯¹åº”èŠ‚ç‚¹ä¸Šä¹‹åæ‰èƒ½è®¡ç®—å­RDDã€‚ ç¬¬äºŒï¼Œæ•°æ®ä¸¢å¤±æ—¶ï¼Œå¯¹äºçª„ä¾èµ–åªéœ€è¦é‡æ–°è®¡ç®—ä¸¢å¤±çš„é‚£ä¸€å—æ•°æ®æ¥æ¢å¤ï¼›å¯¹äºå®½ä¾èµ–åˆ™è¦å°†ç¥–å…ˆRDDä¸­çš„æ‰€æœ‰æ•°æ®å—å…¨éƒ¨é‡æ–°è®¡ç®—æ¥æ¢å¤ã€‚æ‰€ä»¥åœ¨é•¿â€œè¡€ç»Ÿâ€é“¾ç‰¹åˆ«æ˜¯æœ‰å®½ä¾èµ–çš„æ—¶å€™ï¼Œéœ€è¦åœ¨é€‚å½“çš„æ—¶æœºè®¾ç½®æ•°æ®æ£€æŸ¥ç‚¹ã€‚ä¹Ÿæ˜¯è¿™ä¸¤ä¸ªç‰¹æ€§è¦æ±‚å¯¹äºä¸åŒä¾èµ–å…³ç³»è¦é‡‡å–ä¸åŒçš„ä»»åŠ¡è°ƒåº¦æœºåˆ¶å’Œå®¹é”™æ¢å¤æœºåˆ¶ã€‚ å®¹é”™åŸç†åœ¨å®¹é”™æœºåˆ¶ä¸­ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ­»æœºäº†ï¼Œè€Œä¸”è¿ç®—çª„ä¾èµ–ï¼Œåˆ™åªè¦æŠŠä¸¢å¤±çš„çˆ¶RDDåˆ†åŒºé‡ç®—å³å¯ï¼Œä¸ä¾èµ–äºå…¶ä»–èŠ‚ç‚¹ã€‚è€Œå®½ä¾èµ–éœ€è¦çˆ¶RDDçš„æ‰€æœ‰åˆ†åŒºéƒ½å­˜åœ¨ï¼Œé‡ç®—å°±å¾ˆæ˜‚è´µäº†ã€‚ å¯ä»¥è¿™æ ·ç†è§£å¼€é”€çš„ç»æµä¸å¦ï¼šåœ¨çª„ä¾èµ–ä¸­ï¼Œåœ¨å­RDDçš„åˆ†åŒºä¸¢å¤±ã€é‡ç®—çˆ¶RDDåˆ†åŒºæ—¶ï¼Œçˆ¶RDDç›¸åº”åˆ†åŒºçš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯å­RDDåˆ†åŒºçš„æ•°æ®ï¼Œå¹¶ä¸å­˜åœ¨å†—ä½™è®¡ç®—ã€‚åœ¨å®½ä¾èµ–æƒ…å†µä¸‹ï¼Œä¸¢å¤±ä¸€ä¸ªå­RDDåˆ†åŒºé‡ç®—çš„æ¯ä¸ªçˆ¶RDDçš„æ¯ä¸ªåˆ†åŒºçš„æ‰€æœ‰æ•°æ®å¹¶ä¸æ˜¯éƒ½ç»™ä¸¢å¤±çš„å­RDDåˆ†åŒºç”¨çš„ï¼Œä¼šæœ‰ä¸€éƒ¨åˆ†æ•°æ®ç›¸å½“äºå¯¹åº”çš„æ˜¯æœªä¸¢å¤±çš„å­RDDåˆ†åŒºä¸­éœ€è¦çš„æ•°æ®ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿå†—ä½™è®¡ç®—å¼€é”€ï¼Œè¿™ä¹Ÿæ˜¯å®½ä¾èµ–å¼€é”€æ›´å¤§çš„åŸå› ã€‚ å› æ­¤å¦‚æœä½¿ç”¨Checkpointç®—å­æ¥åšæ£€æŸ¥ç‚¹ï¼Œä¸ä»…è¦è€ƒè™‘Lineageæ˜¯å¦è¶³å¤Ÿé•¿ï¼Œä¹Ÿè¦è€ƒè™‘æ˜¯å¦æœ‰å®½ä¾èµ–ï¼Œå¯¹å®½ä¾èµ–åŠ Checkpointæ˜¯æœ€ç‰©æœ‰æ‰€å€¼çš„ã€‚Checkpointæœºåˆ¶é€šè¿‡ä¸Šè¿°åˆ†æå¯ä»¥çœ‹å‡ºåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ï¼ŒRDDéœ€è¦åŠ æ£€æŸ¥ç‚¹ã€‚ DAGä¸­çš„Lineageè¿‡é•¿ï¼Œå¦‚æœé‡ç®—ï¼Œåˆ™å¼€é”€å¤ªå¤§ï¼ˆå¦‚åœ¨PageRankä¸­ï¼‰ã€‚ åœ¨å®½ä¾èµ–ä¸ŠåšCheckpointè·å¾—çš„æ”¶ç›Šæ›´å¤§ã€‚ ç”±äºRDDæ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥Sparkçš„RDDè®¡ç®—ä¸­ä¸€è‡´æ€§ä¸æ˜¯ä¸»è¦å…³å¿ƒçš„å†…å®¹ï¼Œå†…å­˜ç›¸å¯¹å®¹æ˜“ç®¡ç†ï¼Œè¿™ä¹Ÿæ˜¯è®¾è®¡è€…å¾ˆæœ‰è¿œè§çš„åœ°æ–¹ï¼Œè¿™æ ·å‡å°‘äº†æ¡†æ¶çš„å¤æ‚æ€§ï¼Œæå‡äº†æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºä»¥åä¸Šå±‚æ¡†æ¶çš„ä¸°å¯Œå¥ å®šäº†å¼ºæœ‰åŠ›çš„åŸºç¡€ã€‚ åœ¨RDDè®¡ç®—ä¸­ï¼Œé€šè¿‡æ£€æŸ¥ç‚¹æœºåˆ¶è¿›è¡Œå®¹é”™ï¼Œä¼ ç»Ÿåšæ£€æŸ¥ç‚¹æœ‰ä¸¤ç§æ–¹å¼ï¼šé€šè¿‡å†—ä½™æ•°æ®å’Œæ—¥å¿—è®°å½•æ›´æ–°æ“ä½œã€‚åœ¨RDDä¸­çš„doCheckPointæ–¹æ³•ç›¸å½“äºé€šè¿‡å†—ä½™æ•°æ®æ¥ç¼“å­˜æ•°æ®ï¼Œè€Œä¹‹å‰ä»‹ç»çš„è¡€ç»Ÿå°±æ˜¯é€šè¿‡ç›¸å½“ç²—ç²’åº¦çš„è®°å½•æ›´æ–°æ“ä½œæ¥å®ç°å®¹é”™çš„ã€‚ æ£€æŸ¥ç‚¹ï¼ˆæœ¬è´¨æ˜¯é€šè¿‡å°†RDDå†™å…¥Diskåšæ£€æŸ¥ç‚¹ï¼‰æ˜¯ä¸ºäº†é€šè¿‡lineageåšå®¹é”™çš„è¾…åŠ©ï¼Œlineageè¿‡é•¿ä¼šé€ æˆå®¹é”™æˆæœ¬è¿‡é«˜ï¼Œè¿™æ ·å°±ä¸å¦‚åœ¨ä¸­é—´é˜¶æ®µåšæ£€æŸ¥ç‚¹å®¹é”™ï¼Œå¦‚æœä¹‹åæœ‰èŠ‚ç‚¹å‡ºç°é—®é¢˜è€Œä¸¢å¤±åˆ†åŒºï¼Œä»åšæ£€æŸ¥ç‚¹çš„RDDå¼€å§‹é‡åšLineageï¼Œå°±ä¼šå‡å°‘å¼€é”€ã€‚","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"},{"name":"åŸç†","slug":"åŸç†","permalink":"https://stanxia.github.io/tags/åŸç†/"}]},{"title":"ORCä¸PARQUETæ–‡ä»¶ç±»å‹çš„æ¯”è¾ƒ","slug":"ORCä¸PARQUETæ–‡ä»¶ç±»å‹çš„æ¯”è¾ƒ","date":"2017-11-29T10:29:04.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/11/29/ORCä¸PARQUETæ–‡ä»¶ç±»å‹çš„æ¯”è¾ƒ/","link":"","permalink":"https://stanxia.github.io/2017/11/29/ORCä¸PARQUETæ–‡ä»¶ç±»å‹çš„æ¯”è¾ƒ/","excerpt":"åˆ—å¼å­˜å‚¨ç”±äºOLAPæŸ¥è¯¢çš„ç‰¹ç‚¹ï¼Œåˆ—å¼å­˜å‚¨å¯ä»¥æå‡å…¶æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æ˜¯å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿè¿™å°±è¦ä»åˆ—å¼å­˜å‚¨çš„åŸç†è¯´èµ·ï¼Œä»å›¾1ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç›¸å¯¹äºå…³ç³»æ•°æ®åº“ä¸­é€šå¸¸ä½¿ç”¨çš„è¡Œå¼å­˜å‚¨ï¼Œåœ¨ä½¿ç”¨åˆ—å¼å­˜å‚¨æ—¶æ¯ä¸€åˆ—çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯é¡ºåºå­˜å‚¨çš„ã€‚ç”±æ­¤ç‰¹ç‚¹å¯ä»¥ç»™æŸ¥è¯¢å¸¦æ¥å¦‚ä¸‹çš„ä¼˜åŒ–ï¼š\n123æŸ¥è¯¢çš„æ—¶å€™ä¸éœ€è¦æ‰«æå…¨éƒ¨çš„æ•°æ®ï¼Œè€Œåªéœ€è¦è¯»å–æ¯æ¬¡æŸ¥è¯¢æ¶‰åŠçš„åˆ—ï¼Œè¿™æ ·å¯ä»¥å°†I/Oæ¶ˆè€—é™ä½Nå€ï¼Œå¦å¤–å¯ä»¥ä¿å­˜æ¯ä¸€åˆ—çš„ç»Ÿè®¡ä¿¡æ¯(minã€maxã€sumç­‰)ï¼Œå®ç°éƒ¨åˆ†çš„è°“è¯ä¸‹æ¨ã€‚ç”±äºæ¯ä¸€åˆ—çš„æˆå‘˜éƒ½æ˜¯åŒæ„çš„ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®ç±»å‹ä½¿ç”¨æ›´é«˜æ•ˆçš„æ•°æ®å‹ç¼©ç®—æ³•ï¼Œè¿›ä¸€æ­¥å‡å°I/Oã€‚ç”±äºæ¯ä¸€åˆ—çš„æˆå‘˜çš„åŒæ„æ€§ï¼Œå¯ä»¥ä½¿ç”¨æ›´åŠ é€‚åˆCPU pipelineçš„ç¼–ç æ–¹å¼ï¼Œå‡å°CPUçš„ç¼“å­˜å¤±æ•ˆã€‚\nå›¾1 è¡Œå¼å­˜å‚¨VSåˆ—å¼å­˜å‚¨","text":"åˆ—å¼å­˜å‚¨ç”±äºOLAPæŸ¥è¯¢çš„ç‰¹ç‚¹ï¼Œåˆ—å¼å­˜å‚¨å¯ä»¥æå‡å…¶æŸ¥è¯¢æ€§èƒ½ï¼Œä½†æ˜¯å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿè¿™å°±è¦ä»åˆ—å¼å­˜å‚¨çš„åŸç†è¯´èµ·ï¼Œä»å›¾1ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç›¸å¯¹äºå…³ç³»æ•°æ®åº“ä¸­é€šå¸¸ä½¿ç”¨çš„è¡Œå¼å­˜å‚¨ï¼Œåœ¨ä½¿ç”¨åˆ—å¼å­˜å‚¨æ—¶æ¯ä¸€åˆ—çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯é¡ºåºå­˜å‚¨çš„ã€‚ç”±æ­¤ç‰¹ç‚¹å¯ä»¥ç»™æŸ¥è¯¢å¸¦æ¥å¦‚ä¸‹çš„ä¼˜åŒ–ï¼š 123æŸ¥è¯¢çš„æ—¶å€™ä¸éœ€è¦æ‰«æå…¨éƒ¨çš„æ•°æ®ï¼Œè€Œåªéœ€è¦è¯»å–æ¯æ¬¡æŸ¥è¯¢æ¶‰åŠçš„åˆ—ï¼Œè¿™æ ·å¯ä»¥å°†I/Oæ¶ˆè€—é™ä½Nå€ï¼Œå¦å¤–å¯ä»¥ä¿å­˜æ¯ä¸€åˆ—çš„ç»Ÿè®¡ä¿¡æ¯(minã€maxã€sumç­‰)ï¼Œå®ç°éƒ¨åˆ†çš„è°“è¯ä¸‹æ¨ã€‚ç”±äºæ¯ä¸€åˆ—çš„æˆå‘˜éƒ½æ˜¯åŒæ„çš„ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®ç±»å‹ä½¿ç”¨æ›´é«˜æ•ˆçš„æ•°æ®å‹ç¼©ç®—æ³•ï¼Œè¿›ä¸€æ­¥å‡å°I/Oã€‚ç”±äºæ¯ä¸€åˆ—çš„æˆå‘˜çš„åŒæ„æ€§ï¼Œå¯ä»¥ä½¿ç”¨æ›´åŠ é€‚åˆCPU pipelineçš„ç¼–ç æ–¹å¼ï¼Œå‡å°CPUçš„ç¼“å­˜å¤±æ•ˆã€‚ å›¾1 è¡Œå¼å­˜å‚¨VSåˆ—å¼å­˜å‚¨ åµŒå¥—æ•°æ®æ ¼å¼é€šå¸¸æˆ‘ä»¬ä½¿ç”¨å…³ç³»æ•°æ®åº“å­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼Œè€Œå…³ç³»æ•°æ®åº“æ”¯æŒçš„æ•°æ®æ¨¡å‹éƒ½æ˜¯æ‰å¹³å¼çš„ï¼Œè€Œé‡åˆ°è¯¸å¦‚Listã€Mapå’Œè‡ªå®šä¹‰Structçš„æ—¶å€™å°±éœ€è¦ç”¨æˆ·è‡ªå·±è§£æï¼Œä½†æ˜¯åœ¨å¤§æ•°æ®ç¯å¢ƒä¸‹ï¼Œæ•°æ®çš„æ¥æºå¤šç§å¤šæ ·ï¼Œä¾‹å¦‚åŸ‹ç‚¹æ•°æ®ï¼Œå¾ˆå¯èƒ½éœ€è¦æŠŠç¨‹åºä¸­çš„æŸäº›å¯¹è±¡å†…å®¹ä½œä¸ºè¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯èƒ½æ˜¯åµŒå¥—çš„ï¼Œæ‰€ä»¥å¦‚æœèƒ½å¤ŸåŸç”Ÿçš„æ”¯æŒè¿™ç§æ•°æ®ï¼ŒæŸ¥è¯¢çš„æ—¶å€™å°±ä¸éœ€è¦é¢å¤–çš„è§£æä¾¿èƒ½è·å¾—æƒ³è¦çš„ç»“æœã€‚ä¾‹å¦‚åœ¨Twitterï¼Œä»–ä»¬ä¸€ä¸ªå…¸å‹çš„æ—¥å¿—å¯¹è±¡ï¼ˆä¸€æ¡è®°å½•ï¼‰æœ‰87ä¸ªå­—æ®µï¼Œå…¶ä¸­åµŒå¥—äº†7å±‚ï¼Œå¦‚ä¸‹å›¾ã€‚ å›¾2 åµŒå¥—æ•°æ®æ¨¡å‹ éšç€åµŒå¥—æ ¼å¼çš„æ•°æ®çš„éœ€æ±‚æ—¥ç›Šå¢åŠ ï¼Œç›®å‰Hadoopç”Ÿæ€åœˆä¸­ä¸»æµçš„æŸ¥è¯¢å¼•æ“éƒ½æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚Hiveã€SparkSQLã€Impalaç­‰éƒ½åŸç”Ÿçš„æ”¯æŒè¯¸å¦‚structã€mapã€arrayè¿™æ ·çš„å¤æ‚æ•°æ®ç±»å‹ï¼Œè¿™æ ·ä¿ƒä½¿å„ç§å­˜å‚¨æ ¼å¼éƒ½éœ€è¦æ”¯æŒåµŒå¥—æ•°æ®æ ¼å¼ã€‚ Parquetå­˜å‚¨æ ¼å¼Apache Parquetæ˜¯Hadoopç”Ÿæ€åœˆä¸­ä¸€ç§æ–°å‹åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œå®ƒå¯ä»¥å…¼å®¹Hadoopç”Ÿæ€åœˆä¸­å¤§å¤šæ•°è®¡ç®—æ¡†æ¶(Mapreduceã€Sparkç­‰)ï¼Œè¢«å¤šç§æŸ¥è¯¢å¼•æ“æ”¯æŒï¼ˆHiveã€Impalaã€Drillç­‰ï¼‰ï¼Œå¹¶ä¸”å®ƒæ˜¯è¯­è¨€å’Œå¹³å°æ— å…³çš„ã€‚Parquetæœ€åˆæ˜¯ç”±Twitterå’ŒClouderaåˆä½œå¼€å‘å®Œæˆå¹¶å¼€æºï¼Œ2015å¹´5æœˆä»Apacheçš„å­µåŒ–å™¨é‡Œæ¯•ä¸šæˆä¸ºApacheé¡¶çº§é¡¹ç›®ã€‚ Parquetæœ€åˆçš„çµæ„Ÿæ¥è‡ªGoogleäº2010å¹´å‘è¡¨çš„Dremelè®ºæ–‡ï¼Œæ–‡ä¸­ä»‹ç»äº†ä¸€ç§æ”¯æŒåµŒå¥—ç»“æ„çš„å­˜å‚¨æ ¼å¼ï¼Œå¹¶ä¸”ä½¿ç”¨äº†åˆ—å¼å­˜å‚¨çš„æ–¹å¼æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œåœ¨Dremelè®ºæ–‡ä¸­è¿˜ä»‹ç»äº†Googleå¦‚ä½•ä½¿ç”¨è¿™ç§å­˜å‚¨æ ¼å¼å®ç°å¹¶è¡ŒæŸ¥è¯¢çš„ï¼Œå¦‚æœå¯¹æ­¤æ„Ÿå…´è¶£å¯ä»¥å‚è€ƒè®ºæ–‡å’Œå¼€æºå®ç°Drillã€‚ æ•°æ®æ¨¡å‹Parquetæ”¯æŒåµŒå¥—çš„æ•°æ®æ¨¡å‹ï¼Œç±»ä¼¼äºProtocol Buffersï¼Œæ¯ä¸€ä¸ªæ•°æ®æ¨¡å‹çš„schemaåŒ…å«å¤šä¸ªå­—æ®µï¼Œæ¯ä¸€ä¸ªå­—æ®µæœ‰ä¸‰ä¸ªå±æ€§ï¼šé‡å¤æ¬¡æ•°ã€æ•°æ®ç±»å‹å’Œå­—æ®µåï¼Œé‡å¤æ¬¡æ•°å¯ä»¥æ˜¯ä»¥ä¸‹ä¸‰ç§ï¼šrequired(åªå‡ºç°1æ¬¡)ï¼Œrepeated(å‡ºç°0æ¬¡æˆ–å¤šæ¬¡)ï¼Œoptional(å‡ºç°0æ¬¡æˆ–1æ¬¡)ã€‚æ¯ä¸€ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹å¯ä»¥åˆ†æˆä¸¤ç§ï¼šgroup(å¤æ‚ç±»å‹)å’Œprimitive(åŸºæœ¬ç±»å‹)ã€‚ä¾‹å¦‚Dremelä¸­æä¾›çš„Documentçš„schemaç¤ºä¾‹ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314message Document &#123; required int64 DocId; optional group Links &#123; repeated int64 Backward; repeated int64 Forward; &#125; repeated group Name &#123; repeated group Language &#123; required string Code; optional string Country; &#125; optional string Url; &#125;&#125; å¯ä»¥æŠŠè¿™ä¸ªSchemaè½¬æ¢æˆæ ‘çŠ¶ç»“æ„ï¼Œæ ¹èŠ‚ç‚¹å¯ä»¥ç†è§£ä¸ºrepeatedç±»å‹ï¼Œå¦‚å›¾3ã€‚ å›¾3 Parquetçš„schemaç»“æ„ å¯ä»¥çœ‹å‡ºåœ¨Schemaä¸­æ‰€æœ‰çš„åŸºæœ¬ç±»å‹å­—æ®µéƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåœ¨è¿™ä¸ªSchemaä¸­ä¸€å…±å­˜åœ¨6ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå¦‚æœæŠŠè¿™æ ·çš„Schemaè½¬æ¢æˆæ‰å¹³å¼çš„å…³ç³»æ¨¡å‹ï¼Œå°±å¯ä»¥ç†è§£ä¸ºè¯¥è¡¨åŒ…å«å…­ä¸ªåˆ—ã€‚Parquetä¸­æ²¡æœ‰Mapã€Arrayè¿™æ ·çš„å¤æ‚æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡repeatedå’Œgroupç»„åˆæ¥å®ç°çš„ã€‚ç”±äºä¸€æ¡è®°å½•ä¸­æŸä¸€åˆ—å¯èƒ½å‡ºç°é›¶æ¬¡æˆ–è€…å¤šæ¬¡ï¼Œéœ€è¦æ ‡ç¤ºå‡ºå“ªäº›åˆ—çš„å€¼æ„æˆä¸€æ¡å®Œæ•´çš„è®°å½•ã€‚è¿™æ˜¯ç”±Striping/Assemblyç®—æ³•å®ç°çš„ã€‚ ç”±äºParquetæ”¯æŒçš„æ•°æ®æ¨¡å‹æ¯”è¾ƒæ¾æ•£ï¼Œå¯èƒ½ä¸€æ¡è®°å½•ä¸­å­˜åœ¨æ¯”è¾ƒæ·±çš„åµŒå¥—å…³ç³»ï¼Œå¦‚æœä¸ºæ¯ä¸€æ¡è®°å½•éƒ½ç»´æŠ¤ä¸€ä¸ªç±»ä¼¼çš„æ ‘çŠ¶ç»“å¯èƒ½ä¼šå ç”¨è¾ƒå¤§çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤Dremelè®ºæ–‡ä¸­æå‡ºäº†ä¸€ç§é«˜æ•ˆçš„å¯¹äºåµŒå¥—æ•°æ®æ ¼å¼çš„å‹ç¼©ç®—æ³•ï¼šStriping/Assemblyç®—æ³•ã€‚å®ƒçš„åŸç†æ˜¯æ¯ä¸€ä¸ªè®°å½•ä¸­çš„æ¯ä¸€ä¸ªæˆå‘˜å€¼æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼šValueã€Repetition levelå’ŒDefinition levelã€‚valueè®°å½•äº†è¯¥æˆå‘˜çš„åŸå§‹å€¼ï¼Œå¯ä»¥æ ¹æ®ç‰¹å®šç±»å‹çš„å‹ç¼©ç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œä¸¤ä¸ªlevelå€¼ç”¨äºè®°å½•è¯¥å€¼åœ¨æ•´ä¸ªè®°å½•ä¸­çš„ä½ç½®ã€‚å¯¹äºrepeatedç±»å‹çš„åˆ—ï¼ŒRepetition levelå€¼è®°å½•äº†å½“å‰å€¼å±äºå“ªä¸€æ¡è®°å½•ä»¥åŠå®ƒå¤„äºè¯¥è®°å½•çš„ä»€ä¹ˆä½ç½®ï¼›å¯¹äºrepeatedå’Œoptionalç±»å‹çš„åˆ—ï¼Œå¯èƒ½ä¸€æ¡è®°å½•ä¸­æŸä¸€åˆ—æ˜¯æ²¡æœ‰å€¼çš„ï¼Œå‡è®¾æˆ‘ä»¬ä¸è®°å½•è¿™æ ·çš„å€¼å°±ä¼šå¯¼è‡´æœ¬è¯¥å±äºä¸‹ä¸€æ¡è®°å½•çš„å€¼è¢«å½“åšå½“å‰è®°å½•çš„ä¸€éƒ¨åˆ†ï¼Œä»è€Œé€ æˆæ•°æ®çš„é”™è¯¯ï¼Œå› æ­¤å¯¹äºè¿™ç§æƒ…å†µéœ€è¦ä¸€ä¸ªå ä½ç¬¦æ ‡ç¤ºè¿™ç§æƒ…å†µã€‚ é€šè¿‡Striping/Assemblyç®—æ³•ï¼Œparquetå¯ä»¥ä½¿ç”¨è¾ƒå°‘çš„å­˜å‚¨ç©ºé—´è¡¨ç¤ºå¤æ‚çš„åµŒå¥—æ ¼å¼ï¼Œå¹¶ä¸”é€šå¸¸Repetition levelå’ŒDefinition leveléƒ½æ˜¯è¾ƒå°çš„æ•´æ•°å€¼ï¼Œå¯ä»¥é€šè¿‡RLEç®—æ³•å¯¹å…¶è¿›è¡Œå‹ç¼©ï¼Œè¿›ä¸€æ­¥é™ä½å­˜å‚¨ç©ºé—´ã€‚ æ–‡ä»¶ç»“æ„Parquetæ–‡ä»¶æ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œæ˜¯ä¸å¯ä»¥ç›´æ¥è¯»å–å’Œä¿®æ”¹çš„ï¼ŒParquetæ–‡ä»¶æ˜¯è‡ªè§£æçš„ï¼Œæ–‡ä»¶ä¸­åŒ…æ‹¬è¯¥æ–‡ä»¶çš„æ•°æ®å’Œå…ƒæ•°æ®ã€‚åœ¨HDFSæ–‡ä»¶ç³»ç»Ÿå’ŒParquetæ–‡ä»¶ä¸­å­˜åœ¨å¦‚ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š HDFSå—(Block)ï¼šå®ƒæ˜¯HDFSä¸Šçš„æœ€å°çš„å‰¯æœ¬å•ä½ï¼ŒHDFSä¼šæŠŠä¸€ä¸ªBlockå­˜å‚¨åœ¨æœ¬åœ°çš„ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”ç»´æŠ¤åˆ†æ•£åœ¨ä¸åŒçš„æœºå™¨ä¸Šçš„å¤šä¸ªå‰¯æœ¬ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸€ä¸ªBlockçš„å¤§å°ä¸º256Mã€512Mç­‰ã€‚ HDFSæ–‡ä»¶(File)ï¼šä¸€ä¸ªHDFSçš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ•°æ®å’Œå…ƒæ•°æ®ï¼Œæ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªBlockä¸­ã€‚ è¡Œç»„(Row Group)ï¼šæŒ‰ç…§è¡Œå°†æ•°æ®ç‰©ç†ä¸Šåˆ’åˆ†ä¸ºå¤šä¸ªå•å…ƒï¼Œæ¯ä¸€ä¸ªè¡Œç»„åŒ…å«ä¸€å®šçš„è¡Œæ•°ï¼Œåœ¨ä¸€ä¸ªHDFSæ–‡ä»¶ä¸­è‡³å°‘å­˜å‚¨ä¸€ä¸ªè¡Œç»„ï¼ŒParquetè¯»å†™çš„æ—¶å€™ä¼šå°†æ•´ä¸ªè¡Œç»„ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥å¦‚æœæ¯ä¸€ä¸ªè¡Œç»„çš„å¤§å°æ˜¯ç”±å†…å­˜å¤§çš„å°å†³å®šçš„ã€‚ åˆ—å—(Column Chunk)ï¼šåœ¨ä¸€ä¸ªè¡Œç»„ä¸­æ¯ä¸€åˆ—ä¿å­˜åœ¨ä¸€ä¸ªåˆ—å—ä¸­ï¼Œè¡Œç»„ä¸­çš„æ‰€æœ‰åˆ—è¿ç»­çš„å­˜å‚¨åœ¨è¿™ä¸ªè¡Œç»„æ–‡ä»¶ä¸­ã€‚ä¸åŒçš„åˆ—å—å¯èƒ½ä½¿ç”¨ä¸åŒçš„ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚ é¡µ(Page)ï¼šæ¯ä¸€ä¸ªåˆ—å—åˆ’åˆ†ä¸ºå¤šä¸ªé¡µï¼Œä¸€ä¸ªé¡µæ˜¯æœ€å°çš„ç¼–ç çš„å•ä½ï¼Œåœ¨åŒä¸€ä¸ªåˆ—å—çš„ä¸åŒé¡µå¯èƒ½ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨å­˜å‚¨Parquetæ•°æ®çš„æ—¶å€™ä¼šæŒ‰ç…§HDFSçš„Blockå¤§å°è®¾ç½®è¡Œç»„çš„å¤§å°ï¼Œç”±äºä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸€ä¸ªMapperä»»åŠ¡å¤„ç†æ•°æ®çš„æœ€å°å•ä½æ˜¯ä¸€ä¸ªBlockï¼Œè¿™æ ·å¯ä»¥æŠŠæ¯ä¸€ä¸ªè¡Œç»„ç”±ä¸€ä¸ªMapperä»»åŠ¡å¤„ç†ï¼Œå¢å¤§ä»»åŠ¡æ‰§è¡Œå¹¶è¡Œåº¦ã€‚Parquetæ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å›¾4 Parquetæ–‡ä»¶ç»“æ„ ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªParquetæ–‡ä»¶çš„ç»“æ„ï¼Œä¸€ä¸ªæ–‡ä»¶ä¸­å¯ä»¥å­˜å‚¨å¤šä¸ªè¡Œç»„ï¼Œæ–‡ä»¶çš„é¦–ä½éƒ½æ˜¯è¯¥æ–‡ä»¶çš„Magic Codeï¼Œç”¨äºæ ¡éªŒå®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªParquetæ–‡ä»¶ï¼ŒFooter lengthå­˜å‚¨äº†æ–‡ä»¶å…ƒæ•°æ®çš„å¤§å°ï¼Œé€šè¿‡è¯¥å€¼å’Œæ–‡ä»¶é•¿åº¦å¯ä»¥è®¡ç®—å‡ºå…ƒæ•°æ®çš„åç§»é‡ï¼Œæ–‡ä»¶çš„å…ƒæ•°æ®ä¸­åŒ…æ‹¬æ¯ä¸€ä¸ªè¡Œç»„çš„å…ƒæ•°æ®ä¿¡æ¯å’Œå½“å‰æ–‡ä»¶çš„Schemaä¿¡æ¯ã€‚é™¤äº†æ–‡ä»¶ä¸­æ¯ä¸€ä¸ªè¡Œç»„çš„å…ƒæ•°æ®ï¼Œæ¯ä¸€é¡µçš„å¼€å§‹éƒ½ä¼šå­˜å‚¨è¯¥é¡µçš„å…ƒæ•°æ®ï¼Œåœ¨Parquetä¸­ï¼Œæœ‰ä¸‰ç§ç±»å‹çš„é¡µï¼šæ•°æ®é¡µã€å­—å…¸é¡µå’Œç´¢å¼•é¡µã€‚æ•°æ®é¡µç”¨äºå­˜å‚¨å½“å‰è¡Œç»„ä¸­è¯¥åˆ—çš„å€¼ï¼Œå­—å…¸é¡µå­˜å‚¨è¯¥åˆ—å€¼çš„ç¼–ç å­—å…¸ï¼Œæ¯ä¸€ä¸ªåˆ—å—ä¸­æœ€å¤šåŒ…å«ä¸€ä¸ªå­—å…¸é¡µï¼Œç´¢å¼•é¡µç”¨æ¥å­˜å‚¨å½“å‰è¡Œç»„ä¸‹è¯¥åˆ—çš„ç´¢å¼•ï¼Œç›®å‰Parquetä¸­è¿˜ä¸æ”¯æŒç´¢å¼•é¡µï¼Œä½†æ˜¯åœ¨åé¢çš„ç‰ˆæœ¬ä¸­å¢åŠ ã€‚ æ•°æ®è®¿é—®è¯´åˆ°åˆ—å¼å­˜å‚¨çš„ä¼˜åŠ¿ï¼ŒProjectä¸‹æ¨æ˜¯æ— ç–‘æœ€çªå‡ºçš„ï¼Œå®ƒæ„å‘³ç€åœ¨è·å–è¡¨ä¸­åŸå§‹æ•°æ®æ—¶åªéœ€è¦æ‰«ææŸ¥è¯¢ä¸­éœ€è¦çš„åˆ—ï¼Œç”±äºæ¯ä¸€åˆ—çš„æ‰€æœ‰å€¼éƒ½æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œé¿å…æ‰«ææ•´ä¸ªè¡¨æ–‡ä»¶å†…å®¹ã€‚ åœ¨Parquetä¸­åŸç”Ÿå°±æ”¯æŒProjectä¸‹æ¨ï¼Œæ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™å¯ä»¥é€šè¿‡Configurationä¼ é€’éœ€è¦è¯»å–çš„åˆ—çš„ä¿¡æ¯ï¼Œè¿™äº›åˆ—å¿…é¡»æ˜¯Schemaçš„å­é›†ï¼ŒParquetæ¯æ¬¡ä¼šæ‰«æä¸€ä¸ªRow Groupçš„æ•°æ®ï¼Œç„¶åä¸€æ¬¡æ€§å¾—å°†è¯¥Row Groupé‡Œæ‰€æœ‰éœ€è¦çš„åˆ—çš„Cloumn Chunkéƒ½è¯»å–åˆ°å†…å­˜ä¸­ï¼Œæ¯æ¬¡è¯»å–ä¸€ä¸ªRow Groupçš„æ•°æ®èƒ½å¤Ÿå¤§å¤§é™ä½éšæœºè¯»çš„æ¬¡æ•°ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒParquetåœ¨è¯»å–çš„æ—¶å€™ä¼šè€ƒè™‘åˆ—æ˜¯å¦è¿ç»­ï¼Œå¦‚æœæŸäº›éœ€è¦çš„åˆ—æ˜¯å­˜å‚¨ä½ç½®æ˜¯è¿ç»­çš„ï¼Œé‚£ä¹ˆä¸€æ¬¡è¯»æ“ä½œå°±å¯ä»¥æŠŠå¤šä¸ªåˆ—çš„æ•°æ®è¯»å–åˆ°å†…å­˜ã€‚ åœ¨æ•°æ®è®¿é—®çš„è¿‡ç¨‹ä¸­ï¼ŒParquetè¿˜å¯ä»¥åˆ©ç”¨æ¯ä¸€ä¸ªrow groupç”Ÿæˆçš„ç»Ÿè®¡ä¿¡æ¯è¿›è¡Œè°“è¯ä¸‹æ¨ï¼Œè¿™éƒ¨åˆ†ä¿¡æ¯åŒ…æ‹¬è¯¥Column Chunkçš„æœ€å¤§å€¼ã€æœ€å°å€¼å’Œç©ºå€¼ä¸ªæ•°ã€‚é€šè¿‡è¿™äº›ç»Ÿè®¡å€¼å’Œè¯¥åˆ—çš„è¿‡æ»¤æ¡ä»¶å¯ä»¥åˆ¤æ–­è¯¥Row Groupæ˜¯å¦éœ€è¦æ‰«æã€‚å¦å¤–Parquetæœªæ¥è¿˜ä¼šå¢åŠ è¯¸å¦‚Bloom Filterå’ŒIndexç­‰ä¼˜åŒ–æ•°æ®ï¼Œæ›´åŠ æœ‰æ•ˆçš„å®Œæˆè°“è¯ä¸‹æ¨ã€‚ ORCæ–‡ä»¶æ ¼å¼ORCæ–‡ä»¶æ ¼å¼æ˜¯ä¸€ç§Hadoopç”Ÿæ€åœˆä¸­çš„åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œå®ƒçš„äº§ç”Ÿæ—©åœ¨2013å¹´åˆï¼Œæœ€åˆäº§ç”Ÿè‡ªApache Hiveï¼Œç”¨äºé™ä½Hadoopæ•°æ®å­˜å‚¨ç©ºé—´å’ŒåŠ é€ŸHiveæŸ¥è¯¢é€Ÿåº¦ã€‚å’ŒParquetç±»ä¼¼ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå•çº¯çš„åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œä»ç„¶æ˜¯é¦–å…ˆæ ¹æ®è¡Œç»„åˆ†å‰²æ•´ä¸ªè¡¨ï¼Œåœ¨æ¯ä¸€ä¸ªè¡Œç»„å†…è¿›è¡ŒæŒ‰åˆ—å­˜å‚¨ã€‚ORCæ–‡ä»¶æ˜¯è‡ªæè¿°çš„ï¼Œå®ƒçš„å…ƒæ•°æ®ä½¿ç”¨Protocol Buffersåºåˆ—åŒ–ï¼Œå¹¶ä¸”æ–‡ä»¶ä¸­çš„æ•°æ®å°½å¯èƒ½çš„å‹ç¼©ä»¥é™ä½å­˜å‚¨ç©ºé—´çš„æ¶ˆè€—ï¼Œç›®å‰ä¹Ÿè¢«Spark SQLã€Prestoç­‰æŸ¥è¯¢å¼•æ“æ”¯æŒï¼Œä½†æ˜¯Impalaå¯¹äºORCç›®å‰æ²¡æœ‰æ”¯æŒï¼Œä»ç„¶ä½¿ç”¨Parquetä½œä¸ºä¸»è¦çš„åˆ—å¼å­˜å‚¨æ ¼å¼ã€‚2015å¹´ORCé¡¹ç›®è¢«Apacheé¡¹ç›®åŸºé‡‘ä¼šæå‡ä¸ºApacheé¡¶çº§é¡¹ç›®ã€‚ æ•°æ®æ¨¡å‹å’ŒParquetä¸åŒï¼ŒORCåŸç”Ÿæ˜¯ä¸æ”¯æŒåµŒå¥—æ•°æ®æ ¼å¼çš„ï¼Œè€Œæ˜¯é€šè¿‡å¯¹å¤æ‚æ•°æ®ç±»å‹ç‰¹æ®Šå¤„ç†çš„æ–¹å¼å®ç°åµŒå¥—æ ¼å¼çš„æ”¯æŒï¼Œä¾‹å¦‚å¯¹äºå¦‚ä¸‹çš„hiveè¡¨ï¼š 12345CREATE TABLE `orcStructTable`( `name` string, `course` struct&lt;course:string,score:int&gt;, `score` map&lt;string,int&gt;, `work_locations` array&lt;string&gt;) å›¾5 ORCçš„schemaç»“æ„ åœ¨ORCçš„ç»“æ„ä¸­è¿™ä¸ªschemaåŒ…å«10ä¸ªcolumnï¼Œå…¶ä¸­åŒ…å«äº†å¤æ‚ç±»å‹åˆ—å’ŒåŸå§‹ç±»å‹çš„åˆ—ï¼Œå‰è€…åŒ…æ‹¬LISTã€STRUCTã€MAPå’ŒUNIONç±»å‹ï¼Œåè€…åŒ…æ‹¬BOOLEANã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ç±»å‹ç­‰ï¼Œå…¶ä¸­STRUCTçš„å­©å­èŠ‚ç‚¹åŒ…æ‹¬å®ƒçš„æˆå‘˜å˜é‡ï¼Œå¯èƒ½æœ‰å¤šä¸ªå­©å­èŠ‚ç‚¹ï¼ŒMAPæœ‰ä¸¤ä¸ªå­©å­èŠ‚ç‚¹ï¼Œåˆ†åˆ«ä¸ºkeyå’Œvalueï¼ŒLISTåŒ…å«ä¸€ä¸ªå­©å­èŠ‚ç‚¹ï¼Œç±»å‹ä¸ºè¯¥LISTçš„æˆå‘˜ç±»å‹ï¼ŒUNIONä¸€èˆ¬ä¸æ€ä¹ˆç”¨å¾—åˆ°ã€‚æ¯ä¸€ä¸ªSchemaæ ‘çš„æ ¹èŠ‚ç‚¹ä¸ºä¸€ä¸ªStructç±»å‹ï¼Œæ‰€æœ‰çš„columnæŒ‰ç…§æ ‘çš„ä¸­åºéå†é¡ºåºç¼–å·ã€‚ ORCåªéœ€è¦å­˜å‚¨schemaæ ‘ä¸­å¶å­èŠ‚ç‚¹çš„å€¼ï¼Œè€Œä¸­é—´çš„éå¶å­èŠ‚ç‚¹åªæ˜¯åšä¸€å±‚ä»£ç†ï¼Œå®ƒä»¬åªéœ€è¦è´Ÿè´£å­©å­èŠ‚ç‚¹å€¼å¾—è¯»å–ï¼Œåªæœ‰çœŸæ­£çš„å¶å­èŠ‚ç‚¹æ‰ä¼šè¯»å–æ•°æ®ï¼Œç„¶åäº¤ç”±çˆ¶èŠ‚ç‚¹å°è£…æˆå¯¹åº”çš„æ•°æ®ç»“æ„è¿”å›ã€‚ æ–‡ä»¶ç»“æ„å’ŒParquetç±»ä¼¼ï¼ŒORCæ–‡ä»¶ä¹Ÿæ˜¯ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œæ‰€ä»¥æ˜¯ä¸å¯ä»¥ç›´æ¥è¯»å–ï¼ŒORCæ–‡ä»¶ä¹Ÿæ˜¯è‡ªè§£æçš„ï¼Œå®ƒåŒ…å«è®¸å¤šçš„å…ƒæ•°æ®ï¼Œè¿™äº›å…ƒæ•°æ®éƒ½æ˜¯åŒæ„ProtoBufferè¿›è¡Œåºåˆ—åŒ–çš„ã€‚ORCçš„æ–‡ä»¶ç»“æ„å…¥å›¾6ï¼Œå…¶ä¸­æ¶‰åŠåˆ°å¦‚ä¸‹çš„æ¦‚å¿µï¼š ORCæ–‡ä»¶ï¼šä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ™®é€šäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸€ä¸ªORCæ–‡ä»¶ä¸­å¯ä»¥åŒ…å«å¤šä¸ªstripeï¼Œæ¯ä¸€ä¸ªstripeåŒ…å«å¤šæ¡è®°å½•ï¼Œè¿™äº›è®°å½•æŒ‰ç…§åˆ—è¿›è¡Œç‹¬ç«‹å­˜å‚¨ï¼Œå¯¹åº”åˆ°Parquetä¸­çš„row groupçš„æ¦‚å¿µã€‚ æ–‡ä»¶çº§å…ƒæ•°æ®ï¼šåŒ…æ‹¬æ–‡ä»¶çš„æè¿°ä¿¡æ¯PostScriptã€æ–‡ä»¶metaä¿¡æ¯ï¼ˆåŒ…æ‹¬æ•´ä¸ªæ–‡ä»¶çš„ç»Ÿè®¡ä¿¡æ¯ï¼‰ã€æ‰€æœ‰stripeçš„ä¿¡æ¯å’Œæ–‡ä»¶schemaä¿¡æ¯ã€‚ stripeï¼šä¸€ç»„è¡Œå½¢æˆä¸€ä¸ªstripeï¼Œæ¯æ¬¡è¯»å–æ–‡ä»¶æ˜¯ä»¥è¡Œç»„ä¸ºå•ä½çš„ï¼Œä¸€èˆ¬ä¸ºHDFSçš„å—å¤§å°ï¼Œä¿å­˜äº†æ¯ä¸€åˆ—çš„ç´¢å¼•å’Œæ•°æ®ã€‚ stripeå…ƒæ•°æ®ï¼šä¿å­˜stripeçš„ä½ç½®ã€æ¯ä¸€ä¸ªåˆ—çš„åœ¨è¯¥stripeçš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠæ‰€æœ‰çš„streamç±»å‹å’Œä½ç½®ã€‚ row groupï¼šç´¢å¼•çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªstripeä¸­åŒ…å«å¤šä¸ªrow groupï¼Œé»˜è®¤ä¸º10000ä¸ªå€¼ç»„æˆã€‚ streamï¼šä¸€ä¸ªstreamè¡¨ç¤ºæ–‡ä»¶ä¸­ä¸€æ®µæœ‰æ•ˆçš„æ•°æ®ï¼ŒåŒ…æ‹¬ç´¢å¼•å’Œæ•°æ®ä¸¤ç±»ã€‚ç´¢å¼•streamä¿å­˜æ¯ä¸€ä¸ªrow groupçš„ä½ç½®å’Œç»Ÿè®¡ä¿¡æ¯ï¼Œæ•°æ®streamåŒ…æ‹¬å¤šç§ç±»å‹çš„æ•°æ®ï¼Œå…·ä½“éœ€è¦å“ªå‡ ç§æ˜¯ç”±è¯¥åˆ—ç±»å‹å’Œç¼–ç æ–¹å¼å†³å®šã€‚ å›¾6 ORCæ–‡ä»¶ç»“æ„ åœ¨ORCæ–‡ä»¶ä¸­ä¿å­˜äº†ä¸‰ä¸ªå±‚çº§çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œåˆ†åˆ«ä¸ºæ–‡ä»¶çº§åˆ«ã€stripeçº§åˆ«å’Œrow groupçº§åˆ«çš„ï¼Œä»–ä»¬éƒ½å¯ä»¥ç”¨æ¥æ ¹æ®Search ARGumentsï¼ˆè°“è¯ä¸‹æ¨æ¡ä»¶ï¼‰åˆ¤æ–­æ˜¯å¦å¯ä»¥è·³è¿‡æŸäº›æ•°æ®ï¼Œåœ¨ç»Ÿè®¡ä¿¡æ¯ä¸­éƒ½åŒ…å«æˆå‘˜æ•°å’Œæ˜¯å¦æœ‰nullå€¼ï¼Œå¹¶ä¸”å¯¹äºä¸åŒç±»å‹çš„æ•°æ®è®¾ç½®ä¸€äº›ç‰¹å®šçš„ç»Ÿè®¡ä¿¡æ¯ã€‚ æ•°æ®è®¿é—®è¯»å–ORCæ–‡ä»¶æ˜¯ä»å°¾éƒ¨å¼€å§‹çš„ï¼Œç¬¬ä¸€æ¬¡è¯»å–16KBçš„å¤§å°ï¼Œå°½å¯èƒ½çš„å°†Postscriptå’ŒFooteræ•°æ®éƒ½è¯»å…¥å†…å­˜ã€‚æ–‡ä»¶çš„æœ€åä¸€ä¸ªå­—èŠ‚ä¿å­˜ç€PostScriptçš„é•¿åº¦ï¼Œå®ƒçš„é•¿åº¦ä¸ä¼šè¶…è¿‡256å­—èŠ‚ï¼ŒPostScriptä¸­ä¿å­˜ç€æ•´ä¸ªæ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå®ƒåŒ…æ‹¬æ–‡ä»¶çš„å‹ç¼©æ ¼å¼ã€æ–‡ä»¶å†…éƒ¨æ¯ä¸€ä¸ªå‹ç¼©å—çš„æœ€å¤§é•¿åº¦(æ¯æ¬¡åˆ†é…å†…å­˜çš„å¤§å°)ã€Footeré•¿åº¦ï¼Œä»¥åŠä¸€äº›ç‰ˆæœ¬ä¿¡æ¯ã€‚åœ¨Postscriptå’ŒFooterä¹‹é—´å­˜å‚¨ç€æ•´ä¸ªæ–‡ä»¶çš„ç»Ÿè®¡ä¿¡æ¯(ä¸Šå›¾ä¸­æœªç”»å‡º)ï¼Œè¿™éƒ¨åˆ†çš„ç»Ÿè®¡ä¿¡æ¯åŒ…æ‹¬æ¯ä¸€ä¸ªstripeä¸­æ¯ä¸€åˆ—çš„ä¿¡æ¯ï¼Œä¸»è¦ç»Ÿè®¡æˆå‘˜æ•°ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€æ˜¯å¦æœ‰ç©ºå€¼ç­‰ã€‚ æ¥ä¸‹æ¥è¯»å–æ–‡ä»¶çš„Footerä¿¡æ¯ï¼Œå®ƒåŒ…å«äº†æ¯ä¸€ä¸ªstripeçš„é•¿åº¦å’Œåç§»é‡ï¼Œè¯¥æ–‡ä»¶çš„schemaä¿¡æ¯(å°†schemaæ ‘æŒ‰ç…§schemaä¸­çš„ç¼–å·ä¿å­˜åœ¨æ•°ç»„ä¸­)ã€æ•´ä¸ªæ–‡ä»¶çš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠæ¯ä¸€ä¸ªrow groupçš„è¡Œæ•°ã€‚ å¤„ç†stripeæ—¶é¦–å…ˆä»Footerä¸­è·å–æ¯ä¸€ä¸ªstripeçš„å…¶å®ä½ç½®å’Œé•¿åº¦ã€æ¯ä¸€ä¸ªstripeçš„Footeræ•°æ®(å…ƒæ•°æ®ï¼Œè®°å½•äº†indexå’Œdataçš„çš„é•¿åº¦)ï¼Œæ•´ä¸ªstriperè¢«åˆ†ä¸ºindexå’Œdataä¸¤éƒ¨åˆ†ï¼Œstripeå†…éƒ¨æ˜¯æŒ‰ç…§row groupè¿›è¡Œåˆ†å—çš„(æ¯ä¸€ä¸ªrow groupä¸­å¤šå°‘æ¡è®°å½•åœ¨æ–‡ä»¶çš„Footerä¸­å­˜å‚¨)ï¼Œrow groupå†…éƒ¨æŒ‰åˆ—å­˜å‚¨ã€‚æ¯ä¸€ä¸ªrow groupç”±å¤šä¸ªstreamä¿å­˜æ•°æ®å’Œç´¢å¼•ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªstreamçš„æ•°æ®ä¼šæ ¹æ®è¯¥åˆ—çš„ç±»å‹ä½¿ç”¨ç‰¹å®šçš„å‹ç¼©ç®—æ³•ä¿å­˜ã€‚åœ¨ORCä¸­å­˜åœ¨å¦‚ä¸‹å‡ ç§streamç±»å‹ï¼š PRESENTï¼šæ¯ä¸€ä¸ªæˆå‘˜å€¼åœ¨è¿™ä¸ªstreamä¸­ä¿æŒä¸€ä½(bit)ç”¨äºæ ‡ç¤ºè¯¥å€¼æ˜¯å¦ä¸ºNULLï¼Œé€šè¿‡å®ƒå¯ä»¥åªè®°å½•éƒ¨ä½NULLçš„å€¼ DATAï¼šè¯¥åˆ—çš„ä¸­å±äºå½“å‰stripeçš„æˆå‘˜å€¼ã€‚ LENGTHï¼šæ¯ä¸€ä¸ªæˆå‘˜çš„é•¿åº¦ï¼Œè¿™ä¸ªæ˜¯é’ˆå¯¹stringç±»å‹çš„åˆ—æ‰æœ‰çš„ã€‚ DICTIONARY_DATAï¼šå¯¹stringç±»å‹æ•°æ®ç¼–ç ä¹‹åå­—å…¸çš„å†…å®¹ã€‚ SECONDARYï¼šå­˜å‚¨Decimalã€timestampç±»å‹çš„å°æ•°æˆ–è€…çº³ç§’æ•°ç­‰ã€‚ ROW_INDEXï¼šä¿å­˜stripeä¸­æ¯ä¸€ä¸ªrow groupçš„ç»Ÿè®¡ä¿¡æ¯å’Œæ¯ä¸€ä¸ªrow groupèµ·å§‹ä½ç½®ä¿¡æ¯ã€‚ åœ¨åˆå§‹åŒ–é˜¶æ®µè·å–å…¨éƒ¨çš„å…ƒæ•°æ®ä¹‹åï¼Œå¯ä»¥é€šè¿‡includesæ•°ç»„æŒ‡å®šéœ€è¦è¯»å–çš„åˆ—ç¼–å·ï¼Œå®ƒæ˜¯ä¸€ä¸ªbooleanæ•°ç»„ï¼Œå¦‚æœä¸æŒ‡å®šåˆ™è¯»å–å…¨éƒ¨çš„åˆ—ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¼ é€’SearchArgumentå‚æ•°æŒ‡å®šè¿‡æ»¤æ¡ä»¶ï¼Œæ ¹æ®å…ƒæ•°æ®é¦–å…ˆè¯»å–æ¯ä¸€ä¸ªstripeä¸­çš„indexä¿¡æ¯ï¼Œç„¶åæ ¹æ®indexä¸­ç»Ÿè®¡ä¿¡æ¯ä»¥åŠSearchArgumentå‚æ•°ç¡®å®šéœ€è¦è¯»å–çš„row groupç¼–å·ï¼Œå†æ ¹æ®includesæ•°æ®å†³å®šéœ€è¦ä»è¿™äº›row groupä¸­è¯»å–çš„åˆ—ï¼Œé€šè¿‡è¿™ä¸¤å±‚çš„è¿‡æ»¤éœ€è¦è¯»å–çš„æ•°æ®åªæ˜¯æ•´ä¸ªstripeå¤šä¸ªå°æ®µçš„åŒºé—´ï¼Œç„¶åORCä¼šå°½å¯èƒ½åˆå¹¶å¤šä¸ªç¦»æ•£çš„åŒºé—´å°½å¯èƒ½çš„å‡å°‘I/Oæ¬¡æ•°ã€‚ç„¶åå†æ ¹æ®indexä¸­ä¿å­˜çš„ä¸‹ä¸€ä¸ªrow groupçš„ä½ç½®ä¿¡æ¯è°ƒè‡³è¯¥stripeä¸­ç¬¬ä¸€ä¸ªéœ€è¦è¯»å–çš„row groupä¸­ã€‚ ç”±äºORCä¸­ä½¿ç”¨äº†æ›´åŠ ç²¾ç¡®çš„ç´¢å¼•ä¿¡æ¯ï¼Œä½¿å¾—åœ¨è¯»å–æ•°æ®æ—¶å¯ä»¥æŒ‡å®šä»ä»»æ„ä¸€è¡Œå¼€å§‹è¯»å–ï¼Œæ›´ç»†ç²’åº¦çš„ç»Ÿè®¡ä¿¡æ¯ä½¿å¾—è¯»å–ORCæ–‡ä»¶è·³è¿‡æ•´ä¸ªrow groupï¼ŒORCé»˜è®¤ä¼šå¯¹ä»»ä½•ä¸€å—æ•°æ®å’Œç´¢å¼•ä¿¡æ¯ä½¿ç”¨ZLIBå‹ç¼©ï¼Œå› æ­¤ORCæ–‡ä»¶å ç”¨çš„å­˜å‚¨ç©ºé—´ä¹Ÿæ›´å°ï¼Œè¿™ç‚¹åœ¨åé¢çš„æµ‹è¯•å¯¹æ¯”ä¸­ä¹Ÿæœ‰æ‰€å°è¯ã€‚ åœ¨æ–°ç‰ˆæœ¬çš„ORCä¸­ä¹ŸåŠ å…¥äº†å¯¹Bloom Filterçš„æ”¯æŒï¼Œå®ƒå¯ä»¥è¿›ä¸€æ­¥æå‡è°“è¯ä¸‹æ¨çš„æ•ˆç‡ï¼Œåœ¨Hive 1.2.0ç‰ˆæœ¬ä»¥åä¹ŸåŠ å…¥äº†å¯¹æ­¤çš„æ”¯æŒã€‚ æ€§èƒ½æµ‹è¯•ä¸ºäº†å¯¹æ¯”æµ‹è¯•ä¸¤ç§å­˜å‚¨æ ¼å¼ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨TPC-DSæ•°æ®é›†å¹¶ä¸”å¯¹å®ƒè¿›è¡Œæ”¹é€ ä»¥ç”Ÿæˆå®½è¡¨ã€åµŒå¥—å’Œå¤šå±‚åµŒå¥—çš„æ•°æ®ã€‚ä½¿ç”¨æœ€å¸¸ç”¨çš„Hiveä½œä¸ºSQLå¼•æ“è¿›è¡Œæµ‹è¯•ã€‚ æµ‹è¯•ç¯å¢ƒ Hadoopé›†ç¾¤ï¼šç‰©ç†æµ‹è¯•é›†ç¾¤ï¼Œå››å°DataNode/NodeManageræœºå™¨ï¼Œæ¯ä¸ªæœºå™¨32core+128GBï¼Œæµ‹è¯•æ—¶ä½¿ç”¨æ•´ä¸ªé›†ç¾¤çš„èµ„æºã€‚ Hiveï¼šHive 1.2.1ç‰ˆæœ¬ï¼Œä½¿ç”¨hiveserver2å¯åŠ¨ï¼Œæœ¬æœºMySqlä½œä¸ºå…ƒæ•°æ®åº“ï¼Œjdbcæ–¹å¼æäº¤æŸ¥è¯¢SQL æ•°æ®é›†ï¼š100GB TPC-DSæ•°æ®é›†ï¼Œé€‰å–å…¶ä¸­çš„Store_Salesä¸ºäº‹å®è¡¨çš„æ¨¡å‹ä½œä¸ºæµ‹è¯•æ•°æ® æŸ¥è¯¢SQLï¼šé€‰æ‹©TPC-DSä¸­æ¶‰åŠåˆ°ä¸Šè¿°æ¨¡å‹çš„10æ¡SQLå¹¶å¯¹å…¶è¿›è¡Œæ”¹é€ ã€‚ æµ‹è¯•åœºæ™¯å’Œç»“æœæ•´ä¸ªæµ‹è¯•è®¾ç½®äº†å››ç§åœºæ™¯ï¼Œæ¯ä¸€ç§åœºæ™¯ä¸‹å¯¹æ¯”æµ‹è¯•æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´çš„å¤§å°å’Œç›¸åŒæŸ¥è¯¢æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´å¯¹æ¯”ï¼Œé™¤äº†åœºæ™¯ä¸€åŸºäºåŸå§‹çš„TPC-DSæ•°æ®é›†å¤–ï¼Œå…¶ä½™çš„æ•°æ®éƒ½éœ€è¦è¿›è¡Œæ•°æ®å¯¼å…¥ï¼ŒåŒæ—¶å¯¹æ¯”è¿™å‡ ä¸ªåœºæ™¯çš„æ•°æ®å¯¼å…¥æ—¶é—´ã€‚ åœºæ™¯ä¸€ï¼šä¸€ä¸ªäº‹å®è¡¨ã€å¤šä¸ªç»´åº¦è¡¨ï¼Œå¤æ‚çš„joinæŸ¥è¯¢ã€‚åŸºäºåŸå§‹çš„TPC-DSæ•°æ®é›†ã€‚ Store_Salesè¡¨è®°å½•æ•°ï¼š287,997,024ï¼Œè¡¨å¤§å°ä¸ºï¼š åŸå§‹Textæ ¼å¼ï¼Œæœªå‹ç¼© : 38.1 G ORCæ ¼å¼ï¼Œé»˜è®¤å‹ç¼©ï¼ˆZLIBï¼‰,ä¸€å…±1800+ä¸ªåˆ†åŒº : 11.5 G Parquetæ ¼å¼ï¼Œé»˜è®¤å‹ç¼©ï¼ˆSnappyï¼‰ï¼Œä¸€å…±1800+ä¸ªåˆ†åŒº ï¼š 14.8 G æŸ¥è¯¢æµ‹è¯•ç»“æœï¼š åœºæ™¯äºŒï¼šç»´åº¦è¡¨å’Œäº‹å®è¡¨joinä¹‹åç”Ÿæˆçš„å®½è¡¨ï¼Œåªåœ¨ä¸€ä¸ªè¡¨ä¸ŠåšæŸ¥è¯¢ã€‚æ•´ä¸ªæµ‹è¯•è®¾ç½®äº†å››ç§åœºæ™¯ï¼Œæ¯ä¸€ç§åœºæ™¯ä¸‹å¯¹æ¯”æµ‹è¯•æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´çš„å¤§å°å’Œç›¸åŒæŸ¥è¯¢æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´å¯¹æ¯”ï¼Œé™¤äº†åœºæ™¯ä¸€åŸºäºåŸå§‹çš„TPC-DSæ•°æ®é›†å¤–ï¼Œå…¶ä½™çš„æ•°æ®éƒ½éœ€è¦è¿›è¡Œæ•°æ®å¯¼å…¥ï¼ŒåŒæ—¶å¯¹æ¯”è¿™å‡ ä¸ªåœºæ™¯çš„æ•°æ®å¯¼å…¥æ—¶é—´ã€‚é€‰å–æ•°æ®æ¨¡å‹ä¸­çš„store_sales, household_demographics, customer_address, date_dim, storeè¡¨ç”Ÿæˆä¸€ä¸ªæ‰å¹³å¼å®½è¡¨(store_sales_wide_table)ï¼ŒåŸºäºè¿™ä¸ªè¡¨æ‰§è¡ŒæŸ¥è¯¢ï¼Œç”±äºåœºæ™¯ä¸€ç§é€‰æ‹©çš„queryå¤§å¤šæ•°ä¸èƒ½å®Œå…¨matchåˆ°è¿™ä¸ªå®½è¡¨ï¼Œæ‰€ä»¥å¯¹åœºæ™¯1ä¸­çš„SQLè¿›è¡Œéƒ¨åˆ†æ”¹é€ ã€‚ store_sales_wide_tableè¡¨è®°å½•æ•°ï¼š263,704,266ï¼Œè¡¨å¤§å°ä¸ºï¼š åŸå§‹Textæ ¼å¼ï¼Œæœªå‹ç¼© ï¼š 149.0 G ORCæ ¼å¼ï¼Œé»˜è®¤å‹ç¼© ï¼š 10.6 G PARQUETæ ¼å¼ï¼Œé»˜è®¤å‹ç¼© ï¼š 12.5 G æŸ¥è¯¢æµ‹è¯•ç»“æœï¼š åœºæ™¯ä¸‰ï¼šå¤æ‚çš„æ•°æ®ç»“æ„ç»„æˆçš„å®½è¡¨ï¼Œstructã€listã€mapç­‰ï¼ˆ1å±‚ï¼‰æ•´ä¸ªæµ‹è¯•è®¾ç½®äº†å››ç§åœºæ™¯ï¼Œæ¯ä¸€ç§åœºæ™¯ä¸‹å¯¹æ¯”æµ‹è¯•æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´çš„å¤§å°å’Œç›¸åŒæŸ¥è¯¢æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´å¯¹æ¯”ï¼Œé™¤äº†åœºæ™¯ä¸€åŸºäºåŸå§‹çš„TPC-DSæ•°æ®é›†å¤–ï¼Œå…¶ä½™çš„æ•°æ®éƒ½éœ€è¦è¿›è¡Œæ•°æ®å¯¼å…¥ï¼ŒåŒæ—¶å¯¹æ¯”è¿™å‡ ä¸ªåœºæ™¯çš„æ•°æ®å¯¼å…¥æ—¶é—´ã€‚åœ¨åœºæ™¯äºŒçš„åŸºç¡€ä¸Šï¼Œå°†ç»´åº¦è¡¨ï¼ˆé™¤äº†store_salesè¡¨ï¼‰è½¬æ¢æˆä¸€ä¸ªstructæˆ–è€…mapå¯¹è±¡ï¼Œæºstore_salesè¡¨ä¸­çš„å­—æ®µä¿æŒä¸å˜ã€‚ç”Ÿæˆæœ‰ä¸€å±‚åµŒå¥—çš„æ–°è¡¨ï¼ˆstore_sales_wide_table_one_nestedï¼‰ï¼Œä½¿ç”¨çš„æŸ¥è¯¢é€»è¾‘ç›¸åŒã€‚ store_sales_wide_table_one_nestedè¡¨è®°å½•æ•°ï¼š263,704,266ï¼Œè¡¨å¤§å°ä¸ºï¼š åŸå§‹Textæ ¼å¼ï¼Œæœªå‹ç¼© ï¼š 245.3 G ORCæ ¼å¼ï¼Œé»˜è®¤å‹ç¼© ï¼š 10.9 G PARQUETæ ¼å¼ï¼Œé»˜è®¤å‹ç¼© ï¼š 29.8 G æŸ¥è¯¢æµ‹è¯•ç»“æœï¼š åœºæ™¯å››ï¼šå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¤šå±‚åµŒå¥—ã€‚ï¼ˆ3å±‚ï¼‰æ•´ä¸ªæµ‹è¯•è®¾ç½®äº†å››ç§åœºæ™¯ï¼Œæ¯ä¸€ç§åœºæ™¯ä¸‹å¯¹æ¯”æµ‹è¯•æ•°æ®å ç”¨çš„å­˜å‚¨ç©ºé—´çš„å¤§å°å’Œç›¸åŒæŸ¥è¯¢æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´å¯¹æ¯”ï¼Œé™¤äº†åœºæ™¯ä¸€åŸºäºåŸå§‹çš„TPC-DSæ•°æ®é›†å¤–ï¼Œå…¶ä½™çš„æ•°æ®éƒ½éœ€è¦è¿›è¡Œæ•°æ®å¯¼å…¥ï¼ŒåŒæ—¶å¯¹æ¯”è¿™å‡ ä¸ªåœºæ™¯çš„æ•°æ®å¯¼å…¥æ—¶é—´ã€‚åœ¨åœºæ™¯ä¸‰çš„åŸºç¡€ä¸Šï¼Œå°†éƒ¨åˆ†ç»´åº¦è¡¨çš„structå†…çš„å­—æ®µå†è½¬æ¢æˆstructæˆ–è€…mapå¯¹è±¡ï¼Œåªå­˜åœ¨structä¸­åµŒå¥—mapçš„æƒ…å†µï¼Œæœ€æ·±çš„åµŒå¥—ä¸ºä¸‰å±‚ã€‚ç”Ÿæˆä¸€ä¸ªå¤šå±‚åµŒå¥—çš„æ–°è¡¨ï¼ˆstore_sales_wide_table_more_nestedï¼‰ï¼Œä½¿ç”¨çš„æŸ¥è¯¢é€»è¾‘ç›¸åŒã€‚ è¯¥åœºæ™¯ä¸­åªæ¶‰åŠä¸€ä¸ªå¤šå±‚åµŒå¥—çš„å®½è¡¨ï¼Œæ²¡æœ‰ä»»ä½•åˆ†åŒºå­—æ®µï¼Œstore_sales_wide_table_more_nestedè¡¨è®°å½•æ•°ï¼š263,704,266ï¼Œè¡¨å¤§å°ä¸ºï¼š åŸå§‹Textæ ¼å¼ï¼Œæœªå‹ç¼© ï¼š 222.7 G ORCæ ¼å¼ï¼Œé»˜è®¤å‹ç¼© ï¼š 10.9 G PARQUETæ ¼å¼ï¼Œé»˜è®¤å‹ç¼© ï¼š 23.1 G æ¯”ä¸€å±‚åµŒå¥—è¡¨store_sales_wide_table_one_nestedè¦å°ï¼Ÿ æŸ¥è¯¢æµ‹è¯•ç»“æœï¼š ç»“æœåˆ†æä»ä¸Šè¿°æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œæ˜ŸçŠ¶æ¨¡å‹å¯¹äºæ•°æ®åˆ†æåœºæ™¯å¹¶ä¸æ˜¯å¾ˆåˆé€‚ï¼Œå¤šä¸ªè¡¨çš„joinä¼šå¤§å¤§æ‹–æ…¢æŸ¥è¯¢é€Ÿåº¦ï¼Œå¹¶ä¸”ä¸èƒ½å¾ˆå¥½çš„åˆ©ç”¨åˆ—å¼å­˜å‚¨å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œåœ¨ä½¿ç”¨å®½è¡¨çš„æƒ…å†µä¸‹ï¼Œåˆ—å¼å­˜å‚¨çš„æ€§èƒ½æå‡æ˜æ˜¾ï¼ŒORCæ–‡ä»¶æ ¼å¼åœ¨å­˜å‚¨ç©ºé—´ä¸Šè¦è¿œä¼˜äºTextæ ¼å¼ï¼Œè¾ƒä¹‹äºPARQUETæ ¼å¼æœ‰ä¸€å€çš„å­˜å‚¨ç©ºé—´æå‡ï¼Œåœ¨å¯¼æ•°æ®ï¼ˆinsert into table select è¿™æ ·çš„æ–¹å¼ï¼‰æ–¹é¢ORCæ ¼å¼ä¹Ÿè¦ä¼˜äºPARQUETï¼Œåœ¨æœ€ç»ˆçš„æŸ¥è¯¢æ€§èƒ½ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯æ— åµŒå¥—çš„æ‰å¹³å¼å®½è¡¨ï¼Œæˆ–æ˜¯ä¸€å±‚åµŒå¥—è¡¨ï¼Œè¿˜æ˜¯å¤šå±‚åµŒå¥—çš„å®½è¡¨ï¼Œä¸¤è€…çš„æŸ¥è¯¢æ€§èƒ½ç›¸å·®ä¸å¤šï¼Œè¾ƒä¹‹äºTextæ ¼å¼æœ‰2åˆ°3å€å·¦å³çš„æå‡ã€‚ å¦å¤–ï¼Œé€šè¿‡å¯¹æ¯”åœºæ™¯äºŒå’Œåœºæ™¯ä¸‰çš„æµ‹è¯•ç»“æœï¼Œå¯ä»¥å‘ç°æ‰å¹³å¼çš„è¡¨ç»“æ„è¦æ¯”åµŒå¥—å¼ç»“æ„çš„æŸ¥è¯¢æ€§èƒ½æœ‰æ‰€æå‡ï¼Œæ‰€ä»¥å¦‚æœé€‰æ‹©ä½¿ç”¨å¤§å®½è¡¨ï¼Œåˆ™è®¾è®¡å®½è¡¨çš„æ—¶å€™å°½å¯èƒ½çš„å°†è¡¨è®¾è®¡çš„æ‰å¹³åŒ–ï¼Œå‡å°‘åµŒå¥—æ•°æ®ã€‚ é€šè¿‡è¿™ä¸‰ç§æ–‡ä»¶å­˜å‚¨æ ¼å¼çš„æµ‹è¯•å¯¹æ¯”ï¼ŒORCæ–‡ä»¶å­˜å‚¨æ ¼å¼æ— è®ºæ˜¯åœ¨ç©ºé—´å­˜å‚¨ã€å¯¼æ•°æ®é€Ÿåº¦è¿˜æ˜¯æŸ¥è¯¢é€Ÿåº¦ä¸Šè¡¨ç°çš„éƒ½è¾ƒå¥½ä¸€äº›ï¼Œå¹¶ä¸”ORCå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ”¯æŒACIDæ“ä½œï¼Œç¤¾åŒºçš„å‘å±•ç›®å‰ä¹Ÿæ˜¯Hiveä¸­æ¯”è¾ƒæå€¡ä½¿ç”¨çš„ä¸€ç§åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œå¦å¤–ï¼Œæœ¬æ¬¡æµ‹è¯•ä¸»è¦é’ˆå¯¹çš„æ˜¯Hiveå¼•æ“ï¼Œæ‰€ä»¥ä¸æ’é™¤å­˜åœ¨Hiveä¸ORCçš„æ•æ„Ÿåº¦æ¯”PARQUETè¦é«˜çš„å¯èƒ½æ€§ã€‚ æ€»ç»“æœ¬æ–‡ä¸»è¦ä»æ•°æ®æ¨¡å‹ã€æ–‡ä»¶æ ¼å¼å’Œæ•°æ®è®¿é—®æµç¨‹ç­‰å‡ ä¸ªæ–¹é¢è¯¦ç»†ä»‹ç»äº†Hadoopç”Ÿæ€åœˆä¸­çš„ä¸¤ç§åˆ—å¼å­˜å‚¨æ ¼å¼â€”â€”Parquetå’ŒORCï¼Œå¹¶é€šè¿‡å¤§æ•°æ®é‡çš„æµ‹è¯•å¯¹ä¸¤è€…çš„å­˜å‚¨å’ŒæŸ¥è¯¢æ€§èƒ½è¿›è¡Œäº†å¯¹æ¯”ã€‚å¯¹äºå¤§æ•°æ®åœºæ™¯ä¸‹çš„æ•°æ®åˆ†æéœ€æ±‚ï¼Œä½¿ç”¨è¿™ä¸¤ç§å­˜å‚¨æ ¼å¼æ€»ä¼šå¸¦æ¥å­˜å‚¨å’Œæ€§èƒ½ä¸Šçš„æå‡ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨æ—¶è¿˜éœ€è¦é’ˆå¯¹å®é™…çš„æ•°æ®è¿›è¡Œé€‰æ‹©ã€‚å¦å¤–ç”±äºä¸åŒå¼€æºäº§å“å¯èƒ½å¯¹ä¸åŒçš„å­˜å‚¨æ ¼å¼æœ‰ç‰¹å®šçš„ä¼˜åŒ–ï¼Œæ‰€ä»¥é€‰æ‹©æ—¶è¿˜éœ€è¦è€ƒè™‘æŸ¥è¯¢å¼•æ“çš„å› ç´ ã€‚ æ‹“å±•é˜…è¯»ï¼šsparkå…³äºparquetçš„ä¼˜åŒ–","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"},{"name":"parquet","slug":"parquet","permalink":"https://stanxia.github.io/tags/parquet/"},{"name":"orc","slug":"orc","permalink":"https://stanxia.github.io/tags/orc/"}]},{"title":"sparkåˆ†å±‚å–æ ·","slug":"sparkåˆ†å±‚å–æ ·","date":"2017-11-27T16:57:10.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/11/27/sparkåˆ†å±‚å–æ ·/","link":"","permalink":"https://stanxia.github.io/2017/11/27/sparkåˆ†å±‚å–æ ·/","excerpt":"å…ˆå°†æ€»ä½“çš„å•ä½æŒ‰æŸç§ç‰¹å¾åˆ†ä¸ºè‹¥å¹²æ¬¡çº§æ€»ä½“ï¼ˆå±‚ï¼‰ï¼Œç„¶åå†ä»æ¯ä¸€å±‚å†…è¿›è¡Œå•çº¯éšæœºæŠ½æ ·ï¼Œç»„æˆä¸€ä¸ªæ ·æœ¬çš„ç»Ÿè®¡å­¦è®¡ç®—æ–¹æ³•å«åšåˆ†å±‚æŠ½æ ·ã€‚åœ¨spark.mllibä¸­ï¼Œç”¨keyæ¥åˆ†å±‚ã€‚\nä¸å­˜åœ¨äºspark.mllibä¸­çš„å…¶å®ƒç»Ÿè®¡å‡½æ•°ä¸åŒï¼Œåˆ†å±‚é‡‡æ ·æ–¹æ³•sampleByKeyå’ŒsampleByKeyExactå¯ä»¥åœ¨key-valueå¯¹çš„RDDä¸Šæ‰§è¡Œã€‚åœ¨åˆ†å±‚é‡‡æ ·ä¸­ï¼Œå¯ä»¥è®¤ä¸ºkeyæ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼Œvalueæ˜¯ç‰¹å®šçš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œkeyå¯ä»¥æ˜¯ç”·äººæˆ–è€…å¥³äººæˆ–è€…æ–‡æ¡£id,å®ƒç›¸åº”çš„valueå¯èƒ½æ˜¯ä¸€ç»„å¹´é¾„æˆ–è€…æ˜¯æ–‡æ¡£ä¸­çš„è¯ã€‚sampleByKeyæ–¹æ³•é€šè¿‡æ·ç¡¬å¸çš„æ–¹å¼å†³å®šæ˜¯å¦é‡‡æ ·ä¸€ä¸ªè§‚å¯Ÿæ•°æ®ï¼Œå› æ­¤å®ƒéœ€è¦æˆ‘ä»¬ä¼ é€’ï¼ˆpass overï¼‰æ•°æ®å¹¶ä¸”æä¾›æœŸæœ›çš„æ•°æ®å¤§å°(size)ã€‚sampleByKeyExactæ¯”æ¯å±‚ä½¿ç”¨sampleByKeyéšæœºæŠ½æ ·éœ€è¦æ›´å¤šçš„æœ‰æ„ä¹‰çš„èµ„æºï¼Œä½†æ˜¯å®ƒèƒ½ä½¿æ ·æœ¬å¤§å°çš„å‡†ç¡®æ€§è¾¾åˆ°äº†99.99%ã€‚\nsampleByKeyExact()å…è®¸ç”¨æˆ·å‡†ç¡®æŠ½å–f_k * n_kä¸ªæ ·æœ¬ï¼Œè¿™é‡Œf_kè¡¨ç¤ºæœŸæœ›è·å–é”®ä¸ºkçš„æ ·æœ¬çš„æ¯”ä¾‹ï¼Œn_kè¡¨ç¤ºé”®ä¸ºkçš„é”®å€¼å¯¹çš„æ•°é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨çš„ä¾‹å­ï¼š","text":"å…ˆå°†æ€»ä½“çš„å•ä½æŒ‰æŸç§ç‰¹å¾åˆ†ä¸ºè‹¥å¹²æ¬¡çº§æ€»ä½“ï¼ˆå±‚ï¼‰ï¼Œç„¶åå†ä»æ¯ä¸€å±‚å†…è¿›è¡Œå•çº¯éšæœºæŠ½æ ·ï¼Œç»„æˆä¸€ä¸ªæ ·æœ¬çš„ç»Ÿè®¡å­¦è®¡ç®—æ–¹æ³•å«åšåˆ†å±‚æŠ½æ ·ã€‚åœ¨spark.mllibä¸­ï¼Œç”¨keyæ¥åˆ†å±‚ã€‚ ä¸å­˜åœ¨äºspark.mllibä¸­çš„å…¶å®ƒç»Ÿè®¡å‡½æ•°ä¸åŒï¼Œåˆ†å±‚é‡‡æ ·æ–¹æ³•sampleByKeyå’ŒsampleByKeyExactå¯ä»¥åœ¨key-valueå¯¹çš„RDDä¸Šæ‰§è¡Œã€‚åœ¨åˆ†å±‚é‡‡æ ·ä¸­ï¼Œå¯ä»¥è®¤ä¸ºkeyæ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼Œvalueæ˜¯ç‰¹å®šçš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œkeyå¯ä»¥æ˜¯ç”·äººæˆ–è€…å¥³äººæˆ–è€…æ–‡æ¡£id,å®ƒç›¸åº”çš„valueå¯èƒ½æ˜¯ä¸€ç»„å¹´é¾„æˆ–è€…æ˜¯æ–‡æ¡£ä¸­çš„è¯ã€‚sampleByKeyæ–¹æ³•é€šè¿‡æ·ç¡¬å¸çš„æ–¹å¼å†³å®šæ˜¯å¦é‡‡æ ·ä¸€ä¸ªè§‚å¯Ÿæ•°æ®ï¼Œå› æ­¤å®ƒéœ€è¦æˆ‘ä»¬ä¼ é€’ï¼ˆpass overï¼‰æ•°æ®å¹¶ä¸”æä¾›æœŸæœ›çš„æ•°æ®å¤§å°(size)ã€‚sampleByKeyExactæ¯”æ¯å±‚ä½¿ç”¨sampleByKeyéšæœºæŠ½æ ·éœ€è¦æ›´å¤šçš„æœ‰æ„ä¹‰çš„èµ„æºï¼Œä½†æ˜¯å®ƒèƒ½ä½¿æ ·æœ¬å¤§å°çš„å‡†ç¡®æ€§è¾¾åˆ°äº†99.99%ã€‚ sampleByKeyExact()å…è®¸ç”¨æˆ·å‡†ç¡®æŠ½å–f_k * n_kä¸ªæ ·æœ¬ï¼Œè¿™é‡Œf_kè¡¨ç¤ºæœŸæœ›è·å–é”®ä¸ºkçš„æ ·æœ¬çš„æ¯”ä¾‹ï¼Œn_kè¡¨ç¤ºé”®ä¸ºkçš„é”®å€¼å¯¹çš„æ•°é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨çš„ä¾‹å­ï¼š 123456789import org.apache.spark.SparkContextimport org.apache.spark.SparkContext._import org.apache.spark.rdd.PairRDDFunctionsval sc: SparkContext = ...val data = ... // an RDD[(K, V)] of any key value pairsval fractions: Map[K, Double] = ... // specify the exact fraction desired from each key// Get an exact sample from each stratumval approxSample = data.sampleByKey(withReplacement = false, fractions)val exactSample = data.sampleByKeyExact(withReplacement = false, fractions) å½“withReplacementä¸ºtrueæ—¶ï¼Œé‡‡ç”¨PoissonSamplerå–æ ·å™¨ï¼Œå½“withReplacementä¸ºfalseä½¿ï¼Œé‡‡ç”¨BernoulliSamplerå–æ ·å™¨ã€‚ 123456789101112131415161718192021def sampleByKey(withReplacement: Boolean, fractions: Map[K, Double], seed: Long = Utils.random.nextLong): RDD[(K, V)] = self.withScope &#123; val samplingFunc = if (withReplacement) &#123; StratifiedSamplingUtils.getPoissonSamplingFunction(self, fractions, false, seed) &#125; else &#123; StratifiedSamplingUtils.getBernoulliSamplingFunction(self, fractions, false, seed) &#125; self.mapPartitionsWithIndex(samplingFunc, preservesPartitioning = true) &#125;def sampleByKeyExact( withReplacement: Boolean, fractions: Map[K, Double], seed: Long = Utils.random.nextLong): RDD[(K, V)] = self.withScope &#123; val samplingFunc = if (withReplacement) &#123; StratifiedSamplingUtils.getPoissonSamplingFunction(self, fractions, true, seed) &#125; else &#123; StratifiedSamplingUtils.getBernoulliSamplingFunction(self, fractions, true, seed) &#125; self.mapPartitionsWithIndex(samplingFunc, preservesPartitioning = true) &#125; ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹sampleByKeyå’ŒsampleByKeyExactçš„å®ç°ã€‚ sampleByKeyçš„å®ç°å½“æˆ‘ä»¬éœ€è¦ä¸é‡å¤æŠ½æ ·æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æ³Šæ¾æŠ½æ ·å™¨æ¥æŠ½æ ·ã€‚å½“éœ€è¦é‡å¤æŠ½æ ·æ—¶ï¼Œç”¨ä¼¯åŠªåˆ©æŠ½æ ·å™¨æŠ½æ ·ã€‚sampleByKeyçš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå®ƒå°±æ˜¯ç»Ÿä¸€çš„éšæœºæŠ½æ ·ã€‚ æ³Šæ¾æŠ½æ ·å™¨æˆ‘ä»¬é¦–å…ˆçœ‹æ³Šæ¾æŠ½æ ·å™¨çš„å®ç°ã€‚ 12345678910111213141516171819def getPoissonSamplingFunction[K: ClassTag, V: ClassTag](rdd: RDD[(K, V)], fractions: Map[K, Double], exact: Boolean, seed: Long): (Int, Iterator[(K, V)]) =&gt; Iterator[(K, V)] = &#123; (idx: Int, iter: Iterator[(K, V)]) =&gt; &#123; //åˆå§‹åŒ–éšæœºç”Ÿæˆå™¨ val rng = new RandomDataGenerator() rng.reSeed(seed + idx) iter.flatMap &#123; item =&gt; //è·å¾—ä¸‹ä¸€ä¸ªæ³Šæ¾å€¼ val count = rng.nextPoisson(fractions(item._1)) if (count == 0) &#123; Iterator.empty &#125; else &#123; Iterator.fill(count)(item) &#125; &#125; &#125;&#125; getPoissonSamplingFunctionè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼ é€’ç»™mapPartitionsWithIndexå¤„ç†æ¯ä¸ªåˆ†åŒºçš„æ•°æ®ã€‚è¿™é‡ŒRandomDataGeneratoræ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆå™¨ï¼Œå®ƒç”¨äºåŒæ—¶ç”Ÿæˆå‡åŒ€å€¼(uniform values)å’Œæ³Šæ¾å€¼(Poisson values)ã€‚ ä¼¯åŠªåˆ©æŠ½æ ·å™¨1234567891011121314def getBernoulliSamplingFunction[K, V](rdd: RDD[(K, V)], fractions: Map[K, Double], exact: Boolean, seed: Long): (Int, Iterator[(K, V)]) =&gt; Iterator[(K, V)] = &#123; var samplingRateByKey = fractions (idx: Int, iter: Iterator[(K, V)]) =&gt; &#123; //åˆå§‹åŒ–éšæœºç”Ÿæˆå™¨ val rng = new RandomDataGenerator() rng.reSeed(seed + idx) // Must use the same invoke pattern on the rng as in getSeqOp for without replacement // in order to generate the same sequence of random numbers when creating the sample iter.filter(t =&gt; rng.nextUniform() &lt; samplingRateByKey(t._1)) &#125; &#125; sampleByKeyExactçš„å®ç°sampleByKeyExactè·å–æ›´å‡†ç¡®çš„æŠ½æ ·ç»“æœï¼Œå®ƒçš„å®ç°ä¹Ÿåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œé‡å¤æŠ½æ ·å’Œä¸é‡å¤æŠ½æ ·ã€‚å‰è€…ä½¿ç”¨æ³Šæ¾æŠ½æ ·å™¨ï¼Œåè€…ä½¿ç”¨ä¼¯åŠªåˆ©æŠ½æ ·å™¨ã€‚ æ³Šæ¾æŠ½æ ·å™¨12345678910111213141516171819202122232425val counts = Some(rdd.countByKey())//è®¡ç®—ç«‹å³æ¥å—çš„æ ·æœ¬æ•°é‡ï¼Œå¹¶ä¸”ä¸ºæ¯å±‚ç”Ÿæˆå€™é€‰åå•val finalResult = getAcceptanceResults(rdd, true, fractions, counts, seed)//å†³å®šæ¥å—æ ·æœ¬çš„é˜ˆå€¼ï¼Œç”Ÿæˆå‡†ç¡®çš„æ ·æœ¬å¤§å°val thresholdByKey = computeThresholdByKey(finalResult, fractions)(idx: Int, iter: Iterator[(K, V)]) =&gt; &#123; val rng = new RandomDataGenerator() rng.reSeed(seed + idx) iter.flatMap &#123; item =&gt; val key = item._1 val acceptBound = finalResult(key).acceptBound // Must use the same invoke pattern on the rng as in getSeqOp for with replacement // in order to generate the same sequence of random numbers when creating the sample val copiesAccepted = if (acceptBound == 0) 0L else rng.nextPoisson(acceptBound) //å€™é€‰åå• val copiesWaitlisted = rng.nextPoisson(finalResult(key).waitListBound) val copiesInSample = copiesAccepted + (0 until copiesWaitlisted).count(i =&gt; rng.nextUniform() &lt; thresholdByKey(key)) if (copiesInSample &gt; 0) &#123; Iterator.fill(copiesInSample.toInt)(item) &#125; else &#123; Iterator.empty &#125; &#125;&#125; ä¼¯åŠªåˆ©æŠ½æ ·1234567891011121314151617def getBernoulliSamplingFunction[K, V](rdd: RDD[(K, V)], fractions: Map[K, Double], exact: Boolean, seed: Long): (Int, Iterator[(K, V)]) =&gt; Iterator[(K, V)] = &#123; var samplingRateByKey = fractions //è®¡ç®—ç«‹å³æ¥å—çš„æ ·æœ¬æ•°é‡ï¼Œå¹¶ä¸”ä¸ºæ¯å±‚ç”Ÿæˆå€™é€‰åå• val finalResult = getAcceptanceResults(rdd, false, fractions, None, seed) //å†³å®šæ¥å—æ ·æœ¬çš„é˜ˆå€¼ï¼Œç”Ÿæˆå‡†ç¡®çš„æ ·æœ¬å¤§å° samplingRateByKey = computeThresholdByKey(finalResult, fractions) (idx: Int, iter: Iterator[(K, V)]) =&gt; &#123; val rng = new RandomDataGenerator() rng.reSeed(seed + idx) // Must use the same invoke pattern on the rng as in getSeqOp for without replacement // in order to generate the same sequence of random numbers when creating the sample iter.filter(t =&gt; rng.nextUniform() &lt; samplingRateByKey(t._1)) &#125; &#125;","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"},{"name":"å–æ ·","slug":"å–æ ·","permalink":"https://stanxia.github.io/tags/å–æ ·/"},{"name":"æºç ","slug":"æºç ","permalink":"https://stanxia.github.io/tags/æºç /"}]},{"title":"Dataset.scala","slug":"Dataset-scala","date":"2017-11-23T09:34:44.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/11/23/Dataset-scala/","link":"","permalink":"https://stanxia.github.io/2017/11/23/Dataset-scala/","excerpt":"å‰è¨€Dataset æ˜¯ä¸€ç§å¼ºç±»å‹çš„é¢†åŸŸç‰¹å®šå¯¹è±¡é›†åˆï¼Œå¯ä»¥åœ¨ä½¿ç”¨åŠŸèƒ½æˆ–å…³ç³»æ“ä½œçš„åŒæ—¶è¿›è¡Œè½¬æ¢ã€‚æ¯ä¸ª Dataset ä¹Ÿæœ‰ä¸€ä¸ªåä¸º â€œDataFrameâ€ çš„æ— ç±»å‹è§†å›¾ï¼Œå®ƒæ˜¯ [[Row]] çš„ Datasetã€‚Dataset ä¸Šå¯ç”¨çš„æ“ä½œåˆ†ä¸ºè½¬æ¢å’ŒåŠ¨ä½œ:\n\nè½¬æ¢ï¼šäº§ç”Ÿæ–°çš„ Dataset ï¼›åŒ…æ‹¬ map, filter, select, and aggregate (groupBy).åŠ¨ä½œï¼šè§¦å‘è®¡ç®—å¹¶è¿”å›ç»“æœ ï¼›åŒ…æ‹¬ count, show, or å†™æ•°æ®åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚\n\nDatasetæ˜¯æ‡’åŠ è½½çš„ï¼Œä¾‹å¦‚ï¼šåªæœ‰æäº¤åŠ¨ä½œçš„æ—¶å€™æ‰ä¼šè§¦å‘è®¡ç®—ã€‚åœ¨å†…éƒ¨ï¼ŒDatasetsè¡¨ç¤ºä¸€ä¸ªé€»è¾‘è®¡åˆ’ï¼Œå®ƒæè¿°ç”Ÿæˆæ•°æ®æ‰€éœ€çš„è®¡ç®—ã€‚å½“æäº¤åŠ¨ä½œæ—¶ï¼ŒSparkçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šä¼˜åŒ–é€»è¾‘è®¡åˆ’ï¼Œå¹¶ä»¥å¹¶è¡Œå’Œåˆ†å¸ƒå¼çš„æ–¹å¼ç”Ÿæˆæœ‰æ•ˆæ‰§è¡Œçš„ç‰©ç†è®¡åˆ’ã€‚è¯·ä½¿ç”¨explain åŠŸèƒ½ï¼Œæ¢ç´¢é€»è¾‘è®¡åˆ’å’Œä¼˜åŒ–çš„ç‰©ç†è®¡åˆ’ã€‚\nä¸ºäº†æœ‰æ•ˆåœ°æ”¯æŒç‰¹å®šäºé¢†åŸŸçš„å¯¹è±¡ï¼Œéœ€è¦[[Encoder]]ã€‚ç¼–ç å™¨å°†ç‰¹å®šç±»å‹çš„â€œTâ€æ˜ å°„åˆ°Sparkçš„å†…éƒ¨ç±»å‹ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼šç»™ä¸€ä¸ª Person ç±»ï¼Œå¹¶å¸¦æœ‰ä¸¤ä¸ªå±æ€§ï¼šname (string) and age (int),ç¼–ç å™¨å‘Šè¯‰Sparkåœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç ï¼Œåºåˆ—åŒ– Person å¯¹è±¡ä¸ºäºŒè¿›åˆ¶ç»“æ„ã€‚\né€šå¸¸æœ‰ä¸¤ç§åˆ›å»ºDatasetçš„æ–¹æ³•:\n\nä½¿ç”¨ SparkSession ä¸Šå¯ç”¨çš„ read æ–¹æ³•è¯»å– Spark æŒ‡å‘çš„å­˜å‚¨ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚ç”¨ç°å­˜çš„ Datasets è½¬æ¢è€Œæ¥ã€‚\n\nDatasetæ“ä½œä¹Ÿå¯ä»¥æ˜¯æ— ç±»å‹çš„ï¼Œé€šè¿‡å¤šç§é¢†åŸŸä¸“ç”¨è¯­è¨€ï¼ˆDSLï¼‰æ–¹æ³•å®šä¹‰ï¼šè¿™äº›æ“ä½œéå¸¸ç±»ä¼¼äº Ræˆ–Pythonè¯­è¨€ä¸­çš„ æ•°æ®æ¡†æ¶æŠ½è±¡ä¸­å¯ç”¨çš„æ“ä½œã€‚","text":"å‰è¨€Dataset æ˜¯ä¸€ç§å¼ºç±»å‹çš„é¢†åŸŸç‰¹å®šå¯¹è±¡é›†åˆï¼Œå¯ä»¥åœ¨ä½¿ç”¨åŠŸèƒ½æˆ–å…³ç³»æ“ä½œçš„åŒæ—¶è¿›è¡Œè½¬æ¢ã€‚æ¯ä¸ª Dataset ä¹Ÿæœ‰ä¸€ä¸ªåä¸º â€œDataFrameâ€ çš„æ— ç±»å‹è§†å›¾ï¼Œå®ƒæ˜¯ [[Row]] çš„ Datasetã€‚Dataset ä¸Šå¯ç”¨çš„æ“ä½œåˆ†ä¸ºè½¬æ¢å’ŒåŠ¨ä½œ: è½¬æ¢ï¼šäº§ç”Ÿæ–°çš„ Dataset ï¼›åŒ…æ‹¬ map, filter, select, and aggregate (groupBy).åŠ¨ä½œï¼šè§¦å‘è®¡ç®—å¹¶è¿”å›ç»“æœ ï¼›åŒ…æ‹¬ count, show, or å†™æ•°æ®åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚ Datasetæ˜¯æ‡’åŠ è½½çš„ï¼Œä¾‹å¦‚ï¼šåªæœ‰æäº¤åŠ¨ä½œçš„æ—¶å€™æ‰ä¼šè§¦å‘è®¡ç®—ã€‚åœ¨å†…éƒ¨ï¼ŒDatasetsè¡¨ç¤ºä¸€ä¸ªé€»è¾‘è®¡åˆ’ï¼Œå®ƒæè¿°ç”Ÿæˆæ•°æ®æ‰€éœ€çš„è®¡ç®—ã€‚å½“æäº¤åŠ¨ä½œæ—¶ï¼ŒSparkçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šä¼˜åŒ–é€»è¾‘è®¡åˆ’ï¼Œå¹¶ä»¥å¹¶è¡Œå’Œåˆ†å¸ƒå¼çš„æ–¹å¼ç”Ÿæˆæœ‰æ•ˆæ‰§è¡Œçš„ç‰©ç†è®¡åˆ’ã€‚è¯·ä½¿ç”¨explain åŠŸèƒ½ï¼Œæ¢ç´¢é€»è¾‘è®¡åˆ’å’Œä¼˜åŒ–çš„ç‰©ç†è®¡åˆ’ã€‚ ä¸ºäº†æœ‰æ•ˆåœ°æ”¯æŒç‰¹å®šäºé¢†åŸŸçš„å¯¹è±¡ï¼Œéœ€è¦[[Encoder]]ã€‚ç¼–ç å™¨å°†ç‰¹å®šç±»å‹çš„â€œTâ€æ˜ å°„åˆ°Sparkçš„å†…éƒ¨ç±»å‹ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼šç»™ä¸€ä¸ª Person ç±»ï¼Œå¹¶å¸¦æœ‰ä¸¤ä¸ªå±æ€§ï¼šname (string) and age (int),ç¼–ç å™¨å‘Šè¯‰Sparkåœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç ï¼Œåºåˆ—åŒ– Person å¯¹è±¡ä¸ºäºŒè¿›åˆ¶ç»“æ„ã€‚ é€šå¸¸æœ‰ä¸¤ç§åˆ›å»ºDatasetçš„æ–¹æ³•: ä½¿ç”¨ SparkSession ä¸Šå¯ç”¨çš„ read æ–¹æ³•è¯»å– Spark æŒ‡å‘çš„å­˜å‚¨ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚ç”¨ç°å­˜çš„ Datasets è½¬æ¢è€Œæ¥ã€‚ Datasetæ“ä½œä¹Ÿå¯ä»¥æ˜¯æ— ç±»å‹çš„ï¼Œé€šè¿‡å¤šç§é¢†åŸŸä¸“ç”¨è¯­è¨€ï¼ˆDSLï¼‰æ–¹æ³•å®šä¹‰ï¼šè¿™äº›æ“ä½œéå¸¸ç±»ä¼¼äº Ræˆ–Pythonè¯­è¨€ä¸­çš„ æ•°æ®æ¡†æ¶æŠ½è±¡ä¸­å¯ç”¨çš„æ“ä½œã€‚ basic-åŸºç¡€æ–¹æ³•toDF123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * Converts this strongly typed collection of data to generic Dataframe. In contrast to the * strongly typed objects that Dataset operations work on, a Dataframe returns generic [[Row]] * objects that allow fields to be accessed by ordinal or name. * å°†è¿™ç§å¼ºç±»å‹çš„æ•°æ®é›†åˆè½¬æ¢ä¸ºä¸€èˆ¬çš„Dataframeã€‚ * ä¸Datasetæ“ä½œæ‰€ä½¿ç”¨çš„å¼ºç±»å‹å¯¹è±¡ç›¸åï¼Œ * Dataframeè¿”å›æ³›å‹[[Row]]å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å…è®¸é€šè¿‡åºå·æˆ–åç§°è®¿é—®å­—æ®µ * * @group basic * @since 1.6.0 */// This is declared with parentheses to prevent the Scala compiler from treating// `ds.toDF(\"1\")` as invoking this toDF and then apply on the returned DataFrame.// è¿™æ˜¯ç”¨æ‹¬å·å£°æ˜çš„ï¼Œä»¥é˜²æ­¢Scalaç¼–è¯‘å™¨å¤„ç†ds.toDF(â€œ1â€)è°ƒç”¨è¿™ä¸ªtoDFï¼Œç„¶ååœ¨è¿”å›çš„DataFrameä¸Šåº”ç”¨ã€‚def toDF(): DataFrame = new Dataset[Row](sparkSession, queryExecution, RowEncoder(schema)) /** * Converts this strongly typed collection of data to generic `DataFrame` with columns renamed. * This can be quite convenient in conversion from an RDD of tuples into a `DataFrame` with * meaningful names. For example: * * å°†è¿™ç§å¼ºç±»å‹çš„æ•°æ®é›†åˆè½¬æ¢ä¸ºé€šç”¨çš„â€œDataFrameâ€ï¼Œå¹¶å°†åˆ—é‡å‘½åã€‚ * åœ¨å°†tupleçš„RDDè½¬æ¢ä¸ºå¯Œæœ‰å«ä¹‰çš„åç§°çš„â€œDataFrameâ€æ—¶ï¼Œè¿™æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œå¦‚ï¼š * * &#123;&#123;&#123; * val rdd: RDD[(Int, String)] = ... * rdd.toDF() // éšå¼è½¬æ¢åˆ›å»ºäº† DataFrame ï¼Œåˆ—åä¸ºï¼š `_1` and `_2` * rdd.toDF(\"id\", \"name\") // åˆ›å»ºäº† DataFrame ï¼Œåˆ—åä¸ºï¼š \"id\" and \"name\" * &#125;&#125;&#125; * * @group basic * @since 2.0.0 */@scala.annotation.varargsdef toDF(colNames: String*): DataFrame = &#123; require(schema.size == colNames.size, \"The number of columns doesn't match.\\n\" + s\"Old column names ($&#123;schema.size&#125;): \" + schema.fields.map(_.name).mkString(\", \") + \"\\n\" + s\"New column names ($&#123;colNames.size&#125;): \" + colNames.mkString(\", \")) val newCols = logicalPlan.output.zip(colNames).map &#123; case (oldAttribute, newName) =&gt; Column(oldAttribute).as(newName) &#125; select(newCols: _*)&#125; as123456789101112131415161718192021222324252627282930313233/** * :: Experimental :: * Returns a new Dataset where each record has been mapped on to the specified type. The * method used to map columns depend on the type of `U`: * * è¿”å›ä¸€ä¸ªæ–°çš„Datasetï¼Œå…¶ä¸­æ¯ä¸ªè®°å½•éƒ½è¢«æ˜ å°„åˆ°æŒ‡å®šçš„ç±»å‹ã€‚ç”¨äºæ˜ å°„åˆ—çš„æ–¹æ³•å–å†³äºâ€œUâ€çš„ç±»å‹: * * - When `U` is a class, fields for the class will be mapped to columns of the same name * (case sensitivity is determined by `spark.sql.caseSensitive`). * * å½“â€œUâ€æ˜¯ç±»æ—¶ï¼šç±»çš„å±æ€§å°†æ˜ å°„åˆ°ç›¸åŒåç§°çš„åˆ— * * - When `U` is a tuple, the columns will be be mapped by ordinal (i.e. the first column will * be assigned to `_1`). * * å½“â€œUâ€æ˜¯å…ƒç»„æ—¶ï¼šåˆ—å°†ç”±åºæ•°æ˜ å°„ ï¼ˆä¾‹å¦‚ï¼Œç¬¬ä¸€åˆ—å°†ä¸º \"_1\"ï¼‰ * * - When `U` is a primitive type (i.e. String, Int, etc), then the first column of the * `DataFrame` will be used. * * å½“â€œUâ€æ˜¯ åŸºæœ¬ç±»å‹ï¼ˆå¦‚ Stringï¼ŒIntç­‰ï¼‰ï¼šç„¶åå°†ä½¿ç”¨â€œDataFrameâ€çš„ç¬¬ä¸€åˆ—ã€‚ * * If the schema of the Dataset does not match the desired `U` type, you can use `select` * along with `alias` or `as` to rearrange or rename as required. * * å¦‚æœæ•°æ®é›†çš„æ¨¡å¼ä¸æ‰€éœ€çš„â€œUâ€ç±»å‹ä¸åŒ¹é…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨â€œselectâ€å’Œâ€œaliasâ€æˆ–â€œasâ€æ¥é‡æ–°æ’åˆ—æˆ–é‡å‘½åã€‚ * * @group basic * @since 1.6.0 */ @Experimental @InterfaceStability.Evolving def as[U: Encoder]: Dataset[U] = Dataset[U](sparkSession, logicalPlan) schema12345678/** * Returns the schema of this Dataset. * è¿”å›è¯¥Datasetçš„æ¨¡ç‰ˆ * * @group basic * @since 1.6.0 */def schema: StructType = queryExecution.analyzed.schema printSchema12345678910/** * Prints the schema to the console in a nice tree format. * * ä»¥ä¸€ç§æ¼‚äº®çš„æ ‘æ ¼å¼å°†æ¨¡å¼æ‰“å°åˆ°æ§åˆ¶å°ã€‚ * * @group basic * @since 1.6.0 */// scalastyle:off printlndef printSchema(): Unit = println(schema.treeString) explain1234567891011121314151617181920212223242526/** * Prints the plans (logical and physical) to the console for debugging purposes. * * å°†è®¡åˆ’(é€»è¾‘å’Œç‰©ç†)æ‰“å°åˆ°æ§åˆ¶å°ä»¥è¿›è¡Œè°ƒè¯•ã€‚ * å‚æ•°ï¼šextended = false ä¸ºç‰©ç†è®¡åˆ’ * * @group basic * @since 1.6.0 */def explain(extended: Boolean): Unit = &#123; val explain = ExplainCommand(queryExecution.logical, extended = extended) sparkSession.sessionState.executePlan(explain).executedPlan.executeCollect().foreach &#123; // scalastyle:off println r =&gt; println(r.getString(0)) // scalastyle:on println &#125;&#125; /** * Prints the physical plan to the console for debugging purposes. * å°†ç‰©ç†è®¡åˆ’æ‰“å°åˆ°æ§åˆ¶å°ä»¥è¿›è¡Œè°ƒè¯•ã€‚ * * @group basic * @since 1.6.0 */def explain(): Unit = explain(extended = false) dtypes12345678910/** * Returns all column names and their data types as an array. * ä»¥æ•°ç»„çš„å½¢å¼è¿”å›æ‰€æœ‰åˆ—åç§°å’Œå®ƒä»¬çš„æ•°æ®ç±»å‹ * * @group basic * @since 1.6.0 */def dtypes: Array[(String, String)] = schema.fields.map &#123; field =&gt; (field.name, field.dataType.toString)&#125; columns12345678/** * Returns all column names as an array. * ä»¥æ•°ç»„çš„å½¢å¼è¿”å› æ‰€æœ‰åˆ—å * * @group basic * @since 1.6.0 */def columns: Array[String] = schema.fields.map(_.name) isLocal123456789/** * Returns true if the `collect` and `take` methods can be run locally * (without any Spark executors). * å¦‚æœ`collect` and `take` æ–¹æ³•èƒ½åœ¨æœ¬åœ°è¿è¡Œï¼Œåˆ™è¿”å›true * * @group basic * @since 1.6.0 */def isLocal: Boolean = logicalPlan.isInstanceOf[LocalRelation] checkpoint12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364/** * Eagerly checkpoint a Dataset and return the new Dataset. Checkpointing can be used to truncate * the logical plan of this Dataset, which is especially useful in iterative algorithms where the * plan may grow exponentially. It will be saved to files inside the checkpoint * directory set with `SparkContext#setCheckpointDir`. * * æ€¥åˆ‡åœ°æ£€æŸ¥ä¸€ä¸ªæ•°æ®é›†å¹¶è¿”å›æ–°çš„æ•°æ®é›†ã€‚ * æ£€æŸ¥ç‚¹èƒ½ç”¨æ¥æ¸…é™¤Datasetçš„é€»è¾‘è®¡åˆ’ï¼Œå°¤å…¶æ˜¯åœ¨å¯èƒ½ç”ŸæˆæŒ‡æ•°çº§åˆ«çš„è¿­ä»£ç®—æ³•ä¸­å°¤å…¶æœ‰ç”¨ã€‚ * å°†ä¼šåœ¨æ£€æŸ¥ç‚¹ç›®å½•ä¸­ä¿å­˜æ£€æŸ¥æ–‡ä»¶ã€‚å¯ä»¥åœ¨`SparkContext#setCheckpointDir`ä¸­è®¾ç½®ã€‚ * * @group basic * @since 2.1.0 */@Experimental@InterfaceStability.Evolvingdef checkpoint(): Dataset[T] = checkpoint(eager = true) /** * Returns a checkpointed version of this Dataset. Checkpointing can be used to truncate the * logical plan of this Dataset, which is especially useful in iterative algorithms where the * plan may grow exponentially. It will be saved to files inside the checkpoint * directory set with `SparkContext#setCheckpointDir`. * è¿”å›Dataset ä¹‹å‰æ£€æŸ¥è¿‡çš„ç‰ˆæœ¬ã€‚ * æ£€æŸ¥ç‚¹èƒ½ç”¨æ¥æ¸…é™¤Datasetçš„é€»è¾‘è®¡åˆ’ï¼Œå°¤å…¶æ˜¯åœ¨å¯èƒ½ç”ŸæˆæŒ‡æ•°çº§åˆ«çš„è¿­ä»£ç®—æ³•ä¸­å°¤å…¶æœ‰ç”¨ã€‚ * å°†ä¼šåœ¨æ£€æŸ¥ç‚¹ç›®å½•ä¸­ä¿å­˜æ£€æŸ¥æ–‡ä»¶ã€‚å¯ä»¥åœ¨`SparkContext#setCheckpointDir`ä¸­è®¾ç½®ã€‚ * * @group basic * @since 2.1.0 */@Experimental@InterfaceStability.Evolvingdef checkpoint(eager: Boolean): Dataset[T] = &#123; val internalRdd = queryExecution.toRdd.map(_.copy()) internalRdd.checkpoint() if (eager) &#123; internalRdd.count() &#125; val physicalPlan = queryExecution.executedPlan // Takes the first leaf partitioning whenever we see a `PartitioningCollection`. Otherwise the // size of `PartitioningCollection` may grow exponentially for queries involving deep inner // joins. // æ¯å½“æˆ‘ä»¬çœ‹åˆ°â€œPartitioningCollectionâ€æ—¶ï¼Œå°±é‡‡ç”¨ç¬¬ä¸€ä¸ªå¶å­åˆ†åŒº // å¦åˆ™ï¼Œç”¨äºæ¶‰åŠæ·±åº¦å†…è¿æ¥çš„æŸ¥è¯¢ï¼Œâ€œPartitioningCollectionâ€çš„å¤§å°å¯èƒ½ä¼šä»¥æŒ‡æ•°å½¢å¼å¢é•¿ã€‚ def firstLeafPartitioning(partitioning: Partitioning): Partitioning = &#123; partitioning match &#123; case p: PartitioningCollection =&gt; firstLeafPartitioning(p.partitionings.head) case p =&gt; p &#125; &#125; val outputPartitioning = firstLeafPartitioning(physicalPlan.outputPartitioning) Dataset.ofRows( sparkSession, LogicalRDD( logicalPlan.output, internalRdd, outputPartitioning, physicalPlan.outputOrdering )(sparkSession)).as[T]&#125; persist1234567891011121314151617181920212223242526272829303132333435/** * Persist this Dataset with the default storage level (`MEMORY_AND_DISK`). * * æŒä¹…åŒ–ã€‚ * æ ¹æ®é»˜è®¤çš„ å­˜å‚¨çº§åˆ« (`MEMORY_AND_DISK`) æŒä¹…åŒ–Datasetã€‚ * * @group basic * @since 1.6.0 */def persist(): this.type = &#123; sparkSession.sharedState.cacheManager.cacheQuery(this) this&#125; /** * Persist this Dataset with the given storage level. * * æ ¹æ®æŒ‡å®šçš„ å­˜å‚¨çº§åˆ« æŒä¹…åŒ– Datasetã€‚ * * @param newLevel One of: * `MEMORY_ONLY`, * `MEMORY_AND_DISK`, * `MEMORY_ONLY_SER`, * `MEMORY_AND_DISK_SER`, * `DISK_ONLY`, * `MEMORY_ONLY_2`, ä¸MEMORY_ONLYçš„åŒºåˆ«æ˜¯ä¼šå¤‡ä»½æ•°æ®åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š * `MEMORY_AND_DISK_2`, ä¸MEMORY_AND_DISKçš„åŒºåˆ«æ˜¯ä¼šå¤‡ä»½æ•°æ®åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š * etc. * @group basic * @since 1.6.0 */def persist(newLevel: StorageLevel): this.type = &#123; sparkSession.sharedState.cacheManager.cacheQuery(this, None, newLevel) this&#125; cache1234567891011/** * Persist this Dataset with the default storage level (`MEMORY_AND_DISK`). * * æŒä¹…åŒ–ã€‚ * æ ¹æ®é»˜è®¤çš„ å­˜å‚¨çº§åˆ« (`MEMORY_AND_DISK`) æŒä¹…åŒ–Datasetã€‚ * å’Œ persist ä¸€è‡´ã€‚ * * @group basic * @since 1.6.0 */def cache(): this.type = persist() storageLevel12345678910111213/** * Get the Dataset's current storage level, or StorageLevel.NONE if not persisted. * * è·å–å½“å‰Datasetçš„å½“å‰å­˜å‚¨çº§åˆ«ã€‚å¦‚æœæ²¡æœ‰ç¼“å­˜åˆ™ StorageLevel.NONEã€‚ * * @group basic * @since 2.1.0 */def storageLevel: StorageLevel = &#123; sparkSession.sharedState.cacheManager.lookupCachedData(this).map &#123; cachedData =&gt; cachedData.cachedRepresentation.storageLevel &#125;.getOrElse(StorageLevel.NONE)&#125; unpersist1234567891011121314151617181920212223242526/** * Mark the Dataset as non-persistent, and remove all blocks for it from memory and disk. * * è§£é™¤æŒä¹…åŒ–ã€‚ * å°†Datasetæ ‡è®°ä¸ºéæŒä¹…åŒ–ï¼Œå¹¶ä»å†…å­˜å’Œç£ç›˜ä¸­ç§»é™¤æ‰€æœ‰çš„å—ã€‚ * * @param blocking Whether to block until all blocks are deleted. * æ˜¯å¦é˜»å¡ï¼Œç›´åˆ°åˆ é™¤æ‰€æœ‰çš„å—ã€‚ * @group basic * @since 1.6.0 */def unpersist(blocking: Boolean): this.type = &#123; sparkSession.sharedState.cacheManager.uncacheQuery(this, blocking) this&#125; /** * Mark the Dataset as non-persistent, and remove all blocks for it from memory and disk. * * è§£é™¤æŒä¹…åŒ–ã€‚ * å°†Datasetæ ‡è®°ä¸ºéæŒä¹…åŒ–ï¼Œå¹¶ä»å†…å­˜å’Œç£ç›˜ä¸­ç§»é™¤æ‰€æœ‰çš„å—ã€‚ * * @group basic * @since 1.6.0 */def unpersist(): this.type = unpersist(blocking = false) rdd123456789101112131415/** * Represents the content of the Dataset as an `RDD` of [[T]]. * * è½¬æ¢ä¸º[[T]]çš„â€œRDDâ€ï¼Œè¡¨ç¤ºDatasetçš„å†…å®¹ * * @group basic * @since 1.6.0 */lazy val rdd: RDD[T] = &#123; val objectType = exprEnc.deserializer.dataType val deserialized = CatalystSerde.deserialize[T](logicalPlan) sparkSession.sessionState.executePlan(deserialized).toRdd.mapPartitions &#123; rows =&gt; rows.map(_.get(0, objectType).asInstanceOf[T]) &#125;&#125; toJavaRDD12345678910111213141516171819/** * Returns the content of the Dataset as a `JavaRDD` of [[T]]s. * * è½¬æ¢ä¸ºJavaRDD * * @group basic * @since 1.6.0 */def toJavaRDD: JavaRDD[T] = rdd.toJavaRDD() /** * Returns the content of the Dataset as a `JavaRDD` of [[T]]s. * * è½¬æ¢ä¸ºJavaRDD * * @group basic * @since 1.6.0 */def javaRDD: JavaRDD[T] = toJavaRDD registerTempTable1234567891011121314/** * Registers this Dataset as a temporary table using the given name. The lifetime of this * temporary table is tied to the [[SparkSession]] that was used to create this Dataset. * * æ ¹æ®æŒ‡å®šçš„è¡¨åï¼Œæ³¨å†Œä¸´æ—¶è¡¨ã€‚ * ç”Ÿå‘½å‘¨æœŸä¸º[[SparkSession]]çš„ç”Ÿå‘½å‘¨æœŸã€‚ * * @group basic * @since 1.6.0 */@deprecated(\"Use createOrReplaceTempView(viewName) instead.\", \"2.0.0\")def registerTempTable(tableName: String): Unit = &#123; createOrReplaceTempView(tableName)&#125; createTempView123456789101112131415161718192021/** * Creates a local temporary view using the given name. The lifetime of this * temporary view is tied to the [[SparkSession]] that was used to create this Dataset. * * ç”¨æŒ‡å®šçš„åå­—åˆ›å»ºæœ¬åœ°ä¸´æ—¶è¡¨ã€‚ * ä¸[[SparkSession]] åŒç”Ÿå‘½å‘¨æœŸã€‚ * * Local temporary view is session-scoped. Its lifetime is the lifetime of the session that * created it, i.e. it will be automatically dropped when the session terminates. It's not * tied to any databases, i.e. we can't use `db1.view1` to reference a local temporary view. * * æœ¬åœ°ä¸´æ—¶è¡¨æ˜¯ sessionèŒƒå›´å†…çš„ã€‚å½“åˆ›å»ºå®ƒçš„sessionåœæ­¢çš„æ—¶å€™ï¼Œè¯¥è¡¨ä¹Ÿéšä¹‹åœæ­¢ã€‚ * * @throws AnalysisException if the view name already exists * @group basic * @since 2.0.0 */@throws[AnalysisException]def createTempView(viewName: String): Unit = withPlan &#123; createTempViewCommand(viewName, replace = false, global = false)&#125; createOrReplaceTempView123456789101112/** * Creates a local temporary view using the given name. The lifetime of this * temporary view is tied to the [[SparkSession]] that was used to create this Dataset. * * ç”¨æŒ‡å®šçš„åå­—åˆ›å»ºæœ¬åœ°ä¸´æ—¶è¡¨ã€‚å¦‚æœå·²ç»æœ‰äº†åˆ™æ›¿æ¢ã€‚ * * @group basic * @since 2.0.0 */def createOrReplaceTempView(viewName: String): Unit = withPlan &#123; createTempViewCommand(viewName, replace = true, global = false)&#125; createGlobalTempView1234567891011121314151617181920212223/** * Creates a global temporary view using the given name. The lifetime of this * temporary view is tied to this Spark application. * * åˆ›å»ºå…¨å±€ä¸´æ—¶è¡¨ã€‚ * ç”Ÿå‘½å‘¨æœŸä¸ºæ•´ä¸ªSpark application. * * Global temporary view is cross-session. Its lifetime is the lifetime of the Spark application, * i.e. it will be automatically dropped when the application terminates. It's tied to a system * preserved database `_global_temp`, and we must use the qualified name to refer a global temp * view, e.g. `SELECT * FROM _global_temp.view1`. * * å…¨å±€ä¸´æ—¶è¡¨æ˜¯è·¨sessionçš„ã€‚å±äº _global_temp æ•°æ®åº“ã€‚e.g. `SELECT * FROM _global_temp.view1`. * * @throws AnalysisException if the view name already exists * å¦‚æœè¡¨å·²ç»å­˜åœ¨ï¼Œåˆ™æŠ¥é”™ã€‚ * @group basic * @since 2.1.0 */@throws[AnalysisException]def createGlobalTempView(viewName: String): Unit = withPlan &#123; createTempViewCommand(viewName, replace = false, global = true)&#125; write123456789101112131415/** * Interface for saving the content of the non-streaming Dataset out into external storage. * * å°†éæµDatasetçš„å†…å®¹ä¿å­˜åˆ°å¤–éƒ¨å­˜å‚¨ä¸­çš„æ¥å£ã€‚ * * @group basic * @since 1.6.0 */def write: DataFrameWriter[T] = &#123; if (isStreaming) &#123; logicalPlan.failAnalysis( \"'write' can not be called on streaming Dataset/DataFrame\") &#125; new DataFrameWriter[T](this)&#125; writeStream123456789101112131415161718/** * :: Experimental :: * Interface for saving the content of the streaming Dataset out into external storage. * * å°†æµDatasetä¿å­˜åœ¨å¤–éƒ¨å­˜å‚¨ã€‚ * * @group basic * @since 2.0.0 */@Experimental@InterfaceStability.Evolvingdef writeStream: DataStreamWriter[T] = &#123; if (!isStreaming) &#123; logicalPlan.failAnalysis( \"'writeStream' can be called only on streaming Dataset/DataFrame\") &#125; new DataStreamWriter[T](this)&#125; toJSON1234567891011121314151617181920212223242526272829303132333435/** * Returns the content of the Dataset as a Dataset of JSON strings. * * å°†Datasetè½¬æ¢ä¸ºJSONã€‚ * * @since 2.0.0 */def toJSON: Dataset[String] = &#123; val rowSchema = this.schema val rdd: RDD[String] = queryExecution.toRdd.mapPartitions &#123; iter =&gt; val writer = new CharArrayWriter() // create the Generator without separator inserted between 2 records val gen = new JacksonGenerator(rowSchema, writer) new Iterator[String] &#123; override def hasNext: Boolean = iter.hasNext override def next(): String = &#123; gen.write(iter.next()) gen.flush() val json = writer.toString if (hasNext) &#123; writer.reset() &#125; else &#123; gen.close() &#125; json &#125; &#125; &#125; import sparkSession.implicits.newStringEncoder sparkSession.createDataset(rdd)&#125; inputFiles12345678910111213141516171819202122/** * Returns a best-effort snapshot of the files that compose this Dataset. This method simply * asks each constituent BaseRelation for its respective files and takes the union of all results. * Depending on the source relations, this may not find all input files. Duplicates are removed. * * è¿”å›ç»„æˆè¿™ä¸ªDatasetçš„æ‰€æœ‰æ–‡ä»¶çš„æœ€ä½³å¿«ç…§ã€‚ * è¯¥æ–¹æ³•ç®€å•åœ°è¦æ±‚æ¯ä¸ªç»„ä»¶BaseRelationå¯¹å…¶å„è‡ªçš„æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œå¹¶è”åˆæ‰€æœ‰ç»“æœã€‚ * åŸºäºæºå…³ç³»ï¼Œåº”è¯¥å¯ä»¥æ‰¾åˆ°æ‰€æœ‰çš„è¾“å…¥æ–‡ä»¶ã€‚ * é‡å¤çš„ä¹Ÿä¼šè¢«ç§»é™¤ã€‚ * * @group basic * @since 2.0.0 */def inputFiles: Array[String] = &#123; val files: Seq[String] = queryExecution.optimizedPlan.collect &#123; case LogicalRelation(fsBasedRelation: FileRelation, _, _) =&gt; fsBasedRelation.inputFiles case fr: FileRelation =&gt; fr.inputFiles &#125;.flatten files.toSet.toArray&#125; streamingisStreaming123456789101112131415161718/** * Returns true if this Dataset contains one or more sources that continuously * return data as it arrives. A Dataset that reads data from a streaming source * must be executed as a `StreamingQuery` using the `start()` method in * `DataStreamWriter`. Methods that return a single answer, e.g. `count()` or * `collect()`, will throw an [[AnalysisException]] when there is a streaming * source present. * * å¦‚æœDatasetåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒç»­è¿”å›æ•°æ®çš„æºï¼Œåˆ™è¿”å›trueï¼› * å¦‚æœDatasetä»streamingæºè¯»å–æ•°æ®ï¼Œåˆ™å¿…é¡»åƒ `StreamingQuery` ä¸€æ ·æ‰§è¡Œï¼šä½¿ç”¨ `DataStreamWriter` ä¸­çš„ `start()`æ–¹æ³•ã€‚ * è¿”å›å•ä¸ªå€¼çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š `count()` or `collect()`ï¼Œå½“å­˜åœ¨streamingæºæ—¶ï¼Œå°†ä¼šæŠ›å‡º[[AnalysisException]]ã€‚ * * @group streaming * @since 2.0.0 */@Experimental@InterfaceStability.Evolvingdef isStreaming: Boolean = logicalPlan.isStreaming withWatermark123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * :: Experimental :: å®éªŒæ€§çš„ * Defines an event time watermark for this [[Dataset]]. A watermark tracks a point in time * before which we assume no more late data is going to arrive. * * ä¸ºè¿™ä¸ª[[Dataset]]å®šä¹‰äº‹ä»¶æ—¶é—´æ°´å°ã€‚ * æˆ‘ä»¬å‡è®¾æ²¡æœ‰æ›´å¤šçš„æ™šæœŸæ•°æ®å°†åˆ°è¾¾ä¹‹å‰ï¼Œä¸€ä¸ªæ°´å°è·Ÿè¸ªä¸€ä¸ªæ—¶é—´ç‚¹ã€‚ * * Spark will use this watermark for several purposes: * Sparkç”¨æ°´å°æœ‰å‡ ä¸ªç›®çš„ï¼š * - To know when a given time window aggregation can be finalized and thus can be emitted when * using output modes that do not allow updates. * * å¯ä»¥çŸ¥é“ä½•æ—¶å®Œæˆç»™å®šçš„æ—¶é—´çª—å£èšåˆèƒ½å¤Ÿå®Œæˆï¼Œå› æ­¤å½“ä½¿ç”¨ä¸å…è®¸æ›´æ–°çš„è¾“å‡ºæ¨¡å¼æ—¶èƒ½å¤Ÿè¢«æ”¾å‡ºã€‚ * - To minimize the amount of state that we need to keep for on-going aggregations. * ä¸ºäº†æœ€å°åŒ–æˆ‘ä»¬éœ€è¦æŒç»­ä¸æ–­çš„èšåˆçš„çŠ¶æ€æ•°é‡ã€‚ * * * The current watermark is computed by looking at the `MAX(eventTime)` seen across * all of the partitions in the query minus a user specified `delayThreshold`. Due to the cost * of coordinating this value across partitions, the actual watermark used is only guaranteed * to be at least `delayThreshold` behind the actual event time. In some cases we may still * process records that arrive more than `delayThreshold` late. * * å½“å‰çš„æ°´å° = æŸ¥çœ‹æŸ¥è¯¢ä¸­æ‰€æœ‰åˆ†åŒºä¸Šçœ‹åˆ°çš„`MAX(eventTime)` - ç”¨æˆ·æŒ‡å®šçš„`delayThreshold` * ç”±äºåœ¨åˆ†åŒºä¹‹é—´åè°ƒè¿™ä¸ªå€¼çš„èŠ±é”€ï¼Œå®é™…ä½¿ç”¨çš„æ°´å°åªä¿è¯åœ¨å®é™…äº‹ä»¶æ—¶é—´åè‡³å°‘æ˜¯â€œdelayThresholdâ€ã€‚ * åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜ä¼šå¤„ç†æ¯”â€œdelayThresholdâ€æ™šäº›æ—¶å€™åˆ°è¾¾çš„è®°å½•ã€‚ * * @param eventTime the name of the column that contains the event time of the row. * åŒ…å«è¡Œçš„äº‹ä»¶æ—¶é—´çš„åˆ—å * @param delayThreshold the minimum delay to wait to data to arrive late, relative to the latest * record that has been processed in the form of an interval * (e.g. \"1 minute\" or \"5 hours\"). * ç­‰å¾…æ™šåˆ°æ•°æ®çš„æœ€å°‘å»¶è¿Ÿï¼Œç›¸å¯¹äºä»¥é—´éš”å½¢å¼å¤„ç†çš„æœ€æ–°è®°å½• * @group streaming * @since 2.1.0 */@Experimental@InterfaceStability.Evolving// We only accept an existing column name, not a derived column here as a watermark that is// defined on a derived column cannot referenced elsewhere in the plan.// æˆ‘ä»¬åªæ¥å—ä¸€ä¸ªç°æœ‰çš„åˆ—åï¼Œè€Œä¸æ˜¯ä½œä¸ºä¸€ä¸ªåœ¨æ´¾ç”Ÿåˆ—ä¸Šå®šä¹‰çš„æ°´å°çš„æ´¾ç”Ÿåˆ—ï¼Œè€Œä¸èƒ½åœ¨è¯¥è®¡åˆ’çš„å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚def withWatermark(eventTime: String, delayThreshold: String): Dataset[T] = withTypedPlan &#123; val parsedDelay = Option(CalendarInterval.fromString(\"interval \" + delayThreshold)) .getOrElse(throw new AnalysisException(s\"Unable to parse time delay '$delayThreshold'\")) EventTimeWatermark(UnresolvedAttribute(eventTime), parsedDelay, logicalPlan)&#125; actionshow123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990/** * Displays the Dataset in a tabular form. Strings more than 20 characters will be truncated, * and all cells will be aligned right. For example: * * ä»¥è¡¨æ ¼å½¢å¼æ˜¾ç¤ºæ•°æ®é›†ã€‚ * å­—ç¬¦ä¸²è¶…è¿‡20ä¸ªå­—ç¬¦å°†è¢«æˆªæ–­ï¼Œ * æ‰€æœ‰å•å…ƒæ ¼å°†è¢«å¯¹é½ã€‚ * &#123;&#123;&#123; * year month AVG('Adj Close) MAX('Adj Close) * 1980 12 0.503218 0.595103 * 1981 01 0.523289 0.570307 * 1982 02 0.436504 0.475256 * 1983 03 0.410516 0.442194 * 1984 04 0.450090 0.483521 * &#125;&#125;&#125; * * @param numRows Number of rows to show è¦æ˜¾ç¤ºçš„è¡Œæ•° * @group action * @since 1.6.0 */def show(numRows: Int): Unit = show(numRows, truncate = true) /** * Displays the top 20 rows of Dataset in a tabular form. Strings more than 20 characters * will be truncated, and all cells will be aligned right. * æ˜¾ç¤ºå¤´20è¡Œ * * @group action * @since 1.6.0 */def show(): Unit = show(20)/** * Displays the top 20 rows of Dataset in a tabular form. * æ˜¾ç¤ºå¤´20è¡Œ * * @param truncate Whether truncate long strings. If true, strings more than 20 characters will * be truncated and all cells will be aligned right * æ˜¯å¦æˆªæ–­é•¿å­—ç¬¦ä¸²ã€‚å¦‚æœ trueï¼šè¶…è¿‡20ä¸ªå­—ç¬¦å°±ä¼šè¢«æˆªæ–­ * @group action * @since 1.6.0 */def show(truncate: Boolean): Unit = show(20, truncate)/** * Displays the Dataset in a tabular form. For example: * &#123;&#123;&#123; * year month AVG('Adj Close) MAX('Adj Close) * 1980 12 0.503218 0.595103 * 1981 01 0.523289 0.570307 * 1982 02 0.436504 0.475256 * 1983 03 0.410516 0.442194 * 1984 04 0.450090 0.483521 * &#125;&#125;&#125; * * @param numRows Number of rows to show æ˜¾ç¤ºçš„è¡Œæ•° * @param truncate Whether truncate long strings. If true, strings more than 20 characters will * be truncated and all cells will be aligned right * æ˜¯å¦æˆªæ–­é•¿å­—ç¬¦ä¸² * @group action * @since 1.6.0 */// scalastyle:off printlndef show(numRows: Int, truncate: Boolean): Unit = if (truncate) &#123; println(showString(numRows, truncate = 20))&#125; else &#123; println(showString(numRows, truncate = 0))&#125;// scalastyle:on println/** * Displays the Dataset in a tabular form. For example: * &#123;&#123;&#123; * year month AVG('Adj Close) MAX('Adj Close) * 1980 12 0.503218 0.595103 * 1981 01 0.523289 0.570307 * 1982 02 0.436504 0.475256 * 1983 03 0.410516 0.442194 * 1984 04 0.450090 0.483521 * &#125;&#125;&#125; * * @param numRows Number of rows to show * @param truncate If set to more than 0, truncates strings to `truncate` characters and * all cells will be aligned right. * è®¾ç½® è§¦å‘æˆªæ–­å­—ç¬¦ä¸²çš„é˜ˆå€¼ * @group action * @since 1.6.0 */// scalastyle:off printlndef show(numRows: Int, truncate: Int): Unit = println(showString(numRows, truncate)) reduce1234567891011121314151617181920212223242526272829/** * :: Experimental :: * (Scala-specific) * Reduces the elements of this Dataset using the specified binary function. The given `func` * must be commutative and associative or the result may be non-deterministic. * * ä½¿ç”¨æŒ‡å®šçš„äºŒè¿›åˆ¶å‡½æ•°å‡å°‘è¿™ä¸ªæ•°æ®é›†çš„å…ƒç´ ã€‚ç»™å®šçš„â€œfuncâ€å¿…é¡»æ˜¯å¯äº¤æ¢çš„å’Œå…³è”çš„ï¼Œå¦åˆ™ç»“æœå¯èƒ½æ˜¯ä¸ç¡®å®šæ€§çš„ã€‚ * * @group action * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef reduce(func: (T, T) =&gt; T): T = rdd.reduce(func)/** * :: Experimental :: * (Java-specific) * Reduces the elements of this Dataset using the specified binary function. The given `func` * must be commutative and associative or the result may be non-deterministic. * * ä½¿ç”¨æŒ‡å®šçš„äºŒè¿›åˆ¶å‡½æ•°å‡å°‘è¿™ä¸ªæ•°æ®é›†çš„å…ƒç´ ã€‚ç»™å®šçš„â€œfuncâ€å¿…é¡»æ˜¯å¯äº¤æ¢çš„å’Œå…³è”çš„ï¼Œå¦åˆ™ç»“æœå¯èƒ½æ˜¯ä¸ç¡®å®šæ€§çš„ã€‚ * * @group action * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef reduce(func: ReduceFunction[T]): T = reduce(func.call(_, _)) describe123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566/** * Computes statistics for numeric and string columns, including count, mean, stddev, min, and * max. If no columns are given, this function computes statistics for all numerical or string * columns. * * è®¡ç®—æ•°å­—å’Œå­—ç¬¦ä¸²åˆ—çš„ç»Ÿè®¡æ•°æ®ï¼ŒåŒ…æ‹¬countã€meanã€stddevã€minå’Œmaxã€‚ * å¦‚æœæ²¡æœ‰ç»™å‡ºä»»ä½•åˆ—ï¼Œè¯¥å‡½æ•°è®¡ç®—æ‰€æœ‰æ•°å€¼æˆ–å­—ç¬¦ä¸²åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ * * This function is meant for exploratory data analysis, as we make no guarantee about the * backward compatibility of the schema of the resulting Dataset. If you want to * programmatically compute summary statistics, use the `agg` function instead. * * è¿™ä¸ªå‡½æ•°ç”¨äºæ¢ç´¢æ€§çš„æ•°æ®åˆ†æï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½ä¿è¯ç”Ÿæˆæ•°æ®é›†çš„æ¨¡å¼çš„å‘åå…¼å®¹æ€§ã€‚ * å¦‚æœæ‚¨æƒ³é€šè¿‡ç¼–ç¨‹è®¡ç®—æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨â€œaggâ€å‡½æ•°ã€‚ * * &#123;&#123;&#123; * ds.describe(\"age\", \"height\").show() * * // output: * // summary age height * // count 10.0 10.0 * // mean 53.3 178.05 * // stddev 11.6 15.7 * // min 18.0 163.0 * // max 92.0 192.0 * &#125;&#125;&#125; * * @group action * @since 1.6.0 */ @scala.annotation.varargs def describe(cols: String*): DataFrame = withPlan &#123; // The list of summary statistics to compute, in the form of expressions. val statistics = List[(String, Expression =&gt; Expression)]( \"count\" -&gt; ((child: Expression) =&gt; Count(child).toAggregateExpression()), \"mean\" -&gt; ((child: Expression) =&gt; Average(child).toAggregateExpression()), \"stddev\" -&gt; ((child: Expression) =&gt; StddevSamp(child).toAggregateExpression()), \"min\" -&gt; ((child: Expression) =&gt; Min(child).toAggregateExpression()), \"max\" -&gt; ((child: Expression) =&gt; Max(child).toAggregateExpression())) val outputCols = (if (cols.isEmpty) aggregatableColumns.map(usePrettyExpression(_).sql) else cols).toList val ret: Seq[Row] = if (outputCols.nonEmpty) &#123; val aggExprs = statistics.flatMap &#123; case (_, colToAgg) =&gt; outputCols.map(c =&gt; Column(Cast(colToAgg(Column(c).expr), StringType)).as(c)) &#125; val row = groupBy().agg(aggExprs.head, aggExprs.tail: _*).head().toSeq // Pivot the data so each summary is one row row.grouped(outputCols.size).toSeq.zip(statistics).map &#123; case (aggregation, (statistic, _)) =&gt; Row(statistic :: aggregation.toList: _*) &#125; &#125; else &#123; // If there are no output columns, just output a single column that contains the stats. statistics.map &#123; case (name, _) =&gt; Row(name) &#125; &#125; // All columns are string type val schema = StructType( StructField(\"summary\", StringType) :: outputCols.map(StructField(_, StringType))).toAttributes // `toArray` forces materialization to make the seq serializable LocalRelation.fromExternalRows(schema, ret.toArray.toSeq) &#125; head123456789101112131415161718192021222324/** * Returns the first `n` rows. * * è¿”å›å‰nè¡Œ * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. * ä»…é€‚ç”¨äºç»“æœå¾ˆå°‘çš„æ—¶å€™ä½¿ç”¨ï¼Œå› ä¸ºä¼šå°†ç»“æœåŠ è½½è¿›å†…å­˜ä¸­ * @group action * @since 1.6.0 */def head(n: Int): Array[T] = withTypedCallback(\"head\", limit(n)) &#123; df =&gt; df.collect(needCallback = false)&#125;/** * Returns the first row. * * è¿”å›ç¬¬ä¸€è¡Œï¼ˆé»˜è®¤1ï¼‰ * * @group action * @since 1.6.0 */def head(): T = head(1).head first123456789/** * Returns the first row. Alias for head(). * * è¿”å›ç¬¬ä¸€è¡Œ ï¼Œä¸head()ä¸€æ · * * @group action * @since 1.6.0 */def first(): T = head() foreach12345678910111213141516171819202122/** * Applies a function `f` to all rows. * * å¯¹æ‰€æœ‰è¡Œåº”ç”¨å‡½æ•°fã€‚ * * @group action * @since 1.6.0 */def foreach(f: T =&gt; Unit): Unit = withNewExecutionId &#123; rdd.foreach(f)&#125;/** * (Java-specific) * Runs `func` on each element of this Dataset. * * åœ¨è¿™ä¸ªæ•°æ®é›†çš„æ¯ä¸ªå…ƒç´ ä¸Šè¿è¡Œâ€œfuncâ€ã€‚ * * @group action * @since 1.6.0 */def foreach(func: ForeachFunction[T]): Unit = foreach(func.call(_)) foreachPartition1234567891011121314151617181920212223/** * Applies a function `f` to each partition of this Dataset. * * å¯¹è¿™ä¸ªæ•°æ®é›†çš„æ¯ä¸ªåˆ†åŒºåº”ç”¨ä¸€ä¸ªå‡½æ•°fã€‚ * * @group action * @since 1.6.0 */def foreachPartition(f: Iterator[T] =&gt; Unit): Unit = withNewExecutionId &#123; rdd.foreachPartition(f)&#125;/** * (Java-specific) * Runs `func` on each partition of this Dataset. * * å¯¹è¿™ä¸ªæ•°æ®é›†çš„æ¯ä¸ªåˆ†åŒºåº”ç”¨ä¸€ä¸ªå‡½æ•°fã€‚ * * @group action * @since 1.6.0 */def foreachPartition(func: ForeachPartitionFunction[T]): Unit = foreachPartition(it =&gt; func.call(it.asJava)) take123456789101112131415/** * Returns the first `n` rows in the Dataset. * * è¿”å›æ•°æ®é›†ä¸­çš„å‰â€œnâ€è¡Œã€‚ * åŒhead(n) * * Running take requires moving data into the application's driver process, and doing so with * a very large `n` can crash the driver process with OutOfMemoryError. * * takeåœ¨driverç«¯æ‰§è¡Œï¼Œnå¤ªå¤§ä¼šé€ æˆoom * * @group action * @since 1.6.0 */def take(n: Int): Array[T] = head(n) takeAsList1234567891011121314/** * Returns the first `n` rows in the Dataset as a list. * * ä»¥Listå½¢å¼è¿”å› å‰nè¡Œ * * Running take requires moving data into the application's driver process, and doing so with * a very large `n` can crash the driver process with OutOfMemoryError. * * takeåœ¨driverç«¯æ‰§è¡Œï¼Œnå¤ªå¤§ä¼šé€ æˆoom * * @group action * @since 1.6.0 */def takeAsList(n: Int): java.util.List[T] = java.util.Arrays.asList(take(n): _*) collect12345678910111213141516/** * Returns an array that contains all of [[Row]]s in this Dataset. * * è¿”å›åŒ…å«æ‰€æœ‰Rowçš„ ä¸€ä¸ªæ•°ç»„ * * Running collect requires moving all the data into the application's driver process, and * doing so on a very large dataset can crash the driver process with OutOfMemoryError. * * ä¼šå°†æ‰€æœ‰æ•°æ®ç§»åŠ¨åˆ°driverï¼Œæ‰€ä»¥å¯èƒ½ä¼šé€ æˆoom * * For Java API, use [[collectAsList]]. * * @group action * @since 1.6.0 */def collect(): Array[T] = collect(needCallback = true) collectAsList12345678910111213141516171819/** * Returns a Java list that contains all of [[Row]]s in this Dataset. * * è¿”å›åŒ…å«æ‰€æœ‰Rowçš„ä¸€ä¸ªJava List * * Running collect requires moving all the data into the application's driver process, and * doing so on a very large dataset can crash the driver process with OutOfMemoryError. * * ä¼šå°†æ‰€æœ‰æ•°æ®ç§»åŠ¨åˆ°driverï¼Œæ‰€ä»¥å¯èƒ½ä¼šé€ æˆoom * * @group action * @since 1.6.0 */def collectAsList(): java.util.List[T] = withCallback(\"collectAsList\", toDF()) &#123; _ =&gt; withNewExecutionId &#123; val values = queryExecution.executedPlan.executeCollect().map(boundEnc.fromRow) java.util.Arrays.asList(values: _*) &#125;&#125; toLocalIterator12345678910111213141516171819202122/** * Return an iterator that contains all of [[Row]]s in this Dataset. * * è¿”å›åŒ…å«æ‰€æœ‰Rowçš„ä¸€ä¸ªè¿­ä»£å™¨ * * The iterator will consume as much memory as the largest partition in this Dataset. * * è¿­ä»£å™¨å°†æ¶ˆè€—ä¸æ­¤æ•°æ®é›†ä¸­æœ€å¤§çš„åˆ†åŒºä¸€æ ·å¤šçš„å†…å­˜ã€‚ * * @note this results in multiple Spark jobs, and if the input Dataset is the result * of a wide transformation (e.g. join with different partitioners), to avoid * recomputing the input Dataset should be cached first. * è¿™å°†å¯¼è‡´å¤šä¸ªSparkä½œä¸šï¼Œå¦‚æœè¾“å…¥æ•°æ®é›†æ˜¯å®½ä¾èµ–è½¬æ¢çš„ç»“æœ(ä¾‹å¦‚ï¼Œä¸ä¸åŒçš„åˆ†åŒºè¿æ¥)ï¼Œ * é‚£ä¹ˆä¸ºäº†é¿å…é‡æ–°è®¡ç®—è¾“å…¥æ•°æ®ï¼Œåº”è¯¥é¦–å…ˆç¼“å­˜è¾“å…¥æ•°æ®é›†ã€‚ * @group action * @since 2.0.0 */def toLocalIterator(): java.util.Iterator[T] = withCallback(\"toLocalIterator\", toDF()) &#123; _ =&gt; withNewExecutionId &#123; queryExecution.executedPlan.executeToIterator().map(boundEnc.fromRow).asJava &#125;&#125; count1234567891011/** * Returns the number of rows in the Dataset. * * è¿”å›æ€»è¡Œæ•° * * @group action * @since 1.6.0 */def count(): Long = withCallback(\"count\", groupBy().count()) &#123; df =&gt; df.collect(needCallback = false).head.getLong(0)&#125; untypedrel-æ— ç±»å‹è½¬æ¢na123456789101112/** * Returns a [[DataFrameNaFunctions]] for working with missing data. * è¿”å›ä¸€ä¸ªç”¨äºå¤„ç†ä¸¢å¤±æ•°æ®çš„[[DataFrameNaFunctions]]ã€‚ * &#123;&#123;&#123; * // Dropping rows containing any null values. åˆ é™¤åŒ…å«ä»»ä½•null å€¼çš„è¡Œ * ds.na.drop() * &#125;&#125;&#125; * * @group untypedrel * @since 1.6.0 */def na: DataFrameNaFunctions = new DataFrameNaFunctions(toDF()) stat123456789101112/** * Returns a [[DataFrameStatFunctions]] for working statistic functions support. * è¿”å›ç”¨äºæ”¯æŒç»Ÿè®¡åŠŸèƒ½çš„[[DataFrameStatFunctions]]ã€‚ * &#123;&#123;&#123; * // Finding frequent items in column with name 'a'. æŸ¥è¯¢åˆ—åä¸º\"a\"ä¸­çš„é¢‘ç¹æ•°æ®ã€‚ * ds.stat.freqItems(Seq(\"a\")) * &#125;&#125;&#125; * * @group untypedrel * @since 1.6.0 */def stat: DataFrameStatFunctions = new DataFrameStatFunctions(toDF()) join123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180/** * Join with another `DataFrame`. * å’Œ å¦ä¸€ä¸ª `DataFrame` jion * * Behaves as an INNER JOIN and requires a subsequent join predicate. * ä½œä¸ºä¸€ä¸ªå†…éƒ¨è¿æ¥ï¼Œå¹¶éœ€è¦ä¸€ä¸ªåç»­çš„è¿æ¥è°“è¯ã€‚ * * @param right Right side of the join operation. joinæ“ä½œçš„å³ä¾§ * @group untypedrel * @since 2.0.0 */ def join(right: Dataset[_]): DataFrame = withPlan &#123; Join(logicalPlan, right.logicalPlan, joinType = Inner, None) &#125; /** * Inner equi-join with another `DataFrame` using the given column. * ç»™å®šåˆ—åçš„å†…éƒ¨ç­‰å€¼è¿æ¥ * * Different from other join functions, the join column will only appear once in the output, * i.e. similar to SQL's `JOIN USING` syntax. * * &#123;&#123;&#123; * // Joining df1 and df2 using the column \"user_id\" ç”¨\"user_id\" è¿æ¥ df1 å’Œdf2 * df1.join(df2, \"user_id\") * &#125;&#125;&#125; * * @param right Right side of the join operation. joinè¿æ¥å³ä¾§ * @param usingColumn Name of the column to join on. This column must exist on both sides. * åˆ—åã€‚å¿…é¡»åœ¨ä¸¤è¾¹éƒ½å­˜åœ¨ * @note If you perform a self-join using this function without aliasing the input * `DataFrame`s, you will NOT be able to reference any columns after the join, since * there is no way to disambiguate which side of the join you would like to reference. * è‡ªè¿æ¥çš„æ—¶å€™ï¼Œè¯·æŒ‡å®š è¡¨åˆ«åã€‚ä¸ç„¶å¹²ä¸äº†äº‹ * @group untypedrel * @since 2.0.0 */ def join(right: Dataset[_], usingColumn: String): DataFrame = &#123; join(right, Seq(usingColumn)) &#125; /** * Inner equi-join with another `DataFrame` using the given columns. * æ ¹æ®æŒ‡å®šå¤šä¸ªåˆ—è¿›è¡Œjoin * * Different from other join functions, the join columns will only appear once in the output, * i.e. similar to SQL's `JOIN USING` syntax. * * &#123;&#123;&#123; * // Joining df1 and df2 using the columns \"user_id\" and \"user_name\" * df1.join(df2, Seq(\"user_id\", \"user_name\")) * &#125;&#125;&#125; * * @param right Right side of the join operation. * @param usingColumns Names of the columns to join on. This columns must exist on both sides. * @note If you perform a self-join using this function without aliasing the input * `DataFrame`s, you will NOT be able to reference any columns after the join, since * there is no way to disambiguate which side of the join you would like to reference. * @group untypedrel * @since 2.0.0 */ def join(right: Dataset[_], usingColumns: Seq[String]): DataFrame = &#123; join(right, usingColumns, \"inner\") &#125; /** * Equi-join with another `DataFrame` using the given columns. * * Different from other join functions, the join columns will only appear once in the output, * i.e. similar to SQL's `JOIN USING` syntax. * * @param right Right side of the join operation. * @param usingColumns Names of the columns to join on. This columns must exist on both sides. * @param joinType One of: `inner`, `outer`, `left_outer`, `right_outer`, `leftsemi`. * è¿æ¥ç±»å‹ï¼šå†…è¿æ¥ï¼Œå¤–è¿æ¥ï¼Œå·¦å¤–è¿æ¥ï¼Œå³å¤–è¿æ¥ï¼Œå·¦å†…è¿æ¥ * @note If you perform a self-join using this function without aliasing the input * `DataFrame`s, you will NOT be able to reference any columns after the join, since * there is no way to disambiguate which side of the join you would like to reference. * @group untypedrel * @since 2.0.0 */ def join(right: Dataset[_], usingColumns: Seq[String], joinType: String): DataFrame = &#123; // Analyze the self join. The assumption is that the analyzer will disambiguate left vs right // by creating a new instance for one of the branch. // è‡ªè¿æ¥çš„æ—¶å€™ï¼Œä¸ºå…¶ä¸­ä¸€ä¸ªåˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹æ¥æ¶ˆé™¤å·¦vså³çš„æ­§ä¹‰ã€‚ val joined = sparkSession.sessionState.executePlan( Join(logicalPlan, right.logicalPlan, joinType = JoinType(joinType), None)) .analyzed.asInstanceOf[Join] withPlan &#123; Join( joined.left, joined.right, UsingJoin(JoinType(joinType), usingColumns), None) &#125; &#125; /** * Inner join with another `DataFrame`, using the given join expression. * ç”¨ç»™å®šçš„è¡¨è¾¾å¼è¿›è¡Œjoin * &#123;&#123;&#123; * // The following two are equivalent: * df1.join(df2, $\"df1Key\" === $\"df2Key\") * df1.join(df2).where($\"df1Key\" === $\"df2Key\") * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ def join(right: Dataset[_], joinExprs: Column): DataFrame = join(right, joinExprs, \"inner\") /** * Join with another `DataFrame`, using the given join expression. The following performs * a full outer join between `df1` and `df2`. * * &#123;&#123;&#123; * // Scala: * import org.apache.spark.sql.functions._ * df1.join(df2, $\"df1Key\" === $\"df2Key\", \"outer\") * * // Java: * import static org.apache.spark.sql.functions.*; * df1.join(df2, col(\"df1Key\").equalTo(col(\"df2Key\")), \"outer\"); * &#125;&#125;&#125; * * @param right Right side of the join. * @param joinExprs Join expression. * @param joinType One of: `inner`, `outer`, `left_outer`, `right_outer`, `leftsemi`. * @group untypedrel * @since 2.0.0 */ def join(right: Dataset[_], joinExprs: Column, joinType: String): DataFrame = &#123; // Note that in this function, we introduce a hack in the case of self-join to automatically // resolve ambiguous join conditions into ones that might make sense [SPARK-6231]. // Consider this case: df.join(df, df(\"key\") === df(\"key\")) // Since df(\"key\") === df(\"key\") is a trivially true condition, this actually becomes a // cartesian join. However, most likely users expect to perform a self join using \"key\". // With that assumption, this hack turns the trivially true condition into equality on join // keys that are resolved to both sides. // Trigger analysis so in the case of self-join, the analyzer will clone the plan. // After the cloning, left and right side will have distinct expression ids. // é’ˆå¯¹è‡ªè¿æ¥çš„ä¼˜åŒ–ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œè‡ªè¿æ¥å¦‚æœä½¿ç”¨ df.join(df, df(\"key\") === df(\"key\")) // ä¼šé€ æˆ ç¬›å¡å°”ç§¯ // è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ†æå™¨ä¼š å…‹éš†è®¡åˆ’ï¼Œå…‹éš†å®Œæˆåï¼Œå·¦å³ä¸¤è¾¹åˆ™æœ‰ä¸åŒçš„ id val plan = withPlan( Join(logicalPlan, right.logicalPlan, JoinType(joinType), Some(joinExprs.expr))) .queryExecution.analyzed.asInstanceOf[Join] // If auto self join alias is disabled, return the plan. if (!sparkSession.sessionState.conf.dataFrameSelfJoinAutoResolveAmbiguity) &#123; return withPlan(plan) &#125; // If left/right have no output set intersection, return the plan. val lanalyzed = withPlan(this.logicalPlan).queryExecution.analyzed val ranalyzed = withPlan(right.logicalPlan).queryExecution.analyzed if (lanalyzed.outputSet.intersect(ranalyzed.outputSet).isEmpty) &#123; return withPlan(plan) &#125; // Otherwise, find the trivially true predicates and automatically resolves them to both sides. // By the time we get here, since we have already run analysis, all attributes should've been // resolved and become AttributeReference. val cond = plan.condition.map &#123; _.transform &#123; case catalyst.expressions.EqualTo(a: AttributeReference, b: AttributeReference) if a.sameRef(b) =&gt; catalyst.expressions.EqualTo( withPlan(plan.left).resolve(a.name), withPlan(plan.right).resolve(b.name)) &#125; &#125; withPlan &#123; plan.copy(condition = cond) &#125; &#125; crossJoin12345678910111213/** * Explicit cartesian join with another `DataFrame`. * æ˜¾å¼ç¬›å¡å°”ç§¯join * * @param right Right side of the join operation. * @note Cartesian joins are very expensive without an extra filter that can be pushed down. * å¦‚æœæ²¡æœ‰é¢å¤–çš„è¿‡æ»¤å™¨ï¼Œç¬›å¡å°”è¿æ¥éå¸¸æ˜‚è´µã€‚ * @group untypedrel * @since 2.1.0 */def crossJoin(right: Dataset[_]): DataFrame = withPlan &#123; Join(logicalPlan, right.logicalPlan, joinType = Cross, None)&#125; apply123456789101112/** * Selects column based on the column name and return it as a [[Column]]. * * é€‰æ‹©åŸºäºåˆ—åçš„åˆ—ï¼Œå¹¶å°†å…¶ä½œä¸º[[Column]]è¿”å›ã€‚ * * @note The column name can also reference to a nested column like `a.b`. * * åˆ—åä¹Ÿå¯ä»¥å¼•ç”¨åƒâ€œa.bâ€è¿™æ ·çš„åµŒå¥—åˆ—ã€‚ * @group untypedrel * @since 2.0.0 */def apply(colName: String): Column = col(colName) col123456789101112131415161718/** * Selects column based on the column name and return it as a [[Column]]. * * é€‰æ‹©åŸºäºåˆ—åçš„åˆ—ï¼Œå¹¶å°†å…¶ä½œä¸º[[Column]]è¿”å›ã€‚ * * @note The column name can also reference to a nested column like `a.b`. * * åˆ—åä¹Ÿå¯ä»¥å¼•ç”¨åƒâ€œa.bâ€è¿™æ ·çš„åµŒå¥—åˆ—ã€‚ * @group untypedrel * @since 2.0.0 */def col(colName: String): Column = colName match &#123; case \"*\" =&gt; Column(ResolvedStar(queryExecution.analyzed.output)) case _ =&gt; val expr = resolve(colName) Column(expr)&#125; select12345678910111213141516171819202122232425262728293031/** * Selects a set of column based expressions. * &#123;&#123;&#123; * ds.select($\"colA\", $\"colB\" + 1) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */@scala.annotation.varargsdef select(cols: Column*): DataFrame = withPlan &#123; Project(cols.map(_.named), logicalPlan)&#125;/** * Selects a set of columns. This is a variant of `select` that can only select * existing columns using column names (i.e. cannot construct expressions). * * åªèƒ½æ˜¯å·²ç»å­˜åœ¨çš„åˆ—å * * &#123;&#123;&#123; * // The following two are equivalent: * ds.select(\"colA\", \"colB\") * ds.select($\"colA\", $\"colB\") * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */@scala.annotation.varargsdef select(col: String, cols: String*): DataFrame = select((col +: cols).map(Column(_)): _*) selectExpr12345678910111213141516171819202122/** * Selects a set of SQL expressions. This is a variant of `select` that accepts * SQL expressions. * * æ¥å—SQLè¡¨è¾¾å¼ * * &#123;&#123;&#123; * // The following are equivalent: * ä»¥ä¸‹æ˜¯ç­‰ä»·çš„: * ds.selectExpr(\"colA\", \"colB as newName\", \"abs(colC)\") * ds.select(expr(\"colA\"), expr(\"colB as newName\"), expr(\"abs(colC)\")) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */@scala.annotation.varargsdef selectExpr(exprs: String*): DataFrame = &#123; select(exprs.map &#123; expr =&gt; Column(sparkSession.sessionState.sqlParser.parseExpression(expr)) &#125;: _*)&#125; groupBy123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * Groups the Dataset using the specified columns, so we can run aggregation on them. See * [[RelationalGroupedDataset]] for all the available aggregate functions. * * ä½¿ç”¨æŒ‡å®šçš„åˆ—å¯¹æ•°æ®é›†è¿›è¡Œåˆ†ç»„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œèšåˆã€‚ * æŸ¥çœ‹[[RelationalGroupedDataset]]ä¸ºæ‰€æœ‰å¯ç”¨çš„èšåˆå‡½æ•°ã€‚ * * * &#123;&#123;&#123; * // Compute the average for all numeric columns grouped by department. * * è®¡ç®—æŒ‰éƒ¨é—¨åˆ†ç»„çš„æ‰€æœ‰æ•°å­—åˆ—çš„å¹³å‡å€¼ã€‚ * * ds.groupBy($\"department\").avg() * * // Compute the max age and average salary, grouped by department and gender. * ds.groupBy($\"department\", $\"gender\").agg(Map( * \"salary\" -&gt; \"avg\", * \"age\" -&gt; \"max\" * )) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */@scala.annotation.varargsdef groupBy(cols: Column*): RelationalGroupedDataset = &#123; RelationalGroupedDataset(toDF(), cols.map(_.expr), RelationalGroupedDataset.GroupByType)&#125; /** * Groups the Dataset using the specified columns, so that we can run aggregation on them. * See [[RelationalGroupedDataset]] for all the available aggregate functions. * * This is a variant of groupBy that can only group by existing columns using column names * (i.e. cannot construct expressions). * * &#123;&#123;&#123; * // Compute the average for all numeric columns grouped by department. * ds.groupBy(\"department\").avg() * * // Compute the max age and average salary, grouped by department and gender. * ds.groupBy($\"department\", $\"gender\").agg(Map( * \"salary\" -&gt; \"avg\", * \"age\" -&gt; \"max\" * )) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */@scala.annotation.varargsdef groupBy(col1: String, cols: String*): RelationalGroupedDataset = &#123; val colNames: Seq[String] = col1 +: cols RelationalGroupedDataset( toDF(), colNames.map(colName =&gt; resolve(colName)), RelationalGroupedDataset.GroupByType)&#125; rollup1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** * Create a multi-dimensional rollup for the current Dataset using the specified columns, * so we can run aggregation on them. * See [[RelationalGroupedDataset]] for all the available aggregate functions. * * ä½¿ç”¨æŒ‡å®šçš„åˆ—ä¸ºå½“å‰æ•°æ®é›†åˆ›å»ºå¤šç»´çš„æ±‡æ€»ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¸Šè¿è¡Œèšåˆã€‚ * * * &#123;&#123;&#123; * // Compute the average for all numeric columns rolluped by department and group. * * æ±‡æ€»å æ±‚å¹³å‡å€¼ * * ds.rollup($\"department\", $\"group\").avg() * * // Compute the max age and average salary, rolluped by department and gender. * ds.rollup($\"department\", $\"gender\").agg(Map( * \"salary\" -&gt; \"avg\", * \"age\" -&gt; \"max\" * )) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ @scala.annotation.varargs def rollup(cols: Column*): RelationalGroupedDataset = &#123; RelationalGroupedDataset(toDF(), cols.map(_.expr), RelationalGroupedDataset.RollupType) &#125; /** * Create a multi-dimensional rollup for the current Dataset using the specified columns, * so we can run aggregation on them. * See [[RelationalGroupedDataset]] for all the available aggregate functions. * * ä½¿ç”¨æŒ‡å®šçš„åˆ—ä¸ºå½“å‰æ•°æ®é›†åˆ›å»ºå¤šç»´çš„rollupï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¸Šè¿è¡Œèšåˆã€‚ * rollupå¯ä»¥å®ç° ä»å³åˆ°å·¦ä¸€æ¬¡é€’å‡çš„å¤šçº§ç»Ÿè®¡ï¼Œæ˜¾ç¤ºç»Ÿè®¡æŸä¸€å±‚æ¬¡ç»“æ„çš„èšåˆ * ä¾‹å¦‚ rollup(a,b,c,d) =ç»“æœ=&gt; (a,b,c,d),(a,b,c),(a,b),a * * This is a variant of rollup that can only group by existing columns using column names * (i.e. cannot construct expressions). * * &#123;&#123;&#123; * // Compute the average for all numeric columns rolluped by department and group. * ds.rollup(\"department\", \"group\").avg() * * // Compute the max age and average salary, rolluped by department and gender. * ds.rollup($\"department\", $\"gender\").agg(Map( * \"salary\" -&gt; \"avg\", * \"age\" -&gt; \"max\" * )) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ @scala.annotation.varargs def rollup(col1: String, cols: String*): RelationalGroupedDataset = &#123; val colNames: Seq[String] = col1 +: cols RelationalGroupedDataset( toDF(), colNames.map(colName =&gt; resolve(colName)), RelationalGroupedDataset.RollupType) &#125; cube123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * Create a multi-dimensional cube for the current Dataset using the specified columns, * so we can run aggregation on them. * See [[RelationalGroupedDataset]] for all the available aggregate functions. * * ä½¿ç”¨æŒ‡å®šçš„åˆ—ä¸ºå½“å‰æ•°æ®é›†åˆ›å»ºå¤šç»´æ•°æ®é›†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¸Šè¿è¡Œèšåˆã€‚ * * * &#123;&#123;&#123; * // Compute the average for all numeric columns cubed by department and group. * ds.cube($\"department\", $\"group\").avg() * * // Compute the max age and average salary, cubed by department and gender. * ds.cube($\"department\", $\"gender\").agg(Map( * \"salary\" -&gt; \"avg\", * \"age\" -&gt; \"max\" * )) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ @scala.annotation.varargs def cube(cols: Column*): RelationalGroupedDataset = &#123; RelationalGroupedDataset(toDF(), cols.map(_.expr), RelationalGroupedDataset.CubeType) &#125; /** * Create a multi-dimensional cube for the current Dataset using the specified columns, * so we can run aggregation on them. * See [[RelationalGroupedDataset]] for all the available aggregate functions. * * é­”æ–¹ ä¾‹å¦‚ï¼šcube(a,b,c) =ç»“æœ=&gt; (a,b),(a,c),a,(b,c),b,c ç»“æœä¸ºæ‰€æœ‰çš„ç»´åº¦ * ä½¿ç”¨æŒ‡å®šçš„åˆ—ä¸ºå½“å‰æ•°æ®é›†åˆ›å»ºå¤šç»´å¤šç»´æ•°æ®é›†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¸Šè¿è¡Œèšåˆã€‚ * * This is a variant of cube that can only group by existing columns using column names * (i.e. cannot construct expressions). * * è¿™æ˜¯ä¸€ä¸ªå¤šç»´æ•°æ®é›†çš„å˜ä½“ï¼Œå®ƒåªèƒ½é€šè¿‡ä½¿ç”¨åˆ—åçš„ç°æœ‰åˆ—æ¥åˆ†ç»„ * * &#123;&#123;&#123; * // Compute the average for all numeric columns cubed by department and group. * ds.cube(\"department\", \"group\").avg() * * // Compute the max age and average salary, cubed by department and gender. * ds.cube($\"department\", $\"gender\").agg(Map( * \"salary\" -&gt; \"avg\", * \"age\" -&gt; \"max\" * )) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ @scala.annotation.varargs def cube(col1: String, cols: String*): RelationalGroupedDataset = &#123; val colNames: Seq[String] = col1 +: cols RelationalGroupedDataset( toDF(), colNames.map(colName =&gt; resolve(colName)), RelationalGroupedDataset.CubeType) &#125; agg123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263/** * (Scala-specific) Aggregates on the entire Dataset without groups. * å¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œèšåˆï¼Œæ— éœ€åˆ†ç»„ã€‚ * &#123;&#123;&#123; * // ds.agg(...) is a shorthand for ds.groupBy().agg(...) * ds.agg(\"age\" -&gt; \"max\", \"salary\" -&gt; \"avg\") * ds.groupBy().agg(\"age\" -&gt; \"max\", \"salary\" -&gt; \"avg\") * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ def agg(aggExpr: (String, String), aggExprs: (String, String)*): DataFrame = &#123; groupBy().agg(aggExpr, aggExprs: _*) &#125; /** * (Scala-specific) Aggregates on the entire Dataset without groups. * å¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œèšåˆï¼Œæ— éœ€åˆ†ç»„ã€‚ * * &#123;&#123;&#123; * // ds.agg(...) is a shorthand for ds.groupBy().agg(...) * ds.agg(Map(\"age\" -&gt; \"max\", \"salary\" -&gt; \"avg\")) * ds.groupBy().agg(Map(\"age\" -&gt; \"max\", \"salary\" -&gt; \"avg\")) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ def agg(exprs: Map[String, String]): DataFrame = groupBy().agg(exprs) /** * (Java-specific) Aggregates on the entire Dataset without groups. * * å¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œèšåˆï¼Œæ— éœ€åˆ†ç»„ã€‚ * * &#123;&#123;&#123; * // ds.agg(...) is a shorthand for ds.groupBy().agg(...) * ds.agg(Map(\"age\" -&gt; \"max\", \"salary\" -&gt; \"avg\")) * ds.groupBy().agg(Map(\"age\" -&gt; \"max\", \"salary\" -&gt; \"avg\")) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ def agg(exprs: java.util.Map[String, String]): DataFrame = groupBy().agg(exprs) /** * Aggregates on the entire Dataset without groups. * * å¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œèšåˆï¼Œæ— éœ€åˆ†ç»„ã€‚ * * &#123;&#123;&#123; * // ds.agg(...) is a shorthand for ds.groupBy().agg(...) * ds.agg(max($\"age\"), avg($\"salary\")) * ds.groupBy().agg(max($\"age\"), avg($\"salary\")) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */ @scala.annotation.varargs def agg(expr: Column, exprs: Column*): DataFrame = groupBy().agg(expr, exprs: _*) explode12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091/** * (Scala-specific) Returns a new Dataset where each row has been expanded to zero or more * rows by the provided function. This is similar to a `LATERAL VIEW` in HiveQL. The columns of * the input row are implicitly joined with each row that is output by the function. * * æ ¹æ®æä¾›çš„æ–¹æ³•ï¼Œè¯¥æ•°æ®é›†çš„æ¯ä¸€è¡Œéƒ½è¢«æ‰©å±•ä¸ºé›¶ä¸ªæˆ–æ›´å¤šçš„è¡Œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ã€‚ * è¿™ç±»ä¼¼äºHiveQLçš„â€œLATERAL VIEWâ€ã€‚ * è¾“å…¥è¡Œçš„åˆ— éšå¼åœ°åŠ å…¥äº†ç”±å‡½æ•°è¾“å‡ºçš„æ¯ä¸€è¡Œã€‚ * * Given that this is deprecated, as an alternative, you can explode columns either using * `functions.explode()` or `flatMap()`. The following example uses these alternatives to count * the number of books that contain a given word: * * è€ƒè™‘åˆ°è¿™å·²ç»è¢«å¼ƒç”¨ï¼Œä½œä¸ºæ›¿ä»£ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨â€œfunctions.explode()â€æˆ–â€œflatMap()â€æ¥å¼•çˆ†åˆ—ã€‚ * ä¸‹é¢çš„ç¤ºä¾‹ä½¿ç”¨è¿™äº›æ›¿ä»£æ–¹æ³•æ¥è®¡ç®—åŒ…å«ç»™å®šå•è¯çš„å›¾ä¹¦çš„æ•°é‡: * * &#123;&#123;&#123; * case class Book(title: String, words: String) * val ds: Dataset[Book] * * val allWords = ds.select('title, explode(split('words, \" \")).as(\"word\")) * * val bookCountPerWord = allWords.groupBy(\"word\").agg(countDistinct(\"title\")) * &#125;&#125;&#125; * * Using `flatMap()` this can similarly be exploded as: * * &#123;&#123;&#123; * ds.flatMap(_.words.split(\" \")) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 å·²ç»è¿‡æ—¶ï¼Œç”¨ flatMap() æˆ– functions.explode() ä»£æ›¿ */@deprecated(\"use flatMap() or select() with functions.explode() instead\", \"2.0.0\")def explode[A &lt;: Product : TypeTag](input: Column*)(f: Row =&gt; TraversableOnce[A]): DataFrame = &#123; val elementSchema = ScalaReflection.schemaFor[A].dataType.asInstanceOf[StructType] val convert = CatalystTypeConverters.createToCatalystConverter(elementSchema) val rowFunction = f.andThen(_.map(convert(_).asInstanceOf[InternalRow])) val generator = UserDefinedGenerator(elementSchema, rowFunction, input.map(_.expr)) withPlan &#123; Generate(generator, join = true, outer = false, qualifier = None, generatorOutput = Nil, logicalPlan) &#125;&#125;/** * (Scala-specific) Returns a new Dataset where a single column has been expanded to zero * or more rows by the provided function. This is similar to a `LATERAL VIEW` in HiveQL. All * columns of the input row are implicitly joined with each value that is output by the function. * * Given that this is deprecated, as an alternative, you can explode columns either using * `functions.explode()`: * * &#123;&#123;&#123; * ds.select(explode(split('words, \" \")).as(\"word\")) * &#125;&#125;&#125; * * or `flatMap()`: * * &#123;&#123;&#123; * ds.flatMap(_.words.split(\" \")) * &#125;&#125;&#125; * * @group untypedrel * @since 2.0.0 */@deprecated(\"use flatMap() or select() with functions.explode() instead\", \"2.0.0\")def explode[A, B: TypeTag](inputColumn: String, outputColumn: String)(f: A =&gt; TraversableOnce[B]): DataFrame = &#123; val dataType = ScalaReflection.schemaFor[B].dataType val attributes = AttributeReference(outputColumn, dataType)() :: Nil // TODO handle the metadata? val elementSchema = attributes.toStructType def rowFunction(row: Row): TraversableOnce[InternalRow] = &#123; val convert = CatalystTypeConverters.createToCatalystConverter(dataType) f(row(0).asInstanceOf[A]).map(o =&gt; InternalRow(convert(o))) &#125; val generator = UserDefinedGenerator(elementSchema, rowFunction, apply(inputColumn).expr :: Nil) withPlan &#123; Generate(generator, join = true, outer = false, qualifier = None, generatorOutput = Nil, logicalPlan) &#125;&#125; withColumn1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/** * Returns a new Dataset by adding a column or replacing the existing column that has * the same name. * é€šè¿‡æ·»åŠ ä¸€ä¸ªåˆ—æˆ–æ›¿æ¢å…·æœ‰ç›¸åŒåç§°çš„ç°æœ‰åˆ—è¿”å›æ–°çš„æ•°æ®é›†ã€‚ * * @group untypedrel * @since 2.0.0 */def withColumn(colName: String, col: Column): DataFrame = &#123; val resolver = sparkSession.sessionState.analyzer.resolver val output = queryExecution.analyzed.output val shouldReplace = output.exists(f =&gt; resolver(f.name, colName)) if (shouldReplace) &#123; val columns = output.map &#123; field =&gt; if (resolver(field.name, colName)) &#123; col.as(colName) &#125; else &#123; Column(field) &#125; &#125; select(columns: _*) &#125; else &#123; select(Column(\"*\"), col.as(colName)) &#125;&#125;/** * Returns a new Dataset by adding a column with metadata. * é€šè¿‡æ·»åŠ å¸¦æœ‰å…ƒæ•°æ®çš„åˆ—è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ã€‚ */private[spark] def withColumn(colName: String, col: Column, metadata: Metadata): DataFrame = &#123; val resolver = sparkSession.sessionState.analyzer.resolver val output = queryExecution.analyzed.output val shouldReplace = output.exists(f =&gt; resolver(f.name, colName)) if (shouldReplace) &#123; val columns = output.map &#123; field =&gt; if (resolver(field.name, colName)) &#123; col.as(colName, metadata) &#125; else &#123; Column(field) &#125; &#125; select(columns: _*) &#125; else &#123; select(Column(\"*\"), col.as(colName, metadata)) &#125;&#125; withColumnRenamed1234567891011121314151617181920212223242526/** * Returns a new Dataset with a column renamed. * This is a no-op if schema doesn't contain existingName. * è¿”å›ä¸€ä¸ªé‡å‘½åçš„åˆ—çš„æ–°æ•°æ®é›†ã€‚ * å¦‚æœæ¨¡å¼ä¸åŒ…å«å­˜åœ¨åç§°ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸æ“ä½œçš„ã€‚ * * @group untypedrel * @since 2.0.0 */def withColumnRenamed(existingName: String, newName: String): DataFrame = &#123; val resolver = sparkSession.sessionState.analyzer.resolver val output = queryExecution.analyzed.output val shouldRename = output.exists(f =&gt; resolver(f.name, existingName)) if (shouldRename) &#123; val columns = output.map &#123; col =&gt; if (resolver(col.name, existingName)) &#123; Column(col).as(newName) &#125; else &#123; Column(col) &#125; &#125; select(columns: _*) &#125; else &#123; toDF() &#125;&#125; drop1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768/** * Returns a new Dataset with a column dropped. This is a no-op if schema doesn't contain * column name. * * è¿”å›åˆ é™¤æŒ‡å®šåˆ—ä¹‹åçš„æ–°Dataset * * This method can only be used to drop top level columns. the colName string is treated * literally without further interpretation. * * ä»…ç”¨äºåˆ é™¤é¡¶å±‚çš„åˆ— * * @group untypedrel * @since 2.0.0 */def drop(colName: String): DataFrame = &#123; drop(Seq(colName): _*)&#125;/** * Returns a new Dataset with columns dropped. * This is a no-op if schema doesn't contain column name(s). * * åˆ é™¤æŒ‡å®šçš„å¤šä¸ªåˆ—ï¼Œå¹¶è¿”å›æ–°çš„dataset * * This method can only be used to drop top level columns. the colName string is treated literally * without further interpretation. * * @group untypedrel * @since 2.0.0 */@scala.annotation.varargsdef drop(colNames: String*): DataFrame = &#123; val resolver = sparkSession.sessionState.analyzer.resolver val allColumns = queryExecution.analyzed.output val remainingCols = allColumns.filter &#123; attribute =&gt; colNames.forall(n =&gt; !resolver(attribute.name, n)) &#125;.map(attribute =&gt; Column(attribute)) if (remainingCols.size == allColumns.size) &#123; toDF() &#125; else &#123; this.select(remainingCols: _*) &#125;&#125;/** * Returns a new Dataset with a column dropped. * This version of drop accepts a [[Column]] rather than a name. * This is a no-op if the Dataset doesn't have a column * with an equivalent expression. * * åˆ é™¤æŒ‡å®šçš„ åˆ—ï¼ˆæ ¹æ®Columnï¼‰ * * @group untypedrel * @since 2.0.0 */def drop(col: Column): DataFrame = &#123; val expression = col match &#123; case Column(u: UnresolvedAttribute) =&gt; queryExecution.analyzed.resolveQuoted( u.name, sparkSession.sessionState.analyzer.resolver).getOrElse(u) case Column(expr: Expression) =&gt; expr &#125; val attrs = this.logicalPlan.output val colsAfterDrop = attrs.filter &#123; attr =&gt; attr != expression &#125;.map(attr =&gt; Column(attr)) select(colsAfterDrop: _*)&#125; typedrel-æœ‰ç±»å‹çš„è½¬æ¢joinWith123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108/** * :: Experimental :: å®éªŒçš„ * Joins this Dataset returning a `Tuple2` for each pair where `condition` evaluates to * true. * è¿æ¥è¿™ä¸ªæ•°æ®é›†è¿”å›ä¸€ä¸ªâ€œTuple2â€å¯¹æ¯ä¸€å¯¹çš„â€œæ¡ä»¶â€è®¡ç®—ä¸ºtrueã€‚ * * This is similar to the relation `join` function with one important difference in the * result schema. Since `joinWith` preserves objects present on either side of the join, the * result schema is similarly nested into a tuple under the column names `_1` and `_2`. * è¿™ç±»ä¼¼äºå…³ç³»â€œjoinâ€å‡½æ•°ï¼Œåœ¨ç»“æœæ¨¡å¼ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ã€‚ * ç”±äºâ€œjoinWithâ€ä¿å­˜äº†è¿æ¥çš„ä»»ä½•ä¸€è¾¹çš„å¯¹è±¡ï¼Œå› æ­¤ç»“æœæ¨¡å¼ç±»ä¼¼åœ°åµŒå¥—åœ¨åˆ—åç§°â€œ_1â€å’Œâ€œ_2â€ä¸‹é¢çš„tupleä¸­ã€‚ * * This type of join can be useful both for preserving type-safety with the original object * types as well as working with relational data where either side of the join has column * names in common. * è¿™ç§ç±»å‹çš„è”æ¥æ—¢å¯ä»¥ç”¨äºä¿å­˜ä¸åŸå§‹å¯¹è±¡ç±»å‹çš„ç±»å‹å®‰å…¨æ€§ï¼Œ * ä¹Ÿå¯ä»¥ç”¨äºå¤„ç†è¿æ¥çš„ä»»ä½•ä¸€ç«¯éƒ½æœ‰åˆ—åçš„å…³ç³»æ•°æ®ã€‚ * * @param other Right side of the join. * @param condition Join expression. * @param joinType One of: `inner`, `outer`, `left_outer`, `right_outer`, `leftsemi`. * @group typedrel * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef joinWith[U](other: Dataset[U], condition: Column, joinType: String): Dataset[(T, U)] = &#123; // Creates a Join node and resolve it first, to get join condition resolved, self-join resolved, // åˆ›å»ºä¸€ä¸ªè”æ¥èŠ‚ç‚¹å¹¶é¦–å…ˆè§£æå®ƒï¼Œä½¿Joinæ¡ä»¶å¾—åˆ°è§£æï¼Œself - Joinè§£æï¼Œ // etc. val joined = sparkSession.sessionState.executePlan( Join( this.logicalPlan, other.logicalPlan, JoinType(joinType), Some(condition.expr))).analyzed.asInstanceOf[Join] // For both join side, combine all outputs into a single column and alias it with \"_1\" or \"_2\", // to match the schema for the encoder of the join result. // å¯¹äºè¿™ä¸¤ä¸ªè¿æ¥ï¼Œå°†æ‰€æœ‰è¾“å‡ºåˆå¹¶ä¸ºä¸€ä¸ªåˆ—ï¼Œå¹¶å°†å…¶åˆ«åä¸ºâ€œ_1â€æˆ–â€œ_2â€ï¼Œä»¥åŒ¹é…è¿æ¥ç»“æœçš„ç¼–ç å™¨çš„æ¨¡å¼ã€‚ // Note that we do this before joining them, to enable the join operator to return null for one // side, in cases like outer-join. // è¯·æ³¨æ„ï¼Œåœ¨joinå®ƒä»¬ä¹‹å‰ï¼Œæˆ‘ä»¬è¿™æ ·åšï¼Œä½¿joinæ“ä½œç¬¦åœ¨åƒouter - joinè¿™æ ·çš„æƒ…å†µä¸‹è¿”å›nullã€‚ val left = &#123; val combined = if (this.exprEnc.flat) &#123; assert(joined.left.output.length == 1) Alias(joined.left.output.head, \"_1\")() &#125; else &#123; Alias(CreateStruct(joined.left.output), \"_1\")() &#125; Project(combined :: Nil, joined.left) &#125; val right = &#123; val combined = if (other.exprEnc.flat) &#123; assert(joined.right.output.length == 1) Alias(joined.right.output.head, \"_2\")() &#125; else &#123; Alias(CreateStruct(joined.right.output), \"_2\")() &#125; Project(combined :: Nil, joined.right) &#125; // Rewrites the join condition to make the attribute point to correct column/field, after we // combine the outputs of each join side. // åœ¨å°†æ¯ä¸ªè¿æ¥çš„è¾“å‡ºç»„åˆåœ¨ä¸€èµ·ä¹‹å,é‡å†™è”æ¥æ¡ä»¶ï¼Œä½¿å±æ€§æŒ‡å‘æ­£ç¡®çš„åˆ—/å­—æ®µã€‚ val conditionExpr = joined.condition.get transformUp &#123; case a: Attribute if joined.left.outputSet.contains(a) =&gt; if (this.exprEnc.flat) &#123; left.output.head &#125; else &#123; val index = joined.left.output.indexWhere(_.exprId == a.exprId) GetStructField(left.output.head, index) &#125; case a: Attribute if joined.right.outputSet.contains(a) =&gt; if (other.exprEnc.flat) &#123; right.output.head &#125; else &#123; val index = joined.right.output.indexWhere(_.exprId == a.exprId) GetStructField(right.output.head, index) &#125; &#125; implicit val tuple2Encoder: Encoder[(T, U)] = ExpressionEncoder.tuple(this.exprEnc, other.exprEnc) withTypedPlan(Join(left, right, joined.joinType, Some(conditionExpr)))&#125;/** * :: Experimental :: * Using inner equi-join to join this Dataset returning a `Tuple2` for each pair * where `condition` evaluates to true. * * ä½¿ç”¨å†…éƒ¨çš„ç­‰è¿æ¥åŠ å…¥è¿™ä¸ªæ•°æ®é›†ï¼Œä¸ºæ¯ä¸€å¯¹è¿”å›ä¸€ä¸ªâ€œTuple2â€ï¼Œå…¶ä¸­â€œæ¡ä»¶â€çš„è®¡ç®—ç»“æœä¸ºtrueã€‚ * * @param other Right side of the join. * @param condition Join expression. * @group typedrel * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef joinWith[U](other: Dataset[U], condition: Column): Dataset[(T, U)] = &#123; joinWith(other, condition, \"inner\")&#125; sortWithinPartitions123456789101112131415161718192021222324252627282930313233/** * Returns a new Dataset with each partition sorted by the given expressions. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œæ¯ä¸ªåˆ†åŒºæŒ‰ç…§ç»™å®šçš„è¡¨è¾¾å¼æ’åºã€‚ * * This is the same operation as \"SORT BY\" in SQL (Hive QL). * * è¿™ä¸SQL(Hive QL)ä¸­â€œSORT BYâ€çš„æ“ä½œç›¸åŒã€‚ * * @group typedrel * @since 2.0.0 */@scala.annotation.varargsdef sortWithinPartitions(sortCol: String, sortCols: String*): Dataset[T] = &#123; sortWithinPartitions((sortCol +: sortCols).map(Column(_)): _*)&#125;/** * Returns a new Dataset with each partition sorted by the given expressions. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œæ¯ä¸ªåˆ†åŒºæŒ‰ç…§ç»™å®šçš„è¡¨è¾¾å¼æ’åºã€‚ * * This is the same operation as \"SORT BY\" in SQL (Hive QL). * * è¿™ä¸SQL(Hive QL)ä¸­â€œSORT BYâ€çš„æ“ä½œç›¸åŒã€‚ * * @group typedrel * @since 2.0.0 */@scala.annotation.varargsdef sortWithinPartitions(sortExprs: Column*): Dataset[T] = &#123; sortInternal(global = false, sortExprs)&#125; sort1234567891011121314151617181920212223242526272829303132333435/** * Returns a new Dataset sorted by the specified column, all in ascending order. * æ’åº å‡åº * &#123;&#123;&#123; * // The following 3 are equivalent * ä¸‹é¢3ä¸ªæ˜¯ç­‰ä»·çš„ * ds.sort(\"sortcol\") * ds.sort($\"sortcol\") * ds.sort($\"sortcol\".asc) * &#125;&#125;&#125; * * @group typedrel * @since 2.0.0 */ @scala.annotation.varargs def sort(sortCol: String, sortCols: String*): Dataset[T] = &#123; sort((sortCol +: sortCols).map(apply): _*) &#125; /** * Returns a new Dataset sorted by the given expressions. For example: * * è¿”å›ä¸€ä¸ªç”±ç»™å®šè¡¨è¾¾å¼æ’åºçš„æ–°æ•°æ®é›†ã€‚ä¾‹å¦‚: * * &#123;&#123;&#123; * ds.sort($\"col1\", $\"col2\".desc) * &#125;&#125;&#125; * * @group typedrel * @since 2.0.0 */ @scala.annotation.varargs def sort(sortExprs: Column*): Dataset[T] = &#123; sortInternal(global = true, sortExprs) &#125; orderBy123456789101112131415161718192021/** * Returns a new Dataset sorted by the given expressions. * This is an alias of the `sort` function. * è¿™æ˜¯â€œsortâ€å‡½æ•°çš„åˆ«åã€‚ * * @group typedrel * @since 2.0.0 */ @scala.annotation.varargs def orderBy(sortCol: String, sortCols: String*): Dataset[T] = sort(sortCol, sortCols: _*) /** * Returns a new Dataset sorted by the given expressions. * This is an alias of the `sort` function. * è¿™æ˜¯â€œsortâ€å‡½æ•°çš„åˆ«åã€‚ * * @group typedrel * @since 2.0.0 */ @scala.annotation.varargs def orderBy(sortExprs: Column*): Dataset[T] = sort(sortExprs: _*) as12345678910111213141516171819/** * Returns a new Dataset with an alias set. * * è¿”å›ä¸€ä¸ªå…·æœ‰åˆ«åé›†çš„æ–°æ•°æ®é›†ã€‚ * * @group typedrel * @since 1.6.0 */ def as(alias: String): Dataset[T] = withTypedPlan &#123; SubqueryAlias(alias, logicalPlan, None) &#125; /** * (Scala-specific) Returns a new Dataset with an alias set. * * @group typedrel * @since 2.0.0 */ def as(alias: Symbol): Dataset[T] = as(alias.name) alias12345678910111213141516/** * Returns a new Dataset with an alias set. Same as `as`. * è¿”å›ä¸€ä¸ªå…·æœ‰åˆ«åé›†çš„æ–°æ•°æ®é›†ã€‚ä¸â€œasâ€ç›¸åŒã€‚ * * @group typedrel * @since 2.0.0 */ def alias(alias: String): Dataset[T] = as(alias) /** * (Scala-specific) Returns a new Dataset with an alias set. Same as `as`. * * @group typedrel * @since 2.0.0 */ def alias(alias: Symbol): Dataset[T] = as(alias) select1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889/** * :: Experimental :: * Returns a new Dataset by computing the given [[Column]] expression for each element. * * é€šè¿‡è®¡ç®—æ¯ä¸ªå…ƒç´ çš„ç»™å®š[[åˆ—]]è¡¨è¾¾å¼è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ã€‚ * * &#123;&#123;&#123; * val ds = Seq(1, 2, 3).toDS() * val newDS = ds.select(expr(\"value + 1\").as[Int]) * &#125;&#125;&#125; * * @group typedrel * @since 1.6.0 */ @Experimental @InterfaceStability.Evolving def select[U1](c1: TypedColumn[T, U1]): Dataset[U1] = &#123; implicit val encoder = c1.encoder val project = Project(c1.withInputType(exprEnc, logicalPlan.output).named :: Nil, logicalPlan) if (encoder.flat) &#123; new Dataset[U1](sparkSession, project, encoder) &#125; else &#123; // Flattens inner fields of U1 // ä½¿U1çš„å†…éƒ¨åŒºåŸŸå˜å¹³ new Dataset[Tuple1[U1]](sparkSession, project, ExpressionEncoder.tuple(encoder)).map(_._1) &#125; &#125; /** * :: Experimental :: * Returns a new Dataset by computing the given [[Column]] expressions for each element. * * @group typedrel * @since 1.6.0 */ @Experimental @InterfaceStability.Evolving def select[U1, U2](c1: TypedColumn[T, U1], c2: TypedColumn[T, U2]): Dataset[(U1, U2)] = selectUntyped(c1, c2).asInstanceOf[Dataset[(U1, U2)]] /** * :: Experimental :: * Returns a new Dataset by computing the given [[Column]] expressions for each element. * * @group typedrel * @since 1.6.0 */ @Experimental @InterfaceStability.Evolving def select[U1, U2, U3]( c1: TypedColumn[T, U1], c2: TypedColumn[T, U2], c3: TypedColumn[T, U3]): Dataset[(U1, U2, U3)] = selectUntyped(c1, c2, c3).asInstanceOf[Dataset[(U1, U2, U3)]] /** * :: Experimental :: * Returns a new Dataset by computing the given [[Column]] expressions for each element. * * @group typedrel * @since 1.6.0 */ @Experimental @InterfaceStability.Evolving def select[U1, U2, U3, U4]( c1: TypedColumn[T, U1], c2: TypedColumn[T, U2], c3: TypedColumn[T, U3], c4: TypedColumn[T, U4]): Dataset[(U1, U2, U3, U4)] = selectUntyped(c1, c2, c3, c4).asInstanceOf[Dataset[(U1, U2, U3, U4)]] /** * :: Experimental :: * Returns a new Dataset by computing the given [[Column]] expressions for each element. * * @group typedrel * @since 1.6.0 */ @Experimental @InterfaceStability.Evolving def select[U1, U2, U3, U4, U5]( c1: TypedColumn[T, U1], c2: TypedColumn[T, U2], c3: TypedColumn[T, U3], c4: TypedColumn[T, U4], c5: TypedColumn[T, U5]): Dataset[(U1, U2, U3, U4, U5)] = selectUntyped(c1, c2, c3, c4, c5).asInstanceOf[Dataset[(U1, U2, U3, U4, U5)]] filter12345678910111213141516171819202122232425262728293031323334/** * Filters rows using the given condition. * * ç”¨ç»™å®šçš„æ¡ä»¶è¿‡æ»¤rows * * &#123;&#123;&#123; * // The following are equivalent: * ä»¥ä¸‹æ˜¯ç­‰ä»·çš„ï¼š * peopleDs.filter($\"age\" &gt; 15) * peopleDs.where($\"age\" &gt; 15) * &#125;&#125;&#125; * * @group typedrel * @since 1.6.0 */ def filter(condition: Column): Dataset[T] = withTypedPlan &#123; Filter(condition.expr, logicalPlan) &#125; /** * Filters rows using the given SQL expression. * * ç”¨ç»™å®šçš„ SQL è¡¨è¾¾å¼ è¿‡æ»¤rows * * &#123;&#123;&#123; * peopleDs.filter(\"age &gt; 15\") * &#125;&#125;&#125; * * @group typedrel * @since 1.6.0 */ def filter(conditionExpr: String): Dataset[T] = &#123; filter(Column(sparkSession.sessionState.sqlParser.parseExpression(conditionExpr))) &#125; where1234567891011121314151617181920212223242526272829303132/** * Filters rows using the given condition. This is an alias for `filter`. * * ä½¿ç”¨ç»™å®šæ¡ä»¶è¿‡æ»¤è¡Œã€‚ * è¿™æ˜¯â€œfilterâ€çš„åˆ«åã€‚ * * &#123;&#123;&#123; * // The following are equivalent: * peopleDs.filter($\"age\" &gt; 15) * peopleDs.where($\"age\" &gt; 15) * &#125;&#125;&#125; * * @group typedrel * @since 1.6.0 */ def where(condition: Column): Dataset[T] = filter(condition) /** * Filters rows using the given SQL expression. * * ä½¿ç”¨ç»™å®šçš„ SQL è¡¨è¾¾å¼ è¿‡æ»¤ rows * * &#123;&#123;&#123; * peopleDs.where(\"age &gt; 15\") * &#125;&#125;&#125; * * @group typedrel * @since 1.6.0 */ def where(conditionExpr: String): Dataset[T] = &#123; filter(Column(sparkSession.sessionState.sqlParser.parseExpression(conditionExpr))) &#125; groupByKey12345678910111213141516171819202122232425262728293031323334353637/** * :: Experimental :: * (Scala-specific) * Returns a [[KeyValueGroupedDataset]] where the data is grouped by the given key `func`. * è¿”å›ä¸€ä¸ª[[KeyValueGroupedDataset]]ï¼Œæ•°æ®ç”±ç»™å®šé”®' func 'åˆ†ç»„ã€‚ * * @group typedrel * @since 2.0.0 */@Experimental@InterfaceStability.Evolvingdef groupByKey[K: Encoder](func: T =&gt; K): KeyValueGroupedDataset[K, T] = &#123; val inputPlan = logicalPlan val withGroupingKey = AppendColumns(func, inputPlan) val executed = sparkSession.sessionState.executePlan(withGroupingKey) new KeyValueGroupedDataset( encoderFor[K], encoderFor[T], executed, inputPlan.output, withGroupingKey.newColumns)&#125;/** * :: Experimental :: * (Java-specific) * Returns a [[KeyValueGroupedDataset]] where the data is grouped by the given key `func`. * è¿”å›ä¸€ä¸ª[[KeyValueGroupedDataset]]ï¼Œæ•°æ®ç”±ç»™å®šé”®' func 'åˆ†ç»„ã€‚ * * @group typedrel * @since 2.0.0 */@Experimental@InterfaceStability.Evolvingdef groupByKey[K](func: MapFunction[T, K], encoder: Encoder[K]): KeyValueGroupedDataset[K, T] = groupByKey(func.call(_))(encoder) limit123456789101112131415/** * Returns a new Dataset by taking the first `n` rows. The difference between this function * and `head` is that `head` is an action and returns an array (by triggering query execution) * while `limit` returns a new Dataset. * * é€šè¿‡ä½¿ç”¨ç¬¬ä¸€ä¸ªâ€œnâ€è¡Œè¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ã€‚ * è¿™ä¸ªå‡½æ•°å’Œâ€œheadâ€çš„åŒºåˆ«åœ¨äºâ€œheadâ€æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼Œ * å¹¶è¿”å›ä¸€ä¸ªæ•°ç»„(é€šè¿‡è§¦å‘æŸ¥è¯¢æ‰§è¡Œ)ï¼Œè€Œâ€œlimitâ€åˆ™è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ã€‚ * * @group typedrel * @since 2.0.0 */def limit(n: Int): Dataset[T] = withTypedPlan &#123; Limit(Literal(n), logicalPlan)&#125; unionAll-å·²è¿‡æ—¶1234567891011121314151617/** * Returns a new Dataset containing union of rows in this Dataset and another Dataset. * This is equivalent to `UNION ALL` in SQL. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«è¯¥æ•°æ®é›†ä¸­çš„è¡Œå’Œå¦ä¸€ä¸ªæ•°æ®é›†ã€‚ * è¿™ç›¸å½“äºSQLä¸­çš„â€œUNION ALLâ€ã€‚ * * To do a SQL-style set union (that does deduplication of elements), use this function followed * by a [[distinct]]. * * å¦‚æœéœ€è¦å»é‡çš„è¯ï¼Œåœ¨è¯¥æ–¹æ³•åç»§ç»­ç›´æ¥ [[distinct]] * * @group typedrel * @since 2.0.0 å·²ç»è¿‡æ—¶ */@deprecated(\"use union()\", \"2.0.0\")def unionAll(other: Dataset[T]): Dataset[T] = union(other) union123456789101112131415161718192021/** * Returns a new Dataset containing union of rows in this Dataset and another Dataset. * This is equivalent to `UNION ALL` in SQL. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«è¯¥æ•°æ®é›†ä¸­çš„è¡Œå’Œå¦ä¸€ä¸ªæ•°æ®é›†ã€‚ * è¿™ç›¸å½“äºSQLä¸­çš„â€œUNION ALLâ€ã€‚ * * To do a SQL-style set union (that does deduplication of elements), use this function followed * by a [[distinct]]. * * å¦‚æœéœ€è¦å»é‡çš„è¯ï¼Œåœ¨è¯¥æ–¹æ³•åç»§ç»­ç›´æ¥ [[distinct]] * * @group typedrel * @since 2.0.0 */def union(other: Dataset[T]): Dataset[T] = withSetOperator &#123; // This breaks caching, but it's usually ok because it addresses a very specific use case: // using union to union many files or partitions. // è¿™æ‰“ç ´äº†ç¼“å­˜ï¼Œä½†é€šå¸¸æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºå®ƒè§£å†³äº†ä¸€ä¸ªéå¸¸å…·ä½“çš„ç”¨ä¾‹:ä½¿ç”¨unionæ¥è”åˆè®¸å¤šæ–‡ä»¶æˆ–åˆ†åŒºã€‚ CombineUnions(Union(logicalPlan, other.logicalPlan))&#125; intersect-äº¤é›†123456789101112131415161718/** * Returns a new Dataset containing rows only in both this Dataset and another Dataset. * This is equivalent to `INTERSECT` in SQL. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼ŒåªåŒ…å«è¯¥æ•°æ®é›†å’Œå¦ä¸€ä¸ªæ•°æ®é›†ç›¸åŒçš„è¡Œ. * è¿™ç›¸å½“äºåœ¨SQLä¸­â€œINTERSECTâ€ã€‚ * ä¼šå»é‡. * * @note Equality checking is performed directly on the encoded representation of the data * and thus is not affected by a custom `equals` function defined on `T`. * * ç­‰å¼æ£€æŸ¥ç›´æ¥æ‰§è¡Œæ•°æ®çš„ç¼–ç è¡¨ç¤ºï¼Œå› æ­¤ä¸å—å®šä¹‰ä¸ºâ€œTâ€çš„è‡ªå®šä¹‰â€œequalsâ€å‡½æ•°çš„å½±å“ã€‚ * @group typedrel * @since 1.6.0 */def intersect(other: Dataset[T]): Dataset[T] = withSetOperator &#123; Intersect(logicalPlan, other.logicalPlan)&#125; except-åªæ˜¾ç¤ºå¦ä¸ªDatasetä¸­æ²¡æœ‰çš„å€¼12345678910111213141516/** * Returns a new Dataset containing rows in this Dataset but not in another Dataset. * This is equivalent to `EXCEPT` in SQL. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«è¯¥æ•°æ®é›†ä¸­çš„è¡Œï¼Œè€Œä¸æ˜¯åœ¨å¦ä¸€ä¸ªæ•°æ®é›†ã€‚ * è¿™ç­‰ä»·äºSQLä¸­çš„â€œEXCEPTâ€ã€‚ * ä¼šå»é‡. * * @note Equality checking is performed directly on the encoded representation of the data * and thus is not affected by a custom `equals` function defined on `T`. * @group typedrel * @since 2.0.0 */def except(other: Dataset[T]): Dataset[T] = withSetOperator &#123; Except(logicalPlan, other.logicalPlan)&#125; sample-éšæœºæŠ½æ ·1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * Returns a new [[Dataset]] by sampling a fraction of rows, using a user-supplied seed. * * é€šè¿‡ä½¿ç”¨ç”¨æˆ·æä¾›çš„ç§å­ï¼Œé€šè¿‡æŠ½æ ·çš„æ–¹å¼è¿”å›ä¸€ä¸ªæ–°çš„[[Dataset]]ã€‚ * * @param withReplacement Sample with replacement or not. * æ ·æœ¬å·²ç»å–è¿‡çš„å€¼æ˜¯å¦æ”¾å› * @param fraction Fraction of rows to generate. * æ¯ä¸€è¡Œæ•°æ®è¢«å–æ ·çš„æ¦‚ç‡ * @param seed Seed for sampling. * å–æ ·ç§å­ï¼ˆä¸éšæœºæ•°ç”Ÿæˆæœ‰å…³ï¼‰ * @note This is NOT guaranteed to provide exactly the fraction of the count * of the given [[Dataset]]. * ä¸èƒ½ä¿è¯å‡†ç¡®çš„æŒ‰ç…§ç»™å®šçš„åˆ†æ•°å–æ ·ã€‚ï¼ˆä¸€èˆ¬ç»“æœä¼šåœ¨æ¦‚ç‡å€¼*æ€»æ•°å·¦å³ï¼‰ * @group typedrel * @since 1.6.0 */def sample(withReplacement: Boolean, fraction: Double, seed: Long): Dataset[T] = &#123; require(fraction &gt;= 0, s\"Fraction must be nonnegative, but got $&#123;fraction&#125;\") withTypedPlan &#123; Sample(0.0, fraction, withReplacement, seed, logicalPlan)() &#125;&#125;/** * Returns a new [[Dataset]] by sampling a fraction of rows, using a random seed. * * é€šè¿‡ç¨‹åºéšæœºçš„ç§å­ï¼ŒæŠ½æ ·è¿”å›æ–°çš„DataSet * * @param withReplacement Sample with replacement or not. * å–æ ·ç»“æœæ˜¯å¦æ”¾å› * @param fraction Fraction of rows to generate. * æ¯è¡Œæ•°æ®è¢«å–æ ·çš„æ¦‚ç‡ * @note This is NOT guaranteed to provide exactly the fraction of the total count * of the given [[Dataset]]. * ä¸èƒ½ä¿è¯å‡†ç¡®çš„æŒ‰ç…§ç»™å®šçš„åˆ†æ•°å–æ ·ã€‚ï¼ˆä¸€èˆ¬ç»“æœä¼šåœ¨æ¦‚ç‡å€¼*æ€»æ•°å·¦å³ï¼‰ * @group typedrel * @since 1.6.0 */def sample(withReplacement: Boolean, fraction: Double): Dataset[T] = &#123; sample(withReplacement, fraction, Utils.random.nextLong)&#125; randomSplit-æŒ‰ç…§æƒé‡åˆ†å‰²1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** * Randomly splits this Dataset with the provided weights. * * éšæœºå°†æ­¤æ•°æ®é›†æŒ‰ç…§æ‰€æä¾›çš„æƒé‡è¿›è¡Œåˆ†å‰²ã€‚ * * @param weights weights for splits, will be normalized if they don't sum to 1. * åˆ‡åˆ†çš„æƒé‡ã€‚å¦‚æœå’Œä¸ä¸º1å°±ä¼šè¢«æ ‡å‡†åŒ–ã€‚ * @param seed Seed for sampling. * å–æ ·çš„ç§å­ï¼ˆå½±å“éšæœºæ•°ç”Ÿæˆå™¨ï¼‰ * * For Java API, use [[randomSplitAsList]]. * Java API ä½¿ç”¨ [[randomSplitAsList]]. * @group typedrel * @since 2.0.0 */ def randomSplit(weights: Array[Double], seed: Long): Array[Dataset[T]] = &#123; require(weights.forall(_ &gt;= 0), s\"Weights must be nonnegative, but got $&#123;weights.mkString(\"[\", \",\", \"]\")&#125;\") require(weights.sum &gt; 0, s\"Sum of weights must be positive, but got $&#123;weights.mkString(\"[\", \",\", \"]\")&#125;\") // It is possible that the underlying dataframe doesn't guarantee the ordering of rows in its // constituent partitions each time a split is materialized which could result in // overlapping splits. To prevent this, we explicitly sort each input partition to make the // ordering deterministic. // MapType cannot be sorted. val sorted = Sort(logicalPlan.output.filterNot(_.dataType.isInstanceOf[MapType]) .map(SortOrder(_, Ascending)), global = false, logicalPlan) val sum = weights.sum // scanLeft ä»å³åˆ°å³ä¾æ¬¡ç´¯è®¡ç®— scanLeft(0.0d)(_+_): (0.0,(0.0+0.2),(0.0+0.2+0.8)) val normalizedCumWeights = weights.map(_ / sum).scanLeft(0.0d)(_ + _) // sliding(n) æ¯æ¬¡å–nä¸ªå€¼ï¼Œä»¥æ­¥é•¿ä¸º1å‘å³æ»‘åŠ¨ï¼Œå¦‚ï¼š(0.0,0.2,0.8).sliding(2)=(0.0,0.2),(0.2,0.8) normalizedCumWeights.sliding(2).map &#123; x =&gt; new Dataset[T]( sparkSession, Sample(x(0), x(1), withReplacement = false, seed, sorted)(), encoder) &#125;.toArray &#125; /** * Randomly splits this Dataset with the provided weights. * * ç¨‹åºè‡ªåŠ¨ç”Ÿæˆéšæœºæ•°ç§å­ï¼Œéšæœºå°†æ­¤æ•°æ®é›†æŒ‰ç…§æ‰€æä¾›çš„æƒé‡è¿›è¡Œåˆ†å‰²ã€‚ * * @param weights weights for splits, will be normalized if they don't sum to 1. * åˆ‡åˆ†çš„æƒé‡ã€‚å¦‚æœå’Œä¸ä¸º1å°±ä¼šè¢«æ ‡å‡†åŒ–ã€‚ * @group typedrel * @since 2.0.0 */ def randomSplit(weights: Array[Double]): Array[Dataset[T]] = &#123; randomSplit(weights, Utils.random.nextLong) &#125; /** * Randomly splits this Dataset with the provided weights. Provided for the Python Api. * Python ä½¿ç”¨è¯¥æ–¹æ³• * * @param weights weights for splits, will be normalized if they don't sum to 1. * @param seed Seed for sampling. */ private[spark] def randomSplit(weights: List[Double], seed: Long): Array[Dataset[T]] = &#123; randomSplit(weights.toArray, seed) &#125; randomSplitAsList12345678910111213141516/** * Returns a Java list that contains randomly split Dataset with the provided weights. * * æ ¹æ®æä¾›çš„æƒé‡åˆ†å‰²DataFramesï¼Œè¿”å›Java list * * @param weights weights for splits, will be normalized if they don't sum to 1. * åˆ‡åˆ†çš„æƒé‡ã€‚å¦‚æœå’Œä¸ä¸º1å°±ä¼šè¢«æ ‡å‡†åŒ–ã€‚ * @param seed Seed for sampling. * å–æ ·çš„ç§å­ï¼ˆå½±å“éšæœºæ•°ç”Ÿæˆå™¨ï¼‰ * @group typedrel * @since 2.0.0 */def randomSplitAsList(weights: Array[Double], seed: Long): java.util.List[Dataset[T]] = &#123; val values = randomSplit(weights, seed) java.util.Arrays.asList(values: _*)&#125; dropDuplicates-å»é‡123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475/** * Returns a new Dataset that contains only the unique rows from this Dataset. * This is an alias for `distinct`. * * åˆ é™¤é‡å¤çš„rowæ•°æ®ï¼Œæ˜¯distinctçš„åˆ«å * * @group typedrel * @since 2.0.0 */def dropDuplicates(): Dataset[T] = dropDuplicates(this.columns)/** * (Scala-specific) Returns a new Dataset with duplicate rows removed, considering only * the subset of columns. * * åªåˆ é™¤æŒ‡å®šåˆ—çš„é‡å¤æ•°æ® * * @group typedrel * @since 2.0.0 */def dropDuplicates(colNames: Seq[String]): Dataset[T] = withTypedPlan &#123; val resolver = sparkSession.sessionState.analyzer.resolver val allColumns = queryExecution.analyzed.output val groupCols = colNames.flatMap &#123; colName =&gt; // It is possibly there are more than one columns with the same name, // so we call filter instead of find. val cols = allColumns.filter(col =&gt; resolver(col.name, colName)) if (cols.isEmpty) &#123; throw new AnalysisException( s\"\"\"Cannot resolve column name \"$colName\" among ($&#123;schema.fieldNames.mkString(\", \")&#125;)\"\"\") &#125; cols &#125; val groupColExprIds = groupCols.map(_.exprId) val aggCols = logicalPlan.output.map &#123; attr =&gt; if (groupColExprIds.contains(attr.exprId)) &#123; attr &#125; else &#123; // Removing duplicate rows should not change output attributes. We should keep // the original exprId of the attribute. Otherwise, to select a column in original // dataset will cause analysis exception due to unresolved attribute. // åˆ é™¤é‡å¤è¡Œä¸åº”è¯¥æ›´æ”¹è¾“å‡ºå±æ€§ã€‚ // æˆ‘ä»¬åº”è¯¥ä¿ç•™è¿™ä¸ªå±æ€§çš„åŸå§‹å±æ€§ã€‚ // å¦åˆ™ï¼Œåœ¨åŸå§‹æ•°æ®é›†ä¸­é€‰æ‹©ä¸€ä¸ªåˆ—å°†å¯¼è‡´åˆ†æå¼‚å¸¸ï¼ŒåŸå› æ˜¯æœªè§£æçš„å±æ€§ã€‚ Alias(new First(attr).toAggregateExpression(), attr.name)(exprId = attr.exprId) &#125; &#125; Aggregate(groupCols, aggCols, logicalPlan)&#125;/** * Returns a new Dataset with duplicate rows removed, considering only * the subset of columns. * * åªé’ˆå¯¹ç‰¹å®šåˆ—åšå»é‡ * * @group typedrel * @since 2.0.0 */def dropDuplicates(colNames: Array[String]): Dataset[T] = dropDuplicates(colNames.toSeq)/** * Returns a new [[Dataset]] with duplicate rows removed, considering only * the subset of columns. * * åªé’ˆå¯¹ç‰¹å®šå¤šåˆ—åšå»é‡ * * @group typedrel * @since 2.0.0 */@scala.annotation.varargsdef dropDuplicates(col1: String, cols: String*): Dataset[T] = &#123; val colNames: Seq[String] = col1 +: cols dropDuplicates(colNames)&#125; transform-è‡ªå®šä¹‰è½¬æ¢1234567891011121314151617/** * Concise syntax for chaining custom transformations. * * ç”¨äºé“¾æ¥è‡ªå®šä¹‰è½¬æ¢çš„ç®€æ˜è¯­æ³•ã€‚ * * &#123;&#123;&#123; * def featurize(ds: Dataset[T]): Dataset[U] = ... * * ds * .transform(featurize) * .transform(...) * &#125;&#125;&#125; * * @group typedrel * @since 1.6.0 */def transform[U](t: Dataset[T] =&gt; Dataset[U]): Dataset[U] = t(this) filter-è¿‡æ»¤12345678910111213141516171819202122232425262728293031/** * :: Experimental :: * (Scala-specific) * Returns a new Dataset that only contains elements where `func` returns `true`. * * è¯¥æ•°æ®é›†åªåŒ…å«â€œfuncâ€è¿”å›â€œtrueâ€çš„å…ƒç´ ã€‚ * * @group typedrel * @since 1.6.0 */ @Experimental @InterfaceStability.Evolving def filter(func: T =&gt; Boolean): Dataset[T] = &#123; withTypedPlan(TypedFilter(func, logicalPlan)) &#125; /** * :: Experimental :: * (Java-specific) * Returns a new Dataset that only contains elements where `func` returns `true`. * * è¿”å›ä¸€ä¸ªæ–°æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åªåŒ…å«â€œfuncâ€è¿”å›â€œtrueâ€çš„å…ƒç´ ã€‚ * * @group typedrel * @since 1.6.0 */ @Experimental @InterfaceStability.Evolving def filter(func: FilterFunction[T]): Dataset[T] = &#123; withTypedPlan(TypedFilter(func, logicalPlan)) &#125; map1234567891011121314151617181920212223242526272829303132/** * :: Experimental :: * (Scala-specific) * Returns a new Dataset that contains the result of applying `func` to each element. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«å¯¹æ¯ä¸ªå…ƒç´ åº”ç”¨â€œfuncâ€çš„ç»“æœã€‚ * * @group typedrel * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef map[U: Encoder](func: T =&gt; U): Dataset[U] = withTypedPlan &#123; MapElements[T, U](func, logicalPlan)&#125;/** * :: Experimental :: * (Java-specific) * Returns a new Dataset that contains the result of applying `func` to each element. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«å¯¹æ¯ä¸ªå…ƒç´ åº”ç”¨â€œfuncâ€çš„ç»“æœã€‚ * * @group typedrel * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef map[U](func: MapFunction[T, U], encoder: Encoder[U]): Dataset[U] = &#123; implicit val uEnc = encoder withTypedPlan(MapElements[T, U](func, logicalPlan))&#125; mapPartitions1234567891011121314151617181920212223242526272829303132333435/** * :: Experimental :: * (Scala-specific) * Returns a new Dataset that contains the result of applying `func` to each partition. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«å¯¹æ¯ä¸ªåˆ†åŒºåº”ç”¨â€œfuncâ€çš„ç»“æœã€‚ * * @group typedrel * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef mapPartitions[U: Encoder](func: Iterator[T] =&gt; Iterator[U]): Dataset[U] = &#123; new Dataset[U]( sparkSession, MapPartitions[T, U](func, logicalPlan), implicitly[Encoder[U]])&#125;/** * :: Experimental :: * (Java-specific) * Returns a new Dataset that contains the result of applying `f` to each partition. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†åŒ…å«å¯¹æ¯ä¸ªåˆ†åŒºåº”ç”¨â€œfâ€çš„ç»“æœã€‚ * * @group typedrel * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef mapPartitions[U](f: MapPartitionsFunction[T, U], encoder: Encoder[U]): Dataset[U] = &#123; val func: (Iterator[T]) =&gt; Iterator[U] = x =&gt; f.call(x.asJava).asScala mapPartitions(func)(encoder)&#125; flatMap-å°†mapç»“æœflatæ‰å¹³åŒ–123456789101112131415161718192021222324252627282930313233/** * :: Experimental :: * (Scala-specific) * Returns a new Dataset by first applying a function to all elements of this Dataset, * and then flattening the results. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œé¦–å…ˆå¯¹è¯¥æ•°æ®é›†çš„æ‰€æœ‰å…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå°†ç»“æœæ‰å¹³åŒ–ã€‚ * * @group typedrel * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef flatMap[U: Encoder](func: T =&gt; TraversableOnce[U]): Dataset[U] = mapPartitions(_.flatMap(func))/** * :: Experimental :: * (Java-specific) * Returns a new Dataset by first applying a function to all elements of this Dataset, * and then flattening the results. * * è¿”å›ä¸€ä¸ªæ–°çš„æ•°æ®é›†ï¼Œé¦–å…ˆå¯¹è¯¥æ•°æ®é›†çš„æ‰€æœ‰å…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå°†ç»“æœæ‰å¹³åŒ–ã€‚ * * @group typedrel * @since 1.6.0 */@Experimental@InterfaceStability.Evolvingdef flatMap[U](f: FlatMapFunction[T, U], encoder: Encoder[U]): Dataset[U] = &#123; val func: (T) =&gt; Iterator[U] = x =&gt; f.call(x).asScala flatMap(func)(encoder)&#125; repartition-é‡åˆ†åŒº123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * Returns a new Dataset that has exactly `numPartitions` partitions. * * è¿”å›ä¸€ä¸ª ç»™å®šåˆ†åŒºæ•°é‡çš„æ–°DataSet * * @group typedrel * @since 1.6.0 */ def repartition(numPartitions: Int): Dataset[T] = withTypedPlan &#123; Repartition(numPartitions, shuffle = true, logicalPlan) &#125; /** * Returns a new Dataset partitioned by the given partitioning expressions into * `numPartitions`. The resulting Dataset is hash partitioned. * * è¿”å›ä¸€ä¸ªç”±ç»™å®šçš„åˆ†åŒºè¡¨è¾¾å¼åˆ’åˆ†ä¸ºâ€œnumåˆ†åŒºâ€çš„æ–°æ•°æ®é›†ã€‚ * ç”Ÿæˆçš„Datasetæ˜¯å“ˆå¸Œåˆ†åŒºçš„ã€‚ * * This is the same operation as \"DISTRIBUTE BY\" in SQL (Hive QL). * * å’Œ SQL (Hive QL) ä¸­çš„ \"DISTRIBUTE BY\" ä½œç”¨ç›¸åŒ * * @group typedrel * @since 2.0.0 */ @scala.annotation.varargs def repartition(numPartitions: Int, partitionExprs: Column*): Dataset[T] = withTypedPlan &#123; RepartitionByExpression(partitionExprs.map(_.expr), logicalPlan, Some(numPartitions)) &#125; /** * Returns a new Dataset partitioned by the given partitioning expressions, using * `spark.sql.shuffle.partitions` as number of partitions. * The resulting Dataset is hash partitioned. * * æ ¹æ®æŒ‡å®šçš„åˆ†åŒºè¡¨è¾¾å¼è¿›è¡Œé‡åˆ†åŒºã€‚ * åˆ†åŒºæ•°é‡ç”±`spark.sql.shuffle.partitions` è·å¾—ã€‚ * ç»“æœDataset æ˜¯å“ˆå¸Œåˆ†åŒºçš„ã€‚ * * This is the same operation as \"DISTRIBUTE BY\" in SQL (Hive QL). * * å’Œ SQL (Hive QL) ä¸­çš„ \"DISTRIBUTE BY\" ä½œç”¨ç›¸åŒ * * @group typedrel * @since 2.0.0 */ @scala.annotation.varargs def repartition(partitionExprs: Column*): Dataset[T] = withTypedPlan &#123; RepartitionByExpression(partitionExprs.map(_.expr), logicalPlan, numPartitions = None) &#125; coalesce-åˆå¹¶åˆ†åŒº1234567891011121314151617/** * Returns a new Dataset that has exactly `numPartitions` partitions. * Similar to coalesce defined on an `RDD`, this operation results in a narrow dependency, e.g. * if you go from 1000 partitions to 100 partitions, there will not be a shuffle, instead each of * the 100 new partitions will claim 10 of the current partitions. * * åˆå¹¶ã€‚ * è¿”å›ç¡®å®šåˆ†åŒºæ•°é‡çš„Datasetã€‚ * å’ŒRDDä¸­çš„åˆå¹¶æ–¹æ³•ç±»ä¼¼ï¼Œè¿™ä¸ªæ“ä½œå¯¼è‡´äº†ä¸€ä¸ªçª„ä¾èµ–ã€‚ * ä¾‹å¦‚ï¼šå°†1000ä¸ªåˆ†åŒºåˆå¹¶ä¸º100ä¸ªåˆ†åŒºï¼Œè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰shuffleï¼Œè€Œæ˜¯100ä¸ªæ–°åˆ†åŒºä¸­çš„æ¯ä¸ªåˆ†åŒºå°†å£°æ˜å½“å‰çš„10ä¸ªåˆ†åŒºã€‚ * * @group typedrel * @since 1.6.0 */ def coalesce(numPartitions: Int): Dataset[T] = withTypedPlan &#123; Repartition(numPartitions, shuffle = false, logicalPlan) &#125; distinct-å»é‡1234567891011121314/** * Returns a new Dataset that contains only the unique rows from this Dataset. * This is an alias for `dropDuplicates`. * * å»é‡ã€‚ * è¿”å›å»é‡åçš„Datasetã€‚ * å’Œ `dropDuplicates` æ–¹æ³•ä¸€è‡´ã€‚ * * @note Equality checking is performed directly on the encoded representation of the data * and thus is not affected by a custom `equals` function defined on `T`. * @group typedrel * @since 2.0.0 */ def distinct(): Dataset[T] = dropDuplicates()","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"},{"name":"æºç ","slug":"æºç ","permalink":"https://stanxia.github.io/tags/æºç /"}]},{"title":"JavaRDDLike.scala","slug":"JavaRDDLike-scala","date":"2017-11-21T14:21:23.000Z","updated":"2020-02-12T09:15:00.081Z","comments":true,"path":"2017/11/21/JavaRDDLike-scala/","link":"","permalink":"https://stanxia.github.io/2017/11/21/JavaRDDLike-scala/","excerpt":"ä½¿ç”¨Javaå¼€å‘Sparkç¨‹åºï¼ŒJavaRDDçš„åŠŸèƒ½ç®—å­ä¸­è‹±æ–‡æ³¨é‡ŠJavaRDDLikeçš„å®ç°åº”è¯¥æ‰©å±•è¿™ä¸ªè™šæ‹ŸæŠ½è±¡ç±»ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»§æ‰¿è¿™ä¸ªç‰¹æ€§ã€‚\n\nJavaRDD1234567891011121314151617181920package org.apache.spark.api.javaprivate[spark] abstract class AbstractJavaRDDLike[T, This &lt;: JavaRDDLike[T, This]]  extends JavaRDDLike[T, This]/**  * Defines operations common to several Java RDD implementations.  *  * å®šä¹‰å‡ ä¸ªJava RDDå®ç°çš„å¸¸è§æ“ä½œã€‚  *  * @note This trait is not intended to be implemented by user code.  *  *       è¯¥ç‰¹æ€§ä¸æ‰“ç®—ç”±ç”¨æˆ·ä»£ç å®ç°ã€‚  */trait JavaRDDLike[T, This &lt;: JavaRDDLike[T, This]] extends Serializable &#123;  def wrapRDD(rdd: RDD[T]): This  implicit val classTag: ClassTag[T]  def rdd: RDD[T]","text":"ä½¿ç”¨Javaå¼€å‘Sparkç¨‹åºï¼ŒJavaRDDçš„åŠŸèƒ½ç®—å­ä¸­è‹±æ–‡æ³¨é‡ŠJavaRDDLikeçš„å®ç°åº”è¯¥æ‰©å±•è¿™ä¸ªè™šæ‹ŸæŠ½è±¡ç±»ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»§æ‰¿è¿™ä¸ªç‰¹æ€§ã€‚ JavaRDD1234567891011121314151617181920package org.apache.spark.api.javaprivate[spark] abstract class AbstractJavaRDDLike[T, This &lt;: JavaRDDLike[T, This]] extends JavaRDDLike[T, This]/** * Defines operations common to several Java RDD implementations. * * å®šä¹‰å‡ ä¸ªJava RDDå®ç°çš„å¸¸è§æ“ä½œã€‚ * * @note This trait is not intended to be implemented by user code. * * è¯¥ç‰¹æ€§ä¸æ‰“ç®—ç”±ç”¨æˆ·ä»£ç å®ç°ã€‚ */trait JavaRDDLike[T, This &lt;: JavaRDDLike[T, This]] extends Serializable &#123; def wrapRDD(rdd: RDD[T]): This implicit val classTag: ClassTag[T] def rdd: RDD[T] partitions1234/** Set of partitions in this RDD. * åœ¨è¿™ä¸ªRDDä¸­è®¾ç½®çš„åˆ†åŒºã€‚ * */def partitions: JList[Partition] = rdd.partitions.toSeq.asJava getNumPartitions12345/** Return the number of partitions in this RDD. * è¿”å›è¯¥RDDä¸­çš„åˆ†åŒºæ•°ã€‚ * */@Since(\"1.6.0\")def getNumPartitions: Int = rdd.getNumPartitions partitioner1234/** The partitioner of this RDD. * è¿™ä¸ªRDDçš„åˆ†åŒºã€‚ * */def partitioner: Optional[Partitioner] = JavaUtils.optionToOptional(rdd.partitioner) context12345/** The [[org.apache.spark.SparkContext]] that this RDD was created on. * * è¿™ä¸ªRDDæ˜¯åœ¨[[org.apache.spark.SparkContext]]ä¸Šé¢åˆ›å»ºçš„ã€‚ * */def context: SparkContext = rdd.context id1234/** A unique ID for this RDD (within its SparkContext). * è¿™ä¸ªRDDçš„æƒŸä¸€ID(åœ¨å®ƒçš„SparkContextå†…)ã€‚ * */def id: Int = rdd.id name1def name(): String = rdd.name getStorageLevel1234/** Get the RDD's current storage level, or StorageLevel.NONE if none is set. * è·å–RDDçš„å½“å‰å­˜å‚¨çº§åˆ«ï¼Œæˆ–StorageLevelã€‚å¦‚æœæ²¡æœ‰è®¾ç½®å°±æ²¡æœ‰ã€‚ * */def getStorageLevel: StorageLevel = rdd.getStorageLevel iterator12345678910/** * Internal method to this RDD; will read from cache if applicable, or otherwise compute it. * This should ''not'' be called by users directly, but is available for implementors of custom * subclasses of RDD. * å†…éƒ¨æ–¹æ³•çš„RDD;å°†ä»ç¼“å­˜è¯»å–ï¼Œå¦‚æœé€‚ç”¨çš„è¯ï¼Œæˆ–è€…è®¡ç®—å®ƒã€‚ * è¿™åº”è¯¥â€œä¸æ˜¯â€ç›´æ¥ç”±ç”¨æˆ·è°ƒç”¨ï¼Œè€Œæ˜¯ç”¨äºRDDçš„è‡ªå®šä¹‰å­ç±»çš„å®ç°è€… * */def iterator(split: Partition, taskContext: TaskContext): JIterator[T] = rdd.iterator(split, taskContext).asJavs Transformations (return a new RDD)map1234567/** * Return a new RDD by applying a function to all elements of this RDD. * å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ‰€æœ‰å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ * */def map[R](f: JFunction[T, R]): JavaRDD[R] = new JavaRDD(rdd.map(f)(fakeClassTag))(fakeClassTag) mapPartitionsWithIndex1234567891011/** * Return a new RDD by applying a function to each partition of this RDD, while tracking the index * of the original partition. * é€šè¿‡åœ¨RDDçš„æ¯ä¸ªåˆ†åŒºä¸Šåº”ç”¨ä¸€ä¸ªå‡½æ•°æ¥è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼ŒåŒæ—¶è·Ÿè¸ªåŸå§‹åˆ†åŒºçš„ç´¢å¼•ã€‚ * */def mapPartitionsWithIndex[R]( f: JFunction2[jl.Integer, JIterator[T], JIterator[R]], preservesPartitioning: Boolean = false): JavaRDD[R] = new JavaRDD(rdd.mapPartitionsWithIndex((a, b) =&gt; f.call(a, b.asJava).asScala, preservesPartitioning)(fakeClassTag))(fakeClassTag) mapToDouble1234567/** * Return a new RDD by applying a function to all elements of this RDD. * å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ‰€æœ‰å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ */def mapToDouble[R](f: DoubleFunction[T]): JavaDoubleRDD = &#123; new JavaDoubleRDD(rdd.map(f.call(_).doubleValue()))&#125; mapToPair123456789/** * Return a new RDD by applying a function to all elements of this RDD. * å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ‰€æœ‰å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ * */def mapToPair[K2, V2](f: PairFunction[T, K2, V2]): JavaPairRDD[K2, V2] = &#123; def cm: ClassTag[(K2, V2)] = implicitly[ClassTag[(K2, V2)]] new JavaPairRDD(rdd.map[(K2, V2)](f)(cm))(fakeClassTag[K2], fakeClassTag[V2])&#125; flatMap12345678910/** * Return a new RDD by first applying a function to all elements of this * RDD, and then flattening the results. * è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼Œé¦–å…ˆå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ‰€æœ‰å…ƒç´ ï¼Œç„¶åå°†ç»“æœæ‰å¹³åŒ–ã€‚ * */def flatMap[U](f: FlatMapFunction[T, U]): JavaRDD[U] = &#123; def fn: (T) =&gt; Iterator[U] = (x: T) =&gt; f.call(x).asScala JavaRDD.fromRDD(rdd.flatMap(fn)(fakeClassTag[U]))(fakeClassTag[U])&#125; flatMapToDouble12345678910/** * Return a new RDD by first applying a function to all elements of this * RDD, and then flattening the results. * è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼Œé¦–å…ˆå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ‰€æœ‰å…ƒç´ ï¼Œç„¶åå°†ç»“æœæ‰å¹³åŒ–ã€‚ * */def flatMapToDouble(f: DoubleFlatMapFunction[T]): JavaDoubleRDD = &#123; def fn: (T) =&gt; Iterator[jl.Double] = (x: T) =&gt; f.call(x).asScala new JavaDoubleRDD(rdd.flatMap(fn).map(_.doubleValue()))&#125; flatMapToPair1234567891011/** * Return a new RDD by first applying a function to all elements of this * RDD, and then flattening the results. * è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼Œé¦–å…ˆå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ‰€æœ‰å…ƒç´ ï¼Œç„¶åå°†ç»“æœæ‰å¹³åŒ–ã€‚ * */def flatMapToPair[K2, V2](f: PairFlatMapFunction[T, K2, V2]): JavaPairRDD[K2, V2] = &#123; def fn: (T) =&gt; Iterator[(K2, V2)] = (x: T) =&gt; f.call(x).asScala def cm: ClassTag[(K2, V2)] = implicitly[ClassTag[(K2, V2)]] JavaPairRDD.fromRDD(rdd.flatMap(fn)(cm))(fakeClassTag[K2], fakeClassTag[V2])&#125; mapPartitions12345678910111213141516171819202122232425/** * Return a new RDD by applying a function to each partition of this RDD. * é€šè¿‡å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ¯ä¸ªåˆ†åŒºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ * */def mapPartitions[U](f: FlatMapFunction[JIterator[T], U]): JavaRDD[U] = &#123; def fn: (Iterator[T]) =&gt; Iterator[U] = &#123; (x: Iterator[T]) =&gt; f.call(x.asJava).asScala &#125; JavaRDD.fromRDD(rdd.mapPartitions(fn)(fakeClassTag[U]))(fakeClassTag[U])&#125;/** * Return a new RDD by applying a function to each partition of this RDD. * é€šè¿‡å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ¯ä¸ªåˆ†åŒºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ * */def mapPartitions[U](f: FlatMapFunction[JIterator[T], U], preservesPartitioning: Boolean): JavaRDD[U] = &#123; def fn: (Iterator[T]) =&gt; Iterator[U] = &#123; (x: Iterator[T]) =&gt; f.call(x.asJava).asScala &#125; JavaRDD.fromRDD( rdd.mapPartitions(fn, preservesPartitioning)(fakeClassTag[U]))(fakeClassTag[U])&#125; mapPartitionsToDouble12345678910111213141516171819202122232425/** * Return a new RDD by applying a function to each partition of this RDD. * é€šè¿‡å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ¯ä¸ªåˆ†åŒºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ * */def mapPartitionsToDouble(f: DoubleFlatMapFunction[JIterator[T]]): JavaDoubleRDD = &#123; def fn: (Iterator[T]) =&gt; Iterator[jl.Double] = &#123; (x: Iterator[T]) =&gt; f.call(x.asJava).asScala &#125; new JavaDoubleRDD(rdd.mapPartitions(fn).map(_.doubleValue()))&#125;/** * Return a new RDD by applying a function to each partition of this RDD. * é€šè¿‡å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ¯ä¸ªåˆ†åŒºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ * */def mapPartitionsToDouble(f: DoubleFlatMapFunction[JIterator[T]], preservesPartitioning: Boolean): JavaDoubleRDD = &#123; def fn: (Iterator[T]) =&gt; Iterator[jl.Double] = &#123; (x: Iterator[T]) =&gt; f.call(x.asJava).asScala &#125; new JavaDoubleRDD(rdd.mapPartitions(fn, preservesPartitioning) .map(_.doubleValue()))&#125; mapPartitionsToPair1234567891011121314151617181920212223242526/** * Return a new RDD by applying a function to each partition of this RDD. * é€šè¿‡å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ¯ä¸ªåˆ†åŒºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ * */def mapPartitionsToPair[K2, V2](f: PairFlatMapFunction[JIterator[T], K2, V2]):JavaPairRDD[K2, V2] = &#123; def fn: (Iterator[T]) =&gt; Iterator[(K2, V2)] = &#123; (x: Iterator[T]) =&gt; f.call(x.asJava).asScala &#125; JavaPairRDD.fromRDD(rdd.mapPartitions(fn))(fakeClassTag[K2], fakeClassTag[V2])&#125;/** * Return a new RDD by applying a function to each partition of this RDD. * é€šè¿‡å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºè¿™ä¸ªRDDçš„æ¯ä¸ªåˆ†åŒºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚ * */def mapPartitionsToPair[K2, V2](f: PairFlatMapFunction[JIterator[T], K2, V2], preservesPartitioning: Boolean): JavaPairRDD[K2, V2] = &#123; def fn: (Iterator[T]) =&gt; Iterator[(K2, V2)] = &#123; (x: Iterator[T]) =&gt; f.call(x.asJava).asScala &#125; JavaPairRDD.fromRDD( rdd.mapPartitions(fn, preservesPartitioning))(fakeClassTag[K2], fakeClassTag[V2])&#125; foreachPartition12345678/** * Applies a function f to each partition of this RDD. * å°†å‡½æ•°fåº”ç”¨äºè¯¥RDDçš„æ¯ä¸ªåˆ†åŒºã€‚ * */def foreachPartition(f: VoidFunction[JIterator[T]]): Unit = &#123; rdd.foreachPartition(x =&gt; f.call(x.asJava))&#125; glom1234567/** * Return an RDD created by coalescing all elements within each partition into an array. * è¿”å›ä¸€ä¸ªRDDï¼Œå®ƒå°†æ¯ä¸ªåˆ†åŒºä¸­çš„æ‰€æœ‰å…ƒç´ åˆå¹¶åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ * */def glom(): JavaRDD[JList[T]] = new JavaRDD(rdd.glom().map(_.toSeq.asJava)) cartesian12345678/** * Return the Cartesian product of this RDD and another one, that is, the RDD of all pairs of * elements (a, b) where a is in `this` and b is in `other`. * è¿”å›è¿™ä¸ªRDDå’Œå¦ä¸€ä¸ªçš„ç¬›å¡å°”ä¹˜ç§¯ï¼Œå³æ‰€æœ‰å…ƒç´ å¯¹çš„RDD(a,b) ï¼šaåœ¨è¯¥RDDä¸­ï¼Œbåœ¨å¦ä¸€ä¸ªRDDä¸­ * */def cartesian[U](other: JavaRDDLike[U, _]): JavaPairRDD[T, U] = JavaPairRDD.fromRDD(rdd.cartesian(other.rdd)(other.classTag))(classTag, other.classTag) groupBy123456789101112131415161718192021222324252627/** * Return an RDD of grouped elements. Each group consists of a key and a sequence of elements * mapping to that key. * è¿”å›åˆ†ç»„å…ƒç´ çš„RDDã€‚ * æ¯ä¸ªç»„ç”±ä¸€ä¸ªé”®å’Œä¸€ä¸ªæ˜ å°„åˆ°è¯¥é”®çš„å…ƒç´ åºåˆ—ç»„æˆã€‚ * */def groupBy[U](f: JFunction[T, U]): JavaPairRDD[U, JIterable[T]] = &#123; // The type parameter is U instead of K in order to work around a compiler bug; see SPARK-4459 // ç±»å‹å‚æ•°æ˜¯Uè€Œä¸æ˜¯Kï¼Œæ˜¯ä¸ºäº†ç»•è¿‡ç¼–è¯‘å™¨é”™è¯¯ implicit val ctagK: ClassTag[U] = fakeClassTag implicit val ctagV: ClassTag[JList[T]] = fakeClassTag JavaPairRDD.fromRDD(groupByResultToJava(rdd.groupBy(f)(fakeClassTag)))&#125;/** * Return an RDD of grouped elements. Each group consists of a key and a sequence of elements * mapping to that key. * è¿”å›åˆ†ç»„å…ƒç´ çš„RDDã€‚ * æ¯ä¸ªç»„ç”±ä¸€ä¸ªé”®å’Œä¸€ä¸ªæ˜ å°„åˆ°è¯¥é”®çš„å…ƒç´ åºåˆ—ç»„æˆã€‚ */def groupBy[U](f: JFunction[T, U], numPartitions: Int): JavaPairRDD[U, JIterable[T]] = &#123; // The type parameter is U instead of K in order to work around a compiler bug; see SPARK-4459 implicit val ctagK: ClassTag[U] = fakeClassTag implicit val ctagV: ClassTag[JList[T]] = fakeClassTag JavaPairRDD.fromRDD(groupByResultToJava(rdd.groupBy(f, numPartitions)(fakeClassTag[U])))&#125; pipe123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051/** * Return an RDD created by piping elements to a forked external process. * è¿”å›ç”±ç®¡é“å…ƒç´ è°ƒç”¨å¤–éƒ¨ç¨‹åºè¿”å›æ–°çš„RDD * */def pipe(command: String): JavaRDD[String] = &#123; rdd.pipe(command)&#125;/** * Return an RDD created by piping elements to a forked external process. * è¿”å›ç”±ç®¡é“å…ƒç´ è°ƒç”¨å¤–éƒ¨ç¨‹åºè¿”å›æ–°çš„RDD * */def pipe(command: JList[String]): JavaRDD[String] = &#123; rdd.pipe(command.asScala)&#125;/** * Return an RDD created by piping elements to a forked external process. * è¿”å›ç”±ç®¡é“å…ƒç´ è°ƒç”¨å¤–éƒ¨ç¨‹åºè¿”å›æ–°çš„RDD * */def pipe(command: JList[String], env: JMap[String, String]): JavaRDD[String] = &#123; rdd.pipe(command.asScala, env.asScala)&#125;/** * Return an RDD created by piping elements to a forked external process. * è¿”å›ç”±ç®¡é“å…ƒç´ è°ƒç”¨å¤–éƒ¨ç¨‹åºè¿”å›æ–°çš„RDD * */def pipe(command: JList[String], env: JMap[String, String], separateWorkingDir: Boolean, bufferSize: Int): JavaRDD[String] = &#123; rdd.pipe(command.asScala, env.asScala, null, null, separateWorkingDir, bufferSize)&#125;/** * Return an RDD created by piping elements to a forked external process. * è¿”å›ç”±ç®¡é“å…ƒç´ è°ƒç”¨å¤–éƒ¨ç¨‹åºè¿”å›æ–°çš„RDD * */def pipe(command: JList[String], env: JMap[String, String], separateWorkingDir: Boolean, bufferSize: Int, encoding: String): JavaRDD[String] = &#123; rdd.pipe(command.asScala, env.asScala, null, null, separateWorkingDir, bufferSize, encoding)&#125; zip123456789101112/** * Zips this RDD with another one, returning key-value pairs with the first element in each RDD, * second element in each RDD, etc. Assumes that the two RDDs have the *same number of * partitions* and the *same number of elements in each partition* (e.g. one was made through * a map on the other). * å°†æ­¤RDDä¸å¦ä¸€ä¸ªRDDè¿›è¡ŒZipsï¼Œè¿”å›é”®å€¼å¯¹ï¼Œæ¯ä¸ªRDDä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªRDDä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œç­‰ç­‰ã€‚ * å‡è®¾ä¸¤ä¸ªRDDsæ‹¥æœ‰ç›¸åŒæ•°é‡çš„åˆ†åŒºå’Œæ¯ä¸ªåˆ†åŒºä¸­ç›¸åŒæ•°é‡çš„å…ƒç´  * (ä¾‹å¦‚ï¼Œä¸€ä¸ªæ˜¯é€šè¿‡å¦ä¸€ä¸ªmapçš„)ã€‚ */def zip[U](other: JavaRDDLike[U, _]): JavaPairRDD[T, U] = &#123; JavaPairRDD.fromRDD(rdd.zip(other.rdd)(other.classTag))(classTag, other.classTag)&#125; zipPartitions1234567891011121314151617/** * Zip this RDD's partitions with one (or more) RDD(s) and return a new RDD by * applying a function to the zipped partitions. Assumes that all the RDDs have the * *same number of partitions*, but does *not* require them to have the same number * of elements in each partition. * ç”¨ä¸€ä¸ª(æˆ–å¤šä¸ª)RDD(æˆ–å¤šä¸ª)æ¥å‹ç¼©è¿™ä¸ªRDDçš„åˆ†åŒºï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„RDDå°†å‡½æ•°åº”ç”¨äºå‹ç¼©åˆ†åŒºã€‚ * å‡è®¾æ‰€æœ‰RDDsæ‹¥æœ‰ç›¸åŒæ•°é‡çš„åˆ†åŒºï¼Œä½†ä¸è¦æ±‚å®ƒä»¬åœ¨æ¯ä¸ªåˆ†åŒºä¸­æ‹¥æœ‰ç›¸åŒæ•°é‡çš„å…ƒç´ ã€‚ */def zipPartitions[U, V]( other: JavaRDDLike[U, _], f: FlatMapFunction2[JIterator[T], JIterator[U], V]): JavaRDD[V] = &#123; def fn: (Iterator[T], Iterator[U]) =&gt; Iterator[V] = &#123; (x: Iterator[T], y: Iterator[U]) =&gt; f.call(x.asJava, y.asJava).asScala &#125; JavaRDD.fromRDD( rdd.zipPartitions(other.rdd)(fn)(other.classTag, fakeClassTag[V]))(fakeClassTag[V])&#125; zipWithUniqueId1234567891011/** * Zips this RDD with generated unique Long ids. Items in the kth partition will get ids k, n+k, * 2*n+k, ..., where n is the number of partitions. So there may exist gaps, but this method * won't trigger a spark job, which is different from [[org.apache.spark.rdd.RDD#zipWithIndex]]. * ç”¨ç”Ÿæˆçš„å”¯ä¸€é•¿çš„idæ¥å‹ç¼©è¿™ä¸ªRDDã€‚ * ç¬¬kä¸ªåˆ†åŒºçš„é¡¹å°†å¾—åˆ°id k,n + k,2 *n+ kï¼Œâ€¦ï¼Œå…¶ä¸­næ˜¯åˆ†åŒºæ•°ã€‚ * å› æ­¤ï¼Œå¯èƒ½å­˜åœ¨å·®è·ï¼Œä½†è¿™ç§æ–¹æ³•ä¸ä¼šè§¦å‘sparkä½œä¸šï¼Œå®ƒä¸[org .apache.spark. spark.rdd. rdd. rdd # zipWithIndex]ä¸åŒã€‚ */def zipWithUniqueId(): JavaPairRDD[T, jl.Long] = &#123; JavaPairRDD.fromRDD(rdd.zipWithUniqueId()).asInstanceOf[JavaPairRDD[T, jl.Long]]&#125; zipWithIndex12345678910111213141516/** * Zips this RDD with its element indices. The ordering is first based on the partition index * and then the ordering of items within each partition. So the first item in the first * partition gets index 0, and the last item in the last partition receives the largest index. * This is similar to Scala's zipWithIndex but it uses Long instead of Int as the index type. * This method needs to trigger a spark job when this RDD contains more than one partitions. * * ç”¨å®ƒçš„å…ƒç´ ç´¢å¼•æ¥å‹ç¼©è¿™ä¸ªRDDã€‚ * æ’åºé¦–å…ˆåŸºäºåˆ†åŒºç´¢å¼•ï¼Œç„¶åæ˜¯æ¯ä¸ªåˆ†åŒºä¸­çš„æ¡ç›®çš„æ’åºã€‚ * å› æ­¤ï¼Œç¬¬ä¸€ä¸ªåˆ†åŒºä¸­çš„ç¬¬ä¸€ä¸ªé¡¹çš„ç´¢å¼•å€¼ä¸º0ï¼Œæœ€åä¸€ä¸ªåˆ†åŒºä¸­çš„æœ€åä¸€ä¸ªé¡¹å¾—åˆ°æœ€å¤§çš„ç´¢å¼•ã€‚ * è¿™ç±»ä¼¼äºScalaçš„zipWithIndexï¼Œä½†å®ƒä½¿ç”¨çš„æ˜¯Longè€Œä¸æ˜¯Intä½œä¸ºç´¢å¼•ç±»å‹ã€‚ * å½“è¿™ä¸ªRDDåŒ…å«å¤šä¸ªåˆ†åŒºæ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦è§¦å‘ä¸€ä¸ªsparkä½œä¸šã€‚ */def zipWithIndex(): JavaPairRDD[T, jl.Long] = &#123; JavaPairRDD.fromRDD(rdd.zipWithIndex()).asInstanceOf[JavaPairRDD[T, jl.Long]]&#125; Actions (launch a job to return a value to the user program)foreach1234567/** * Applies a function f to all elements of this RDD. * å°†å‡½æ•°fåº”ç”¨äºè¯¥RDDçš„æ‰€æœ‰å…ƒç´ ã€‚ */def foreach(f: VoidFunction[T]) &#123; rdd.foreach(x =&gt; f.call(x))&#125; collect12345678910/** * Return an array that contains all of the elements in this RDD. * è¿”å›åŒ…å«è¯¥RDDä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚ * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. * è¯¥æ–¹æ³•åªåœ¨é¢„æœŸçš„æ•°ç»„å¾ˆå°çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå› ä¸ºæ‰€æœ‰çš„æ•°æ®éƒ½è¢«åŠ è½½åˆ°é©±åŠ¨ç¨‹åºçš„å†…å­˜ä¸­ã€‚ */def collect(): JList[T] = rdd.collect().toSeq.asJava toLocalIterator123456789/** * Return an iterator that contains all of the elements in this RDD. * è¿”å›åŒ…å«è¯¥RDDä¸­æ‰€æœ‰å…ƒç´ çš„è¿­ä»£å™¨ã€‚ * * The iterator will consume as much memory as the largest partition in this RDD. * è¿­ä»£å™¨å°†æ¶ˆè€—ä¸æ­¤RDDä¸­æœ€å¤§çš„åˆ†åŒºä¸€æ ·å¤šçš„å†…å­˜ã€‚ */def toLocalIterator(): JIterator[T] = asJavaIteratorConverter(rdd.toLocalIterator).asJava collectPartitions1234567891011 /** * Return an array that contains all of the elements in a specific partition of this RDD. * è¿”å›åŒ…å«è¯¥RDDçš„ç‰¹å®šåˆ†åŒºä¸­çš„æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚ */def collectPartitions(partitionIds: Array[Int]): Array[JList[T]] = &#123; // This is useful for implementing `take` from other language frontends // like Python where the data is serialized. // è¿™æœ‰åŠ©äºä»å…¶ä»–è¯­è¨€çš„å‰æ²¿å®ç°â€œtakeâ€ï¼Œå¦‚Pythonï¼Œæ•°æ®è¢«åºåˆ—åŒ–ã€‚ val res = context.runJob(rdd, (it: Iterator[T]) =&gt; it.toArray, partitionIds) res.map(_.toSeq.asJava)&#125; reduce123456/** * Reduces the elements of this RDD using the specified commutative and associative binary * operator. * ä½¿ç”¨æŒ‡å®šçš„äº¤æ¢å’Œå…³è”äºŒå…ƒè¿ç®—ç¬¦æ¥å‡å°‘è¯¥RDDçš„å…ƒç´ ã€‚ */def reduce(f: JFunction2[T, T, T]): T = rdd.reduce(f) treeReduce12345678910111213/** * Reduces the elements of this RDD in a multi-level tree pattern. * å°†æ­¤RDDçš„å…ƒç´ ç®€åŒ–ä¸ºå¤šå±‚æ ‘æ¨¡å¼ã€‚ * * @param depth suggested depth of the tree å»ºè®®æ ‘çš„æ·±åº¦ * @see [[org.apache.spark.api.java.JavaRDDLike#reduce]] */def treeReduce(f: JFunction2[T, T, T], depth: Int): T = rdd.treeReduce(f, depth)/** * [[org.apache.spark.api.java.JavaRDDLike#treeReduce]] å»ºè®®æ·±åº¦ 2 . */def treeReduce(f: JFunction2[T, T, T]): T = treeReduce(f, 2) fold123456789101112131415161718192021 /** * Aggregate the elements of each partition, and then the results for all the partitions, using a * given associative function and a neutral \"zero value\". The function * op(t1, t2) is allowed to modify t1 and return it as its result value to avoid object * allocation; however, it should not modify t2. * å¯¹æ¯ä¸ªåˆ†åŒºçš„å…ƒç´ è¿›è¡Œèšåˆï¼Œç„¶åä½¿ç”¨ç»™å®šçš„å…³è”å‡½æ•°å’Œä¸­ç«‹çš„â€œé›¶å€¼â€ï¼Œå¯¹æ‰€æœ‰åˆ†åŒºè¿›è¡Œç»“æœã€‚ * å‡½æ•°op(t1,t2)è¢«å…è®¸ä¿®æ”¹t1ï¼Œå¹¶å°†å…¶ä½œä¸ºå…¶ç»“æœå€¼è¿”å›ï¼Œä»¥é¿å…å¯¹è±¡åˆ†é…;ä½†æ˜¯ï¼Œå®ƒä¸åº”è¯¥ä¿®æ”¹t2ã€‚ * * This behaves somewhat differently from fold operations implemented for non-distributed * collections in functional languages like Scala. This fold operation may be applied to * partitions individually, and then fold those results into the final result, rather than * apply the fold to each element sequentially in some defined ordering. For functions * that are not commutative, the result may differ from that of a fold applied to a * non-distributed collection. * è¿™ä¸åœ¨Scalaç­‰å‡½æ•°å¼è¯­è¨€ä¸­å®ç°éåˆ†å¸ƒå¼é›†åˆçš„æŠ˜å æ“ä½œæœ‰ä¸€å®šçš„ä¸åŒã€‚ * è¿™ä¸ªæŠ˜å æ“ä½œå¯ä»¥å•ç‹¬åº”ç”¨äºåˆ†åŒºï¼Œç„¶åå°†è¿™äº›ç»“æœæŠ˜å åˆ°æœ€ç»ˆç»“æœä¸­ï¼Œè€Œä¸æ˜¯åœ¨æŸäº›å®šä¹‰çš„æ’åºä¸­é¡ºåºåœ°å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡ŒæŠ˜å ã€‚ * å¯¹äºéäº¤æ¢çš„å‡½æ•°ï¼Œç»“æœå¯èƒ½ä¸åº”ç”¨äºéåˆ†å¸ƒå¼é›†åˆçš„å‡½æ•°ä¸åŒã€‚ * */def fold(zeroValue: T)(f: JFunction2[T, T, T]): T = rdd.fold(zeroValue)(f) aggregate12345678910111213141516 /** * Aggregate the elements of each partition, and then the results for all the partitions, using * given combine functions and a neutral \"zero value\". This function can return a different result * type, U, than the type of this RDD, T. Thus, we need one operation for merging a T into an U * and one operation for merging two U's, as in scala.TraversableOnce. Both of these functions are * allowed to modify and return their first argument instead of creating a new U to avoid memory * allocation. * å¯¹æ¯ä¸ªåˆ†åŒºçš„å…ƒç´ è¿›è¡Œèšåˆï¼Œç„¶åä½¿ç”¨ç»™å®šçš„ç»„åˆå‡½æ•°å’Œä¸€ä¸ªä¸­ç«‹çš„â€œé›¶å€¼â€ï¼Œå¯¹æ‰€æœ‰åˆ†åŒºè¿›è¡Œç»“æœã€‚ * è¿™ä¸ªå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªä¸åŒçš„ç»“æœç±»å‹Uï¼Œè€Œä¸æ˜¯è¿™ä¸ªRDDçš„ç±»å‹ã€‚ * å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ“ä½œæ¥å°†ä¸€ä¸ªTåˆå¹¶åˆ°ä¸€ä¸ªUå’Œä¸€ä¸ªåˆå¹¶ä¸¤ä¸ªUçš„æ“ä½œï¼Œå°±åƒåœ¨scala . traversableonceä¸­é‚£æ ·ã€‚ * è¿™ä¸¤ä¸ªå‡½æ•°éƒ½å¯ä»¥ä¿®æ”¹å’Œè¿”å›ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„Uï¼Œä»¥é¿å…å†…å­˜åˆ†é…ã€‚ * */def aggregate[U](zeroValue: U)(seqOp: JFunction2[U, T, U], combOp: JFunction2[U, U, U]): U = rdd.aggregate(zeroValue)(seqOp, combOp)(fakeClassTag[U]) treeAggregate12345678910111213141516171819202122232425 /** * Aggregates the elements of this RDD in a multi-level tree pattern. * å°†æ­¤RDDçš„å…ƒç´ èšé›†åœ¨å¤šå±‚æ ‘æ¨¡å¼ä¸­ã€‚ * * @param depth suggested depth of the tree å»ºè®®çš„æ ‘çš„æ·±åº¦ * @see [[org.apache.spark.api.java.JavaRDDLike#aggregate]] */def treeAggregate[U]( zeroValue: U, seqOp: JFunction2[U, T, U], combOp: JFunction2[U, U, U], depth: Int): U = &#123; rdd.treeAggregate(zeroValue)(seqOp, combOp, depth)(fakeClassTag[U])&#125;/** * [[org.apache.spark.api.java.JavaRDDLike#treeAggregate]] with suggested depth 2. * å»ºè®®çš„æ ‘çš„æ·±åº¦ä¸º 2 */def treeAggregate[U]( zeroValue: U, seqOp: JFunction2[U, T, U], combOp: JFunction2[U, U, U]): U = &#123; treeAggregate(zeroValue, seqOp, combOp, 2)&#125; count123456/** * Return the number of elements in the RDD. * è¿”å›RDDä¸­å…ƒç´ çš„æ•°é‡ã€‚ * */def count(): Long = rdd.count() countApprox12345678910111213141516171819202122232425262728293031323334353637 /** * Approximate version of count() that returns a potentially incomplete result * within a timeout, even if not all tasks have finished. * è¿‘ä¼¼ç‰ˆæœ¬çš„count()ï¼Œå³ä½¿ä¸æ˜¯æ‰€æœ‰çš„ä»»åŠ¡éƒ½å®Œæˆäº†ï¼Œä¹Ÿä¼šåœ¨ä¸€ä¸ªè¶…æ—¶ä¸­è¿”å›ä¸€ä¸ªæ½œåœ¨çš„ä¸å®Œæ•´çš„ç»“æœã€‚ * * * The confidence is the probability that the error bounds of the result will * contain the true value. That is, if countApprox were called repeatedly * with confidence 0.9, we would expect 90% of the results to contain the * true count. The confidence must be in the range [0,1] or an exception will * be thrown. * ç½®ä¿¡å€¼æ˜¯ç»“æœçš„è¯¯å·®è¾¹ç•ŒåŒ…å«çœŸå®å€¼çš„æ¦‚ç‡ã€‚ * ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœcountApproxè¢«åå¤è°ƒç”¨ï¼Œconfidence 0.9ï¼Œæˆ‘ä»¬å°†æœŸæœ›90%çš„ç»“æœåŒ…å«çœŸå®çš„è®¡æ•°ã€‚ * confidenceå¿…é¡»åœ¨èŒƒå›´[0,1]ä¸­ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚ * * * @param timeout maximum time to wait for the job, in milliseconds * ç­‰å¾…å·¥ä½œçš„æœ€å¤§æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ * @param confidence the desired statistical confidence in the result * å¯¹ç»“æœçš„æœŸæœ›çš„ç»Ÿè®¡ä¿¡å¿ƒ * @return a potentially incomplete result, with error bounds * ä¸€ä¸ªå¯èƒ½ä¸å®Œæ•´çš„ç»“æœï¼Œæœ‰é”™è¯¯ç•Œé™ */def countApprox(timeout: Long, confidence: Double): PartialResult[BoundedDouble] = rdd.countApprox(timeout, confidence)/** * Approximate version of count() that returns a potentially incomplete result * within a timeout, even if not all tasks have finished. * è¿‘ä¼¼ç‰ˆæœ¬çš„count()ï¼Œå³ä½¿ä¸æ˜¯æ‰€æœ‰çš„ä»»åŠ¡éƒ½å®Œæˆäº†ï¼Œä¹Ÿä¼šåœ¨ä¸€ä¸ªè¶…æ—¶ä¸­è¿”å›ä¸€ä¸ªæ½œåœ¨çš„ä¸å®Œæ•´çš„ç»“æœã€‚ * * * @param timeout maximum time to wait for the job, in milliseconds * ç­‰å¾…å·¥ä½œçš„æœ€å¤§æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ */def countApprox(timeout: Long): PartialResult[BoundedDouble] = rdd.countApprox(timeout) countByValue123456789/** * Return the count of each unique value in this RDD as a map of (value, count) pairs. The final * combine step happens locally on the master, equivalent to running a single reduce task. * å°†æ­¤RDDä¸­çš„æ¯ä¸ªæƒŸä¸€å€¼çš„è®¡æ•°ä½œä¸º(å€¼ã€è®¡æ•°)å¯¹çš„æ˜ å°„ã€‚ * æœ€åçš„è”åˆæ­¥éª¤åœ¨masterçš„æœ¬åœ°å‘ç”Ÿï¼Œç›¸å½“äºè¿è¡Œä¸€ä¸ªreduceä»»åŠ¡ã€‚ * */def countByValue(): JMap[T, jl.Long] = mapAsSerializableJavaMap(rdd.countByValue()).asInstanceOf[JMap[T, jl.Long]] countByValueApprox1234567891011121314151617181920212223242526272829303132333435363738 /** * Approximate version of countByValue(). * countByValue()è¿‘ä¼¼çš„ç‰ˆæœ¬ã€‚ * * The confidence is the probability that the error bounds of the result will * contain the true value. That is, if countApprox were called repeatedly * with confidence 0.9, we would expect 90% of the results to contain the * true count. The confidence must be in the range [0,1] or an exception will * be thrown. * ç½®ä¿¡å€¼æ˜¯ç»“æœçš„è¯¯å·®è¾¹ç•ŒåŒ…å«çœŸå®å€¼çš„æ¦‚ç‡ã€‚ * ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœcountApproxè¢«åå¤è°ƒç”¨ï¼Œconfidence 0.9ï¼Œæˆ‘ä»¬å°†æœŸæœ›90%çš„ç»“æœåŒ…å«çœŸå®çš„è®¡æ•°ã€‚ * confidenceå¿…é¡»åœ¨èŒƒå›´[0,1]ä¸­ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚ * * * @param timeout maximum time to wait for the job, in milliseconds * ç­‰å¾…å·¥ä½œçš„æœ€å¤§æ—¶é—´ï¼Œæ¯«ç§’ä¸ºå•ä½ã€‚ * @param confidence the desired statistical confidence in the result * å¯¹ç»“æœçš„æœŸæœ›çš„ç»Ÿè®¡ä¿¡å¿ƒ * @return a potentially incomplete result, with error bounds * ä¸€ä¸ªå¯èƒ½ä¸å®Œæ•´çš„ç»“æœï¼Œæœ‰é”™è¯¯ç•Œé™ */def countByValueApprox( timeout: Long, confidence: Double ): PartialResult[JMap[T, BoundedDouble]] = rdd.countByValueApprox(timeout, confidence).map(mapAsSerializableJavaMap)/** * Approximate version of countByValue(). * countByValue().çš„è¿‘ä¼¼ç‰ˆæœ¬. * * @param timeout maximum time to wait for the job, in milliseconds * ç­‰å¾…å·¥ä½œçš„æœ€å¤§æ—¶é—´ï¼Œæ¯«ç§’ä¸ºå•ä½ã€‚ * @return a potentially incomplete result, with error bounds * ä¸€ä¸ªå¯èƒ½ä¸å®Œæ•´çš„ç»“æœï¼Œæœ‰é”™è¯¯ç•Œé™ */def countByValueApprox(timeout: Long): PartialResult[JMap[T, BoundedDouble]] = rdd.countByValueApprox(timeout).map(mapAsSerializableJavaMap) take12345678910111213141516 /** * Take the first num elements of the RDD. This currently scans the partitions *one by one*, so * it will be slow if a lot of partitions are required. In that case, use collect() to get the * whole RDD instead. * è·å–RDDçš„ç¬¬ä¸€ä¸ªnumå…ƒç´ ã€‚ * è¿™å°†ä¼šä¸€æ¬¡ä¸€ä¸ªåœ°æ‰«æåˆ†åŒºï¼Œæ‰€ä»¥å¦‚æœéœ€è¦å¾ˆå¤šåˆ†åŒºï¼Œå®ƒå°†ä¼šå¾ˆæ…¢ã€‚ * åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨collect()æ¥è·å¾—æ•´ä¸ªRDDã€‚ * * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. * è¯¥æ–¹æ³•åªåœ¨é¢„æœŸçš„æ•°ç»„å¾ˆå°çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå› ä¸ºæ‰€æœ‰çš„æ•°æ®éƒ½è¢«åŠ è½½åˆ°é©±åŠ¨ç¨‹åºçš„å†…å­˜ä¸­ã€‚ * */def take(num: Int): JList[T] = rdd.take(num).toSeq.asJava takeSample12345def takeSample(withReplacement: Boolean, num: Int): JList[T] = takeSample(withReplacement, num, Utils.random.nextLong)def takeSample(withReplacement: Boolean, num: Int, seed: Long): JList[T] = rdd.takeSample(withReplacement, num, seed).toSeq.asJava first12345 /** * Return the first element in this RDD. * è¿”å›è¿™ä¸ªRDDä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ */def first(): T = rdd.first() isEmpty1234567/** * @return true if and only if the RDD contains no elements at all. Note that an RDD * may be empty even when it has at least 1 partition. * å½“ä¸”ä»…å½“RDDä¸åŒ…å«ä»»ä½•å…ƒç´ ï¼Œåˆ™ä¸ºçœŸã€‚ * è¯·æ³¨æ„ï¼Œå³ä½¿åœ¨è‡³å°‘æœ‰ä¸€ä¸ªåˆ†åŒºçš„æƒ…å†µä¸‹ï¼ŒRDDä¹Ÿå¯èƒ½æ˜¯ç©ºçš„ã€‚ */def isEmpty(): Boolean = rdd.isEmpty() saveAsTextFile123456789101112131415/** * Save this RDD as a text file, using string representations of elements. * å°†æ­¤RDDä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨å…ƒç´ çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ */def saveAsTextFile(path: String): Unit = &#123; rdd.saveAsTextFile(path)&#125;/** * Save this RDD as a compressed text file, using string representations of elements. * å°†æ­¤RDDä¿å­˜ä¸ºä¸€ä¸ªå‹ç¼©æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨å…ƒç´ çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ */def saveAsTextFile(path: String, codec: Class[_ &lt;: CompressionCodec]): Unit = &#123; rdd.saveAsTextFile(path, codec)&#125; saveAsObjectFile1234567/** * Save this RDD as a SequenceFile of serialized objects. * å°†æ­¤RDDä¿å­˜ä¸ºåºåˆ—åŒ–å¯¹è±¡çš„åºåˆ—æ–‡ä»¶ã€‚ */def saveAsObjectFile(path: String): Unit = &#123; rdd.saveAsObjectFile(path)&#125; keyBy12345678910/** * Creates tuples of the elements in this RDD by applying `f`. * é€šè¿‡åº”ç”¨â€œfâ€åˆ›å»ºè¿™ä¸ªRDDä¸­å…ƒç´ çš„å…ƒç»„ã€‚ */def keyBy[U](f: JFunction[T, U]): JavaPairRDD[U, T] = &#123; // The type parameter is U instead of K in order to work around a compiler bug; see SPARK-4459 // ç±»å‹å‚æ•°ç”¨Uæ›¿ä»£Kï¼Œä¸ºäº†ç»•è¿‡ç¼–è¯‘å™¨é”™è¯¯; implicit val ctag: ClassTag[U] = fakeClassTag JavaPairRDD.fromRDD(rdd.keyBy(f))&#125; checkpoint12345678910111213141516/** * Mark this RDD for checkpointing. It will be saved to a file inside the checkpoint * directory set with SparkContext.setCheckpointDir() and all references to its parent * RDDs will be removed. This function must be called before any job has been * executed on this RDD. It is strongly recommended that this RDD is persisted in * memory, otherwise saving it on a file will require recomputation. * å°†æ­¤RDDæ ‡è®°ä¸ºæ£€æŸ¥ç‚¹ã€‚ * å®ƒå°†è¢«ä¿å­˜åˆ°ç”±SparkContext.setCheckpointDir()è®¾ç½®çš„æ£€æŸ¥ç‚¹ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸­ã€‚ * æ‰€æœ‰å¯¹å…¶çˆ¶RDDsçš„å¼•ç”¨å°†è¢«åˆ é™¤ã€‚ * åœ¨æ­¤RDDä¸Šæ‰§è¡Œä»»ä½•ä½œä¸šä¹‹å‰ï¼Œå¿…é¡»è°ƒç”¨æ­¤å‡½æ•°ã€‚ * å¼ºçƒˆå»ºè®®å°†æ­¤RDDä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¦åˆ™å°†å…¶ä¿å­˜åœ¨æ–‡ä»¶ä¸­éœ€è¦é‡æ–°è®¡ç®—ã€‚ * */def checkpoint(): Unit = &#123; rdd.checkpoint()&#125; isCheckpointed12345/** * Return whether this RDD has been checkpointed or not * è¿”å› RDDæ˜¯å¦å·²è¢«æ£€æŸ¥è¿‡ */def isCheckpointed: Boolean = rdd.isCheckpointed getCheckpointFile1234567/** * Gets the name of the file to which this RDD was checkpointed * è·å–è¯¥RDDæ‰€æŒ‡å‘çš„checkpointedæ–‡ä»¶çš„åç§° */def getCheckpointFile(): Optional[String] = &#123; JavaUtils.optionToOptional(rdd.getCheckpointFile)&#125; toDebugString123456/** A description of this RDD and its recursive dependencies for debugging. * å¯¹è¯¥RDDåŠå…¶å¯¹è°ƒè¯•çš„é€’å½’ä¾èµ–çš„æè¿°ã€‚ * */def toDebugString(): String = &#123; rdd.toDebugString&#125; top12345678910111213141516171819202122232425262728293031323334/** * Returns the top k (largest) elements from this RDD as defined by * the specified Comparator[T] and maintains the order. * æ ¹æ®æŒ‡å®šçš„æ¯”è¾ƒå™¨[T]ï¼Œä»è¿™ä¸ªRDDä¸­è¿”å›æœ€å¤§çš„k(æœ€å¤§)å…ƒç´ ï¼Œå¹¶ç»´æŠ¤é¡ºåºã€‚ * * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. * è¯¥æ–¹æ³•åªåœ¨é¢„æœŸçš„æ•°ç»„å¾ˆå°çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå› ä¸ºæ‰€æœ‰çš„æ•°æ®éƒ½è¢«åŠ è½½åˆ°é©±åŠ¨ç¨‹åºçš„å†…å­˜ä¸­ã€‚ * * @param num k, the number of top elements to return è¿”å›çš„å…ƒç´ æ•°é‡ * @param comp the comparator that defines the order å®šä¹‰æ’åºçš„æ¯”è¾ƒå™¨ * @return an array of top elements è¿”å›æœ€å¤§å…ƒç´ çš„æ•°ç»„ */def top(num: Int, comp: Comparator[T]): JList[T] = &#123; rdd.top(num)(Ordering.comparatorToOrdering(comp)).toSeq.asJava&#125;/** * Returns the top k (largest) elements from this RDD using the * natural ordering for T and maintains the order. * ä½¿ç”¨Tçš„è‡ªç„¶é¡ºåºï¼Œä»è¿™ä¸ªRDDä¸­è¿”å›æœ€å¤§çš„k(æœ€å¤§)å…ƒç´ ï¼Œå¹¶ç»´æŠ¤é¡ºåºã€‚ * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. * è¯¥æ–¹æ³•åªåœ¨é¢„æœŸçš„æ•°ç»„å¾ˆå°çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå› ä¸ºæ‰€æœ‰çš„æ•°æ®éƒ½è¢«åŠ è½½åˆ°é©±åŠ¨ç¨‹åºçš„å†…å­˜ä¸­ã€‚ * * @param num k, the number of top elements to return è¿”å›çš„å…ƒç´ æ•°é‡ * @return an array of top elements æœ€å¤§å…ƒç´ çš„æ•°ç»„ */def top(num: Int): JList[T] = &#123; val comp = com.google.common.collect.Ordering.natural().asInstanceOf[Comparator[T]] top(num, comp)&#125; takeOrdered123456789101112131415161718192021222324252627282930313233/** * Returns the first k (smallest) elements from this RDD as defined by * the specified Comparator[T] and maintains the order. * ä»è¿™ä¸ªRDDä¸­è¿”å›ç¬¬ä¸€ä¸ªk(æœ€å°)å…ƒç´ ï¼Œç”±æŒ‡å®šçš„Comparator[T]å®šä¹‰ï¼Œå¹¶ç»´æŠ¤è¯¥é¡ºåºã€‚ * * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. * è¯¥æ–¹æ³•åªåœ¨é¢„æœŸçš„æ•°ç»„å¾ˆå°çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå› ä¸ºæ‰€æœ‰çš„æ•°æ®éƒ½è¢«åŠ è½½åˆ°é©±åŠ¨ç¨‹åºçš„å†…å­˜ä¸­ã€‚ * * @param num k, the number of elements to return è¿”å›çš„å…ƒç´ æ•°é‡ * @param comp the comparator that defines the order æ’åºæ¯”è¾ƒå™¨ * @return an array of top elements å…ƒç´ æ•°ç»„ */def takeOrdered(num: Int, comp: Comparator[T]): JList[T] = &#123; rdd.takeOrdered(num)(Ordering.comparatorToOrdering(comp)).toSeq.asJava&#125;/** * Returns the first k (smallest) elements from this RDD using the * natural ordering for T while maintain the order. * ä½¿ç”¨åŸç”Ÿçš„ Tæ’åºæ¯”è¾ƒå™¨ï¼Œè¿”å› kä¸ª æœ€å°å€¼ï¼Œå¹¶ç»´æŠ¤è¿™ä¸ªé¡ºåº * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. * å°½é‡åº”ç”¨äºå°çš„æ•°ç»„ï¼Œå› ä¸ºä¼šåŠ è½½åˆ°driverå†…å­˜ä¸­ã€‚ * @param num k, the number of top elements to return * @return an array of top elements */def takeOrdered(num: Int): JList[T] = &#123; val comp = com.google.common.collect.Ordering.natural().asInstanceOf[Comparator[T]] takeOrdered(num, comp)&#125; max123456789101112/** * Returns the maximum element from this RDD as defined by the specified * Comparator[T]. * æŒ‰ç…§æŒ‡å®šæ¯”è¾ƒå™¨[T]å®šä¹‰çš„RDDï¼Œ * è¿”å›æœ€å¤§å…ƒç´ ã€‚ * * @param comp the comparator that defines ordering æŒ‡å®šçš„æ¯”è¾ƒå™¨ * @return the maximum of the RDD æœ€å¤§å€¼ */def max(comp: Comparator[T]): T = &#123; rdd.max()(Ordering.comparatorToOrdering(comp))&#125; min123456789101112/** * Returns the minimum element from this RDD as defined by the specified * Comparator[T]. * æŒ‰ç…§æŒ‡å®šæ¯”è¾ƒå™¨[T]å®šä¹‰çš„RDDï¼Œ * è¿”å›æœ€å°å…ƒç´ ã€‚ * * @param comp the comparator that defines ordering æŒ‡å®šçš„æ¯”è¾ƒå™¨ * @return the minimum of the RDD æœ€å°å€¼ */def min(comp: Comparator[T]): T = &#123; rdd.min()(Ordering.comparatorToOrdering(comp))&#125; countApproxDistinct123456789101112131415161718/*** Return approximate number of distinct elements in the RDD.* è¿”å›RDDä¸­ä¸é‡å¤å…ƒç´ çš„æ•°é‡è¿‘ä¼¼æ•°ã€‚** The algorithm used is based on streamlib's implementation of \"HyperLogLog in Practice:* Algorithmic Engineering of a State of The Art Cardinality Estimation Algorithm\", available * &lt;a href=\"http://dx.doi.org/10.1145/2452376.2452456\"&gt;here&lt;/a&gt;. * æ‰€ä½¿ç”¨çš„ç®—æ³•æ˜¯åŸºäºstreamlibåœ¨å®è·µä¸­çš„â€œHyperLogLogâ€çš„å®ç°: * â€œä¸€ç§è‰ºæœ¯åŸºæ•°ä¼°è®¡ç®—æ³•çŠ¶æ€çš„ç®—æ³•å·¥ç¨‹â€ï¼Œ * * * @param relativeSD Relative accuracy. Smaller values create counters that require more space. * It must be greater than 0.000017. * ç›¸å¯¹ç²¾åº¦ã€‚ * è¾ƒå°çš„å€¼åˆ›å»ºéœ€è¦æ›´å¤šç©ºé—´çš„è®¡æ•°å™¨ã€‚ * å®ƒå¿…é¡»å¤§äº0.000017ã€‚ */ def countApproxDistinct(relativeSD: Double): Long = rdd.countApproxDistinct(relativeSD) countAsync12345678/** * The asynchronous version of `count`, which returns a * future for counting the number of elements in this RDD. * â€œcountâ€çš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œå®ƒä¸ºè®¡ç®—è¿™ä¸ªRDDä¸­å…ƒç´ çš„æ•°é‡è¿”å›ä¸€ä¸ªæœªæ¥ã€‚ */def countAsync(): JavaFutureAction[jl.Long] = &#123;new JavaFutureActionWrapper[Long, jl.Long](rdd.countAsync(), jl.Long.valueOf)&#125; collectAsync12345678910111213/** * The asynchronous version of `collect`, which returns a future for * retrieving an array containing all of the elements in this RDD. * â€œcollectâ€çš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œ * å®ƒè¿”å›ä¸€ä¸ªç”¨äºæ£€ç´¢åŒ…å«è¯¥RDDä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„çš„æœªæ¥ã€‚ * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. * å°½é‡åº”ç”¨äºå°æ•°é‡æ•°ç»„ã€‚ */def collectAsync(): JavaFutureAction[JList[T]] = &#123;new JavaFutureActionWrapper(rdd.collectAsync(), (x: Seq[T]) =&gt; x.asJava)&#125; takeAsync123456789101112/** * The asynchronous version of the `take` action, which returns a * future for retrieving the first `num` elements of this RDD. * â€œtakeâ€æ“ä½œçš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œ * å®ƒå°†è¿”å›ç”¨äºæ£€ç´¢æ­¤RDDçš„ç¬¬ä¸€ä¸ªâ€œnumâ€å…ƒç´ çš„æœªæ¥ã€‚ * * @note this method should only be used if the resulting array is expected to be small, as * all the data is loaded into the driver's memory. */def takeAsync(num: Int): JavaFutureAction[JList[T]] = &#123;new JavaFutureActionWrapper(rdd.takeAsync(num), (x: Seq[T]) =&gt; x.asJava)&#125; foreachAsync1234567891011/** * The asynchronous version of the `foreach` action, which * applies a function f to all the elements of this RDD. * â€œforeachâ€æ“ä½œçš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œ * å®ƒå°†å‡½æ•°fåº”ç”¨äºè¿™ä¸ªRDDçš„æ‰€æœ‰å…ƒç´ ã€‚ * */def foreachAsync(f: VoidFunction[T]): JavaFutureAction[Void] = &#123;new JavaFutureActionWrapper[Unit, Void](rdd.foreachAsync(x =&gt; f.call(x)),&#123; x =&gt; null.asInstanceOf[Void] &#125;)&#125; foreachPartitionAsync1234567891011/** * The asynchronous version of the `foreachPartition` action, which * applies a function f to each partition of this RDD. * â€œforeachPartitionâ€æ“ä½œçš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œ * å®ƒå°†å‡½æ•°fåº”ç”¨äºè¯¥RDDçš„æ¯ä¸ªåˆ†åŒºã€‚ */def foreachPartitionAsync(f: VoidFunction[JIterator[T]]): JavaFutureAction[Void] = &#123;new JavaFutureActionWrapper[Unit, Void](rdd.foreachPartitionAsync(x =&gt; f.call(x.asJava)),&#123; x =&gt; null.asInstanceOf[Void] &#125;)&#125;&#125;","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"},{"name":"æºç ","slug":"æºç ","permalink":"https://stanxia.github.io/tags/æºç /"}]},{"title":"sparkæºç æ³¨é‡Šç¿»è¯‘","slug":"sparkæºç æ³¨é‡Šç¿»è¯‘","date":"2017-11-06T16:57:05.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/11/06/sparkæºç æ³¨é‡Šç¿»è¯‘/","link":"","permalink":"https://stanxia.github.io/2017/11/06/sparkæºç æ³¨é‡Šç¿»è¯‘/","excerpt":"ç‰ˆæœ¬ï¼šspark2.1.1ç›®çš„ï¼šæ–¹ä¾¿ä¸­æ–‡ç”¨æˆ·é˜…è¯»æºç ï¼ŒæŠŠæ—¶é—´èŠ±åœ¨ç†è§£è€Œä¸æ˜¯ç¿»è¯‘ä¸Š\n\nåˆè¡·å¼€å§‹ç«‹é¡¹è¿›è¡Œç¿»è¯‘ï¼Œä¸€æ–¹é¢æ–¹ä¾¿æ—¥åé˜…è¯»æºç ï¼Œå¦ä¸€æ–¹é¢å…ˆç²—ç²’åº¦çš„ç†Ÿæ‚‰ä¸‹sparkæ¡†æ¶å’Œç»„ä»¶ã€‚ä¼˜åŒ–å®Œä¹‹åå¸Œæœ›èƒ½å¸®åŠ©æ›´å¤šçš„ä¸­æ–‡ç”¨æˆ·ï¼ŒèŠ‚çœç¿»è¯‘æ—¶é—´ã€‚","text":"ç‰ˆæœ¬ï¼šspark2.1.1ç›®çš„ï¼šæ–¹ä¾¿ä¸­æ–‡ç”¨æˆ·é˜…è¯»æºç ï¼ŒæŠŠæ—¶é—´èŠ±åœ¨ç†è§£è€Œä¸æ˜¯ç¿»è¯‘ä¸Š åˆè¡·å¼€å§‹ç«‹é¡¹è¿›è¡Œç¿»è¯‘ï¼Œä¸€æ–¹é¢æ–¹ä¾¿æ—¥åé˜…è¯»æºç ï¼Œå¦ä¸€æ–¹é¢å…ˆç²—ç²’åº¦çš„ç†Ÿæ‚‰ä¸‹sparkæ¡†æ¶å’Œç»„ä»¶ã€‚ä¼˜åŒ–å®Œä¹‹åå¸Œæœ›èƒ½å¸®åŠ©æ›´å¤šçš„ä¸­æ–‡ç”¨æˆ·ï¼ŒèŠ‚çœç¿»è¯‘æ—¶é—´ã€‚ è¿›åº¦å·²å®Œæˆï¼š æ­£åœ¨ä½œï¼šspark coreæ¨¡å— æ¨¡å—å æ¨¡å—ä»‹ç» å®Œæˆåº¦ api broadcast deploy executor æ‰§è¡Œå™¨ï¼šç”¨äºå¯åŠ¨çº¿ç¨‹æ± ï¼Œæ˜¯çœŸæ­£è´Ÿè´£æ‰§è¡Œtaskçš„éƒ¨ä»¶ å·²å®Œæˆ input internal io launcher mapred memory metrics network partial rdd rpc scheduler è°ƒåº¦å™¨ï¼šsparkåº”ç”¨ç¨‹åºçš„ä»»åŠ¡è°ƒåº¦å™¨ æ­£åœ¨ä½œ security serializer shuffle status.api.v1 storage util","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"}]},{"title":"sparkå…³äºparquetçš„ä¼˜åŒ–","slug":"sparkå…³äºparquetçš„ä¼˜åŒ–","date":"2017-11-01T14:53:13.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/11/01/sparkå…³äºparquetçš„ä¼˜åŒ–/","link":"","permalink":"https://stanxia.github.io/2017/11/01/sparkå…³äºparquetçš„ä¼˜åŒ–/","excerpt":"parquetæ˜¯ä¸€ç§åˆ—å¼å­˜å‚¨ã€‚å¯ä»¥æä¾›é¢å‘åˆ—çš„å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚\nParquetçš„ä¼˜åŠ¿åœ¨sparkSQLç¨‹åºä¸­ä½¿ç”¨parquetæ ¼å¼å­˜å‚¨æ–‡ä»¶ï¼Œåœ¨å­˜å‚¨ç©ºé—´å’ŒæŸ¥è¯¢æ€§èƒ½æ–¹é¢éƒ½æœ‰å¾ˆé«˜çš„æ•ˆç‡ã€‚\nå­˜å‚¨æ–¹é¢å› ä¸ºæ˜¯é¢å‘åˆ—çš„å­˜å‚¨ï¼ŒåŒä¸€åˆ—çš„ç±»å‹ç›¸åŒï¼Œå› è€Œåœ¨å­˜å‚¨çš„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨æ›´é«˜æ•ˆçš„å‹ç¼©æ–¹æ¡ˆï¼Œå¯ä»¥èŠ‚çœå¤§é‡çš„å­˜å‚¨ç©ºé—´ã€‚\næŸ¥è¯¢æ–¹é¢åœ¨æ‰§è¡ŒæŸ¥è¯¢ä»»åŠ¡æ—¶ï¼Œåªä¼šæ‰«æéœ€è¦çš„åˆ—ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ï¼Œé«˜åº¦çµæ´»æ€§ä½¿æŸ¥è¯¢å˜å¾—éå¸¸é«˜æ•ˆã€‚","text":"parquetæ˜¯ä¸€ç§åˆ—å¼å­˜å‚¨ã€‚å¯ä»¥æä¾›é¢å‘åˆ—çš„å­˜å‚¨å’ŒæŸ¥è¯¢ã€‚ Parquetçš„ä¼˜åŠ¿åœ¨sparkSQLç¨‹åºä¸­ä½¿ç”¨parquetæ ¼å¼å­˜å‚¨æ–‡ä»¶ï¼Œåœ¨å­˜å‚¨ç©ºé—´å’ŒæŸ¥è¯¢æ€§èƒ½æ–¹é¢éƒ½æœ‰å¾ˆé«˜çš„æ•ˆç‡ã€‚ å­˜å‚¨æ–¹é¢å› ä¸ºæ˜¯é¢å‘åˆ—çš„å­˜å‚¨ï¼ŒåŒä¸€åˆ—çš„ç±»å‹ç›¸åŒï¼Œå› è€Œåœ¨å­˜å‚¨çš„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨æ›´é«˜æ•ˆçš„å‹ç¼©æ–¹æ¡ˆï¼Œå¯ä»¥èŠ‚çœå¤§é‡çš„å­˜å‚¨ç©ºé—´ã€‚ æŸ¥è¯¢æ–¹é¢åœ¨æ‰§è¡ŒæŸ¥è¯¢ä»»åŠ¡æ—¶ï¼Œåªä¼šæ‰«æéœ€è¦çš„åˆ—ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ï¼Œé«˜åº¦çµæ´»æ€§ä½¿æŸ¥è¯¢å˜å¾—éå¸¸é«˜æ•ˆã€‚ å®ä¾‹æµ‹è¯• æµ‹è¯•æ•°æ®å¤§å° å­˜å‚¨ç±»å‹ å­˜å‚¨æ‰€å ç©ºé—´ æŸ¥è¯¢æ€§èƒ½ 1T TEXTFILE 897.9G 698s 1T Parquet 231.4G 21s Parquetçš„ä½¿ç”¨ä½¿ç”¨parquetçš„ç®€å•demoï¼š 12345678910111213141516171819202122// Encoders for most common types are automatically provided by importing spark.implicits._import spark.implicits._val peopleDF = spark.read.json(\"examples/src/main/resources/people.json\")// DataFrames can be saved as Parquet files, maintaining the schema informationpeopleDF.write.parquet(\"people.parquet\")// Read in the parquet file created above// Parquet files are self-describing so the schema is preserved// The result of loading a Parquet file is also a DataFrameval parquetFileDF = spark.read.parquet(\"people.parquet\")// Parquet files can also be used to create a temporary view and then used in SQL statementsparquetFileDF.createOrReplaceTempView(\"parquetFile\")val namesDF = spark.sql(\"SELECT name FROM parquetFile WHERE age BETWEEN 13 AND 19\")namesDF.map(attributes =&gt; \"Name: \" + attributes(0)).show()// +------------+// | value|// +------------+// |Name: Justin|// +------------+ Parquet çš„é—®é¢˜ spark å†™å…¥æ•°æ®åˆ° hive ä¸­ï¼Œä½¿ç”¨ Parquet å­˜å‚¨æ ¼å¼ï¼ŒæŸ¥è¯¢è¯¥è¡¨æ—¶æŠ¥é”™å¦‚ä¸‹ï¼š 1Error: java.io.IOException: org.apache.parquet.io.ParquetDecodingException: Can not read value at 0 in block -1 in file å½“æ—¶è®¾ç½®çš„å­—æ®µå±æ€§ä¸ºï¼š ç»è¿‡æ¯”å¯¹ï¼Œå‘ç°æ˜¯ decimal ç±»å‹å‡ºäº†é—®é¢˜ï¼ŒæŸ¥è¯¢ decimal çš„å­—æ®µæ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œè€ŒæŸ¥è¯¢å…¶ä»–çš„å¹¶ä¸ä¼šæŠ¥é”™ã€‚ï¼ˆè¿™åº”è¯¥æ˜¯ spark å¼•èµ·çš„ï¼Œå› ä¸ºåœ¨ hive å®¢æˆ·ç«¯æ‰§è¡Œ decimal ç±»å‹çš„æ“ä½œæ—¶å¹¶ä¸ä¼šå‡ºé”™ã€‚ï¼‰ æŸ¥é˜…ç½‘ä¸Šï¼Œä¹Ÿæœ‰äº›æœ‹å‹é‡åˆ°äº†ç±»ä¼¼çš„äº‹æƒ…ï¼Œåº”è¯¥æ˜¯å®˜æ–¹çš„ bug ï¼Œæš‚æ—¶çš„è§£å†³åŠæ³•æ˜¯: 121. å°† Parquet çš„å­˜å‚¨æ ¼å¼è½¬æ¢ä¸º ORC 2. æˆ–å°† decimal æ¢ä¸º double ç±»å‹å­˜å‚¨å­—æ®µ","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"},{"name":"parquet","slug":"parquet","permalink":"https://stanxia.github.io/tags/parquet/"}]},{"title":"ä¸‰æ­¥èµ°æˆ˜ç•¥","slug":"ä¸‰æ­¥èµ°æˆ˜ç•¥","date":"2017-11-01T10:45:09.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/11/01/ä¸‰æ­¥èµ°æˆ˜ç•¥/","link":"","permalink":"https://stanxia.github.io/2017/11/01/ä¸‰æ­¥èµ°æˆ˜ç•¥/","excerpt":"è®¾å®šä¸­é•¿æœŸè§„åˆ’ç¨³æ‰ç¨³æ‰“ï¼Œé€ä¸ªå‡»ç ´ï¼Œå®ç°æŠ€æœ¯ä¸Šçš„é‡å¤§çªç ´","text":"è®¾å®šä¸­é•¿æœŸè§„åˆ’ç¨³æ‰ç¨³æ‰“ï¼Œé€ä¸ªå‡»ç ´ï¼Œå®ç°æŠ€æœ¯ä¸Šçš„é‡å¤§çªç ´ ç¬¬ä¸€æ­¥æ·±åˆ»äº†è§£sparkè¿è¡Œæœºåˆ¶ç¬¬äºŒæ­¥æ·±åº¦å‰–æsparkSQLå’ŒsparkStreamingç¬¬ä¸‰æ­¥å®ç°å¯¹sparkæœºå™¨å­¦ä¹ çš„æ·±åº¦æŒæ¡","raw":null,"content":null,"categories":[{"name":"è§„åˆ’","slug":"è§„åˆ’","permalink":"https://stanxia.github.io/categories/è§„åˆ’/"}],"tags":[{"name":"è§„åˆ’","slug":"è§„åˆ’","permalink":"https://stanxia.github.io/tags/è§„åˆ’/"}]},{"title":"æ‰‹æŠŠæ‰‹æ­å»ºvpså’Œshadowsocks","slug":"æ‰‹æŠŠæ‰‹æ­å»ºvpså’Œshadowsocks","date":"2017-10-31T00:16:22.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/10/31/æ‰‹æŠŠæ‰‹æ­å»ºvpså’Œshadowsocks/","link":"","permalink":"https://stanxia.github.io/2017/10/31/æ‰‹æŠŠæ‰‹æ­å»ºvpså’Œshadowsocks/","excerpt":"è®°æ€§ä¸å¥½ï¼Œåšä¸ªè®°å½•ï¼Œæ—¥åæœ‰éœ€è¦æ—¶éš¾å¾—è´¹ç¥ã€‚\nåè¯è§£é‡Šäº†è§£ä¸€äº›åŸç†ï¼Œç†Ÿæ‚‰ä¸€äº›åè¯ï¼Œä¹Ÿæ–¹ä¾¿ç†è§£æ¥ä¸‹æ¥å®‰è£…è¿‡ç¨‹ä¸­çš„æ“ä½œã€‚\nvpsVPS(Virtual private server) è¯‘ä½œè™šæ‹Ÿä¸“ç”¨ä¼ºæœå™¨ã€‚ä½ å¯ä»¥æŠŠå®ƒç®€å•åœ°ç†è§£ä¸ºä¸€å°åœ¨è¿œç«¯çš„å¼ºåŠ²ç”µè„‘ã€‚å½“ä½ ç§Ÿç”¨äº†å®ƒä»¥åï¼Œå¯ä»¥ç»™å®ƒå®‰è£…æ“ä½œç³»ç»Ÿã€è½¯ä»¶ï¼Œå¹¶é€šè¿‡ä¸€äº›å·¥å…·è¿æ¥å’Œè¿œç¨‹æ“æ§å®ƒã€‚\nvultrVultr æ˜¯ä¸€å®¶ VPS æœåŠ¡å™¨æä¾›å•†ï¼Œæœ‰ç¾å›½ã€äºšæ´²ã€æ¬§æ´²ç­‰å¤šåœ°çš„ VPSã€‚å®ƒå®¶çš„æœåŠ¡å™¨ä»¥æ€§ä»·æ¯”é«˜é—»åï¼ŒæŒ‰æ—¶é—´è®¡è´¹ï¼Œæœ€ä½çš„èµ„è´¹ä¸ºæ¯æœˆ $2.5ã€‚\nlinuxLinux æ˜¯å…è´¹å¼€æºçš„æ“ä½œç³»ç»Ÿï¼Œå¤§æ¦‚è¢«ä¸–ç•Œä¸Šè¿‡åŠæœåŠ¡å™¨æ‰€é‡‡ç”¨ã€‚æœ‰å¤§é‡ä¼˜ç§€çš„å¼€æºè½¯ä»¶å¯ä»¥å®‰è£…ï¼Œä¸Šè¿° Shadowsocks å°±æ˜¯å…¶ä¸€ã€‚ä½ å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥ç›´æ¥ç»™ Linux æ“ä½œç³»ç»Ÿã€Œä¸‹å‘½ä»¤ã€ï¼Œæ¯”å¦‚ $ cd ~/Desktop å°±æ˜¯è¿›å…¥ä½ æ ¹ç›®å½•ä¸‹çš„ Desktop æ–‡ä»¶å¤¹ã€‚\nssh SSH æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œä½œä¸ºæ¯ä¸€å° Linux ç”µè„‘çš„æ ‡å‡†é…ç½®ï¼Œç”¨äºè®¡ç®—æœºä¹‹é—´çš„åŠ å¯†ç™»å½•ã€‚å½“ä½ ä¸ºç§Ÿç”¨çš„ VPS å®‰è£… Linux ç³»ç»Ÿåï¼Œåªè¦å€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œå°±å¯ä»¥ç”¨ SSH åœ¨ä½ è‡ªå·±çš„ Mac/PC ç”µè„‘ä¸Šè¿œç¨‹ç™»å½•è¯¥ VPS äº†ã€‚\nshadowsocksShadowsocks(ss) æ˜¯ç”± Clowwindy å¼€å‘çš„ä¸€æ¬¾è½¯ä»¶ï¼Œå…¶ä½œç”¨æœ¬æ¥æ˜¯åŠ å¯†ä¼ è¾“èµ„æ–™ã€‚å½“ç„¶ï¼Œä¹Ÿæ­£å› ä¸ºå®ƒåŠ å¯†ä¼ è¾“èµ„æ–™çš„ç‰¹æ€§ï¼Œä½¿å¾— GFW æ²¡æ³•å°†ç”±å®ƒä¼ è¾“çš„èµ„æ–™å’Œå…¶ä»–æ™®é€šèµ„æ–™åŒºåˆ†å¼€æ¥ï¼Œä¹Ÿå°±ä¸èƒ½å¹²æ‰°æˆ‘ä»¬è®¿é—®é‚£äº›ã€Œä¸å­˜åœ¨ã€çš„ç½‘ç«™äº†ã€‚","text":"è®°æ€§ä¸å¥½ï¼Œåšä¸ªè®°å½•ï¼Œæ—¥åæœ‰éœ€è¦æ—¶éš¾å¾—è´¹ç¥ã€‚ åè¯è§£é‡Šäº†è§£ä¸€äº›åŸç†ï¼Œç†Ÿæ‚‰ä¸€äº›åè¯ï¼Œä¹Ÿæ–¹ä¾¿ç†è§£æ¥ä¸‹æ¥å®‰è£…è¿‡ç¨‹ä¸­çš„æ“ä½œã€‚ vpsVPS(Virtual private server) è¯‘ä½œè™šæ‹Ÿä¸“ç”¨ä¼ºæœå™¨ã€‚ä½ å¯ä»¥æŠŠå®ƒç®€å•åœ°ç†è§£ä¸ºä¸€å°åœ¨è¿œç«¯çš„å¼ºåŠ²ç”µè„‘ã€‚å½“ä½ ç§Ÿç”¨äº†å®ƒä»¥åï¼Œå¯ä»¥ç»™å®ƒå®‰è£…æ“ä½œç³»ç»Ÿã€è½¯ä»¶ï¼Œå¹¶é€šè¿‡ä¸€äº›å·¥å…·è¿æ¥å’Œè¿œç¨‹æ“æ§å®ƒã€‚ vultrVultr æ˜¯ä¸€å®¶ VPS æœåŠ¡å™¨æä¾›å•†ï¼Œæœ‰ç¾å›½ã€äºšæ´²ã€æ¬§æ´²ç­‰å¤šåœ°çš„ VPSã€‚å®ƒå®¶çš„æœåŠ¡å™¨ä»¥æ€§ä»·æ¯”é«˜é—»åï¼ŒæŒ‰æ—¶é—´è®¡è´¹ï¼Œæœ€ä½çš„èµ„è´¹ä¸ºæ¯æœˆ $2.5ã€‚ linuxLinux æ˜¯å…è´¹å¼€æºçš„æ“ä½œç³»ç»Ÿï¼Œå¤§æ¦‚è¢«ä¸–ç•Œä¸Šè¿‡åŠæœåŠ¡å™¨æ‰€é‡‡ç”¨ã€‚æœ‰å¤§é‡ä¼˜ç§€çš„å¼€æºè½¯ä»¶å¯ä»¥å®‰è£…ï¼Œä¸Šè¿° Shadowsocks å°±æ˜¯å…¶ä¸€ã€‚ä½ å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥ç›´æ¥ç»™ Linux æ“ä½œç³»ç»Ÿã€Œä¸‹å‘½ä»¤ã€ï¼Œæ¯”å¦‚ $ cd ~/Desktop å°±æ˜¯è¿›å…¥ä½ æ ¹ç›®å½•ä¸‹çš„ Desktop æ–‡ä»¶å¤¹ã€‚ ssh SSH æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œä½œä¸ºæ¯ä¸€å° Linux ç”µè„‘çš„æ ‡å‡†é…ç½®ï¼Œç”¨äºè®¡ç®—æœºä¹‹é—´çš„åŠ å¯†ç™»å½•ã€‚å½“ä½ ä¸ºç§Ÿç”¨çš„ VPS å®‰è£… Linux ç³»ç»Ÿåï¼Œåªè¦å€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œå°±å¯ä»¥ç”¨ SSH åœ¨ä½ è‡ªå·±çš„ Mac/PC ç”µè„‘ä¸Šè¿œç¨‹ç™»å½•è¯¥ VPS äº†ã€‚ shadowsocksShadowsocks(ss) æ˜¯ç”± Clowwindy å¼€å‘çš„ä¸€æ¬¾è½¯ä»¶ï¼Œå…¶ä½œç”¨æœ¬æ¥æ˜¯åŠ å¯†ä¼ è¾“èµ„æ–™ã€‚å½“ç„¶ï¼Œä¹Ÿæ­£å› ä¸ºå®ƒåŠ å¯†ä¼ è¾“èµ„æ–™çš„ç‰¹æ€§ï¼Œä½¿å¾— GFW æ²¡æ³•å°†ç”±å®ƒä¼ è¾“çš„èµ„æ–™å’Œå…¶ä»–æ™®é€šèµ„æ–™åŒºåˆ†å¼€æ¥ï¼Œä¹Ÿå°±ä¸èƒ½å¹²æ‰°æˆ‘ä»¬è®¿é—®é‚£äº›ã€Œä¸å­˜åœ¨ã€çš„ç½‘ç«™äº†ã€‚ æ­å»ºvpsç›®çš„å°±æ˜¯æ­å»ºæ¢¯å­ã€‚æ— å»ºç«™çš„éœ€æ±‚ã€‚æ¨èvultrï¼Œæœ€ä¾¿å®œçš„æœ‰2.5ç¾å…ƒä¸€ä¸ªæœˆã€‚500gæµé‡å®Œå…¨å¤Ÿç”¨äº†ã€‚ä¸”ç°åœ¨æ”¯æŒæ”¯ä»˜å®ä»˜æ¬¾ï¼Œé¢‡ä¸ºæ–¹ä¾¿ã€‚ç°é˜¶æ®µçš„ä¼˜æƒ æ´»åŠ¨æ˜¯æ–°æ³¨å†Œçš„ç”¨æˆ·å®ŒæˆæŒ‡å®šçš„ä»»åŠ¡ä¼šè·å¾—3ç¾å…ƒçš„å¥–åŠ±ã€‚ï¼ˆè¯¦ç»†æƒ…å†µå¯ä¾å‚è§å®˜ç½‘ã€‚ï¼‰ æ³¨å†Œé¦–å…ˆç‚¹å‡»å³ä¾§æ³¨å†Œé“¾æ¥ï¼šhttps://www.vultr.com/2017Promoï¼Œç„¶åä¼šæ¥åˆ°ä¸‹å›¾æ‰€ç¤ºçš„æ³¨å†Œé¡µé¢ã€‚ ç¬¬ä¸€ä¸ªæ¡†ä¸­å¡«å†™æ³¨å†Œé‚®ç®±ï¼Œç¬¬äºŒä¸ªæ¡†ä¸­å¡«å†™æ³¨å†Œå¯†ç ï¼ˆè‡³å°‘åŒ…å«1ä¸ªå°å†™å­—æ¯ã€1ä¸ªå¤§å†™å­—æ¯å’Œ1ä¸ªæ•°å­—ï¼‰ï¼Œæœ€åç‚¹å‡»Create Accountåˆ›å»ºè´¦æˆ·ã€‚ åˆ›å»ºè´¦æˆ·åæ³¨å†Œé‚®ç®±ä¼šæ”¶åˆ°ä¸€å°éªŒè¯é‚®ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç‚¹å‡»Verify Your E-mailæ¥éªŒè¯é‚®ç®±ã€‚ å¦‚æœæ³¨å†Œé‚®ç®±æ”¶ä¸åˆ°éªŒè¯é‚®ä»¶è¯·æ›´æ¢æ³¨å†Œé‚®ç®±åé‡å¤ç¬¬ä¸€æ­¥ã€‚ éªŒè¯é‚®ç®±åæˆ‘ä»¬ä¼šæ¥åˆ°ä¸‹å›¾æ‰€ç¤ºçš„ç™»å½•ç•Œé¢ï¼ŒæŒ‰ä¸‹å›¾ä¸­æŒ‡ç¤ºå¡«å†™ä¿¡æ¯ï¼Œç„¶åç‚¹å‡»Loginç™»å½•ã€‚ ç™»é™†åæˆ‘ä»¬ä¼šæ¥åˆ°å……å€¼ç•Œé¢ã€‚Vultrè¦æ±‚æ–°è´¦æˆ·å……å€¼åæ‰å¯ä»¥æ­£å¸¸åˆ›å»ºæœåŠ¡å™¨ã€‚Vultrå·²ç»æ”¯æŒæ”¯ä»˜å®äº†ï¼Œåœ¨è¿™é‡Œæ¨èå¤§å®¶ä½¿ç”¨æ”¯ä»˜å®å……å€¼ï¼Œæœ€ä½é‡‘é¢ä¸º10ç¾å…ƒã€‚ è´­ä¹°å……å€¼å®Œæ¯•åç‚¹å‡»å³ä¸Šè§’çš„è“è‰²åŠ å·æŒ‰é’®è¿›å…¥åˆ›å»ºæœåŠ¡å™¨ç•Œé¢ã€‚ é¦–å…ˆéœ€è¦é€‰æ‹©Server Locationå³æœºæˆ¿ä½ç½®ï¼Œä»å·¦åˆ°å³ã€ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ä¸ºä¸œäº¬ã€æ–°åŠ å¡ã€ä¼¦æ•¦ã€æ³•å…°å…‹ç¦ã€å·´é»ã€é˜¿å§†æ–¯ç‰¹ä¸¹ã€è¿ˆé˜¿å¯†ã€äºšç‰¹å…°å¤§ã€èŠåŠ å“¥ã€ç¡…è°·ã€è¾¾æ‹‰æ–¯ã€æ´›æ‰çŸ¶ã€çº½çº¦ã€è¥¿é›…å›¾ã€æ‚‰å°¼ã€‚ ç„¶åéœ€è¦é€‰æ‹©Server Typeå³æœåŠ¡ç±»å‹ï¼Œè¿™é‡Œå¤§å®¶éœ€è¦é€‰æ‹©å®‰è£…Debian 7 x64ç³»ç»Ÿï¼Œå› ä¸ºè¿™ä¸ªç³»ç»ŸæŠ˜è…¾èµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œæ­å»ºä¸œè¥¿ä¹Ÿç®€å•ä¾¿æ·ã€‚ ç„¶åéœ€è¦é€‰æ‹©Server Sizeå³æ–¹æ¡ˆç±»å‹ï¼Œè¿™é‡Œå¤§å®¶å¯ä»¥æŒ‰ç…§éœ€è¦è‡ªè¡Œé€‰æ‹©ï¼Œå¦‚æœåªæ˜¯æ™®é€šä½¿ç”¨é‚£ä¹ˆé€‰æ‹©ç¬¬äºŒä¸ª5ç¾å…ƒæ–¹æ¡ˆå³å¯ã€‚ ç„¶åAdditional Featuresã€Startup Scriptã€SSH Keysä»¥åŠServer Hostname &amp; Labelç­‰å››éƒ¨åˆ†å¤§å®¶ä¿æŒé»˜è®¤å³å¯ï¼Œæœ€åç‚¹å‡»å³ä¸‹æ–¹çš„è“è‰²Deploy NowæŒ‰é’®ç¡®è®¤åˆ›å»ºæœåŠ¡å™¨ã€‚ åˆ›å»ºæœåŠ¡å™¨åæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸‹å›¾æ‰€ç¤ºç•Œé¢ã€‚ ä¸Šå›¾ä¸­æˆ‘ä»¬éœ€è¦è€å¿ƒç­‰å¾…3~4åˆ†é’Ÿï¼Œç­‰çº¢è‰²Installingå­—å˜ä¸ºç»¿è‰²Runningå­—åï¼Œç‚¹å‡»Cloud Instanceå³å¯è¿›å…¥æœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å·¦ä¾§çº¢æ¡†å†…å››è¡Œä¿¡æ¯ä¾æ¬¡ä¸ºæœºæˆ¿ä½ç½®ã€IPåœ°å€ã€ç™»å½•ç”¨æˆ·åã€ç™»å½•å¯†ç ã€‚IPåœ°å€åé¢çš„æŒ‰é’®ä¸ºå¤åˆ¶IPåœ°å€ï¼Œç™»å½•å¯†ç åé¢çš„æŒ‰é’®ä¸ºå¤åˆ¶å¯†ç åŠæ˜¾ç¤º/éšè—å¯†ç ã€‚å³ä¸Šè§’çº¢æ¡†å†…åé¢å››ä¸ªæŒ‰é’®åˆ†åˆ«æ˜¯å…³é—­æœåŠ¡å™¨ã€é‡å¯æœåŠ¡å™¨ã€é‡è£…ç³»ç»Ÿã€åˆ é™¤æœåŠ¡å™¨ã€‚ è¿œç¨‹ç™»å½•å®‰è£…è¿œç¨‹ç™»å½•è½¯ä»¶ã€‚è¿™é‡Œä»¥windosç«¯çš„xshellä¸ºä¾‹ã€‚ä½¿ç”¨macçš„åŒå­¦å¯ä»¥ä¸‹è½½iTermã€‚ ä¸‹è½½å®‰è£…åæ‰“å¼€è½¯ä»¶ã€‚æ ¹æ®ä¸‹å›¾ä¸­çš„æŒ‡ç¤ºï¼Œæˆ‘ä»¬ç‚¹å‡»ä¼šè¯æ¡†ä¸­çš„æ–°å»ºæŒ‰é’®ã€‚ ç‚¹å‡»æ–°å»ºæŒ‰é’®åä¼šå¼¹å‡ºä¸‹å›¾æ‰€ç¤ºç•Œé¢ã€‚æ ¹æ®å›¾ä¸­æŒ‡ç¤ºï¼Œæˆ‘ä»¬é¦–å…ˆå¡«å†™IPåœ°å€ï¼Œç„¶åç‚¹å‡»ç¡®å®šæŒ‰é’®ã€‚ ç‚¹å‡»ç¡®å®šæŒ‰é’®åæˆ‘ä»¬ä¼šå›åˆ°ä¸‹å›¾æ‰€ç¤ºç•Œé¢ã€‚æ ¹æ®å›¾ä¸­æŒ‡ç¤ºï¼Œæˆ‘ä»¬åŒå‡»æ‰“å¼€æ–°å»ºä¼šè¯æˆ–è€…ç‚¹å‡»ä¸‹æ–¹è¿æ¥æŒ‰é’®æ‰“å¼€æ–°å»ºä¼šè¯ã€‚ å¼€æ–°å»ºä¼šè¯åä¼šå¼¹å‡ºä¸‹å›¾æ‰€ç¤ºç•Œé¢ã€‚æ ¹æ®å›¾ä¸­æŒ‡ç¤ºï¼Œæˆ‘ä»¬ç‚¹å‡»æ¥å—å¹¶ä¿å­˜æŒ‰é’®ã€‚ ç‚¹å‡»æ¥å—å¹¶ä¿å­˜æŒ‰é’®ä¼šå¼¹å‡ºä¸‹å›¾æ‰€ç¤ºç•Œé¢ã€‚æ ¹æ®å›¾ä¸­æŒ‡ç¤ºï¼Œæˆ‘ä»¬é¦–å…ˆå¡«å†™SSHè¿æ¥å¯†ç ï¼Œç„¶åæ‰“é’©è®°ä½å¯†ç ï¼Œæœ€åç‚¹å‡»ç¡®å®šæŒ‰é’®ã€‚ å¦‚æœæç¤ºéœ€è¦è¾“å…¥ç”¨æˆ·åï¼ˆç™»å½•åï¼‰ï¼Œé‚£ä¹ˆè¯·è¾“å…¥rootï¼ ç‚¹å‡»ç¡®å®šæŒ‰é’®åæœåŠ¡å™¨ä¼šè‡ªåŠ¨è¿æ¥ï¼Œè¿æ¥å®Œæ¯•åæˆ‘ä»¬ä¼šæ¥åˆ°ä¸‹å›¾æ‰€ç¤ºç•Œé¢ éƒ¨ç½²shadowsocksè¿™é‡Œé‡‡ç”¨ç½‘ä¸Šæ•´ç†çš„ä¸€é”®éƒ¨ç½²çš„æ–¹æ¡ˆã€‚ç®€å•æ–¹ä¾¿æ“ä½œã€‚ é¦–å…ˆå¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š 1wget -N --no-check-certificate https://0123.cool/download/55r.sh &amp;&amp; chmod +x 55r.sh &amp;&amp; ./55r.sh ç„¶åå›åˆ°Xshellè½¯ä»¶ï¼Œå³å‡»é€‰æ‹©ç²˜è´´ï¼Œç²˜è´´å®Œæ¯•åå›è½¦ç»§ç»­ã€‚ å›è½¦åç³»ç»Ÿä¼šè‡ªè¡Œä¸‹è½½è„šæœ¬æ–‡ä»¶å¹¶è¿è¡Œã€‚æ ¹æ®ä¸‹å›¾å›¾ä¸­æŒ‡ç¤ºï¼Œæˆ‘ä»¬ä¾æ¬¡è¾“å…¥SSRçš„å„é¡¹è¿æ¥ä¿¡æ¯ï¼Œæœ€åå›è½¦ç»§ç»­ã€‚ å®‰è£…å®Œæˆåä¼šå‡ºç°ä¸‹å›¾æ‰€ç¤ºç•Œé¢ã€‚æ ¹æ®å›¾ä¸­æŒ‡ç¤ºï¼Œæˆ‘ä»¬å°†çº¢æ¡†åœˆä¸­çš„ä¿¡æ¯ä¿å­˜åˆ°è®°äº‹æœ¬å†…ã€‚ é…ç½®é”æ„åŠ é€Ÿæ ¹æ®ä¸‹å›¾å›¾ä¸­æŒ‡ç¤ºï¼Œæˆ‘ä»¬ç»§ç»­å¤åˆ¶ä¸‹åˆ—ä¿¡æ¯ï¼š 1wget -N --no-check-certificate https://0123.cool/download/rs.sh &amp;&amp; bash rs.sh install ç„¶åå›åˆ°Xshellè½¯ä»¶ï¼Œå³å‡»é€‰æ‹©ç²˜è´´ï¼Œç²˜è´´å®Œæ¯•åå›è½¦ç»§ç»­ã€‚ å›è½¦åç³»ç»Ÿä¼šè‡ªè¡Œä¸‹è½½è„šæœ¬æ–‡ä»¶å¹¶è¿è¡Œã€‚æ ¹æ®ä¸‹å›¾å›¾ä¸­æŒ‡ç¤ºï¼Œæˆ‘ä»¬ä¾æ¬¡è¾“å…¥é”é€Ÿçš„å„é¡¹é…ç½®ä¿¡æ¯ï¼Œæœ€åå›è½¦ç»§ç»­ã€‚ å›è½¦åï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤å®Œæˆç ´è§£ç‰ˆé”é€Ÿå®‰è£…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æˆ‘ä»¬é¦–å…ˆè¾“å…¥ï¼š 1reboot ç„¶åå›è½¦ï¼ŒXshellä¼šæ–­å¼€è¿æ¥ï¼Œç³»ç»Ÿä¼šåœ¨1åˆ†é’Ÿåé‡å¯å®Œæ¯•ï¼Œæ­¤æ—¶å¯ä»¥å…³é—­Xshellè½¯ä»¶äº†ã€‚ æ­å»ºæ•™ç¨‹åˆ°æ­¤ç»“æŸï¼Œäº²æµ‹æˆåŠŸã€‚å¦‚æœä¸èƒ½è¿æ¥çš„ï¼Œè¯·æ£€æŸ¥è‡ªå·±çš„æ¯ä¸€æ­¥æ“ä½œã€‚","raw":null,"content":null,"categories":[{"name":"vps","slug":"vps","permalink":"https://stanxia.github.io/categories/vps/"}],"tags":[{"name":"vps","slug":"vps","permalink":"https://stanxia.github.io/tags/vps/"}]},{"title":"sparkæŠ¥é”™é›†","slug":"sparkæŠ¥é”™é›†","date":"2017-10-30T13:58:58.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/10/30/sparkæŠ¥é”™é›†/","link":"","permalink":"https://stanxia.github.io/2017/10/30/sparkæŠ¥é”™é›†/","excerpt":"æœ‰è¯è¦è¯´é’ˆå¯¹ä¸€ä¸ªè€æ¯›ç—…ï¼šæœ‰äº›é”™è¯¯å±¡çŠ¯å±¡æ”¹ï¼Œå±¡æ”¹å±¡çŠ¯ï¼Œæ²¡æœ‰å¼•èµ·æ ¹æœ¬ä¸Šçš„æ³¨æ„ï¼Œæˆ–è€…æ²¡æœ‰ä»æºå¤´ç†è§£é”™è¯¯å‘ç”Ÿçš„åº•å±‚åŸç†ï¼Œå¯¼è‡´åšå¾ˆå¤šæ— ç”¨åŠŸã€‚\næ€»ç»“å†å²ï¼Œå¹¶ä»ä¸­å¸å–æ•™è®­ï¼Œå‡å°‘æ— ç”¨åŠŸé€ æˆçš„æ—¶é—´æµªè´¹ã€‚ç‰¹æ­¤å°†ä»ç›®å‰é‡åˆ°çš„sparké—®é¢˜å…¨éƒ¨è®°å½•åœ¨è¿™é‡Œï¼Œææ¸…æ¥šé—®é¢˜ï¼Œè‡ªä¿¡å‘å‰ã€‚","text":"æœ‰è¯è¦è¯´é’ˆå¯¹ä¸€ä¸ªè€æ¯›ç—…ï¼šæœ‰äº›é”™è¯¯å±¡çŠ¯å±¡æ”¹ï¼Œå±¡æ”¹å±¡çŠ¯ï¼Œæ²¡æœ‰å¼•èµ·æ ¹æœ¬ä¸Šçš„æ³¨æ„ï¼Œæˆ–è€…æ²¡æœ‰ä»æºå¤´ç†è§£é”™è¯¯å‘ç”Ÿçš„åº•å±‚åŸç†ï¼Œå¯¼è‡´åšå¾ˆå¤šæ— ç”¨åŠŸã€‚ æ€»ç»“å†å²ï¼Œå¹¶ä»ä¸­å¸å–æ•™è®­ï¼Œå‡å°‘æ— ç”¨åŠŸé€ æˆçš„æ—¶é—´æµªè´¹ã€‚ç‰¹æ­¤å°†ä»ç›®å‰é‡åˆ°çš„sparké—®é¢˜å…¨éƒ¨è®°å½•åœ¨è¿™é‡Œï¼Œææ¸…æ¥šé—®é¢˜ï¼Œè‡ªä¿¡å‘å‰ã€‚ é—®é¢˜æ±‡æ€»é—®é¢˜1ï¼šspark-hive classes are not foundæ¦‚è¿°ï¼š1Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Unable to instantiate SparkSession with Hive support because Hive classes are not found. åœºæ™¯ï¼šåœ¨æœ¬åœ°è°ƒè¯•sparkç¨‹åºï¼Œè¿æ¥è™šæ‹Ÿæœºä¸Šçš„é›†ç¾¤ï¼Œå°è¯•æ‰§è¡ŒsparkSQLæ—¶ï¼Œå¯åŠ¨ä»»åŠ¡å°±æŠ¥é”™ã€‚ åŸç†ï¼šç¼ºå°‘sparkSQLè¿æ¥hiveçš„å¿…è¦å’Œä¾èµ–jaråŒ…ï¼Œæ·»åŠ ç›¸åº”çš„ä¾èµ–åŒ…å³å¯ã€‚ åŠæ³•ï¼š123456789åœ¨é¡¹ç›®ï¼æ¨¡å—çš„pom.xmlä¸­æ·»åŠ ç›¸å…³çš„spark-hiveä¾èµ–jaråŒ…ã€‚&lt;!-- https://mvnrepository.com/artifact/org.apache.spark/spark-hive_2.11 --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.spark&lt;/groupId&gt; &lt;artifactId&gt;spark-hive_2.11&lt;/artifactId&gt; &lt;version&gt;2.1.1&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;é‡æ–°ç¼–è¯‘é¡¹ç›®ï¼æ¨¡å—å³å¯ã€‚ é—®é¢˜2ï¼šSpark Local æ¨¡å¼å†™ Hiveï¼Œuser=xialinshengæ¦‚è¿°ï¼š1Caused by: org.apache.hadoop.security.AccessControlException: Permission denied: user=xialinsheng, access=WRITE, inode=&quot;/user/hive/warehouse/xls002&quot;:hadoop:supergroup:drwxr-xr-x åœºæ™¯ï¼šSpark Local æ¨¡å¼è¿æ¥é›†ç¾¤ï¼Œå¯¹ Hadoop æ— æ“ä½œæƒé™ã€‚ åŸç†ï¼šSpark åœ¨ Local æ¨¡å¼æ—¶ï¼Œå¦‚æœåœ¨æœ¬åœ°æœºå™¨æ²¡æœ‰è®¾å®š HADOOP_USER_NAME ï¼Œç¨‹åºä¼šä½¿ç”¨æœ¬åœ°çš„æœºå™¨åä½œä¸º HADOOP_USER_NAME ï¼Œè¿™å°±å¯¼è‡´åœ¨ Hadoop é›†ç¾¤ä¸­æ— æ³•è¯†åˆ«è¯¥ç”¨æˆ·åï¼Œä»è€Œæ²¡æƒé™æ“ä½œ Hadoop ã€‚ è·å– HADOOP_USER_NAME çš„æ ¸å¿ƒæºç å¦‚ä¸‹ï¼š 1234567if (!isSecurityEnabled() &amp;&amp; (user == null)) &#123; String envUser = System.getenv(HADOOP_USER_NAME); if (envUser == null) &#123; envUser = System.getProperty(HADOOP_USER_NAME); &#125; user = envUser == null ? null : new User(envUser);&#125; ä»æºç å¯çŸ¥ï¼Œè¦æƒ³è§£å†³è¯¥é—®é¢˜ï¼Œåªè¦åœ¨æœ¬æœºçš„ç¯å¢ƒå˜é‡ä¸­æ·»åŠ  HADOOP_USER_NAME = Hadoop ï¼ˆå¯¹ Hadoop é›†ç¾¤æœ‰æ“ä½œæƒé™çš„ç”¨æˆ·ï¼Œå…·ä½“è§†è‡ªèº«æƒ…å†µè€Œå®šã€‚ï¼‰å‚è€ƒåšå®¢ï¼šç‚¹æˆ‘äº†è§£æ›´å¤š è§£å†³ï¼šå› ä¸ºæˆ‘çš„éœ€æ±‚åªæ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™ä¼šä½¿ç”¨ Local æ¨¡å¼è¿æ¥é›†ç¾¤ä¸Šçš„ Hive è¡¨ï¼Œå› è€Œæˆ‘çš„å¤„ç†æ–¹å¼åˆ™æ˜¯åœ¨ç¨‹åºä»£ç ä¸­æŒ‡å®š ï¼š 1System.setProperty(\"HADOOP_USER_NAME\",\"Hadoopæœ‰æƒé™çš„ç”¨æˆ·å\"); é—®é¢˜3ï¼šjavax.servlet.FilterRegistrationæ¦‚è¿°ï¼šåœ¨ideaä¸Šè¿è¡Œsparkç¨‹åºæ—¶ï¼Œå‡ºç°ä»¥ä¸‹ä¿¡æ¯ï¼š 1Spark error class &quot;javax.servlet.FilterRegistration&quot;&apos;s signer information does not match signer information of other classes in the same package å¦‚å›¾ï¼š åŸç†ï¼šåŒ…å†²çªå¯¼è‡´ã€‚ è§£å†³ï¼šæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š å³é”®æ¨¡å—é¡¹ç›® Open Module Settings é€‰æ‹©Dependencies æ‰¾åˆ° javax.servlet:servlet-api:xx ç§»åŠ¨åˆ°åˆ—è¡¨çš„æœ€æœ«ç«¯ Applyï¼ŒOk å¦‚ä¸‹å›¾ï¼š","raw":null,"content":null,"categories":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/categories/spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://stanxia.github.io/tags/spark/"},{"name":"æŠ¥é”™é›†","slug":"æŠ¥é”™é›†","permalink":"https://stanxia.github.io/tags/æŠ¥é”™é›†/"}]},{"title":"life","slug":"life","date":"2017-10-29T11:00:42.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/10/29/life/","link":"","permalink":"https://stanxia.github.io/2017/10/29/life/","excerpt":"\n\nvar dplayer0 = new DPlayer({\"element\":document.getElementById(\"dplayer0\"),\"autoplay\":0,\"theme\":\"#FADFA3\",\"loop\":1,\"video\":{\"url\":\"http://oliji9s3j.bkt.clouddn.com/Unbroken%20-%20Motivational%20Video.mp4\",\"pic\":\"/images/pic/life.jpeg\"}});\nLife is simple &amp;&amp; funny.","text":"var dplayer0 = new DPlayer({\"element\":document.getElementById(\"dplayer0\"),\"autoplay\":0,\"theme\":\"#FADFA3\",\"loop\":1,\"video\":{\"url\":\"http://oliji9s3j.bkt.clouddn.com/Unbroken%20-%20Motivational%20Video.mp4\",\"pic\":\"/images/pic/life.jpeg\"}}); Life is simple &amp;&amp; funny.","raw":null,"content":null,"categories":[{"name":"movie","slug":"movie","permalink":"https://stanxia.github.io/categories/movie/"}],"tags":[{"name":"movie","slug":"movie","permalink":"https://stanxia.github.io/tags/movie/"}]},{"title":"æ‚ä¹±æ— ç« ","slug":"æ‚ä¹±æ— ç« ","date":"2017-10-29T01:31:31.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/10/29/æ‚ä¹±æ— ç« /","link":"","permalink":"https://stanxia.github.io/2017/10/29/æ‚ä¹±æ— ç« /","excerpt":"æ—¶å…‰çš„æœºå™¨ï¼ŒåŠ è¶³é©¬åŠ›å†²å›è¿‡å»\nå†å²çš„é•¿æ²³ï¼Œä¸ä¸æ¶Ÿæ¼ªæ¶Œå‘æœªæ¥","text":"æ—¶å…‰çš„æœºå™¨ï¼ŒåŠ è¶³é©¬åŠ›å†²å›è¿‡å» å†å²çš„é•¿æ²³ï¼Œä¸ä¸æ¶Ÿæ¼ªæ¶Œå‘æœªæ¥ é“ä¸æ¸…æ¥šï¼Œè¯´ä¸æ˜ç™½ï¼Œå¤œæ·±äººé™çš„æ—¶å€™ï¼Œè¯´ä¸€äº›æƒ³åˆ°çš„åºŸè¯ã€‚çª—å¤–éš†éš†ä½œå“ï¼Œä¸çŸ¥ç–²å€¦çš„æœºå™¨ä¸çŸ¥ç–²å€¦çš„æ‰§è¡Œç€ä¸çŸ¥ç–²å€¦çš„åŠ¨ä½œã€‚çª—å†…å±å¹•æš—æ·¡ï¼ŒåŒçœ¼å¹²æ¶©ï¼Œæ€ç´¢ç€å®‡å®™å¤–çš„å›æƒ³ã€‚ å°æ—¶å€™ï¼Œæœ›å‘æ˜Ÿç©ºï¼Œé‚£æ—¶çš„å¤©ç©ºç¾¤æ˜Ÿé—ªçƒï¼Œå“ªåƒç°åœ¨ï¼Œå˜¿ï¼Œäº«å—äº†å¤§åŸå¸‚çš„éœ“è™¹ï¼Œå“ªé‡Œå†ç»™ä½ æ— å çš„æ˜Ÿç©ºï¼Œè´ªã€‚ èººåœ¨è‰åœ°ï¼Œå¾®é£è½»æ‹‚è„¸é¢Šï¼Œåˆç§‹çš„å¤œæ™šï¼Œæœ‰ç‚¹å¾®å‡‰ã€‚ ä»°æœ›æ˜Ÿæ²³ï¼Œä¹Ÿæƒ³ç€å¤–é¢çš„ä¸–ç•Œï¼Œå¤šç²¾å½©ã€‚ æ£æ‘©ç€æ— å çš„å®‡å®™ï¼Œç¿»è¿‡åœ°çƒï¼Œè¶Šè¿‡é“¶æ²³ï¼Œé©¶å‘æ— é™æ‹“å±•çš„æ˜Ÿé™…ï¼Œèº«ä¸Šçš„çƒ¦æ¼ï¼Œå¾®é£ä¸€å¹ï¼Œå…¨æ•£äº†ã€‚ é£è½»æ‹‚ï¼Œé™é™æœ›ç€å¤©ç©ºï¼Œæ€è€ƒç€å¤–é¢çš„æœ‹å‹æˆ–è®¸ä¹Ÿåœ¨æ¸´æœ›ç€è¿œæ–¹çš„æˆ‘ï¼Œä¼¸æ‰‹è§¦æ‘¸è¿™å¤©ç©ºï¼ŒæŠ“ä¸€æŠŠæ˜Ÿè¾°è´ªå©ªçš„æ”¾å…¥æ¢¦ã€‚ æ·±é‚ƒçš„å¤œç©ºï¼Œæœ›ä¸å°½çš„è¿œæ–¹ï¼Œæ˜¯å…‰æ˜ä¸­çš„æ— å°½é»‘æš—ï¼Œä¹Ÿä¼¼é»‘æš—é“è·¯çš„ä¸€æŸäº®å…‰ï¼Œæ´’å‘æˆ‘ï¼Œæ€ç»ªè·Ÿç€é¨æ¸¸ï¼Œå‘µï¼Œä¸–ç•Œä¸æˆ‘ä¸‡åƒç¾å¥½ï¼Œæˆ‘ä¸ä¸–ç•Œå´å¿µå¿µå¨å¨ï¼Œççç¢ç¢ï¼Œéº»éº»çƒ¦çƒ¦ã€‚å¿ƒé‡Œæ˜¯æƒ³æ”¾é£çš„ã€‚ å¤œæ·±ï¼Œè½¦æ°´å‘¼å•¸ï¼Œè¯‰è¯´ç€åŸå¸‚çš„ä¸çœ ï¼Œå¯æˆ‘å›°ï¼Œå…³çª—ï¼Œé—·ã€‚å¼€çª—ï¼Œå˜¿ï¼Œä¸çŸ¥ç–²å€¦çš„æœºå™¨åˆå¼€å§‹ä¸çŸ¥ç–²å€¦çš„æ‰§è¡Œä¸çŸ¥ç–²å€¦çš„åŠ¨ä½œã€‚è¿™æ ·çš„å¤œæ™šï¼Œçœ éš¾ã€‚ æ·±å¤œæ€è€ƒï¼Œå†™ä½œã€‚å¤œä½¿æˆ‘å®é™ï¼Œå†…å¿ƒçš„å®é™ï¼Œè¿™ç™½å¤©çš„å¤§åŸå¸‚ç»™äºˆä¸äº†ã€‚æ„Ÿè°¢å¤œçš„é¦ˆèµ ï¼Œæ¥æ”¶è¿™æ— ä¸Šçš„åŠ å†•ï¼Œé©°éª‹åœ¨æ€ç»ªçš„æ˜Ÿç©ºï¼Œç—›å¿«ï¼Œç²¾å½©ï¼Œç²¾å½©ã€‚ æ‚ä¹±æ— ç« ï¼Œå‘µï¼Œå¯ä»¥ã€‚","raw":null,"content":null,"categories":[{"name":"think","slug":"think","permalink":"https://stanxia.github.io/categories/think/"}],"tags":[{"name":"think","slug":"think","permalink":"https://stanxia.github.io/tags/think/"}]},{"title":"é—²è°ˆ","slug":"é—²è°ˆ","date":"2017-10-28T11:07:14.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/10/28/é—²è°ˆ/","link":"","permalink":"https://stanxia.github.io/2017/10/28/é—²è°ˆ/","excerpt":"æ˜¥å›å¤§åœ°","text":"æ˜¥å›å¤§åœ°","raw":null,"content":null,"categories":[{"name":"think","slug":"think","permalink":"https://stanxia.github.io/categories/think/"}],"tags":[{"name":"think","slug":"think","permalink":"https://stanxia.github.io/tags/think/"}]},{"title":"è¿™ä¸ªæ€æ‰‹ä¸å¤ªå†·","slug":"è¿™ä¸ªæ€æ‰‹ä¸å¤ªå†·","date":"2017-10-28T01:18:04.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/10/28/è¿™ä¸ªæ€æ‰‹ä¸å¤ªå†·/","link":"","permalink":"https://stanxia.github.io/2017/10/28/è¿™ä¸ªæ€æ‰‹ä¸å¤ªå†·/","excerpt":"Is life always this hard,or is it just when youâ€™re a kid?Always like this.\n","text":"Is life always this hard,or is it just when youâ€™re a kid?Always like this.","raw":null,"content":null,"categories":[{"name":"movie","slug":"movie","permalink":"https://stanxia.github.io/categories/movie/"}],"tags":[{"name":"movie","slug":"movie","permalink":"https://stanxia.github.io/tags/movie/"}]},{"title":"macä½¿ç”¨å°æŠ€å·§","slug":"macä½¿ç”¨å°æŠ€å·§","date":"2017-10-28T01:13:44.000Z","updated":"2020-02-12T09:15:00.097Z","comments":true,"path":"2017/10/28/macä½¿ç”¨å°æŠ€å·§/","link":"","permalink":"https://stanxia.github.io/2017/10/28/macä½¿ç”¨å°æŠ€å·§/","excerpt":"å‰è¨€\nè®°å½•macä½¿ç”¨çš„å°æŠ€å·§å’Œä¸€äº›é—®é¢˜ã€‚ä¸å®šæœŸæ›´æ–°ingæ–‡ä»¶æŸåçš„è§£å†³åŠæ³•åœ¨å®‰è£…ä¸€äº›ç½‘ä¸Šä¸‹è½½çš„åº”ç”¨æ—¶ï¼Œå¦‚æœæŠ¥é”™æ˜¾ç¤ºï¼šæ–‡ä»¶å·²ç»æŸåï¼Œè¯·ç§»è‡³åºŸçº¸ç¯“ã€‚è¯·ä¸è¦æƒŠæ…Œï¼Œå…¶å®åˆ«ä¸æ˜¯æ–‡ä»¶çœŸçš„æŸåäº†ï¼Œæ ¹æœ¬åŸå› æ˜¯ mac ç³»ç»Ÿçš„å®‰å…¨éªŒè¯æœºåˆ¶ï¼Œé»˜è®¤æ˜¯ä¸å…è®¸æŸäº›åº”ç”¨çš„å®‰è£…ã€‚è¦æƒ³é¿å¼€è¯¥å®‰å…¨è®¤è¯ï¼Œå…¶å®æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š\nç¬¬ä¸€æ­¥ï¼šæ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®ä¸­çš„ å®‰å…¨æ€§ä¸éšç§ ï¼Œè§£å¼€é”ï¼Œé€‰æ‹© ä»»ä½•æ¥æº ï¼Œå®Œæˆã€‚\nç¬¬äºŒæ­¥ï¼šåœ¨è¿™é‡Œå…³é”®æ˜¯å¾ˆå¤šæœ‹å‹æ²¡æ‰¾åˆ°è¿™ä¸ª ä»»ä½•æ¥æº ï¼Œä¸è¦ç€æ€¥ï¼Œå’±ä»¬æ¥ç€å¾€æ¥ä¸‹ï¼Œæ‰“å¼€ ç»ˆç«¯ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š\n12cd ~sudo spctl --master-disable\næˆåŠŸè¾“å…¥ä»¥ä¸Šå‘½ä»¤ï¼Œå†å»æ‰§è¡Œç¬¬ä¸€æ­¥æ“ä½œï¼Œå®Œæˆï¼Œç°åœ¨å¯ä»¥å»å¼€å¿ƒçš„å®‰è£…åº”ç”¨äº†ã€‚","text":"å‰è¨€ è®°å½•macä½¿ç”¨çš„å°æŠ€å·§å’Œä¸€äº›é—®é¢˜ã€‚ä¸å®šæœŸæ›´æ–°ingæ–‡ä»¶æŸåçš„è§£å†³åŠæ³•åœ¨å®‰è£…ä¸€äº›ç½‘ä¸Šä¸‹è½½çš„åº”ç”¨æ—¶ï¼Œå¦‚æœæŠ¥é”™æ˜¾ç¤ºï¼šæ–‡ä»¶å·²ç»æŸåï¼Œè¯·ç§»è‡³åºŸçº¸ç¯“ã€‚è¯·ä¸è¦æƒŠæ…Œï¼Œå…¶å®åˆ«ä¸æ˜¯æ–‡ä»¶çœŸçš„æŸåäº†ï¼Œæ ¹æœ¬åŸå› æ˜¯ mac ç³»ç»Ÿçš„å®‰å…¨éªŒè¯æœºåˆ¶ï¼Œé»˜è®¤æ˜¯ä¸å…è®¸æŸäº›åº”ç”¨çš„å®‰è£…ã€‚è¦æƒ³é¿å¼€è¯¥å®‰å…¨è®¤è¯ï¼Œå…¶å®æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®ä¸­çš„ å®‰å…¨æ€§ä¸éšç§ ï¼Œè§£å¼€é”ï¼Œé€‰æ‹© ä»»ä½•æ¥æº ï¼Œå®Œæˆã€‚ ç¬¬äºŒæ­¥ï¼šåœ¨è¿™é‡Œå…³é”®æ˜¯å¾ˆå¤šæœ‹å‹æ²¡æ‰¾åˆ°è¿™ä¸ª ä»»ä½•æ¥æº ï¼Œä¸è¦ç€æ€¥ï¼Œå’±ä»¬æ¥ç€å¾€æ¥ä¸‹ï¼Œæ‰“å¼€ ç»ˆç«¯ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š 12cd ~sudo spctl --master-disable æˆåŠŸè¾“å…¥ä»¥ä¸Šå‘½ä»¤ï¼Œå†å»æ‰§è¡Œç¬¬ä¸€æ­¥æ“ä½œï¼Œå®Œæˆï¼Œç°åœ¨å¯ä»¥å»å¼€å¿ƒçš„å®‰è£…åº”ç”¨äº†ã€‚ç»ˆç«¯ command not found é—®é¢˜åœ¨åˆæ¬¡ä½¿ç”¨ mac ç»ˆç«¯çš„æ—¶å€™ï¼Œç»ˆç«¯é™¤äº†èƒ½æ‰§è¡Œ cd å‘½ä»¤ï¼Œå…¶ä½™çš„è²Œä¼¼éƒ½ä¸å¾—è¡Œï¼Œä¼šæŠ¥ command not found çš„é—®é¢˜ï¼Œä¸‹é¢ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚ åŸå› ï¼šå‡ºç°è¯¥é—®é¢˜çš„åŸå› æ˜¯æ²¡æœ‰å°†è¿™äº›å‘½ä»¤æ·»åŠ è¿›ç¯å¢ƒå˜é‡ä¸­ï¼Œå¯¼è‡´ç³»ç»Ÿæ— æ³•è¯†åˆ«ã€‚ ç¬¬ä¸€æ­¥ï¼šå…ˆè®¾ç½®ä¸´æ—¶çš„ç¯å¢ƒå˜é‡ï¼Œä»¥ä½¿æˆ‘ä»¬èƒ½ç»§ç»­è¿›è¡Œä¸‹é¢çš„æ“ä½œã€‚ 1export PATH=/usr/bin:/usr/sbin:/bin:/sbin ç¬¬äºŒæ­¥ï¼šè¿›å…¥åˆ°ç”¨æˆ·çš„ç›®å½•ï¼Œå¹¶æ‰“å¼€å­˜å‚¨ç¯å¢ƒå˜é‡çš„æ–‡ä»¶ .bash_profile , vi æ˜¯æ“ä½œæ–‡ä»¶çš„åˆ©å™¨ï¼Œå¦‚æœæ²¡æœ‰æ–‡ä»¶ä¼šæ–°å»ºæ–‡ä»¶ã€‚ 12cd ~vi .bash_profile ç¬¬ä¸‰æ­¥ï¼šåœ¨æ‰“å¼€çš„æ–‡ä»¶é¡µé¢ï¼Œè¾“å…¥ i æ‰§è¡Œç¼–è¾‘æ“ä½œï¼Œå¯çœ‹åˆ°é¡µé¢çš„å·¦ä¸‹è§’æœ‰ä¸ª insert çš„å­—æ ·å³å¯ï¼Œç„¶åæ·»åŠ ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼š 1export PATH=/usr/bin:/usr/sbin:/bin:/sbin æ·»åŠ å®Œä»¥ä¸Šä¿¡æ¯ä¹‹åï¼ŒæŒ‰ esc é”®é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œç„¶åè¾“å…¥ :wq ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘é¡µé¢ã€‚ ç¬¬å››æ­¥ï¼šä½¿åˆšæ‰ç¼–è¾‘çš„ç¯å¢ƒå˜é‡æ–‡ä»¶ç”Ÿæ•ˆã€‚ source å‘½ä»¤å³å¯ã€‚ 1source .bash_profile å®Œæˆä¹‹ååˆ™å¯ä»¥é‡å¯ ç»ˆç«¯ ï¼Œå¹¶æ‰§è¡Œå¦‚ ls ç­‰ Linux æ“ä½œï¼ŒéªŒè¯æ˜¯å¦æˆåŠŸã€‚å¼€å¯å……ç”µæç¤ºéŸ³ï¼ˆç±»ä¼¼äºiphoneå……ç”µæç¤ºéŸ³ï¼Œé»˜è®¤å…³é—­ï¼‰ç»ˆç«¯è¾“å…¥ï¼ˆå¼€å¯ï¼‰ï¼š 1defaults write com.apple.PowerChime ChimeOnAllHardware -bool true; open /System/Library/CoreServices/PowerChime.app &amp; å…³é—­ï¼š 1defaults write com.apple.PowerChime ChimeOnAllHardware -bool false;killall PowerChime éšè—æ–‡ä»¶å¤¹ æ›´å¥½çš„ä¿æŠ¤å­¦ä¹ èµ„æ–™ï¼Œæœ‰æ—¶å€™éœ€è¦è®¾ç½®éšè—æ–‡ä»¶å¤¹ï¼š 1mv foldername .foldername æŸ¥çœ‹éšè—æ–‡ä»¶å¤¹ macæœ€æ–°ç‰ˆæœ¬ï¼š 1âŒ˜â‡§.(Command + Shift + .) #éšè— å’Œæ˜¾ç¤º Macbook Pro ç”¨å¤–æ¥æ˜¾ç¤ºå™¨æ—¶ï¼Œå¦‚ä½•å…³é—­ç¬”è®°æœ¬å±å¹•ï¼ŒåŒæ—¶å¼€ç›–ä½¿ç”¨ 12sudo nvram boot-args=\"iog=0x0\" #(10.10ä»¥å‰ç‰ˆæœ¬)sudo nvram boot-args=\"niog=1\" #(10.10åŠä»¥åç‰ˆæœ¬)è¿™ä¸ªå‘½ä»¤çš„æ„æ€å°±æ˜¯å¤–æ¥æ˜¾ç¤ºå™¨æ—¶å…³é—­è‡ªèº«å±å¹•ï¼Œé‡å¯ç”Ÿæ•ˆ å¼€æœºæµç¨‹ï¼šè¿ä¸Šç”µæºå’Œå¤–æ¥æ˜¾ç¤ºå™¨ï¼ŒæŒ‰å¼€æœºé”®ï¼Œç«‹å³åˆç›–ï¼Œç­‰å¤–æ¥æ˜¾ç¤ºå™¨æœ‰ä¿¡å·æ—¶å¼€ç›–å³å¯å¦‚æœæŠ¥é”™ (å·²çŸ¥ 10.11/10.12 ä¼šæŠ¥é”™)nvram: Error setting variable - â€˜boot-argsâ€™: (iokit/common) general error é‡å¯ï¼ŒæŒ‰ä½command + r è¿›å…¥æ¢å¤ç•Œé¢ å·¦ä¸Šè§’èœå•é‡Œé¢æ‰¾åˆ°ç»ˆç«¯ï¼Œè¾“å…¥nvram boot-args=â€niog=1â€ï¼Œå›è½¦é—®é¢˜è§£å†³ã€‚é‡å¯ç”Ÿæ•ˆ","raw":null,"content":null,"categories":[{"name":"mac","slug":"mac","permalink":"https://stanxia.github.io/categories/mac/"}],"tags":[{"name":"mac","slug":"mac","permalink":"https://stanxia.github.io/tags/mac/"}]}]}